{"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _apolloServerExpress = require(\"apollo-server-express\");\n\nvar _graphql = _interopRequireDefault(require(\"./graphql\"));\n\nvar _validateToken = _interopRequireDefault(require(\"./middlewares/auth/validate-token\"));\n\nrequire(\"./config/mongodb-config\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst client = require(\"./config/redis-config\");\n\n_dotenv.default.config();\n\nconst app = (0, _express.default)();\n\nasync function startApolloServer() {\n  const server = new _apolloServerExpress.ApolloServer({\n    schema: _graphql.default,\n    playground: true,\n    introspection: true,\n    tracing: true,\n    path: \"/\",\n    context: ({\n      req\n    }) => {\n      return {\n        user: req.headers.user,\n        headers: req.headers,\n        phoneVerification: req.headers.phoneverification || \"\",\n        // context: { client },\n        accessToken: req.headers.authorization || \"\"\n      };\n    }\n  });\n  app.use(_validateToken.default);\n  await server.start();\n  server.applyMiddleware({\n    app,\n    path: \"/\",\n    cors: \"no-cors\"\n  });\n  app.listen({\n    port: process.env.PORT\n  }, () => {\n    console.log(`ðŸš€ Server listening on port ${process.env.PORT}`);\n  });\n}\n\nstartApolloServer().then(() => {\n  console.log(\"Apollo server started\");\n}).catch(err => {\n  console.log(`ðŸš€ Server Error: ${err.message}`);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImNsaWVudCIsInJlcXVpcmUiLCJkb3RlbnYiLCJjb25maWciLCJhcHAiLCJzdGFydEFwb2xsb1NlcnZlciIsInNlcnZlciIsIkFwb2xsb1NlcnZlciIsInNjaGVtYSIsInBsYXlncm91bmQiLCJpbnRyb3NwZWN0aW9uIiwidHJhY2luZyIsInBhdGgiLCJjb250ZXh0IiwicmVxIiwidXNlciIsImhlYWRlcnMiLCJwaG9uZVZlcmlmaWNhdGlvbiIsInBob25ldmVyaWZpY2F0aW9uIiwiYWNjZXNzVG9rZW4iLCJhdXRob3JpemF0aW9uIiwidXNlIiwidmFsaWRhdGVUb2tlbiIsInN0YXJ0IiwiYXBwbHlNaWRkbGV3YXJlIiwiY29ycyIsImxpc3RlbiIsInBvcnQiLCJwcm9jZXNzIiwiZW52IiwiUE9SVCIsImNvbnNvbGUiLCJsb2ciLCJ0aGVuIiwiY2F0Y2giLCJlcnIiLCJtZXNzYWdlIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsdUJBQUQsQ0FBdEI7O0FBRUFDLGdCQUFPQyxNQUFQOztBQUNBLE1BQU1DLEdBQUcsR0FBRyx1QkFBWjs7QUFFQSxlQUFlQyxpQkFBZixHQUFtQztBQUMvQixRQUFNQyxNQUFNLEdBQUcsSUFBSUMsaUNBQUosQ0FBaUI7QUFDNUJDLElBQUFBLE1BQU0sRUFBTkEsZ0JBRDRCO0FBRTVCQyxJQUFBQSxVQUFVLEVBQUUsSUFGZ0I7QUFHNUJDLElBQUFBLGFBQWEsRUFBRSxJQUhhO0FBSTVCQyxJQUFBQSxPQUFPLEVBQUUsSUFKbUI7QUFLNUJDLElBQUFBLElBQUksRUFBRSxHQUxzQjtBQU01QkMsSUFBQUEsT0FBTyxFQUFFLENBQUM7QUFBQ0MsTUFBQUE7QUFBRCxLQUFELEtBQVc7QUFDaEIsYUFBTztBQUNIQyxRQUFBQSxJQUFJLEVBQUVELEdBQUcsQ0FBQ0UsT0FBSixDQUFZRCxJQURmO0FBRUhDLFFBQUFBLE9BQU8sRUFBRUYsR0FBRyxDQUFDRSxPQUZWO0FBR0hDLFFBQUFBLGlCQUFpQixFQUFFSCxHQUFHLENBQUNFLE9BQUosQ0FBWUUsaUJBQVosSUFBaUMsRUFIakQ7QUFJSDtBQUNBQyxRQUFBQSxXQUFXLEVBQUVMLEdBQUcsQ0FBQ0UsT0FBSixDQUFZSSxhQUFaLElBQTZCO0FBTHZDLE9BQVA7QUFPSDtBQWQyQixHQUFqQixDQUFmO0FBaUJBaEIsRUFBQUEsR0FBRyxDQUFDaUIsR0FBSixDQUFRQyxzQkFBUjtBQUVBLFFBQU1oQixNQUFNLENBQUNpQixLQUFQLEVBQU47QUFFQWpCLEVBQUFBLE1BQU0sQ0FBQ2tCLGVBQVAsQ0FBdUI7QUFDbkJwQixJQUFBQSxHQURtQjtBQUVuQlEsSUFBQUEsSUFBSSxFQUFFLEdBRmE7QUFHbkJhLElBQUFBLElBQUksRUFBRTtBQUhhLEdBQXZCO0FBTUFyQixFQUFBQSxHQUFHLENBQUNzQixNQUFKLENBQVc7QUFBQ0MsSUFBQUEsSUFBSSxFQUFFQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUM7QUFBbkIsR0FBWCxFQUFxQyxNQUFNO0FBQ3ZDQyxJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBYSwrQkFBOEJKLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxJQUFLLEVBQTVEO0FBQ0gsR0FGRDtBQUdIOztBQUVEekIsaUJBQWlCLEdBQUc0QixJQUFwQixDQUF5QixNQUFNO0FBQzNCRixFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSx1QkFBWjtBQUNILENBRkQsRUFFR0UsS0FGSCxDQUVVQyxHQUFELElBQVM7QUFDZEosRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQWEsb0JBQW1CRyxHQUFHLENBQUNDLE9BQVEsRUFBNUM7QUFDSCxDQUpEIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZG90ZW52IGZyb20gXCJkb3RlbnZcIjtcclxuaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcclxuaW1wb3J0IHtBcG9sbG9TZXJ2ZXJ9IGZyb20gXCJhcG9sbG8tc2VydmVyLWV4cHJlc3NcIjtcclxuaW1wb3J0IHNjaGVtYSBmcm9tIFwiLi9ncmFwaHFsXCI7XHJcbmltcG9ydCB2YWxpZGF0ZVRva2VuIGZyb20gXCIuL21pZGRsZXdhcmVzL2F1dGgvdmFsaWRhdGUtdG9rZW5cIjtcclxuaW1wb3J0IFwiLi9jb25maWcvbW9uZ29kYi1jb25maWdcIjtcclxuXHJcbmNvbnN0IGNsaWVudCA9IHJlcXVpcmUoXCIuL2NvbmZpZy9yZWRpcy1jb25maWdcIik7XHJcblxyXG5kb3RlbnYuY29uZmlnKCk7XHJcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0QXBvbGxvU2VydmVyKCkge1xyXG4gICAgY29uc3Qgc2VydmVyID0gbmV3IEFwb2xsb1NlcnZlcih7XHJcbiAgICAgICAgc2NoZW1hLFxyXG4gICAgICAgIHBsYXlncm91bmQ6IHRydWUsXHJcbiAgICAgICAgaW50cm9zcGVjdGlvbjogdHJ1ZSxcclxuICAgICAgICB0cmFjaW5nOiB0cnVlLFxyXG4gICAgICAgIHBhdGg6IFwiL1wiLFxyXG4gICAgICAgIGNvbnRleHQ6ICh7cmVxfSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgdXNlcjogcmVxLmhlYWRlcnMudXNlcixcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHJlcS5oZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgcGhvbmVWZXJpZmljYXRpb246IHJlcS5oZWFkZXJzLnBob25ldmVyaWZpY2F0aW9uIHx8IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAvLyBjb250ZXh0OiB7IGNsaWVudCB9LFxyXG4gICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24gfHwgXCJcIlxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICBhcHAudXNlKHZhbGlkYXRlVG9rZW4pXHJcblxyXG4gICAgYXdhaXQgc2VydmVyLnN0YXJ0KCk7XHJcblxyXG4gICAgc2VydmVyLmFwcGx5TWlkZGxld2FyZSh7XHJcbiAgICAgICAgYXBwLFxyXG4gICAgICAgIHBhdGg6IFwiL1wiLFxyXG4gICAgICAgIGNvcnM6IFwibm8tY29yc1wiLFxyXG4gICAgfSk7XHJcblxyXG4gICAgYXBwLmxpc3Rlbih7cG9ydDogcHJvY2Vzcy5lbnYuUE9SVH0sICgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhg8J+agCBTZXJ2ZXIgbGlzdGVuaW5nIG9uIHBvcnQgJHtwcm9jZXNzLmVudi5QT1JUfWApO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbnN0YXJ0QXBvbGxvU2VydmVyKCkudGhlbigoKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkFwb2xsbyBzZXJ2ZXIgc3RhcnRlZFwiKTtcclxufSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coYPCfmoAgU2VydmVyIEVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xyXG59KSJdfQ==","map":{"version":3,"sources":["index.js"],"names":["client","require","dotenv","config","app","startApolloServer","server","ApolloServer","schema","playground","introspection","tracing","path","context","req","user","headers","phoneVerification","phoneverification","accessToken","authorization","use","validateToken","start","applyMiddleware","cors","listen","port","process","env","PORT","console","log","then","catch","err","message"],"mappings":";;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,MAAM,GAAGC,OAAO,CAAC,uBAAD,CAAtB;;AAEAC,gBAAOC,MAAP;;AACA,MAAMC,GAAG,GAAG,uBAAZ;;AAEA,eAAeC,iBAAf,GAAmC;AAC/B,QAAMC,MAAM,GAAG,IAAIC,iCAAJ,CAAiB;AAC5BC,IAAAA,MAAM,EAANA,gBAD4B;AAE5BC,IAAAA,UAAU,EAAE,IAFgB;AAG5BC,IAAAA,aAAa,EAAE,IAHa;AAI5BC,IAAAA,OAAO,EAAE,IAJmB;AAK5BC,IAAAA,IAAI,EAAE,GALsB;AAM5BC,IAAAA,OAAO,EAAE,CAAC;AAACC,MAAAA;AAAD,KAAD,KAAW;AAChB,aAAO;AACHC,QAAAA,IAAI,EAAED,GAAG,CAACE,OAAJ,CAAYD,IADf;AAEHC,QAAAA,OAAO,EAAEF,GAAG,CAACE,OAFV;AAGHC,QAAAA,iBAAiB,EAAEH,GAAG,CAACE,OAAJ,CAAYE,iBAAZ,IAAiC,EAHjD;AAIH;AACAC,QAAAA,WAAW,EAAEL,GAAG,CAACE,OAAJ,CAAYI,aAAZ,IAA6B;AALvC,OAAP;AAOH;AAd2B,GAAjB,CAAf;AAiBAhB,EAAAA,GAAG,CAACiB,GAAJ,CAAQC,sBAAR;AAEA,QAAMhB,MAAM,CAACiB,KAAP,EAAN;AAEAjB,EAAAA,MAAM,CAACkB,eAAP,CAAuB;AACnBpB,IAAAA,GADmB;AAEnBQ,IAAAA,IAAI,EAAE,GAFa;AAGnBa,IAAAA,IAAI,EAAE;AAHa,GAAvB;AAMArB,EAAAA,GAAG,CAACsB,MAAJ,CAAW;AAACC,IAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYC;AAAnB,GAAX,EAAqC,MAAM;AACvCC,IAAAA,OAAO,CAACC,GAAR,CAAa,+BAA8BJ,OAAO,CAACC,GAAR,CAAYC,IAAK,EAA5D;AACH,GAFD;AAGH;;AAEDzB,iBAAiB,GAAG4B,IAApB,CAAyB,MAAM;AAC3BF,EAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACH,CAFD,EAEGE,KAFH,CAEUC,GAAD,IAAS;AACdJ,EAAAA,OAAO,CAACC,GAAR,CAAa,oBAAmBG,GAAG,CAACC,OAAQ,EAA5C;AACH,CAJD","sourceRoot":"E:\\haleta-new-api\\src\\","sourcesContent":["import dotenv from \"dotenv\";\r\nimport express from \"express\";\r\nimport {ApolloServer} from \"apollo-server-express\";\r\nimport schema from \"./graphql\";\r\nimport validateToken from \"./middlewares/auth/validate-token\";\r\nimport \"./config/mongodb-config\";\r\n\r\nconst client = require(\"./config/redis-config\");\r\n\r\ndotenv.config();\r\nconst app = express();\r\n\r\nasync function startApolloServer() {\r\n    const server = new ApolloServer({\r\n        schema,\r\n        playground: true,\r\n        introspection: true,\r\n        tracing: true,\r\n        path: \"/\",\r\n        context: ({req}) => {\r\n            return {\r\n                user: req.headers.user,\r\n                headers: req.headers,\r\n                phoneVerification: req.headers.phoneverification || \"\",\r\n                // context: { client },\r\n                accessToken: req.headers.authorization || \"\"\r\n            };\r\n        },\r\n    });\r\n\r\n    app.use(validateToken)\r\n\r\n    await server.start();\r\n\r\n    server.applyMiddleware({\r\n        app,\r\n        path: \"/\",\r\n        cors: \"no-cors\",\r\n    });\r\n\r\n    app.listen({port: process.env.PORT}, () => {\r\n        console.log(`ðŸš€ Server listening on port ${process.env.PORT}`);\r\n    });\r\n}\r\n\r\nstartApolloServer().then(() => {\r\n    console.log(\"Apollo server started\");\r\n}).catch((err) => {\r\n    console.log(`ðŸš€ Server Error: ${err.message}`);\r\n})"]}},"mtime":1648763898292},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _graphqlCompose = require(\"graphql-compose\");\n\nvar _auth = require(\"./auth\");\n\nvar _user = require(\"./user\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst schemaComposer = new _graphqlCompose.SchemaComposer();\nschemaComposer.Query.addFields(_objectSpread({}, _user.UserQuery));\nschemaComposer.Mutation.addFields(_objectSpread(_objectSpread({}, _auth.AuthMutation), _user.UserMutation));\nconst schema = schemaComposer.buildSchema();\nvar _default = schema;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInNjaGVtYUNvbXBvc2VyIiwiU2NoZW1hQ29tcG9zZXIiLCJRdWVyeSIsImFkZEZpZWxkcyIsIlVzZXJRdWVyeSIsIk11dGF0aW9uIiwiQXV0aE11dGF0aW9uIiwiVXNlck11dGF0aW9uIiwic2NoZW1hIiwiYnVpbGRTY2hlbWEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFFQSxNQUFNQSxjQUFjLEdBQUcsSUFBSUMsOEJBQUosRUFBdkI7QUFFQUQsY0FBYyxDQUFDRSxLQUFmLENBQXFCQyxTQUFyQixtQkFDT0MsZUFEUDtBQUlBSixjQUFjLENBQUNLLFFBQWYsQ0FBd0JGLFNBQXhCLGlDQUNPRyxrQkFEUCxHQUVPQyxrQkFGUDtBQUtBLE1BQU1DLE1BQU0sR0FBR1IsY0FBYyxDQUFDUyxXQUFmLEVBQWY7ZUFDZUQsTSIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtTY2hlbWFDb21wb3Nlcn0gZnJvbSBcImdyYXBocWwtY29tcG9zZVwiO1xyXG5pbXBvcnQge0F1dGhNdXRhdGlvbn0gZnJvbSBcIi4vYXV0aFwiO1xyXG5pbXBvcnQge1VzZXJNdXRhdGlvbiwgVXNlclF1ZXJ5fSBmcm9tIFwiLi91c2VyXCI7XHJcblxyXG5jb25zdCBzY2hlbWFDb21wb3NlciA9IG5ldyBTY2hlbWFDb21wb3NlcigpO1xyXG5cclxuc2NoZW1hQ29tcG9zZXIuUXVlcnkuYWRkRmllbGRzKHtcclxuICAgIC4uLlVzZXJRdWVyeSxcclxufSk7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5NdXRhdGlvbi5hZGRGaWVsZHMoe1xyXG4gICAgLi4uQXV0aE11dGF0aW9uLFxyXG4gICAgLi4uVXNlck11dGF0aW9uLFxyXG59KTtcclxuXHJcbmNvbnN0IHNjaGVtYSA9IHNjaGVtYUNvbXBvc2VyLmJ1aWxkU2NoZW1hKCk7XHJcbmV4cG9ydCBkZWZhdWx0IHNjaGVtYTtcclxuIl19","map":{"version":3,"sources":["index.js"],"names":["schemaComposer","SchemaComposer","Query","addFields","UserQuery","Mutation","AuthMutation","UserMutation","schema","buildSchema"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,cAAc,GAAG,IAAIC,8BAAJ,EAAvB;AAEAD,cAAc,CAACE,KAAf,CAAqBC,SAArB,mBACOC,eADP;AAIAJ,cAAc,CAACK,QAAf,CAAwBF,SAAxB,iCACOG,kBADP,GAEOC,kBAFP;AAKA,MAAMC,MAAM,GAAGR,cAAc,CAACS,WAAf,EAAf;eACeD,M","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\","sourcesContent":["import {SchemaComposer} from \"graphql-compose\";\r\nimport {AuthMutation} from \"./auth\";\r\nimport {UserMutation, UserQuery} from \"./user\";\r\n\r\nconst schemaComposer = new SchemaComposer();\r\n\r\nschemaComposer.Query.addFields({\r\n    ...UserQuery,\r\n});\r\n\r\nschemaComposer.Mutation.addFields({\r\n    ...AuthMutation,\r\n    ...UserMutation,\r\n});\r\n\r\nconst schema = schemaComposer.buildSchema();\r\nexport default schema;\r\n"]}},"mtime":1648684433887},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuthMutation = void 0;\n\nvar _user = require(\"../../models/user\");\n\nvar _middlewares = require(\"../../middlewares\");\n\nvar _authResolvers = _interopRequireDefault(require(\"./resolvers/auth-resolvers\"));\n\nrequire(\"./typedefs/types\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfor (const resolver in _authResolvers.default) {\n  _user.UserTC.addResolver(_authResolvers.default[resolver]);\n}\n\nconst AuthMutation = {\n  signIn: _user.UserTC.getResolver(\"signIn\", [_middlewares.authentication.isGuest, _middlewares.userValidator.signIn]),\n  signUp: _user.UserTC.getResolver(\"signUp\", [_middlewares.authentication.isGuest, _middlewares.userValidator.signUp]),\n  logout: _user.UserTC.getResolver('logout', [_middlewares.authentication.isAuth]),\n  // resetPassword: UserTC.getResolver(\"resetPassword\", [middleware.isGuest, validators.resetPassword]),\n  // newPassword: UserTC.getResolver(\"newPassword\", [middleware.isGuest, validators.newPassword]),\n  changePassword: _user.UserTC.getResolver(\"changePassword\", [_middlewares.authentication.isAuth, _middlewares.userValidator.changePassword])\n};\nexports.AuthMutation = AuthMutation;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInJlc29sdmVyIiwiUmVzb2x2ZXJzIiwiVXNlclRDIiwiYWRkUmVzb2x2ZXIiLCJBdXRoTXV0YXRpb24iLCJzaWduSW4iLCJnZXRSZXNvbHZlciIsImF1dGhlbnRpY2F0aW9uIiwiaXNHdWVzdCIsInVzZXJWYWxpZGF0b3IiLCJzaWduVXAiLCJsb2dvdXQiLCJpc0F1dGgiLCJjaGFuZ2VQYXNzd29yZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOztBQUVBOztBQUVBOzs7O0FBRUEsS0FBSyxNQUFNQSxRQUFYLElBQXVCQyxzQkFBdkIsRUFBa0M7QUFDOUJDLGVBQU9DLFdBQVAsQ0FBbUJGLHVCQUFVRCxRQUFWLENBQW5CO0FBQ0g7O0FBRUQsTUFBTUksWUFBWSxHQUFHO0FBQ2pCQyxFQUFBQSxNQUFNLEVBQUVILGFBQU9JLFdBQVAsQ0FBbUIsUUFBbkIsRUFBNkIsQ0FBQ0MsNEJBQWVDLE9BQWhCLEVBQXlCQywyQkFBY0osTUFBdkMsQ0FBN0IsQ0FEUztBQUVqQkssRUFBQUEsTUFBTSxFQUFFUixhQUFPSSxXQUFQLENBQW1CLFFBQW5CLEVBQTZCLENBQUNDLDRCQUFlQyxPQUFoQixFQUF5QkMsMkJBQWNDLE1BQXZDLENBQTdCLENBRlM7QUFHakJDLEVBQUFBLE1BQU0sRUFBRVQsYUFBT0ksV0FBUCxDQUFtQixRQUFuQixFQUE2QixDQUFDQyw0QkFBZUssTUFBaEIsQ0FBN0IsQ0FIUztBQUlqQjtBQUNBO0FBQ0FDLEVBQUFBLGNBQWMsRUFBRVgsYUFBT0ksV0FBUCxDQUFtQixnQkFBbkIsRUFBcUMsQ0FBQ0MsNEJBQWVLLE1BQWhCLEVBQXdCSCwyQkFBY0ksY0FBdEMsQ0FBckM7QUFOQyxDQUFyQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtVc2VyVEN9IGZyb20gXCIuLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5cclxuaW1wb3J0IHsgYXV0aGVudGljYXRpb24sIHVzZXJWYWxpZGF0b3IgfSBmcm9tIFwiLi4vLi4vbWlkZGxld2FyZXNcIjtcclxuXHJcbmltcG9ydCBSZXNvbHZlcnMgZnJvbSBcIi4vcmVzb2x2ZXJzL2F1dGgtcmVzb2x2ZXJzXCI7XHJcblxyXG5pbXBvcnQgXCIuL3R5cGVkZWZzL3R5cGVzXCJcclxuXHJcbmZvciAoY29uc3QgcmVzb2x2ZXIgaW4gUmVzb2x2ZXJzKSB7XHJcbiAgICBVc2VyVEMuYWRkUmVzb2x2ZXIoUmVzb2x2ZXJzW3Jlc29sdmVyXSk7XHJcbn1cclxuXHJcbmNvbnN0IEF1dGhNdXRhdGlvbiA9IHtcclxuICAgIHNpZ25JbjogVXNlclRDLmdldFJlc29sdmVyKFwic2lnbkluXCIsIFthdXRoZW50aWNhdGlvbi5pc0d1ZXN0LCB1c2VyVmFsaWRhdG9yLnNpZ25Jbl0pLFxyXG4gICAgc2lnblVwOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJzaWduVXBcIiwgW2F1dGhlbnRpY2F0aW9uLmlzR3Vlc3QsIHVzZXJWYWxpZGF0b3Iuc2lnblVwXSksXHJcbiAgICBsb2dvdXQ6IFVzZXJUQy5nZXRSZXNvbHZlcignbG9nb3V0JywgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aF0pLFxyXG4gICAgLy8gcmVzZXRQYXNzd29yZDogVXNlclRDLmdldFJlc29sdmVyKFwicmVzZXRQYXNzd29yZFwiLCBbbWlkZGxld2FyZS5pc0d1ZXN0LCB2YWxpZGF0b3JzLnJlc2V0UGFzc3dvcmRdKSxcclxuICAgIC8vIG5ld1Bhc3N3b3JkOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJuZXdQYXNzd29yZFwiLCBbbWlkZGxld2FyZS5pc0d1ZXN0LCB2YWxpZGF0b3JzLm5ld1Bhc3N3b3JkXSksXHJcbiAgICBjaGFuZ2VQYXNzd29yZDogVXNlclRDLmdldFJlc29sdmVyKFwiY2hhbmdlUGFzc3dvcmRcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgdXNlclZhbGlkYXRvci5jaGFuZ2VQYXNzd29yZF0pLFxyXG59O1xyXG5cclxuZXhwb3J0IHtBdXRoTXV0YXRpb259O1xyXG4iXX0=","map":{"version":3,"sources":["index.js"],"names":["resolver","Resolvers","UserTC","addResolver","AuthMutation","signIn","getResolver","authentication","isGuest","userValidator","signUp","logout","isAuth","changePassword"],"mappings":";;;;;;;AAAA;;AAEA;;AAEA;;AAEA;;;;AAEA,KAAK,MAAMA,QAAX,IAAuBC,sBAAvB,EAAkC;AAC9BC,eAAOC,WAAP,CAAmBF,uBAAUD,QAAV,CAAnB;AACH;;AAED,MAAMI,YAAY,GAAG;AACjBC,EAAAA,MAAM,EAAEH,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeC,OAAhB,EAAyBC,2BAAcJ,MAAvC,CAA7B,CADS;AAEjBK,EAAAA,MAAM,EAAER,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeC,OAAhB,EAAyBC,2BAAcC,MAAvC,CAA7B,CAFS;AAGjBC,EAAAA,MAAM,EAAET,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeK,MAAhB,CAA7B,CAHS;AAIjB;AACA;AACAC,EAAAA,cAAc,EAAEX,aAAOI,WAAP,CAAmB,gBAAnB,EAAqC,CAACC,4BAAeK,MAAhB,EAAwBH,2BAAcI,cAAtC,CAArC;AANC,CAArB","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\","sourcesContent":["import {UserTC} from \"../../models/user\";\r\n\r\nimport { authentication, userValidator } from \"../../middlewares\";\r\n\r\nimport Resolvers from \"./resolvers/auth-resolvers\";\r\n\r\nimport \"./typedefs/types\"\r\n\r\nfor (const resolver in Resolvers) {\r\n    UserTC.addResolver(Resolvers[resolver]);\r\n}\r\n\r\nconst AuthMutation = {\r\n    signIn: UserTC.getResolver(\"signIn\", [authentication.isGuest, userValidator.signIn]),\r\n    signUp: UserTC.getResolver(\"signUp\", [authentication.isGuest, userValidator.signUp]),\r\n    logout: UserTC.getResolver('logout', [authentication.isAuth]),\r\n    // resetPassword: UserTC.getResolver(\"resetPassword\", [middleware.isGuest, validators.resetPassword]),\r\n    // newPassword: UserTC.getResolver(\"newPassword\", [middleware.isGuest, validators.newPassword]),\r\n    changePassword: UserTC.getResolver(\"changePassword\", [authentication.isAuth, userValidator.changePassword]),\r\n};\r\n\r\nexport {AuthMutation};\r\n"]}},"mtime":1648755864085},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\user.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserTC = exports.UserSchema = exports.UserModel = void 0;\n\nvar _mongoose = _interopRequireWildcard(require(\"mongoose\"));\n\nvar _mongooseTimestamp = _interopRequireDefault(require(\"mongoose-timestamp\"));\n\nvar _graphqlComposeMongoose = require(\"graphql-compose-mongoose\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nconst UserSchema = new _mongoose.Schema({\n  firstName: String,\n  middleName: String,\n  lastName: String,\n  email: String,\n  phoneNumber: String,\n  image: String,\n  firebaseId: String,\n  password: String,\n  status: {\n    type: String,\n    default: \"ACTIVE\",\n    enum: [\"ACTIVE\", \"BLOCKED\"]\n  },\n  roles: {\n    type: String,\n    default: \"NORMAL\",\n    enum: [\"NORMAL\", \"OWNER\", \"ADMIN\", \"SALES\"]\n  },\n  account: {\n    verification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    emailVerification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    phoneVerification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    resetPassword: {\n      token: String,\n      expiresIn: Date\n    }\n  }\n}, {\n  collection: \"users\"\n});\nexports.UserSchema = UserSchema;\nUserSchema.plugin(_mongooseTimestamp.default);\nUserSchema.index({\n  createdAt: 1,\n  updatedAt: 1\n});\n\nUserSchema.statics.emailExist = function (email) {\n  return this.findOne({\n    email\n  });\n};\n\nUserSchema.statics.phoneNumberExist = function (phoneNumber) {\n  return this.findOne({\n    phoneNumber\n  });\n};\n\nUserSchema.methods.comparePassword = function (password) {\n  return bcrypt.compareSync(password, this.password);\n};\n\nconst UserModel = _mongoose.default.model(\"User\", UserSchema);\n\nexports.UserModel = UserModel;\nconst UserTC = (0, _graphqlComposeMongoose.composeWithMongoose)(UserModel); // const UserTC = composeWithMongoose(UserModel).removeField('password');\n\nexports.UserTC = UserTC;\nconst UserAccountTC = UserTC.getFieldTC(\"account\");\nUserAccountTC.getFieldTC(\"verification\").removeField([\"token\", \"expiresIn\"]); // UserAccountTC.removeField('resetPassword');\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsiVXNlclNjaGVtYSIsIlNjaGVtYSIsImZpcnN0TmFtZSIsIlN0cmluZyIsIm1pZGRsZU5hbWUiLCJsYXN0TmFtZSIsImVtYWlsIiwicGhvbmVOdW1iZXIiLCJpbWFnZSIsImZpcmViYXNlSWQiLCJwYXNzd29yZCIsInN0YXR1cyIsInR5cGUiLCJkZWZhdWx0IiwiZW51bSIsInJvbGVzIiwiYWNjb3VudCIsInZlcmlmaWNhdGlvbiIsInZlcmlmaWVkIiwiQm9vbGVhbiIsInRva2VuIiwiZXhwaXJlc0luIiwiRGF0ZSIsImVtYWlsVmVyaWZpY2F0aW9uIiwicGhvbmVWZXJpZmljYXRpb24iLCJyZXNldFBhc3N3b3JkIiwiY29sbGVjdGlvbiIsInBsdWdpbiIsInRpbWVzdGFtcHMiLCJpbmRleCIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInN0YXRpY3MiLCJlbWFpbEV4aXN0IiwiZmluZE9uZSIsInBob25lTnVtYmVyRXhpc3QiLCJtZXRob2RzIiwiY29tcGFyZVBhc3N3b3JkIiwiYmNyeXB0IiwiY29tcGFyZVN5bmMiLCJVc2VyTW9kZWwiLCJtb25nb29zZSIsIm1vZGVsIiwiVXNlclRDIiwiVXNlckFjY291bnRUQyIsImdldEZpZWxkVEMiLCJyZW1vdmVGaWVsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLE1BQU1BLFVBQVUsR0FBRyxJQUFJQyxnQkFBSixDQUFXO0FBQzFCQyxFQUFBQSxTQUFTLEVBQUVDLE1BRGU7QUFFMUJDLEVBQUFBLFVBQVUsRUFBRUQsTUFGYztBQUcxQkUsRUFBQUEsUUFBUSxFQUFFRixNQUhnQjtBQUkxQkcsRUFBQUEsS0FBSyxFQUFFSCxNQUptQjtBQUsxQkksRUFBQUEsV0FBVyxFQUFFSixNQUxhO0FBTTFCSyxFQUFBQSxLQUFLLEVBQUVMLE1BTm1CO0FBTzFCTSxFQUFBQSxVQUFVLEVBQUVOLE1BUGM7QUFRMUJPLEVBQUFBLFFBQVEsRUFBRVAsTUFSZ0I7QUFTMUJRLEVBQUFBLE1BQU0sRUFBRTtBQUNKQyxJQUFBQSxJQUFJLEVBQUVULE1BREY7QUFFSlUsSUFBQUEsT0FBTyxFQUFFLFFBRkw7QUFHSkMsSUFBQUEsSUFBSSxFQUFFLENBQUMsUUFBRCxFQUFXLFNBQVg7QUFIRixHQVRrQjtBQWMxQkMsRUFBQUEsS0FBSyxFQUFFO0FBQ0hILElBQUFBLElBQUksRUFBRVQsTUFESDtBQUVIVSxJQUFBQSxPQUFPLEVBQUUsUUFGTjtBQUdIQyxJQUFBQSxJQUFJLEVBQUUsQ0FBQyxRQUFELEVBQVcsT0FBWCxFQUFvQixPQUFwQixFQUE2QixPQUE3QjtBQUhILEdBZG1CO0FBbUIxQkUsRUFBQUEsT0FBTyxFQUFFO0FBQ0xDLElBQUFBLFlBQVksRUFBRTtBQUNWQyxNQUFBQSxRQUFRLEVBQUU7QUFDTk4sUUFBQUEsSUFBSSxFQUFFTyxPQURBO0FBRU5OLFFBQUFBLE9BQU8sRUFBRTtBQUZILE9BREE7QUFLVk8sTUFBQUEsS0FBSyxFQUFFakIsTUFMRztBQU1Wa0IsTUFBQUEsU0FBUyxFQUFFQztBQU5ELEtBRFQ7QUFTTEMsSUFBQUEsaUJBQWlCLEVBQUU7QUFDZkwsTUFBQUEsUUFBUSxFQUFFO0FBQ05OLFFBQUFBLElBQUksRUFBRU8sT0FEQTtBQUVOTixRQUFBQSxPQUFPLEVBQUU7QUFGSCxPQURLO0FBS2ZPLE1BQUFBLEtBQUssRUFBRWpCLE1BTFE7QUFNZmtCLE1BQUFBLFNBQVMsRUFBRUM7QUFOSSxLQVRkO0FBaUJMRSxJQUFBQSxpQkFBaUIsRUFBRTtBQUNmTixNQUFBQSxRQUFRLEVBQUU7QUFDTk4sUUFBQUEsSUFBSSxFQUFFTyxPQURBO0FBRU5OLFFBQUFBLE9BQU8sRUFBRTtBQUZILE9BREs7QUFLZk8sTUFBQUEsS0FBSyxFQUFFakIsTUFMUTtBQU1ma0IsTUFBQUEsU0FBUyxFQUFFQztBQU5JLEtBakJkO0FBeUJMRyxJQUFBQSxhQUFhLEVBQUU7QUFDWEwsTUFBQUEsS0FBSyxFQUFFakIsTUFESTtBQUVYa0IsTUFBQUEsU0FBUyxFQUFFQztBQUZBO0FBekJWO0FBbkJpQixDQUFYLEVBaURoQjtBQUNDSSxFQUFBQSxVQUFVLEVBQUU7QUFEYixDQWpEZ0IsQ0FBbkI7O0FBcURBMUIsVUFBVSxDQUFDMkIsTUFBWCxDQUFrQkMsMEJBQWxCO0FBQ0E1QixVQUFVLENBQUM2QixLQUFYLENBQWlCO0FBQ2JDLEVBQUFBLFNBQVMsRUFBRSxDQURFO0FBRWJDLEVBQUFBLFNBQVMsRUFBRTtBQUZFLENBQWpCOztBQUtBL0IsVUFBVSxDQUFDZ0MsT0FBWCxDQUFtQkMsVUFBbkIsR0FBZ0MsVUFBVTNCLEtBQVYsRUFBaUI7QUFDN0MsU0FBTyxLQUFLNEIsT0FBTCxDQUFhO0FBQUM1QixJQUFBQTtBQUFELEdBQWIsQ0FBUDtBQUNILENBRkQ7O0FBSUFOLFVBQVUsQ0FBQ2dDLE9BQVgsQ0FBbUJHLGdCQUFuQixHQUFzQyxVQUFVNUIsV0FBVixFQUF1QjtBQUN6RCxTQUFPLEtBQUsyQixPQUFMLENBQWE7QUFBQzNCLElBQUFBO0FBQUQsR0FBYixDQUFQO0FBQ0gsQ0FGRDs7QUFJQVAsVUFBVSxDQUFDb0MsT0FBWCxDQUFtQkMsZUFBbkIsR0FBcUMsVUFBVTNCLFFBQVYsRUFBb0I7QUFDckQsU0FBTzRCLE1BQU0sQ0FBQ0MsV0FBUCxDQUFtQjdCLFFBQW5CLEVBQTZCLEtBQUtBLFFBQWxDLENBQVA7QUFDSCxDQUZEOztBQUlBLE1BQU04QixTQUFTLEdBQUdDLGtCQUFTQyxLQUFULENBQWUsTUFBZixFQUF1QjFDLFVBQXZCLENBQWxCOzs7QUFDQSxNQUFNMkMsTUFBTSxHQUFHLGlEQUFvQkgsU0FBcEIsQ0FBZixDLENBQ0E7OztBQUVBLE1BQU1JLGFBQWEsR0FBR0QsTUFBTSxDQUFDRSxVQUFQLENBQWtCLFNBQWxCLENBQXRCO0FBRUFELGFBQWEsQ0FBQ0MsVUFBZCxDQUF5QixjQUF6QixFQUF5Q0MsV0FBekMsQ0FBcUQsQ0FBQyxPQUFELEVBQVUsV0FBVixDQUFyRCxFLENBRUEiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXG1vZGVsc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlLCB7U2NoZW1hfSBmcm9tIFwibW9uZ29vc2VcIjtcclxuaW1wb3J0IHRpbWVzdGFtcHMgZnJvbSBcIm1vbmdvb3NlLXRpbWVzdGFtcFwiO1xyXG5pbXBvcnQge2NvbXBvc2VXaXRoTW9uZ29vc2V9IGZyb20gXCJncmFwaHFsLWNvbXBvc2UtbW9uZ29vc2VcIjtcclxuXHJcbmNvbnN0IFVzZXJTY2hlbWEgPSBuZXcgU2NoZW1hKHtcclxuICAgIGZpcnN0TmFtZTogU3RyaW5nLFxyXG4gICAgbWlkZGxlTmFtZTogU3RyaW5nLFxyXG4gICAgbGFzdE5hbWU6IFN0cmluZyxcclxuICAgIGVtYWlsOiBTdHJpbmcsXHJcbiAgICBwaG9uZU51bWJlcjogU3RyaW5nLFxyXG4gICAgaW1hZ2U6IFN0cmluZyxcclxuICAgIGZpcmViYXNlSWQ6IFN0cmluZyxcclxuICAgIHBhc3N3b3JkOiBTdHJpbmcsXHJcbiAgICBzdGF0dXM6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZGVmYXVsdDogXCJBQ1RJVkVcIixcclxuICAgICAgICBlbnVtOiBbXCJBQ1RJVkVcIiwgXCJCTE9DS0VEXCJdLFxyXG4gICAgfSxcclxuICAgIHJvbGVzOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIGRlZmF1bHQ6IFwiTk9STUFMXCIsXHJcbiAgICAgICAgZW51bTogW1wiTk9STUFMXCIsIFwiT1dORVJcIiwgXCJBRE1JTlwiLCBcIlNBTEVTXCJdLFxyXG4gICAgfSxcclxuICAgIGFjY291bnQ6IHtcclxuICAgICAgICB2ZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW1haWxWZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcGhvbmVWZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVzZXRQYXNzd29yZDoge1xyXG4gICAgICAgICAgICB0b2tlbjogU3RyaW5nLFxyXG4gICAgICAgICAgICBleHBpcmVzSW46IERhdGUsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcbn0sIHtcclxuICAgIGNvbGxlY3Rpb246IFwidXNlcnNcIixcclxufSk7XHJcblxyXG5Vc2VyU2NoZW1hLnBsdWdpbih0aW1lc3RhbXBzKTtcclxuVXNlclNjaGVtYS5pbmRleCh7XHJcbiAgICBjcmVhdGVkQXQ6IDEsXHJcbiAgICB1cGRhdGVkQXQ6IDEsXHJcbn0pO1xyXG5cclxuVXNlclNjaGVtYS5zdGF0aWNzLmVtYWlsRXhpc3QgPSBmdW5jdGlvbiAoZW1haWwpIHtcclxuICAgIHJldHVybiB0aGlzLmZpbmRPbmUoe2VtYWlsfSk7XHJcbn07XHJcblxyXG5Vc2VyU2NoZW1hLnN0YXRpY3MucGhvbmVOdW1iZXJFeGlzdCA9IGZ1bmN0aW9uIChwaG9uZU51bWJlcikge1xyXG4gICAgcmV0dXJuIHRoaXMuZmluZE9uZSh7cGhvbmVOdW1iZXJ9KTtcclxufTtcclxuXHJcblVzZXJTY2hlbWEubWV0aG9kcy5jb21wYXJlUGFzc3dvcmQgPSBmdW5jdGlvbiAocGFzc3dvcmQpIHtcclxuICAgIHJldHVybiBiY3J5cHQuY29tcGFyZVN5bmMocGFzc3dvcmQsIHRoaXMucGFzc3dvcmQpO1xyXG59O1xyXG5cclxuY29uc3QgVXNlck1vZGVsID0gbW9uZ29vc2UubW9kZWwoXCJVc2VyXCIsIFVzZXJTY2hlbWEpO1xyXG5jb25zdCBVc2VyVEMgPSBjb21wb3NlV2l0aE1vbmdvb3NlKFVzZXJNb2RlbCk7XHJcbi8vIGNvbnN0IFVzZXJUQyA9IGNvbXBvc2VXaXRoTW9uZ29vc2UoVXNlck1vZGVsKS5yZW1vdmVGaWVsZCgncGFzc3dvcmQnKTtcclxuXHJcbmNvbnN0IFVzZXJBY2NvdW50VEMgPSBVc2VyVEMuZ2V0RmllbGRUQyhcImFjY291bnRcIik7XHJcblxyXG5Vc2VyQWNjb3VudFRDLmdldEZpZWxkVEMoXCJ2ZXJpZmljYXRpb25cIikucmVtb3ZlRmllbGQoW1widG9rZW5cIiwgXCJleHBpcmVzSW5cIl0pO1xyXG5cclxuLy8gVXNlckFjY291bnRUQy5yZW1vdmVGaWVsZCgncmVzZXRQYXNzd29yZCcpO1xyXG5cclxuZXhwb3J0IHtVc2VyTW9kZWwsIFVzZXJUQywgVXNlclNjaGVtYX07XHJcbiJdfQ==","map":{"version":3,"sources":["user.js"],"names":["UserSchema","Schema","firstName","String","middleName","lastName","email","phoneNumber","image","firebaseId","password","status","type","default","enum","roles","account","verification","verified","Boolean","token","expiresIn","Date","emailVerification","phoneVerification","resetPassword","collection","plugin","timestamps","index","createdAt","updatedAt","statics","emailExist","findOne","phoneNumberExist","methods","comparePassword","bcrypt","compareSync","UserModel","mongoose","model","UserTC","UserAccountTC","getFieldTC","removeField"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\models\\","sourcesContent":["import mongoose, {Schema} from \"mongoose\";\r\nimport timestamps from \"mongoose-timestamp\";\r\nimport {composeWithMongoose} from \"graphql-compose-mongoose\";\r\n\r\nconst UserSchema = new Schema({\r\n    firstName: String,\r\n    middleName: String,\r\n    lastName: String,\r\n    email: String,\r\n    phoneNumber: String,\r\n    image: String,\r\n    firebaseId: String,\r\n    password: String,\r\n    status: {\r\n        type: String,\r\n        default: \"ACTIVE\",\r\n        enum: [\"ACTIVE\", \"BLOCKED\"],\r\n    },\r\n    roles: {\r\n        type: String,\r\n        default: \"NORMAL\",\r\n        enum: [\"NORMAL\", \"OWNER\", \"ADMIN\", \"SALES\"],\r\n    },\r\n    account: {\r\n        verification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        emailVerification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        phoneVerification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        resetPassword: {\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n    },\r\n}, {\r\n    collection: \"users\",\r\n});\r\n\r\nUserSchema.plugin(timestamps);\r\nUserSchema.index({\r\n    createdAt: 1,\r\n    updatedAt: 1,\r\n});\r\n\r\nUserSchema.statics.emailExist = function (email) {\r\n    return this.findOne({email});\r\n};\r\n\r\nUserSchema.statics.phoneNumberExist = function (phoneNumber) {\r\n    return this.findOne({phoneNumber});\r\n};\r\n\r\nUserSchema.methods.comparePassword = function (password) {\r\n    return bcrypt.compareSync(password, this.password);\r\n};\r\n\r\nconst UserModel = mongoose.model(\"User\", UserSchema);\r\nconst UserTC = composeWithMongoose(UserModel);\r\n// const UserTC = composeWithMongoose(UserModel).removeField('password');\r\n\r\nconst UserAccountTC = UserTC.getFieldTC(\"account\");\r\n\r\nUserAccountTC.getFieldTC(\"verification\").removeField([\"token\", \"expiresIn\"]);\r\n\r\n// UserAccountTC.removeField('resetPassword');\r\n\r\nexport {UserModel, UserTC, UserSchema};\r\n"]}},"mtime":1648684433894},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"authentication\", {\n  enumerable: true,\n  get: function () {\n    return _authentication.default;\n  }\n});\nObject.defineProperty(exports, \"authorization\", {\n  enumerable: true,\n  get: function () {\n    return _authorization.default;\n  }\n});\nObject.defineProperty(exports, \"phoneVerification\", {\n  enumerable: true,\n  get: function () {\n    return _phoneVerification.default;\n  }\n});\nObject.defineProperty(exports, \"userValidator\", {\n  enumerable: true,\n  get: function () {\n    return _userValidator.default;\n  }\n});\nObject.defineProperty(exports, \"validateToken\", {\n  enumerable: true,\n  get: function () {\n    return _validateToken.default;\n  }\n});\n\nvar _authentication = _interopRequireDefault(require(\"./auth/authentication\"));\n\nvar _authorization = _interopRequireDefault(require(\"./auth/authorization\"));\n\nvar _validateToken = _interopRequireDefault(require(\"./auth/validate-token\"));\n\nvar _phoneVerification = _interopRequireDefault(require(\"./auth/phone-verification\"));\n\nvar _userValidator = _interopRequireDefault(require(\"./validators/user-validator\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF1dGhlbnRpY2F0aW9uIGZyb20gXCIuL2F1dGgvYXV0aGVudGljYXRpb25cIlxyXG5pbXBvcnQgYXV0aG9yaXphdGlvbiBmcm9tIFwiLi9hdXRoL2F1dGhvcml6YXRpb25cIlxyXG5pbXBvcnQgdmFsaWRhdGVUb2tlbiBmcm9tIFwiLi9hdXRoL3ZhbGlkYXRlLXRva2VuXCJcclxuaW1wb3J0IHBob25lVmVyaWZpY2F0aW9uIGZyb20gXCIuL2F1dGgvcGhvbmUtdmVyaWZpY2F0aW9uXCJcclxuaW1wb3J0IHVzZXJWYWxpZGF0b3IgZnJvbSBcIi4vdmFsaWRhdG9ycy91c2VyLXZhbGlkYXRvclwiO1xyXG5cclxuZXhwb3J0IHtcclxuICAgIGF1dGhlbnRpY2F0aW9uLFxyXG4gICAgYXV0aG9yaXphdGlvbixcclxuICAgIHZhbGlkYXRlVG9rZW4sXHJcbiAgICBwaG9uZVZlcmlmaWNhdGlvbixcclxuICAgIHVzZXJWYWxpZGF0b3IsXHJcbn0iXX0=","map":{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\","sourcesContent":["import authentication from \"./auth/authentication\"\r\nimport authorization from \"./auth/authorization\"\r\nimport validateToken from \"./auth/validate-token\"\r\nimport phoneVerification from \"./auth/phone-verification\"\r\nimport userValidator from \"./validators/user-validator\";\r\n\r\nexport {\r\n    authentication,\r\n    authorization,\r\n    validateToken,\r\n    phoneVerification,\r\n    userValidator,\r\n}"]}},"mtime":1648684433893},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\authentication.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nconst isAuth = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n\n  if (!user) {\n    return Promise.reject(new Error(\"You must be authorized.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nconst isGuest = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n\n  if (user) {\n    return Promise.reject(new Error(\"You have already authorized.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nvar _default = {\n  isAuth,\n  isGuest\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0aW9uLmpzIl0sIm5hbWVzIjpbImlzQXV0aCIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iLCJ1c2VyIiwiUHJvbWlzZSIsInJlamVjdCIsIkVycm9yIiwiaXNHdWVzdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLE1BQU1BLE1BQU0sR0FBRyxPQUFPQyxPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUMzRCxRQUFNO0FBQUNDLElBQUFBO0FBQUQsTUFBU0YsT0FBZjs7QUFDQSxNQUFJLENBQUNFLElBQUwsRUFBVztBQUNQLFdBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLElBQUlDLEtBQUosQ0FBVSx5QkFBVixDQUFmLENBQVA7QUFDSDs7QUFDRCxTQUFPUixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsQ0FORDs7QUFRQSxNQUFNSyxPQUFPLEdBQUcsT0FBT1QsT0FBUCxFQUFnQkMsTUFBaEIsRUFBd0JDLElBQXhCLEVBQThCQyxPQUE5QixFQUF1Q0MsSUFBdkMsS0FBZ0Q7QUFDNUQsUUFBTTtBQUFDQyxJQUFBQTtBQUFELE1BQVNGLE9BQWY7O0FBQ0EsTUFBSUUsSUFBSixFQUFVO0FBQ04sV0FBT0MsT0FBTyxDQUFDQyxNQUFSLENBQWUsSUFBSUMsS0FBSixDQUFVLDhCQUFWLENBQWYsQ0FBUDtBQUNIOztBQUNELFNBQU9SLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxDQU5EOztlQVFlO0FBQUNMLEVBQUFBLE1BQUQ7QUFBU1UsRUFBQUE7QUFBVCxDIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaXNBdXRoID0gYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgY29uc3Qge3VzZXJ9ID0gY29udGV4dDtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJZb3UgbXVzdCBiZSBhdXRob3JpemVkLlwiKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzb2x2ZShzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pO1xyXG59O1xyXG5cclxuY29uc3QgaXNHdWVzdCA9IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgIGNvbnN0IHt1c2VyfSA9IGNvbnRleHQ7XHJcbiAgICBpZiAodXNlcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJZb3UgaGF2ZSBhbHJlYWR5IGF1dGhvcml6ZWQuXCIpKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7aXNBdXRoLCBpc0d1ZXN0fTtcclxuIl19","map":{"version":3,"sources":["authentication.js"],"names":["isAuth","resolve","source","args","context","info","user","Promise","reject","Error","isGuest"],"mappings":";;;;;;;AAAA,MAAMA,MAAM,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC3D,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;;AACA,MAAI,CAACE,IAAL,EAAW;AACP,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,yBAAV,CAAf,CAAP;AACH;;AACD,SAAOR,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAND;;AAQA,MAAMK,OAAO,GAAG,OAAOT,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC5D,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;;AACA,MAAIE,IAAJ,EAAU;AACN,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,8BAAV,CAAf,CAAP;AACH;;AACD,SAAOR,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAND;;eAQe;AAACL,EAAAA,MAAD;AAASU,EAAAA;AAAT,C","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["const isAuth = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    if (!user) {\r\n        return Promise.reject(new Error(\"You must be authorized.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nconst isGuest = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    if (user) {\r\n        return Promise.reject(new Error(\"You have already authorized.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nexport default {isAuth, isGuest};\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\authorization.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n//list from redis, list of functions for each role\nconst accessList = {\n  ADMIN: [\"findMany\", \"createOne\"],\n  SUPER_ADMIN: [\"findMany\", \"createOne\"],\n  NORMAL: [],\n  TUTOR: [],\n  CUSTOMER_SERVICE: []\n};\n\nconst authorization = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n  const fieldName = info.fieldName;\n  let hasAccess = false; //list from redis, list of functions for each role\n\n  user.roles.forEach(role => {\n    if (accessList[role].includes(fieldName)) {\n      hasAccess = true;\n    }\n  });\n\n  if (!hasAccess) {\n    return Promise.reject(new Error(\"Access denied.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nvar _default = authorization;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6YXRpb24uanMiXSwibmFtZXMiOlsiYWNjZXNzTGlzdCIsIkFETUlOIiwiU1VQRVJfQURNSU4iLCJOT1JNQUwiLCJUVVRPUiIsIkNVU1RPTUVSX1NFUlZJQ0UiLCJhdXRob3JpemF0aW9uIiwicmVzb2x2ZSIsInNvdXJjZSIsImFyZ3MiLCJjb250ZXh0IiwiaW5mbyIsInVzZXIiLCJmaWVsZE5hbWUiLCJoYXNBY2Nlc3MiLCJyb2xlcyIsImZvckVhY2giLCJyb2xlIiwiaW5jbHVkZXMiLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0EsTUFBTUEsVUFBVSxHQUFHO0FBQ2ZDLEVBQUFBLEtBQUssRUFBRSxDQUFDLFVBQUQsRUFBYSxXQUFiLENBRFE7QUFFZkMsRUFBQUEsV0FBVyxFQUFFLENBQUMsVUFBRCxFQUFhLFdBQWIsQ0FGRTtBQUdmQyxFQUFBQSxNQUFNLEVBQUUsRUFITztBQUlmQyxFQUFBQSxLQUFLLEVBQUUsRUFKUTtBQUtmQyxFQUFBQSxnQkFBZ0IsRUFBRTtBQUxILENBQW5COztBQVFBLE1BQU1DLGFBQWEsR0FBRyxPQUFPQyxPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUNsRSxRQUFNO0FBQUNDLElBQUFBO0FBQUQsTUFBU0YsT0FBZjtBQUNBLFFBQU1HLFNBQVMsR0FBR0YsSUFBSSxDQUFDRSxTQUF2QjtBQUNBLE1BQUlDLFNBQVMsR0FBRyxLQUFoQixDQUhrRSxDQUlsRTs7QUFDQUYsRUFBQUEsSUFBSSxDQUFDRyxLQUFMLENBQVdDLE9BQVgsQ0FBbUJDLElBQUksSUFBSTtBQUN2QixRQUFHakIsVUFBVSxDQUFDaUIsSUFBRCxDQUFWLENBQWlCQyxRQUFqQixDQUEwQkwsU0FBMUIsQ0FBSCxFQUF3QztBQUNwQ0MsTUFBQUEsU0FBUyxHQUFHLElBQVo7QUFDSDtBQUNKLEdBSkQ7O0FBS0EsTUFBSSxDQUFDQSxTQUFMLEVBQWdCO0FBQ1osV0FBT0ssT0FBTyxDQUFDQyxNQUFSLENBQWUsSUFBSUMsS0FBSixDQUFVLGdCQUFWLENBQWYsQ0FBUDtBQUNIOztBQUNELFNBQU9kLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxDQWREOztlQWdCZUwsYSIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbWlkZGxld2FyZXNcXGF1dGhcXCIsInNvdXJjZXNDb250ZW50IjpbIi8vbGlzdCBmcm9tIHJlZGlzLCBsaXN0IG9mIGZ1bmN0aW9ucyBmb3IgZWFjaCByb2xlXHJcbmNvbnN0IGFjY2Vzc0xpc3QgPSB7XHJcbiAgICBBRE1JTjogW1wiZmluZE1hbnlcIiwgXCJjcmVhdGVPbmVcIl0sXHJcbiAgICBTVVBFUl9BRE1JTjogW1wiZmluZE1hbnlcIiwgXCJjcmVhdGVPbmVcIl0sXHJcbiAgICBOT1JNQUw6IFtdLFxyXG4gICAgVFVUT1I6IFtdLFxyXG4gICAgQ1VTVE9NRVJfU0VSVklDRTogW10sXHJcbn07XHJcblxyXG5jb25zdCBhdXRob3JpemF0aW9uID0gYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgY29uc3Qge3VzZXJ9ID0gY29udGV4dDtcclxuICAgIGNvbnN0IGZpZWxkTmFtZSA9IGluZm8uZmllbGROYW1lXHJcbiAgICBsZXQgaGFzQWNjZXNzID0gZmFsc2VcclxuICAgIC8vbGlzdCBmcm9tIHJlZGlzLCBsaXN0IG9mIGZ1bmN0aW9ucyBmb3IgZWFjaCByb2xlXHJcbiAgICB1c2VyLnJvbGVzLmZvckVhY2gocm9sZSA9PiB7XHJcbiAgICAgICAgaWYoYWNjZXNzTGlzdFtyb2xlXS5pbmNsdWRlcyhmaWVsZE5hbWUpKXtcclxuICAgICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICBpZiAoIWhhc0FjY2Vzcykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJBY2Nlc3MgZGVuaWVkLlwiKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzb2x2ZShzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXV0aG9yaXphdGlvbjtcclxuIl19","map":{"version":3,"sources":["authorization.js"],"names":["accessList","ADMIN","SUPER_ADMIN","NORMAL","TUTOR","CUSTOMER_SERVICE","authorization","resolve","source","args","context","info","user","fieldName","hasAccess","roles","forEach","role","includes","Promise","reject","Error"],"mappings":";;;;;;AAAA;AACA,MAAMA,UAAU,GAAG;AACfC,EAAAA,KAAK,EAAE,CAAC,UAAD,EAAa,WAAb,CADQ;AAEfC,EAAAA,WAAW,EAAE,CAAC,UAAD,EAAa,WAAb,CAFE;AAGfC,EAAAA,MAAM,EAAE,EAHO;AAIfC,EAAAA,KAAK,EAAE,EAJQ;AAKfC,EAAAA,gBAAgB,EAAE;AALH,CAAnB;;AAQA,MAAMC,aAAa,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAClE,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;AACA,QAAMG,SAAS,GAAGF,IAAI,CAACE,SAAvB;AACA,MAAIC,SAAS,GAAG,KAAhB,CAHkE,CAIlE;;AACAF,EAAAA,IAAI,CAACG,KAAL,CAAWC,OAAX,CAAmBC,IAAI,IAAI;AACvB,QAAGjB,UAAU,CAACiB,IAAD,CAAV,CAAiBC,QAAjB,CAA0BL,SAA1B,CAAH,EAAwC;AACpCC,MAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,GAJD;;AAKA,MAAI,CAACA,SAAL,EAAgB;AACZ,WAAOK,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,gBAAV,CAAf,CAAP;AACH;;AACD,SAAOd,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAdD;;eAgBeL,a","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["//list from redis, list of functions for each role\r\nconst accessList = {\r\n    ADMIN: [\"findMany\", \"createOne\"],\r\n    SUPER_ADMIN: [\"findMany\", \"createOne\"],\r\n    NORMAL: [],\r\n    TUTOR: [],\r\n    CUSTOMER_SERVICE: [],\r\n};\r\n\r\nconst authorization = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    const fieldName = info.fieldName\r\n    let hasAccess = false\r\n    //list from redis, list of functions for each role\r\n    user.roles.forEach(role => {\r\n        if(accessList[role].includes(fieldName)){\r\n            hasAccess = true\r\n        }\r\n    })\r\n    if (!hasAccess) {\r\n        return Promise.reject(new Error(\"Access denied.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nexport default authorization;\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\validate-token.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../models/user\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import redis from \"../config/redis-config\";\nconst validateToken = async (req, res, next) => {\n  try {\n    const authorization = req.headers.authorization;\n    console.log(\"authorization: \", authorization);\n    Object.assign(req.headers, {\n      user: null,\n      authorization: null\n    });\n\n    if (!authorization) {\n      return next();\n    }\n\n    const accessToken = authorization.split(\" \")[1];\n    console.log(\"accessTocken: \", accessToken);\n    let decoded;\n\n    if (accessToken) {\n      decoded = _jsonwebtoken.default.verify(accessToken, process.env.JWT_SECRET);\n    }\n\n    if (!decoded) {\n      // invalid token, remove the token from everywhere\n      //remove from database\n      //remove from redis\n      return next();\n    }\n\n    if (decoded.exp * 1000 < Date.now()) {\n      //remove from database\n      //remove from redis\n      return next();\n    } //check if token is in redis\n    //if NOT in redis call next()\n    //else check last update time if greater than or equals to 1hour update the token\n    // if less skip else update token\n    // authorization = new token\n\n\n    const user = await _user.UserModel.findById(decoded.userId);\n\n    if (!user) {\n      //remove from database\n      //remove from redis\n      return next();\n    } // if the token has come all this way everything is good just attach it to the request header\n\n\n    Object.assign(req.headers, {\n      user,\n      authorization\n    });\n    return next();\n  } catch (error) {\n    console.log(error);\n    return Promise.reject(new Error(\"Error Happened!\"));\n  }\n};\n\nvar _default = validateToken; // ------------- authorization ------------------\n// let check_user_action = async (req,action,resource) =>{\n//   if(!['updateOwn','deleteOwn'].includes(action)){\n//     return true\n//   }\n//\n//   const userResource = new Set()\n//\n//   if(resource == 'tender'){\n//     let userTender = await Tender.find({ creator_user: req.user._id })\n//     userTender.forEach(tender => userResource.add(`${tender._id}`))\n//\n//   }else if(resource == 'company'){\n//     let userCompany = await Company.find({ creator_user: req.user._id })\n//     userCompany.forEach(company => userResource.add( `${company._id}`))\n//\n//   }else if(resource == 'award'){\n//     let userAward = await Award.find({ creator_user: req.user._id })\n//     userAward.forEach(award => userResource.add(`${award._id}`))\n//   }\n//\n//   if(!userResource.has(req.params.id)){\n//     return false\n//   }\n//\n//   return true\n// }\n//\n//\n//\n// exports.authorize = function (action, resource) {\n//   return async (req, res, next) => {\n//     try {\n//       const permission = roles.can(req.user.role)[action](resource);\n//\n//       if (!permission.granted) {\n//         return res.status(401).send(\"You don't have enough permission to perform this action\");\n//       }\n//\n//       let result = await check_user_action(req,action,resource)\n//       if(!result){\n//         return res.status(401).send({ param: resource , msg: `You are not authorized to edit this ${resource}.` })\n//       }\n//\n//       next()\n//     } catch (error) {\n//       return res.status(401).send(\"You don't have enough permission to perform this action\")\n//     }\n//   }\n// }\n\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRlLXRva2VuLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlVG9rZW4iLCJyZXEiLCJyZXMiLCJuZXh0IiwiYXV0aG9yaXphdGlvbiIsImhlYWRlcnMiLCJjb25zb2xlIiwibG9nIiwiT2JqZWN0IiwiYXNzaWduIiwidXNlciIsImFjY2Vzc1Rva2VuIiwic3BsaXQiLCJkZWNvZGVkIiwiand0IiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJleHAiLCJEYXRlIiwibm93IiwiVXNlck1vZGVsIiwiZmluZEJ5SWQiLCJ1c2VySWQiLCJlcnJvciIsIlByb21pc2UiLCJyZWplY3QiLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUdBOzs7O0FBREE7QUFHQSxNQUFNQSxhQUFhLEdBQUcsT0FBT0MsR0FBUCxFQUFZQyxHQUFaLEVBQWlCQyxJQUFqQixLQUEwQjtBQUM1QyxNQUFJO0FBQ0EsVUFBTUMsYUFBYSxHQUFHSCxHQUFHLENBQUNJLE9BQUosQ0FBWUQsYUFBbEM7QUFDQUUsSUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksaUJBQVosRUFBOEJILGFBQTlCO0FBQ0FJLElBQUFBLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjUixHQUFHLENBQUNJLE9BQWxCLEVBQTJCO0FBQ3ZCSyxNQUFBQSxJQUFJLEVBQUUsSUFEaUI7QUFFdkJOLE1BQUFBLGFBQWEsRUFBRTtBQUZRLEtBQTNCOztBQUtBLFFBQUksQ0FBQ0EsYUFBTCxFQUFvQjtBQUNoQixhQUFPRCxJQUFJLEVBQVg7QUFDSDs7QUFFRCxVQUFNUSxXQUFXLEdBQUdQLGFBQWEsQ0FBQ1EsS0FBZCxDQUFvQixHQUFwQixFQUF5QixDQUF6QixDQUFwQjtBQUNBTixJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxnQkFBWixFQUE4QkksV0FBOUI7QUFDQSxRQUFJRSxPQUFKOztBQUNBLFFBQUlGLFdBQUosRUFBaUI7QUFDYkUsTUFBQUEsT0FBTyxHQUFHQyxzQkFBSUMsTUFBSixDQUFXSixXQUFYLEVBQXdCSyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsVUFBcEMsQ0FBVjtBQUNIOztBQUNELFFBQUksQ0FBQ0wsT0FBTCxFQUFjO0FBQ1Y7QUFDQTtBQUNBO0FBQ0EsYUFBT1YsSUFBSSxFQUFYO0FBQ0g7O0FBRUQsUUFBSVUsT0FBTyxDQUFDTSxHQUFSLEdBQWMsSUFBZCxHQUFxQkMsSUFBSSxDQUFDQyxHQUFMLEVBQXpCLEVBQXFDO0FBQ2pDO0FBQ0E7QUFDQSxhQUFPbEIsSUFBSSxFQUFYO0FBQ0gsS0E3QkQsQ0ErQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUEsVUFBTU8sSUFBSSxHQUFHLE1BQU1ZLGdCQUFVQyxRQUFWLENBQW1CVixPQUFPLENBQUNXLE1BQTNCLENBQW5COztBQUNBLFFBQUksQ0FBQ2QsSUFBTCxFQUFXO0FBQ1A7QUFDQTtBQUNBLGFBQU9QLElBQUksRUFBWDtBQUNILEtBMUNELENBNENBOzs7QUFDQUssSUFBQUEsTUFBTSxDQUFDQyxNQUFQLENBQWNSLEdBQUcsQ0FBQ0ksT0FBbEIsRUFBMkI7QUFDdkJLLE1BQUFBLElBRHVCO0FBRXZCTixNQUFBQTtBQUZ1QixLQUEzQjtBQUtBLFdBQU9ELElBQUksRUFBWDtBQUNILEdBbkRELENBbURFLE9BQU9zQixLQUFQLEVBQWM7QUFDWm5CLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZa0IsS0FBWjtBQUNBLFdBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLElBQUlDLEtBQUosQ0FBVSxpQkFBVixDQUFmLENBQVA7QUFDSDtBQUNKLENBeEREOztlQTBEZTVCLGEsRUFHZjtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcblxyXG4vLyBpbXBvcnQgcmVkaXMgZnJvbSBcIi4uL2NvbmZpZy9yZWRpcy1jb25maWdcIjtcclxuaW1wb3J0IHtVc2VyTW9kZWx9IGZyb20gXCIuLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5cclxuY29uc3QgdmFsaWRhdGVUb2tlbiA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBhdXRob3JpemF0aW9uID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvblxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiYXV0aG9yaXphdGlvbjogXCIsYXV0aG9yaXphdGlvbilcclxuICAgICAgICBPYmplY3QuYXNzaWduKHJlcS5oZWFkZXJzLCB7XHJcbiAgICAgICAgICAgIHVzZXI6IG51bGwsXHJcbiAgICAgICAgICAgIGF1dGhvcml6YXRpb246IG51bGwsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICghYXV0aG9yaXphdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhdXRob3JpemF0aW9uLnNwbGl0KFwiIFwiKVsxXTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImFjY2Vzc1RvY2tlbjogXCIsIGFjY2Vzc1Rva2VuKTtcclxuICAgICAgICBsZXQgZGVjb2RlZDtcclxuICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHtcclxuICAgICAgICAgICAgZGVjb2RlZCA9IGp3dC52ZXJpZnkoYWNjZXNzVG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWRlY29kZWQpIHtcclxuICAgICAgICAgICAgLy8gaW52YWxpZCB0b2tlbiwgcmVtb3ZlIHRoZSB0b2tlbiBmcm9tIGV2ZXJ5d2hlcmVcclxuICAgICAgICAgICAgLy9yZW1vdmUgZnJvbSBkYXRhYmFzZVxyXG4gICAgICAgICAgICAvL3JlbW92ZSBmcm9tIHJlZGlzXHJcbiAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZGVjb2RlZC5leHAgKiAxMDAwIDwgRGF0ZS5ub3coKSkge1xyXG4gICAgICAgICAgICAvL3JlbW92ZSBmcm9tIGRhdGFiYXNlXHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGZyb20gcmVkaXNcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vY2hlY2sgaWYgdG9rZW4gaXMgaW4gcmVkaXNcclxuICAgICAgICAvL2lmIE5PVCBpbiByZWRpcyBjYWxsIG5leHQoKVxyXG4gICAgICAgIC8vZWxzZSBjaGVjayBsYXN0IHVwZGF0ZSB0aW1lIGlmIGdyZWF0ZXIgdGhhbiBvciBlcXVhbHMgdG8gMWhvdXIgdXBkYXRlIHRoZSB0b2tlblxyXG4gICAgICAgIC8vIGlmIGxlc3Mgc2tpcCBlbHNlIHVwZGF0ZSB0b2tlblxyXG4gICAgICAgIC8vIGF1dGhvcml6YXRpb24gPSBuZXcgdG9rZW5cclxuXHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXJNb2RlbC5maW5kQnlJZChkZWNvZGVkLnVzZXJJZCk7XHJcbiAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGZyb20gZGF0YWJhc2VcclxuICAgICAgICAgICAgLy9yZW1vdmUgZnJvbSByZWRpc1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaWYgdGhlIHRva2VuIGhhcyBjb21lIGFsbCB0aGlzIHdheSBldmVyeXRoaW5nIGlzIGdvb2QganVzdCBhdHRhY2ggaXQgdG8gdGhlIHJlcXVlc3QgaGVhZGVyXHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihyZXEuaGVhZGVycywge1xyXG4gICAgICAgICAgICB1c2VyLFxyXG4gICAgICAgICAgICBhdXRob3JpemF0aW9uLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3IgSGFwcGVuZWQhXCIpKTtcclxuICAgIH1cclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHZhbGlkYXRlVG9rZW47XHJcblxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLSBhdXRob3JpemF0aW9uIC0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuLy8gbGV0IGNoZWNrX3VzZXJfYWN0aW9uID0gYXN5bmMgKHJlcSxhY3Rpb24scmVzb3VyY2UpID0+e1xyXG4vLyAgIGlmKCFbJ3VwZGF0ZU93bicsJ2RlbGV0ZU93biddLmluY2x1ZGVzKGFjdGlvbikpe1xyXG4vLyAgICAgcmV0dXJuIHRydWVcclxuLy8gICB9XHJcbi8vXHJcbi8vICAgY29uc3QgdXNlclJlc291cmNlID0gbmV3IFNldCgpXHJcbi8vXHJcbi8vICAgaWYocmVzb3VyY2UgPT0gJ3RlbmRlcicpe1xyXG4vLyAgICAgbGV0IHVzZXJUZW5kZXIgPSBhd2FpdCBUZW5kZXIuZmluZCh7IGNyZWF0b3JfdXNlcjogcmVxLnVzZXIuX2lkIH0pXHJcbi8vICAgICB1c2VyVGVuZGVyLmZvckVhY2godGVuZGVyID0+IHVzZXJSZXNvdXJjZS5hZGQoYCR7dGVuZGVyLl9pZH1gKSlcclxuLy9cclxuLy8gICB9ZWxzZSBpZihyZXNvdXJjZSA9PSAnY29tcGFueScpe1xyXG4vLyAgICAgbGV0IHVzZXJDb21wYW55ID0gYXdhaXQgQ29tcGFueS5maW5kKHsgY3JlYXRvcl91c2VyOiByZXEudXNlci5faWQgfSlcclxuLy8gICAgIHVzZXJDb21wYW55LmZvckVhY2goY29tcGFueSA9PiB1c2VyUmVzb3VyY2UuYWRkKCBgJHtjb21wYW55Ll9pZH1gKSlcclxuLy9cclxuLy8gICB9ZWxzZSBpZihyZXNvdXJjZSA9PSAnYXdhcmQnKXtcclxuLy8gICAgIGxldCB1c2VyQXdhcmQgPSBhd2FpdCBBd2FyZC5maW5kKHsgY3JlYXRvcl91c2VyOiByZXEudXNlci5faWQgfSlcclxuLy8gICAgIHVzZXJBd2FyZC5mb3JFYWNoKGF3YXJkID0+IHVzZXJSZXNvdXJjZS5hZGQoYCR7YXdhcmQuX2lkfWApKVxyXG4vLyAgIH1cclxuLy9cclxuLy8gICBpZighdXNlclJlc291cmNlLmhhcyhyZXEucGFyYW1zLmlkKSl7XHJcbi8vICAgICByZXR1cm4gZmFsc2VcclxuLy8gICB9XHJcbi8vXHJcbi8vICAgcmV0dXJuIHRydWVcclxuLy8gfVxyXG4vL1xyXG4vL1xyXG4vL1xyXG4vLyBleHBvcnRzLmF1dGhvcml6ZSA9IGZ1bmN0aW9uIChhY3Rpb24sIHJlc291cmNlKSB7XHJcbi8vICAgcmV0dXJuIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4vLyAgICAgdHJ5IHtcclxuLy8gICAgICAgY29uc3QgcGVybWlzc2lvbiA9IHJvbGVzLmNhbihyZXEudXNlci5yb2xlKVthY3Rpb25dKHJlc291cmNlKTtcclxuLy9cclxuLy8gICAgICAgaWYgKCFwZXJtaXNzaW9uLmdyYW50ZWQpIHtcclxuLy8gICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJZb3UgZG9uJ3QgaGF2ZSBlbm91Z2ggcGVybWlzc2lvbiB0byBwZXJmb3JtIHRoaXMgYWN0aW9uXCIpO1xyXG4vLyAgICAgICB9XHJcbi8vXHJcbi8vICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBjaGVja191c2VyX2FjdGlvbihyZXEsYWN0aW9uLHJlc291cmNlKVxyXG4vLyAgICAgICBpZighcmVzdWx0KXtcclxuLy8gICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoeyBwYXJhbTogcmVzb3VyY2UgLCBtc2c6IGBZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIGVkaXQgdGhpcyAke3Jlc291cmNlfS5gIH0pXHJcbi8vICAgICAgIH1cclxuLy9cclxuLy8gICAgICAgbmV4dCgpXHJcbi8vICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4vLyAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJZb3UgZG9uJ3QgaGF2ZSBlbm91Z2ggcGVybWlzc2lvbiB0byBwZXJmb3JtIHRoaXMgYWN0aW9uXCIpXHJcbi8vICAgICB9XHJcbi8vICAgfVxyXG4vLyB9XHJcbiJdfQ==","map":{"version":3,"sources":["validate-token.js"],"names":["validateToken","req","res","next","authorization","headers","console","log","Object","assign","user","accessToken","split","decoded","jwt","verify","process","env","JWT_SECRET","exp","Date","now","UserModel","findById","userId","error","Promise","reject","Error"],"mappings":";;;;;;;AAAA;;AAGA;;;;AADA;AAGA,MAAMA,aAAa,GAAG,OAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAC5C,MAAI;AACA,UAAMC,aAAa,GAAGH,GAAG,CAACI,OAAJ,CAAYD,aAAlC;AACAE,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA8BH,aAA9B;AACAI,IAAAA,MAAM,CAACC,MAAP,CAAcR,GAAG,CAACI,OAAlB,EAA2B;AACvBK,MAAAA,IAAI,EAAE,IADiB;AAEvBN,MAAAA,aAAa,EAAE;AAFQ,KAA3B;;AAKA,QAAI,CAACA,aAAL,EAAoB;AAChB,aAAOD,IAAI,EAAX;AACH;;AAED,UAAMQ,WAAW,GAAGP,aAAa,CAACQ,KAAd,CAAoB,GAApB,EAAyB,CAAzB,CAApB;AACAN,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BI,WAA9B;AACA,QAAIE,OAAJ;;AACA,QAAIF,WAAJ,EAAiB;AACbE,MAAAA,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,WAAX,EAAwBK,OAAO,CAACC,GAAR,CAAYC,UAApC,CAAV;AACH;;AACD,QAAI,CAACL,OAAL,EAAc;AACV;AACA;AACA;AACA,aAAOV,IAAI,EAAX;AACH;;AAED,QAAIU,OAAO,CAACM,GAAR,GAAc,IAAd,GAAqBC,IAAI,CAACC,GAAL,EAAzB,EAAqC;AACjC;AACA;AACA,aAAOlB,IAAI,EAAX;AACH,KA7BD,CA+BA;AACA;AACA;AACA;AACA;;;AAEA,UAAMO,IAAI,GAAG,MAAMY,gBAAUC,QAAV,CAAmBV,OAAO,CAACW,MAA3B,CAAnB;;AACA,QAAI,CAACd,IAAL,EAAW;AACP;AACA;AACA,aAAOP,IAAI,EAAX;AACH,KA1CD,CA4CA;;;AACAK,IAAAA,MAAM,CAACC,MAAP,CAAcR,GAAG,CAACI,OAAlB,EAA2B;AACvBK,MAAAA,IADuB;AAEvBN,MAAAA;AAFuB,KAA3B;AAKA,WAAOD,IAAI,EAAX;AACH,GAnDD,CAmDE,OAAOsB,KAAP,EAAc;AACZnB,IAAAA,OAAO,CAACC,GAAR,CAAYkB,KAAZ;AACA,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,iBAAV,CAAf,CAAP;AACH;AACJ,CAxDD;;eA0De5B,a,EAGf;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\n\r\n// import redis from \"../config/redis-config\";\r\nimport {UserModel} from \"../../models/user\";\r\n\r\nconst validateToken = async (req, res, next) => {\r\n    try {\r\n        const authorization = req.headers.authorization\r\n        console.log(\"authorization: \",authorization)\r\n        Object.assign(req.headers, {\r\n            user: null,\r\n            authorization: null,\r\n        });\r\n\r\n        if (!authorization) {\r\n            return next();\r\n        }\r\n\r\n        const accessToken = authorization.split(\" \")[1];\r\n        console.log(\"accessTocken: \", accessToken);\r\n        let decoded;\r\n        if (accessToken) {\r\n            decoded = jwt.verify(accessToken, process.env.JWT_SECRET);\r\n        }\r\n        if (!decoded) {\r\n            // invalid token, remove the token from everywhere\r\n            //remove from database\r\n            //remove from redis\r\n            return next();\r\n        }\r\n\r\n        if (decoded.exp * 1000 < Date.now()) {\r\n            //remove from database\r\n            //remove from redis\r\n            return next();\r\n        }\r\n\r\n        //check if token is in redis\r\n        //if NOT in redis call next()\r\n        //else check last update time if greater than or equals to 1hour update the token\r\n        // if less skip else update token\r\n        // authorization = new token\r\n\r\n        const user = await UserModel.findById(decoded.userId);\r\n        if (!user) {\r\n            //remove from database\r\n            //remove from redis\r\n            return next();\r\n        }\r\n\r\n        // if the token has come all this way everything is good just attach it to the request header\r\n        Object.assign(req.headers, {\r\n            user,\r\n            authorization,\r\n        });\r\n\r\n        return next();\r\n    } catch (error) {\r\n        console.log(error)\r\n        return Promise.reject(new Error(\"Error Happened!\"));\r\n    }\r\n};\r\n\r\nexport default validateToken;\r\n\r\n\r\n// ------------- authorization ------------------\r\n\r\n// let check_user_action = async (req,action,resource) =>{\r\n//   if(!['updateOwn','deleteOwn'].includes(action)){\r\n//     return true\r\n//   }\r\n//\r\n//   const userResource = new Set()\r\n//\r\n//   if(resource == 'tender'){\r\n//     let userTender = await Tender.find({ creator_user: req.user._id })\r\n//     userTender.forEach(tender => userResource.add(`${tender._id}`))\r\n//\r\n//   }else if(resource == 'company'){\r\n//     let userCompany = await Company.find({ creator_user: req.user._id })\r\n//     userCompany.forEach(company => userResource.add( `${company._id}`))\r\n//\r\n//   }else if(resource == 'award'){\r\n//     let userAward = await Award.find({ creator_user: req.user._id })\r\n//     userAward.forEach(award => userResource.add(`${award._id}`))\r\n//   }\r\n//\r\n//   if(!userResource.has(req.params.id)){\r\n//     return false\r\n//   }\r\n//\r\n//   return true\r\n// }\r\n//\r\n//\r\n//\r\n// exports.authorize = function (action, resource) {\r\n//   return async (req, res, next) => {\r\n//     try {\r\n//       const permission = roles.can(req.user.role)[action](resource);\r\n//\r\n//       if (!permission.granted) {\r\n//         return res.status(401).send(\"You don't have enough permission to perform this action\");\r\n//       }\r\n//\r\n//       let result = await check_user_action(req,action,resource)\r\n//       if(!result){\r\n//         return res.status(401).send({ param: resource , msg: `You are not authorized to edit this ${resource}.` })\r\n//       }\r\n//\r\n//       next()\r\n//     } catch (error) {\r\n//       return res.status(401).send(\"You don't have enough permission to perform this action\")\r\n//     }\r\n//   }\r\n// }\r\n"]}},"mtime":1648703549482},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\phone-verification.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\n// import admin from \"../../config/firebase-config\";\nconst phoneVerification = async (resolve, source, args, context, info) => {\n  // const {phoneVerification} = context;\n  // let phoneNumber = \"\";\n  //\n  // await admin\n  //     .auth()\n  //     .verifyIdToken(phoneVerification)\n  //     .then((decodedToken) => {\n  //         phoneNumber = decodedToken.phone_number;\n  //     })\n  //     .catch(() => Promise.reject(new Error(\"Error happened!\")));\n  // if (phoneNumber === \"\") {\n  //     return Promise.reject(new Error(\"Phone number not detected!\"));\n  // }\n  // context.phoneNumber = phoneNumber;\n  return resolve(source, args, context, info);\n};\n\nvar _default = phoneVerification;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBob25lLXZlcmlmaWNhdGlvbi5qcyJdLCJuYW1lcyI6WyJwaG9uZVZlcmlmaWNhdGlvbiIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUVBLE1BQU1BLGlCQUFpQixHQUFHLE9BQU9DLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFPSixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsQ0FoQkQ7O2VBa0JlTCxpQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbWlkZGxld2FyZXNcXGF1dGhcXCIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCBhZG1pbiBmcm9tIFwiLi4vLi4vY29uZmlnL2ZpcmViYXNlLWNvbmZpZ1wiO1xyXG5cclxuY29uc3QgcGhvbmVWZXJpZmljYXRpb24gPSBhc3luYyAocmVzb2x2ZSwgc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiB7XHJcbiAgICAvLyBjb25zdCB7cGhvbmVWZXJpZmljYXRpb259ID0gY29udGV4dDtcclxuICAgIC8vIGxldCBwaG9uZU51bWJlciA9IFwiXCI7XHJcbiAgICAvL1xyXG4gICAgLy8gYXdhaXQgYWRtaW5cclxuICAgIC8vICAgICAuYXV0aCgpXHJcbiAgICAvLyAgICAgLnZlcmlmeUlkVG9rZW4ocGhvbmVWZXJpZmljYXRpb24pXHJcbiAgICAvLyAgICAgLnRoZW4oKGRlY29kZWRUb2tlbikgPT4ge1xyXG4gICAgLy8gICAgICAgICBwaG9uZU51bWJlciA9IGRlY29kZWRUb2tlbi5waG9uZV9udW1iZXI7XHJcbiAgICAvLyAgICAgfSlcclxuICAgIC8vICAgICAuY2F0Y2goKCkgPT4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3IgaGFwcGVuZWQhXCIpKSk7XHJcbiAgICAvLyBpZiAocGhvbmVOdW1iZXIgPT09IFwiXCIpIHtcclxuICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiUGhvbmUgbnVtYmVyIG5vdCBkZXRlY3RlZCFcIikpO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gY29udGV4dC5waG9uZU51bWJlciA9IHBob25lTnVtYmVyO1xyXG4gICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgcGhvbmVWZXJpZmljYXRpb247XHJcbiJdfQ==","map":{"version":3,"sources":["phone-verification.js"],"names":["phoneVerification","resolve","source","args","context","info"],"mappings":";;;;;;;AAAA;AAEA,MAAMA,iBAAiB,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAOJ,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAhBD;;eAkBeL,iB","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["// import admin from \"../../config/firebase-config\";\r\n\r\nconst phoneVerification = async (resolve, source, args, context, info) => {\r\n    // const {phoneVerification} = context;\r\n    // let phoneNumber = \"\";\r\n    //\r\n    // await admin\r\n    //     .auth()\r\n    //     .verifyIdToken(phoneVerification)\r\n    //     .then((decodedToken) => {\r\n    //         phoneNumber = decodedToken.phone_number;\r\n    //     })\r\n    //     .catch(() => Promise.reject(new Error(\"Error happened!\")));\r\n    // if (phoneNumber === \"\") {\r\n    //     return Promise.reject(new Error(\"Phone number not detected!\"));\r\n    // }\r\n    // context.phoneNumber = phoneNumber;\r\n    return resolve(source, args, context, info);\r\n}\r\n\r\nexport default phoneVerification;\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\validators\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\validators\\\\user-validator.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n// import validator from \"validators\";\nconst userValidator = {\n  changePassword: async (resolve, source, args, context, info) => {\n    const {\n      newPassword\n    } = args; // if (!validator.isLength(newPassword, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: newPassword\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  newPassword: async (resolve, source, args, context, info) => {\n    const {\n      newPassword\n    } = args; // if (!validator.isLength(newPassword, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: newPassword\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  resetPassword: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = validator.normalizeEmail(email);\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    return resolve(source, args, context, info);\n  },\n  signIn: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = email.toString().toLowerCase();\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    return resolve(source, args, context, info);\n  },\n  signUp: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = email.toString().toLowerCase();\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    const {\n      password\n    } = args; // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\n    //     return Promise.reject(new Error(\"Error: email\"));\n    // }\n    //\n    // if (!validator.isLength(password, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: password\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  updateUser: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = validator.normalizeEmail(email);\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    const {\n      firstName,\n      lastName\n    } = args; // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\n    //     return Promise.reject(new Error(\"Error: email\"));\n    // }\n    // if (!validator.isLength(firstName, {min: 2})) {\n    //     return Promise.reject(new Error(\"Error: firstName\"));\n    // }\n    // if (!validator.isLength(lastName, {min: 2})) {\n    //     return Promise.reject(new Error(\"Error: lastName\"));\n    // }\n\n    return resolve(source, args, context, info);\n  }\n};\nvar _default = userValidator;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXItdmFsaWRhdG9yLmpzIl0sIm5hbWVzIjpbInVzZXJWYWxpZGF0b3IiLCJjaGFuZ2VQYXNzd29yZCIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iLCJuZXdQYXNzd29yZCIsInJlc2V0UGFzc3dvcmQiLCJlbWFpbCIsInNpZ25JbiIsInNpZ25VcCIsInBhc3N3b3JkIiwidXBkYXRlVXNlciIsImZpcnN0TmFtZSIsImxhc3ROYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUVBLE1BQU1BLGFBQWEsR0FBRztBQUNsQkMsRUFBQUEsY0FBYyxFQUFFLE9BQU9DLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQzVELFVBQU07QUFBQ0MsTUFBQUE7QUFBRCxRQUFnQkgsSUFBdEIsQ0FENEQsQ0FHNUQ7QUFDQTtBQUNBOztBQUVBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxHQVRpQjtBQVVsQkMsRUFBQUEsV0FBVyxFQUFFLE9BQU9MLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3pELFVBQU07QUFBQ0MsTUFBQUE7QUFBRCxRQUFnQkgsSUFBdEIsQ0FEeUQsQ0FHekQ7QUFDQTtBQUNBOztBQUVBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxHQWxCaUI7QUFtQmxCRSxFQUFBQSxhQUFhLEVBQUUsT0FBT04sT0FBUCxFQUFnQkMsTUFBaEIsRUFBd0JDLElBQXhCLEVBQThCQyxPQUE5QixFQUF1Q0MsSUFBdkMsS0FBZ0Q7QUFDM0QsUUFBSTtBQUFDRyxNQUFBQTtBQUFELFFBQVVMLElBQWQsQ0FEMkQsQ0FHM0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsV0FBT0YsT0FBTyxDQUFDQyxNQUFELEVBQVNDLElBQVQsRUFBZUMsT0FBZixFQUF3QkMsSUFBeEIsQ0FBZDtBQUNILEdBNUJpQjtBQTZCbEJJLEVBQUFBLE1BQU0sRUFBRSxPQUFPUixPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUNwRCxRQUFJO0FBQUNHLE1BQUFBO0FBQUQsUUFBVUwsSUFBZCxDQURvRCxDQUdwRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxXQUFPRixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsR0F0Q2lCO0FBdUNsQkssRUFBQUEsTUFBTSxFQUFFLE9BQU9ULE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3BELFFBQUk7QUFBQ0csTUFBQUE7QUFBRCxRQUFVTCxJQUFkLENBRG9ELENBR3BEO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFVBQU07QUFBQ1EsTUFBQUE7QUFBRCxRQUFhUixJQUFuQixDQVJvRCxDQVVwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxXQUFPRixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsR0ExRGlCO0FBMkRsQk8sRUFBQUEsVUFBVSxFQUFFLE9BQU9YLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3hELFFBQUk7QUFBQ0csTUFBQUE7QUFBRCxRQUFVTCxJQUFkLENBRHdELENBR3hEO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFVBQU07QUFDRlUsTUFBQUEsU0FERTtBQUVGQyxNQUFBQTtBQUZFLFFBR0ZYLElBSEosQ0FSd0QsQ0FheEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSDtBQWxGaUIsQ0FBdEI7ZUFxRmVOLGEiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXG1pZGRsZXdhcmVzXFx2YWxpZGF0b3JzXFwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgdmFsaWRhdG9yIGZyb20gXCJ2YWxpZGF0b3JzXCI7XHJcblxyXG5jb25zdCB1c2VyVmFsaWRhdG9yID0ge1xyXG4gICAgY2hhbmdlUGFzc3dvcmQ6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB7bmV3UGFzc3dvcmR9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgobmV3UGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IG5ld1Bhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgbmV3UGFzc3dvcmQ6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB7bmV3UGFzc3dvcmR9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgobmV3UGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IG5ld1Bhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgcmVzZXRQYXNzd29yZDogYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgICAgIGxldCB7ZW1haWx9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gZW1haWwgPSB2YWxpZGF0b3Iubm9ybWFsaXplRW1haWwoZW1haWwpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxuICAgIH0sXHJcbiAgICBzaWduSW46IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBsZXQge2VtYWlsfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGVtYWlsID0gZW1haWwudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxuICAgIH0sXHJcbiAgICBzaWduVXA6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBsZXQge2VtYWlsfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGVtYWlsID0gZW1haWwudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgY29uc3Qge3Bhc3N3b3JkfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGlmICghdmFsaWRhdG9yLmlzRW1haWwoZW1haWwsIHthbGxvd191dGY4X2xvY2FsX3BhcnQ6IGZhbHNlfSkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVycm9yOiBlbWFpbFwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgocGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IHBhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgdXBkYXRlVXNlcjogYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgICAgIGxldCB7ZW1haWx9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gZW1haWwgPSB2YWxpZGF0b3Iubm9ybWFsaXplRW1haWwoZW1haWwpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICBmaXJzdE5hbWUsXHJcbiAgICAgICAgICAgIGxhc3ROYW1lLFxyXG4gICAgICAgIH0gPSBhcmdzO1xyXG5cclxuICAgICAgICAvLyBpZiAoIXZhbGlkYXRvci5pc0VtYWlsKGVtYWlsLCB7YWxsb3dfdXRmOF9sb2NhbF9wYXJ0OiBmYWxzZX0pKSB7XHJcbiAgICAgICAgLy8gICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJFcnJvcjogZW1haWxcIikpO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyBpZiAoIXZhbGlkYXRvci5pc0xlbmd0aChmaXJzdE5hbWUsIHttaW46IDJ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IGZpcnN0TmFtZVwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vIGlmICghdmFsaWRhdG9yLmlzTGVuZ3RoKGxhc3ROYW1lLCB7bWluOiAyfSkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVycm9yOiBsYXN0TmFtZVwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlclZhbGlkYXRvcjtcclxuIl19","map":{"version":3,"sources":["user-validator.js"],"names":["userValidator","changePassword","resolve","source","args","context","info","newPassword","resetPassword","email","signIn","signUp","password","updateUser","firstName","lastName"],"mappings":";;;;;;AAAA;AAEA,MAAMA,aAAa,GAAG;AAClBC,EAAAA,cAAc,EAAE,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC5D,UAAM;AAACC,MAAAA;AAAD,QAAgBH,IAAtB,CAD4D,CAG5D;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GATiB;AAUlBC,EAAAA,WAAW,EAAE,OAAOL,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACzD,UAAM;AAACC,MAAAA;AAAD,QAAgBH,IAAtB,CADyD,CAGzD;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GAlBiB;AAmBlBE,EAAAA,aAAa,EAAE,OAAON,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC3D,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CAD2D,CAG3D;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GA5BiB;AA6BlBI,EAAAA,MAAM,EAAE,OAAOR,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACpD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADoD,CAGpD;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GAtCiB;AAuClBK,EAAAA,MAAM,EAAE,OAAOT,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACpD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADoD,CAGpD;AACA;AACA;AACA;;AAEA,UAAM;AAACQ,MAAAA;AAAD,QAAaR,IAAnB,CARoD,CAUpD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GA1DiB;AA2DlBO,EAAAA,UAAU,EAAE,OAAOX,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACxD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADwD,CAGxD;AACA;AACA;AACA;;AAEA,UAAM;AACFU,MAAAA,SADE;AAEFC,MAAAA;AAFE,QAGFX,IAHJ,CARwD,CAaxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH;AAlFiB,CAAtB;eAqFeN,a","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\validators\\","sourcesContent":["// import validator from \"validators\";\r\n\r\nconst userValidator = {\r\n    changePassword: async (resolve, source, args, context, info) => {\r\n        const {newPassword} = args;\r\n\r\n        // if (!validator.isLength(newPassword, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: newPassword\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    newPassword: async (resolve, source, args, context, info) => {\r\n        const {newPassword} = args;\r\n\r\n        // if (!validator.isLength(newPassword, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: newPassword\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    resetPassword: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = validator.normalizeEmail(email);\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    signIn: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = email.toString().toLowerCase();\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    signUp: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = email.toString().toLowerCase();\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        const {password} = args;\r\n\r\n        // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\r\n        //     return Promise.reject(new Error(\"Error: email\"));\r\n        // }\r\n        //\r\n        // if (!validator.isLength(password, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: password\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    updateUser: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = validator.normalizeEmail(email);\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        const {\r\n            firstName,\r\n            lastName,\r\n        } = args;\r\n\r\n        // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\r\n        //     return Promise.reject(new Error(\"Error: email\"));\r\n        // }\r\n        // if (!validator.isLength(firstName, {min: 2})) {\r\n        //     return Promise.reject(new Error(\"Error: firstName\"));\r\n        // }\r\n        // if (!validator.isLength(lastName, {min: 2})) {\r\n        //     return Promise.reject(new Error(\"Error: lastName\"));\r\n        // }\r\n        return resolve(source, args, context, info);\r\n    },\r\n};\r\n\r\nexport default userValidator;\r\n"]}},"mtime":1648684433893},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\resolvers\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\resolvers\\\\auth-resolvers.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _authUseCases = _interopRequireDefault(require(\"../../../services/auth/use-cases/auth-use-cases\"));\n\nvar _redisServices = _interopRequireDefault(require(\"../../../services/redis/redis-services\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\nconst signIn = {\n  name: \"signIn\",\n  type: \"AccessToken!\",\n  args: {\n    phoneNumber: \"String!\",\n    password: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      phoneNumber,\n      password\n    }\n  }) => {\n    try {\n      const {\n        user,\n        accessToken\n      } = await _authUseCases.default.signIn({\n        phoneNumber,\n        password\n      });\n      return {\n        accessToken,\n        user\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst signUp = {\n  name: \"signUp\",\n  type: \"AccessToken!\",\n  args: {\n    firstName: \"String!\",\n    middleName: \"String!\",\n    lastName: \"String!\",\n    password: \"String!\",\n    phoneNumber: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      firstName,\n      middleName,\n      lastName,\n      password,\n      phoneNumber\n    },\n    context: {\n      phoneVerification\n    }\n  }) => {\n    try {\n      const {\n        accessToken,\n        user\n      } = await _authUseCases.default.signUp({\n        firstName,\n        middleName,\n        lastName,\n        password,\n        phoneNumber\n      });\n      console.log(accessToken);\n      return {\n        accessToken,\n        // roles: user.roles,\n        user\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst logout = {\n  name: 'logout',\n  type: 'Succeed!',\n  resolve: async ({\n    context: {\n      user,\n      accessToken\n    }\n  }) => {\n    try {\n      // await redis.set(`expiredToken:${accessToken}`, user._id, 'EX', process.env.REDIS_TOKEN_EXPIRY);\n      await _authUseCases.default.logout({\n        user,\n        accessToken\n      });\n      return {\n        succeed: true\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst changePassword = {\n  name: \"changePassword\",\n  type: \"AccessToken!\",\n  args: {\n    newPassword: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      newPassword\n    },\n    context: {\n      user,\n      accessToken\n    }\n  }) => {\n    try {\n      console.log(\"changepassword\");\n      const {\n        updatedUser,\n        oldAccessTocken\n      } = await _authUseCases.default.changePassword({\n        newPassword,\n        user,\n        accessToken\n      });\n      return {\n        updatedUser,\n        oldAccessTocken\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nvar _default = {\n  signIn,\n  signUp,\n  logout,\n  changePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtcmVzb2x2ZXJzLmpzIl0sIm5hbWVzIjpbInNpZ25JbiIsIm5hbWUiLCJ0eXBlIiwiYXJncyIsInBob25lTnVtYmVyIiwicGFzc3dvcmQiLCJyZXNvbHZlIiwidXNlciIsImFjY2Vzc1Rva2VuIiwiYXV0aFNlcnZpY2VzIiwiZXJyb3IiLCJQcm9taXNlIiwicmVqZWN0Iiwic2lnblVwIiwiZmlyc3ROYW1lIiwibWlkZGxlTmFtZSIsImxhc3ROYW1lIiwiY29udGV4dCIsInBob25lVmVyaWZpY2F0aW9uIiwiY29uc29sZSIsImxvZyIsImxvZ291dCIsInN1Y2NlZWQiLCJjaGFuZ2VQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwidXBkYXRlZFVzZXIiLCJvbGRBY2Nlc3NUb2NrZW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUNBO0FBRUEsTUFBTUEsTUFBTSxHQUFHO0FBQ1hDLEVBQUFBLElBQUksRUFBRSxRQURLO0FBRVhDLEVBQUFBLElBQUksRUFBRSxjQUZLO0FBR1hDLEVBQUFBLElBQUksRUFBRTtBQUNGQyxJQUFBQSxXQUFXLEVBQUUsU0FEWDtBQUVGQyxJQUFBQSxRQUFRLEVBQUU7QUFGUixHQUhLO0FBT1hDLEVBQUFBLE9BQU8sRUFBRSxPQUFPO0FBQUNILElBQUFBLElBQUksRUFBRTtBQUFDQyxNQUFBQSxXQUFEO0FBQWNDLE1BQUFBO0FBQWQ7QUFBUCxHQUFQLEtBQTJDO0FBQ2hELFFBQUk7QUFFQSxZQUFNO0FBQUNFLFFBQUFBLElBQUQ7QUFBT0MsUUFBQUE7QUFBUCxVQUFzQixNQUFNQyxzQkFBYVQsTUFBYixDQUFvQjtBQUFDSSxRQUFBQSxXQUFEO0FBQWNDLFFBQUFBO0FBQWQsT0FBcEIsQ0FBbEM7QUFFQSxhQUFPO0FBQUNHLFFBQUFBLFdBQUQ7QUFBY0QsUUFBQUE7QUFBZCxPQUFQO0FBQ0gsS0FMRCxDQUtFLE9BQU9HLEtBQVAsRUFBYztBQUNaLGFBQU9DLE9BQU8sQ0FBQ0MsTUFBUixD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RUFBYztBQUNaLGFBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlRixLQUFmLENBQVA7QUFDSDtBQUNKO0FBZmtCLENBQXZCO2VBa0JlO0FBQ1hWLEVBQUFBLE1BRFc7QUFFWGEsRUFBQUEsTUFGVztBQUdYUSxFQUFBQSxNQUhXO0FBSVhFLEVBQUFBO0FBSlcsQyIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcYXV0aFxccmVzb2x2ZXJzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcclxuaW1wb3J0IHtVc2VyTW9kZWx9IGZyb20gXCIuLi8uLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5pbXBvcnQgYXV0aFNlcnZpY2VzIGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9hdXRoL3VzZS1jYXNlcy9hdXRoLXVzZS1jYXNlc1wiO1xyXG5pbXBvcnQgc3RvcmVOZXdTZXNzaW9uIGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9yZWRpcy9yZWRpcy1zZXJ2aWNlc1wiXHJcbi8vIGltcG9ydCBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xyXG5cclxuY29uc3Qgc2lnbkluID0ge1xyXG4gICAgbmFtZTogXCJzaWduSW5cIixcclxuICAgIHR5cGU6IFwiQWNjZXNzVG9rZW4hXCIsXHJcbiAgICBhcmdzOiB7XHJcbiAgICAgICAgcGhvbmVOdW1iZXI6IFwiU3RyaW5nIVwiLFxyXG4gICAgICAgIHBhc3N3b3JkOiBcIlN0cmluZyFcIixcclxuICAgIH0sXHJcbiAgICByZXNvbHZlOiBhc3luYyAoe2FyZ3M6IHtwaG9uZU51bWJlciwgcGFzc3dvcmR9fSkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB7dXNlciwgYWNjZXNzVG9rZW59ID0gYXdhaXQgYXV0aFNlcnZpY2VzLnNpZ25Jbih7cGhvbmVOdW1iZXIsIHBhc3N3b3JkfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4ge2FjY2Vzc1Rva2VuLCB1c2VyfTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn07XHJcblxyXG5cclxuY29uc3Qgc2lnblVwID0ge1xyXG4gICAgbmFtZTogXCJzaWduVXBcIixcclxuICAgIHR5cGU6IFwiQWNjZXNzVG9rZW4hXCIsXHJcbiAgICBhcmdzOiB7XHJcbiAgICAgICAgZmlyc3ROYW1lOiBcIlN0cmluZyFcIixcclxuICAgICAgICBtaWRkbGVOYW1lOiBcIlN0cmluZyFcIixcclxuICAgICAgICBsYXN0TmFtZTogXCJTdHJpbmchXCIsXHJcbiAgICAgICAgcGFzc3dvcmQ6IFwiU3RyaW5nIVwiLFxyXG4gICAgICAgIHBob25lTnVtYmVyOiBcIlN0cmluZyFcIixcclxuICAgIH0sXHJcbiAgICByZXNvbHZlOiBhc3luYyAoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaWRkbGVOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBob25lTnVtYmVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBob25lVmVyaWZpY2F0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIH0pID0+IHtcclxuICAgICAgICB0cnkge1xyXG5cclxuICAgICAgICAgICAgY29uc3Qge2FjY2Vzc1Rva2VuLCB1c2VyfSA9IGF3YWl0IGF1dGhTZXJ2aWNlcy5zaWduVXAoe1xyXG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgbWlkZGxlTmFtZSxcclxuICAgICAgICAgICAgICAgIGxhc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICBwaG9uZU51bWJlcixcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGFjY2Vzc1Rva2VuKSAgIFxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4sXHJcbiAgICAgICAgICAgICAgICAvLyByb2xlczogdXNlci5yb2xlcyxcclxuICAgICAgICAgICAgICAgIHVzZXIsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59O1xyXG5cclxuY29uc3QgbG9nb3V0ID0ge1xyXG4gICAgbmFtZTogJ2xvZ291dCcsXHJcbiAgICB0eXBlOiAnU3VjY2VlZCEnLFxyXG4gICAgcmVzb2x2ZTogYXN5bmMgKHtjb250ZXh0OiB7dXNlciwgYWNjZXNzVG9rZW59fSkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIGF3YWl0IHJlZGlzLnNldChgZXhwaXJlZFRva2VuOiR7YWNjZXNzVG9rZW59YCwgdXNlci5faWQsICdFWCcsIHByb2Nlc3MuZW52LlJFRElTX1RPS0VOX0VYUElSWSk7XHJcbiAgICAgICAgICAgIGF3YWl0IGF1dGhTZXJ2aWNlcy5sb2dvdXQoe3VzZXIsYWNjZXNzVG9rZW59KVxyXG4gICAgICAgICAgICByZXR1cm4ge3N1Y2NlZWQ6IHRydWV9O1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuY29uc3QgY2hhbmdlUGFzc3dvcmQgPSB7XHJcbiAgICBuYW1lOiBcImNoYW5nZVBhc3N3b3JkXCIsXHJcbiAgICB0eXBlOiBcIkFjY2Vzc1Rva2VuIVwiLFxyXG4gICAgYXJnczoge1xyXG4gICAgICAgIG5ld1Bhc3N3b3JkOiBcIlN0cmluZyFcIixcclxuICAgIH0sXHJcbiAgICByZXNvbHZlOiBhc3luYyAoe2FyZ3M6IHtuZXdQYXNzd29yZH0sIGNvbnRleHQ6IHt1c2VyLCBhY2Nlc3NUb2tlbn19KSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuY29uc29sZS5sb2coXCJjaGFuZ2VwYXNzd29yZFwiKVxyXG4gICAgICAgICAgICBjb25zdCB7dXBkYXRlZFVzZXIsIG9sZEFjY2Vzc1RvY2tlbn0gPSBhd2FpdCBhdXRoU2VydmljZXMuY2hhbmdlUGFzc3dvcmQoe25ld1Bhc3N3b3JkLCB1c2VyLCBhY2Nlc3NUb2tlbn0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHt1cGRhdGVkVXNlciwgb2xkQWNjZXNzVG9ja2VufTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBzaWduSW4sXHJcbiAgICBzaWduVXAsXHJcbiAgICBsb2dvdXQsXHJcbiAgICBjaGFuZ2VQYXNzd29yZCxcclxufSJdfQ==","map":{"version":3,"sources":["auth-resolvers.js"],"names":["signIn","name","type","args","phoneNumber","password","resolve","user","accessToken","authServices","error","Promise","reject","signUp","firstName","middleName","lastName","context","phoneVerification","console","log","logout","succeed","changePassword","newPassword","updatedUser","oldAccessTocken"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AACA;AAEA,MAAMA,MAAM,GAAG;AACXC,EAAAA,IAAI,EAAE,QADK;AAEXC,EAAAA,IAAI,EAAE,cAFK;AAGXC,EAAAA,IAAI,EAAE;AACFC,IAAAA,WAAW,EAAE,SADX;AAEFC,IAAAA,QAAQ,EAAE;AAFR,GAHK;AAOXC,EAAAA,OAAO,EAAE,OAAO;AAACH,IAAAA,IAAI,EAAE;AAACC,MAAAA,WAAD;AAAcC,MAAAA;AAAd;AAAP,GAAP,KAA2C;AAChD,QAAI;AAEA,YAAM;AAACE,QAAAA,IAAD;AAAOC,QAAAA;AAAP,UAAsB,MAAMC,sBAAaT,MAAb,CAAoB;AAACI,QAAAA,WAAD;AAAcC,QAAAA;AAAd,OAApB,CAAlC;AAEA,aAAO;AAACG,QAAAA,WAAD;AAAcD,QAAAA;AAAd,OAAP;AACH,KALD,CAKE,OAAOG,KAAP,EAAc;AACZ,aAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH;AACJ;AAhBU,CAAf;AAoBA,MAAMG,MAAM,GAAG;AACXZ,EAAAA,IAAI,EAAE,QADK;AAEXC,EAAAA,IAAI,EAAE,cAFK;AAGXC,EAAAA,IAAI,EAAE;AACFW,IAAAA,SAAS,EAAE,SADT;AAEFC,IAAAA,UAAU,EAAE,SAFV;AAGFC,IAAAA,QAAQ,EAAE,SAHR;AAIFX,IAAAA,QAAQ,EAAE,SAJR;AAKFD,IAAAA,WAAW,EAAE;AALX,GAHK;AAUXE,EAAAA,OAAO,EAAE,OAAO;AACIH,IAAAA,IAAI,EAAE;AACFW,MAAAA,SADE;AAEFC,MAAAA,UAFE;AAGFC,MAAAA,QAHE;AAIFX,MAAAA,QAJE;AAKFD,MAAAA;AALE,KADV;AAQIa,IAAAA,OAAO,EAAE;AACLC,MAAAA;AADK;AARb,GAAP,KAWa;AAClB,QAAI;AAEA,YAAM;AAACV,QAAAA,WAAD;AAAcD,QAAAA;AAAd,UAAsB,MAAME,sBAAaI,MAAb,CAAoB;AAClDC,QAAAA,SADkD;AAElDC,QAAAA,UAFkD;AAGlDC,QAAAA,QAHkD;AAIlDX,QAAAA,QAJkD;AAKlDD,QAAAA;AALkD,OAApB,CAAlC;AAOAe,MAAAA,OAAO,CAACC,GAAR,CAAYZ,WAAZ;AACA,aAAO;AACHA,QAAAA,WADG;AAEH;AACAD,QAAAA;AAHG,OAAP;AAKH,KAfD,CAeE,OAAOG,KAAP,EAAc;AACZ,aAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH;AACJ;AAxCU,CAAf;AA2CA,MAAMW,MAAM,GAAG;AACXpB,EAAAA,IAAI,EAAE,QADK;AAEXC,EAAAA,IAAI,EAAE,UAFK;AAGXI,EAAAA,OAAO,EAAE,OAAO;AAACW,IAAAA,OAAO,EAAE;AAACV,MAAAA,IAAD;AAAOC,MAAAA;AAAP;AAAV,GAAP,KAA0C;AAC/C,QAAI;AACA;AACA,YAAMC,sBAAaY,MAAb,CAAoB;AAACd,QAAAA,IAAD;AAAMC,QAAAA;AAAN,OAApB,CAAN;AACA,aAAO;AAACc,QAAAA,OAAO,EAAE;AAAV,OAAP;AACH,KAJD,CAIE,OAAOZ,KAAP,EAAc;AACZ,aAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH;AACJ;AAXU,CAAf;AAcA,MAAMa,cAAc,GAAG;AACnBtB,EAAAA,IAAI,EAAE,gBADa;AAEnBC,EAAAA,IAAI,EAAE,cAFa;AAGnBC,EAAAA,IAAI,EAAE;AACFqB,IAAAA,WAAW,EAAE;AADX,GAHa;AAMnBlB,EAAAA,OAAO,EAAE,OAAO;AAACH,IAAAA,IAAI,EAAE;AAACqB,MAAAA;AAAD,KAAP;AAAsBP,IAAAA,OAAO,EAAE;AAACV,MAAAA,IAAD;AAAOC,MAAAA;AAAP;AAA/B,GAAP,KAA+D;AACpE,QAAI;AACZW,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACY,YAAM;AAACK,QAAAA,WAAD;AAAcC,QAAAA;AAAd,UAAiC,MAAMjB,sBAAac,cAAb,CAA4B;AAACC,QAAAA,WAAD;AAAcjB,QAAAA,IAAd;AAAoBC,QAAAA;AAApB,OAA5B,CAA7C;AAEA,aAAO;AAACiB,QAAAA,WAAD;AAAcC,QAAAA;AAAd,OAAP;AACH,KALD,CAKE,OAAOhB,KAAP,EAAc;AACZ,aAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH;AACJ;AAfkB,CAAvB;eAkBe;AACXV,EAAAA,MADW;AAEXa,EAAAA,MAFW;AAGXQ,EAAAA,MAHW;AAIXE,EAAAA;AAJW,C","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\resolvers\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport {UserModel} from \"../../../models/user\";\r\nimport authServices from \"../../../services/auth/use-cases/auth-use-cases\";\r\nimport storeNewSession from \"../../../services/redis/redis-services\"\r\n// import crypto from \"crypto\";\r\n\r\nconst signIn = {\r\n    name: \"signIn\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        phoneNumber: \"String!\",\r\n        password: \"String!\",\r\n    },\r\n    resolve: async ({args: {phoneNumber, password}}) => {\r\n        try {\r\n\r\n            const {user, accessToken} = await authServices.signIn({phoneNumber, password});\r\n\r\n            return {accessToken, user};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\n\r\nconst signUp = {\r\n    name: \"signUp\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        firstName: \"String!\",\r\n        middleName: \"String!\",\r\n        lastName: \"String!\",\r\n        password: \"String!\",\r\n        phoneNumber: \"String!\",\r\n    },\r\n    resolve: async ({\r\n                        args: {\r\n                            firstName,\r\n                            middleName,\r\n                            lastName,\r\n                            password,\r\n                            phoneNumber\r\n                        },\r\n                        context: {\r\n                            phoneVerification,\r\n                        },\r\n                    }) => {\r\n        try {\r\n\r\n            const {accessToken, user} = await authServices.signUp({\r\n                firstName,\r\n                middleName,\r\n                lastName,\r\n                password,\r\n                phoneNumber,\r\n            });\r\n            console.log(accessToken)   \r\n            return {\r\n                accessToken,\r\n                // roles: user.roles,\r\n                user,\r\n            };\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\nconst logout = {\r\n    name: 'logout',\r\n    type: 'Succeed!',\r\n    resolve: async ({context: {user, accessToken}}) => {\r\n        try {\r\n            // await redis.set(`expiredToken:${accessToken}`, user._id, 'EX', process.env.REDIS_TOKEN_EXPIRY);\r\n            await authServices.logout({user,accessToken})\r\n            return {succeed: true};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    }\r\n};\r\n\r\nconst changePassword = {\r\n    name: \"changePassword\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        newPassword: \"String!\",\r\n    },\r\n    resolve: async ({args: {newPassword}, context: {user, accessToken}}) => {\r\n        try {\r\nconsole.log(\"changepassword\")\r\n            const {updatedUser, oldAccessTocken} = await authServices.changePassword({newPassword, user, accessToken});\r\n\r\n            return {updatedUser, oldAccessTocken};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\nexport default {\r\n    signIn,\r\n    signUp,\r\n    logout,\r\n    changePassword,\r\n}"]}},"mtime":1648762694289},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\use-cases\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\use-cases\\\\auth-use-cases.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _session = require(\"../../../models/session\");\n\nvar _authDataAccess = _interopRequireDefault(require(\"../data-access/auth-data-access\"));\n\nvar _redisConfig = _interopRequireDefault(require(\"../../../config/redis-config\"));\n\nvar _redisServices = _interopRequireDefault(require(\"../../redis/redis-services\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\n//load our .env file\nrequire('dotenv').config();\n\nconst moment = require(\"moment\");\n\nconst signIn = async ({\n  phoneNumber,\n  password\n}) => {\n  try {\n    const user = await _authDataAccess.default.signIn({\n      phoneNumber,\n      password\n    });\n    const userId = user._id; //check if session exists in mongodb \n\n    const session = await _authDataAccess.default.findSession(userId);\n    console.log(session);\n    let accessToken;\n\n    if (session) {\n      //session exists in mongodb'\n      console.log('sessison exists');\n      let updatedDate = session.expirationDate;\n      accessToken = session.jwtToken;\n      const updatedAt = moment(session.updatedAt);\n      const now = moment(new Date());\n      const duration = moment.duration(now.diff(updatedAt)).asHours();\n      console.log(duration);\n\n      if (duration >= 1) {\n        updatedDate = moment(session.expirationDate).add(1, 'days').toDate();\n      } // increase count and date of session\n\n\n      const newSession = await _authDataAccess.default.updateSession(session.userCount + 1, session, updatedDate);\n      console.log('new session', newSession);\n      await _redisServices.default.syncWithRedis(_redisConfig.default, accessToken, newSession); //     let dataInRedis;\n      //     await client.get(accessToken, async(err,sessionData) => {\n      //        if (sessionData) {\n      //            dataInRedis = sessionData\n      //            console.log(sessionData)\n      //        }\n      //        else if (err){\n      //            console.log('errrr')\n      //            console.log(err)\n      //        }\n      //    })\n      //    console.log('data in redis ', dataInRedis)\n    } else {\n      console.log(\"session does not exit\"); //session doesn't exist create a new one\n\n      accessToken = await _jsonwebtoken.default.sign(user.toJSON(), process.env.JWT_SECRET, {\n        expiresIn: process.env.JWT_EXPIRATION\n      });\n      const tomorrowDate = moment().clone().add(1, 'days').toDate(); // save session in mongodb\n\n      const newSession = await _authDataAccess.default.saveNewSession(userId, accessToken, tomorrowDate);\n      console.log(newSession);\n      await _redisServices.default.syncWithRedis(_redisConfig.default, accessToken, newSession); // // store session in redis\n      // redisService.storeNewSession(client,session)\n    }\n\n    return {\n      accessToken,\n      user\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst signUp = async ({\n  firstName,\n  middleName,\n  lastName,\n  password,\n  phoneNumber\n}) => {\n  try {\n    const user = await _authDataAccess.default.signUp({\n      firstName,\n      middleName,\n      lastName,\n      password,\n      phoneNumber\n    });\n    const userId = user._id; //check if there is an error\n\n    const accessToken = await _jsonwebtoken.default.sign(JSON.parse(JSON.stringify(user)), // roles: user.roles,\n    process.env.JWT_SECRET, {\n      expiresIn: process.env.JWT_EXPIRATION\n    }); // storeNewSession(token, user information(id), count, last update)\n\n    const tomorrowDate = moment().clone().add(1, 'days').toDate(); // save session in mongodb\n\n    const newSession = await _authDataAccess.default.saveNewSession(userId, accessToken, tomorrowDate);\n    console.log(\"In auth us case\", accessToken);\n    await _redisServices.default.syncWithRedis(_redisConfig.default, accessToken, newSession);\n    return {\n      accessToken,\n      user\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst logout = async ({\n  user,\n  accessToken\n}) => {\n  try {\n    await _authDataAccess.default.logout({\n      user,\n      accessToken\n    });\n    await _redisServices.default.deleteSessionRedis(_redisConfig.default, accessToken);\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst changePassword = async ({\n  newPassword,\n  user,\n  accessToken\n}) => {\n  try {\n    await _authDataAccess.default.changePassword({\n      newPassword,\n      user,\n      accessToken\n    });\n    await _redisServices.default.deleteSessionRedisForChangePassword(_redisConfig.default, accessToken);\n    return {\n      user,\n      accessToken\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nvar _default = {\n  signIn,\n  signUp,\n  logout,\n  changePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtdXNlLWNhc2VzLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJtb21lbnQiLCJzaWduSW4iLCJwaG9uZU51bWJlciIsInBhc3N3b3JkIiwidXNlciIsImF1dGhSZXBvc2l0b3J5IiwidXNlcklkIiwiX2lkIiwic2Vzc2lvbiIsImZpbmRTZXNzaW9uIiwiY29uc29sZSIsImxvZyIsImFjY2Vzc1Rva2VuIiwidXBkYXRlZERhdGUiLCJleHBpcmF0aW9uRGF0ZSIsImp3dFRva2VuIiwidXBkYXRlZEF0Iiwibm93IiwiRGF0ZSIsImR1cmF0aW9uIiwiZGlmZiIsImFzSG91cnMiLCJhZGQiLCJ0b0RhdGUiLCJuZXdTZXNzaW9uIiwidXBkYXRlU2Vzc2lvbiIsInVzZXJDb3VudCIsInJlZGlzU2VydmljZSIsInN5bmNXaXRoUmVkaXMiLCJjbGllbnQiLCJqd3QiLCJzaWduIiwidG9KU09OIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJleHBpcmVzSW4iLCJKV1RfRVhQSVJBVElPTiIsInRvbW9ycm93RGF0ZSIsImNsb25lIiwic2F2ZU5ld1Nlc3Npb24iLCJlcnJvciIsIlByb21pc2UiLCJyZWplY3QiLCJzaWduVXAiLCJmaXJzdE5hbWUiLCJtaWRkbGVOYW1lIiwibGFzdE5hbWUiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJsb2dvdXQiLCJkZWxldGVTZXNzaW9uUmVkaXMiLCJjaGFuZ2VQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwiZGVsZXRlU2Vzc2lvblJlZGlzRm9yQ2hhbmdlUGFzc3dvcmQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7OztBQUhBO0FBSUE7QUFDQUEsT0FBTyxDQUFDLFFBQUQsQ0FBUCxDQUFrQkMsTUFBbEI7O0FBRUEsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUMsUUFBRCxDQUF0Qjs7QUFFQSxNQUFNRyxNQUFNLEdBQUcsT0FBTztBQUFD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Q0FBZUYsS0FBZixDQUFQO0FBQ0g7QUFDSixDQVJEOztlQVVlO0FBQ1h4QyxFQUFBQSxNQURXO0FBRVgyQyxFQUFBQSxNQUZXO0FBR1hPLEVBQUFBLE1BSFc7QUFJWEUsRUFBQUE7QUFKVyxDIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxzZXJ2aWNlc1xcYXV0aFxcdXNlLWNhc2VzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcclxuaW1wb3J0IHtVc2VyTW9kZWx9IGZyb20gXCIuLi8uLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5pbXBvcnQge1Nlc3Npb25Nb2RlbH0gZnJvbSBcIi4uLy4uLy4uL21vZGVscy9zZXNzaW9uXCI7XHJcbi8vIGltcG9ydCBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xyXG5pbXBvcnQgYXV0aFJlcG9zaXRvcnkgZnJvbSBcIi4uL2RhdGEtYWNjZXNzL2F1dGgtZGF0YS1hY2Nlc3NcIjtcclxuaW1wb3J0IGNsaWVudCBmcm9tIFwiLi4vLi4vLi4vY29uZmlnL3JlZGlzLWNvbmZpZ1wiO1xyXG5pbXBvcnQgcmVkaXNTZXJ2aWNlIGZyb20gXCIuLi8uLi9yZWRpcy9yZWRpcy1zZXJ2aWNlc1wiXHJcbi8vbG9hZCBvdXIgLmVudiBmaWxlXHJcbnJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpXHJcblxyXG5jb25zdCBtb21lbnQgPSByZXF1aXJlKFwibW9tZW50XCIpXHJcblxyXG5jb25zdCBzaWduSW4gPSBhc3luYyAoe3Bob25lTnVtYmVyLCBwYXNzd29yZH0pID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGF1dGhSZXBvc2l0b3J5LnNpZ25Jbih7cGhvbmVOdW1iZXIsIHBhc3N3b3JkfSk7XHJcbiAgICAgICAgY29uc3QgdXNlcklkID0gdXNlci5faWRcclxuICAgICAgICAvL2NoZWNrIGlmIHNlc3Npb24gZXhpc3RzIGluIG1vbmdvZGIgXHJcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGF1dGhSZXBvc2l0b3J5LmZpbmRTZXNzaW9uKHVzZXJJZClcclxuICAgICAgICBjb25zb2xlLmxvZyhzZXNzaW9uKVxyXG4gICAgICAgIGxldCBhY2Nlc3NUb2tlbjtcclxuXHJcbiAgICAgICAgaWYgKHNlc3Npb24pIHtcclxuICAgICAgICAgICAgLy9zZXNzaW9uIGV4aXN0cyBpbiBtb25nb2RiJ1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2Vzc2lzb24gZXhpc3RzJylcclxuICAgICAgICAgICAgbGV0IHVwZGF0ZWREYXRlID0gc2Vzc2lvbi5leHBpcmF0aW9uRGF0ZTtcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBzZXNzaW9uLmp3dFRva2VuXHJcblxyXG4gICAgICAgICAgICBjb25zdCB1cGRhdGVkQXQgPSBtb21lbnQoc2Vzc2lvbi51cGRhdGVkQXQpXHJcbiAgICAgICAgICAgIGNvbnN0IG5vdyA9IG1vbWVudChuZXcgRGF0ZSgpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gKG1vbWVudC5kdXJhdGlvbihub3cuZGlmZih1cGRhdGVkQXQpKSkuYXNIb3VycygpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGR1cmF0aW9uKVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGR1cmF0aW9uID49IDEpIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZWREYXRlID0gKG1vbWVudChzZXNzaW9uLmV4cGlyYXRpb25EYXRlKS5hZGQoMSwnZGF5cycpKS50b0RhdGUoKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGluY3JlYXNlIGNvdW50IGFuZCBkYXRlIG9mIHNlc3Npb25cclxuICAgICAgICAgICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IGF1dGhSZXBvc2l0b3J5LnVwZGF0ZVNlc3Npb24oc2Vzc2lvbi51c2VyQ291bnQrMSxzZXNzaW9uLHVwZGF0ZWREYXRlKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbmV3IHNlc3Npb24nLCBuZXdTZXNzaW9uKVxyXG4gICAgICAgICAgICBhd2FpdCByZWRpc1NlcnZpY2Uuc3luY1dpdGhSZWRpcyhjbGllbnQsYWNjZXNzVG9rZW4sbmV3U2Vzc2lvbilcclxuICAgICAgICAvLyAgICAgbGV0IGRhdGFJblJlZGlzO1xyXG4gICAgICAgIC8vICAgICBhd2FpdCBjbGllbnQuZ2V0KGFjY2Vzc1Rva2VuLCBhc3luYyhlcnIsc2Vzc2lvbkRhdGEpID0+IHtcclxuICAgICAgICAvLyAgICAgICAgaWYgKHNlc3Npb25EYXRhKSB7XHJcbiAgICAgICAgLy8gICAgICAgICAgICBkYXRhSW5SZWRpcyA9IHNlc3Npb25EYXRhXHJcbiAgICAgICAgLy8gICAgICAgICAgICBjb25zb2xlLmxvZyhzZXNzaW9uRGF0YSlcclxuICAgICAgICAvLyAgICAgICAgfVxyXG4gICAgICAgIC8vICAgICAgICBlbHNlIGlmIChlcnIpe1xyXG4gICAgICAgIC8vICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycnJyJylcclxuICAgICAgICAvLyAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcclxuICAgICAgICAvLyAgICAgICAgfVxyXG4gICAgICAgIC8vICAgIH0pXHJcbiAgICAgICAgLy8gICAgY29uc29sZS5sb2coJ2RhdGEgaW4gcmVkaXMgJywgZGF0YUluUmVkaXMpXHJcbiAgICAgICAgfVxyXG4gXHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic2Vzc2lvbiBkb2VzIG5vdCBleGl0XCIpXHJcbiAgICAgICAgICAgIC8vc2Vzc2lvbiBkb2Vzbid0IGV4aXN0IGNyZWF0ZSBhIG5ldyBvbmVcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBhd2FpdCBqd3Quc2lnbih1c2VyLnRvSlNPTigpLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVULCB7XHJcbiAgICAgICAgICAgICAgICBleHBpcmVzSW46IHByb2Nlc3MuZW52LkpXVF9FWFBJUkFUSU9OLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHRvbW9ycm93RGF0ZSA9IChtb21lbnQoKS5jbG9uZSgpLmFkZCgxLCdkYXlzJykpLnRvRGF0ZSgpXHJcbiAgICAgICAgICAgIC8vIHNhdmUgc2Vzc2lvbiBpbiBtb25nb2RiXHJcbiAgICAgICAgICAgIGNvbnN0IG5ld1Nlc3Npb24gPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5zYXZlTmV3U2Vzc2lvbih1c2VySWQsYWNjZXNzVG9rZW4sdG9tb3Jyb3dEYXRlKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhuZXdTZXNzaW9uKVxyXG4gICAgICAgICAgICBhd2FpdCByZWRpc1NlcnZpY2Uuc3luY1dpdGhSZWRpcyhjbGllbnQsYWNjZXNzVG9rZW4sbmV3U2Vzc2lvbilcclxuICAgICAgICAgICAgLy8gLy8gc3RvcmUgc2Vzc2lvbiBpbiByZWRpc1xyXG4gICAgICAgICAgICAvLyByZWRpc1NlcnZpY2Uuc3RvcmVOZXdTZXNzaW9uKGNsaWVudCxzZXNzaW9uKVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgdXNlcixcclxuICAgICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBzaWduVXAgPSBhc3luYyAoe2ZpcnN0TmFtZSxtaWRkbGVOYW1lLGxhc3ROYW1lLHBhc3N3b3JkLHBob25lTnVtYmVyfSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgYXV0aFJlcG9zaXRvcnkuc2lnblVwKHtmaXJzdE5hbWUsbWlkZGxlTmFtZSxsYXN0TmFtZSxwYXNzd29yZCxwaG9uZU51bWJlcn0pXHJcbiAgICAgICAgY29uc3QgdXNlcklkID0gdXNlci5faWRcclxuICAgICAgICAvL2NoZWNrIGlmIHRoZXJlIGlzIGFuIGVycm9yXHJcblxyXG4gICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXdhaXQgand0LnNpZ24oXHJcbiAgICAgICAgICAgIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodXNlcikpLFxyXG4gICAgICAgICAgICAvLyByb2xlczogdXNlci5yb2xlcyxcclxuICAgICAgICAgICAgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCwge1xyXG4gICAgICAgICAgICBleHBpcmVzSW46IHByb2Nlc3MuZW52LkpXVF9FWFBJUkFUSU9OLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBzdG9yZU5ld1Nlc3Npb24odG9rZW4sIHVzZXIgaW5mb3JtYXRpb24oaWQpLCBjb3VudCwgbGFzdCB1cGRhdGUpXHJcbiAgICAgICAgY29uc3QgdG9tb3Jyb3dEYXRlID0gKG1vbWVudCgpLmNsb25lKCkuYWRkKDEsJ2RheXMnKSkudG9EYXRlKClcclxuICAgICAgICAvLyBzYXZlIHNlc3Npb24gaW4gbW9uZ29kYlxyXG4gICAgICAgIGNvbnN0IG5ld1Nlc3Npb24gPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5zYXZlTmV3U2Vzc2lvbih1c2VySWQsYWNjZXNzVG9rZW4sdG9tb3Jyb3dEYXRlKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiSW4gYXV0aCB1cyBjYXNlXCIsYWNjZXNzVG9rZW4pXHJcbiAgICAgICAgYXdhaXQgcmVkaXNTZXJ2aWNlLnN5bmNXaXRoUmVkaXMoY2xpZW50LGFjY2Vzc1Rva2VuLG5ld1Nlc3Npb24pXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW4sXHJcbiAgICAgICAgICAgIHVzZXIsXHJcbiAgICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgIH1cclxufVxyXG5cclxuY29uc3QgbG9nb3V0ID0gYXN5bmMgKHt1c2VyLCBhY2Nlc3NUb2tlbn0pID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgYXV0aFJlcG9zaXRvcnkubG9nb3V0KHt1c2VyLCBhY2Nlc3NUb2tlbn0pXHJcbiAgICAgICAgYXdhaXQgcmVkaXNTZXJ2aWNlLmRlbGV0ZVNlc3Npb25SZWRpcyhjbGllbnQsYWNjZXNzVG9rZW4pXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IGNoYW5nZVBhc3N3b3JkID0gYXN5bmMgKHtuZXdQYXNzd29yZCwgdXNlciwgYWNjZXNzVG9rZW59KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IGF1dGhSZXBvc2l0b3J5LmNoYW5nZVBhc3N3b3JkKHtuZXdQYXNzd29yZCwgdXNlciwgYWNjZXNzVG9rZW59KVxyXG4gICAgICAgIGF3YWl0IHJlZGlzU2VydmljZS5kZWxldGVTZXNzaW9uUmVkaXNGb3JDaGFuZ2VQYXNzd29yZChjbGllbnQsYWNjZXNzVG9rZW4pXHJcbiAgICAgICAgcmV0dXJuIHt1c2VyLCBhY2Nlc3NUb2tlbn07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICAgIHNpZ25JbixcclxuICAgIHNpZ25VcCxcclxuICAgIGxvZ291dCxcclxuICAgIGNoYW5nZVBhc3N3b3JkLFxyXG59Il19","map":{"version":3,"sources":["auth-use-cases.js"],"names":["require","config","moment","signIn","phoneNumber","password","user","authRepository","userId","_id","session","findSession","console","log","accessToken","updatedDate","expirationDate","jwtToken","updatedAt","now","Date","duration","diff","asHours","add","toDate","newSession","updateSession","userCount","redisService","syncWithRedis","client","jwt","sign","toJSON","process","env","JWT_SECRET","expiresIn","JWT_EXPIRATION","tomorrowDate","clone","saveNewSession","error","Promise","reject","signUp","firstName","middleName","lastName","JSON","parse","stringify","logout","deleteSessionRedis","changePassword","newPassword","deleteSessionRedisForChangePassword"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\services\\auth\\use-cases\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport {UserModel} from \"../../../models/user\";\r\nimport {SessionModel} from \"../../../models/session\";\r\n// import crypto from \"crypto\";\r\nimport authRepository from \"../data-access/auth-data-access\";\r\nimport client from \"../../../config/redis-config\";\r\nimport redisService from \"../../redis/redis-services\"\r\n//load our .env file\r\nrequire('dotenv').config()\r\n\r\nconst moment = require(\"moment\")\r\n\r\nconst signIn = async ({phoneNumber, password}) => {\r\n    try {\r\n        const user = await authRepository.signIn({phoneNumber, password});\r\n        const userId = user._id\r\n        //check if session exists in mongodb \r\n        const session = await authRepository.findSession(userId)\r\n        console.log(session)\r\n        let accessToken;\r\n\r\n        if (session) {\r\n            //session exists in mongodb'\r\n            console.log('sessison exists')\r\n            let updatedDate = session.expirationDate;\r\n            accessToken = session.jwtToken\r\n\r\n            const updatedAt = moment(session.updatedAt)\r\n            const now = moment(new Date());\r\n            \r\n            const duration = (moment.duration(now.diff(updatedAt))).asHours()\r\n            console.log(duration)\r\n            \r\n            if (duration >= 1) {\r\n                updatedDate = (moment(session.expirationDate).add(1,'days')).toDate()\r\n            }\r\n            // increase count and date of session\r\n            const newSession = await authRepository.updateSession(session.userCount+1,session,updatedDate)\r\n            console.log('new session', newSession)\r\n            await redisService.syncWithRedis(client,accessToken,newSession)\r\n        //     let dataInRedis;\r\n        //     await client.get(accessToken, async(err,sessionData) => {\r\n        //        if (sessionData) {\r\n        //            dataInRedis = sessionData\r\n        //            console.log(sessionData)\r\n        //        }\r\n        //        else if (err){\r\n        //            console.log('errrr')\r\n        //            console.log(err)\r\n        //        }\r\n        //    })\r\n        //    console.log('data in redis ', dataInRedis)\r\n        }\r\n \r\n        else {\r\n            console.log(\"session does not exit\")\r\n            //session doesn't exist create a new one\r\n            accessToken = await jwt.sign(user.toJSON(), process.env.JWT_SECRET, {\r\n                expiresIn: process.env.JWT_EXPIRATION,\r\n            });\r\n      \r\n            const tomorrowDate = (moment().clone().add(1,'days')).toDate()\r\n            // save session in mongodb\r\n            const newSession = await authRepository.saveNewSession(userId,accessToken,tomorrowDate)\r\n            console.log(newSession)\r\n            await redisService.syncWithRedis(client,accessToken,newSession)\r\n            // // store session in redis\r\n            // redisService.storeNewSession(client,session)\r\n        }\r\n        \r\n        return {\r\n            accessToken,\r\n            user,\r\n        };\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst signUp = async ({firstName,middleName,lastName,password,phoneNumber}) => {\r\n    try {\r\n        const user = await authRepository.signUp({firstName,middleName,lastName,password,phoneNumber})\r\n        const userId = user._id\r\n        //check if there is an error\r\n\r\n        const accessToken = await jwt.sign(\r\n            JSON.parse(JSON.stringify(user)),\r\n            // roles: user.roles,\r\n            process.env.JWT_SECRET, {\r\n            expiresIn: process.env.JWT_EXPIRATION,\r\n        });\r\n\r\n        // storeNewSession(token, user information(id), count, last update)\r\n        const tomorrowDate = (moment().clone().add(1,'days')).toDate()\r\n        // save session in mongodb\r\n        const newSession = await authRepository.saveNewSession(userId,accessToken,tomorrowDate)\r\n        console.log(\"In auth us case\",accessToken)\r\n        await redisService.syncWithRedis(client,accessToken,newSession)\r\n        return {\r\n            accessToken,\r\n            user,\r\n        };\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst logout = async ({user, accessToken}) => {\r\n    try {\r\n        await authRepository.logout({user, accessToken})\r\n        await redisService.deleteSessionRedis(client,accessToken)\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst changePassword = async ({newPassword, user, accessToken}) => {\r\n    try {\r\n        await authRepository.changePassword({newPassword, user, accessToken})\r\n        await redisService.deleteSessionRedisForChangePassword(client,accessToken)\r\n        return {user, accessToken};\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nexport default {\r\n    signIn,\r\n    signUp,\r\n    logout,\r\n    changePassword,\r\n}"]}},"mtime":1648762623197},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\session.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SessionTC = exports.SessionSchema = exports.SessionModel = void 0;\n\nvar _mongoose = _interopRequireWildcard(require(\"mongoose\"));\n\nvar _mongooseTimestamp = _interopRequireDefault(require(\"mongoose-timestamp\"));\n\nvar _graphqlComposeMongoose = require(\"graphql-compose-mongoose\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nconst SessionSchema = new _mongoose.Schema({\n  userId: {\n    type: _mongoose.Schema.Types.ObjectId,\n    ref: \"User\"\n  },\n  jwtToken: String,\n  expirationDate: Date,\n  userCount: Number\n}, {\n  collection: \"sessions\"\n});\nexports.SessionSchema = SessionSchema;\nSessionSchema.plugin(_mongooseTimestamp.default);\nSessionSchema.index({\n  createdAt: 1,\n  updatedAt: 1\n});\n\nconst SessionModel = _mongoose.default.model(\"Session\", SessionSchema);\n\nexports.SessionModel = SessionModel;\nconst SessionTC = (0, _graphqlComposeMongoose.composeWithMongoose)(SessionModel);\nexports.SessionTC = SessionTC;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlc3Npb24uanMiXSwibmFtZXMiOlsiU2Vzc2lvblNjaGVtYSIsIlNjaGVtYSIsInVzZXJJZCIsInR5cGUiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwiand0VG9rZW4iLCJTdHJpbmciLCJleHBpcmF0aW9uRGF0ZSIsIkRhdGUiLCJ1c2VyQ291bnQiLCJOdW1iZXIiLCJjb2xsZWN0aW9uIiwicGx1Z2luIiwidGltZXN0YW1wcyIsImluZGV4IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwiU2Vzc2lvbk1vZGVsIiwibW9uZ29vc2UiLCJtb2RlbCIsIlNlc3Npb25UQyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLE1BQU1BLGFBQWEsR0FBRyxJQUFJQyxnQkFBSixDQUFXO0FBQzdCQyxFQUFBQSxNQUFNLEVBQUU7QUFDSkMsSUFBQUEsSUFBSSxFQUFFRixpQkFBT0csS0FBUCxDQUFhQyxRQURmO0FBRUpDLElBQUFBLEdBQUcsRUFBRTtBQUZELEdBRHFCO0FBSzdCQyxFQUFBQSxRQUFRLEVBQUVDLE1BTG1CO0FBTTdCQyxFQUFBQSxjQUFjLEVBQUVDLElBTmE7QUFPN0JDLEVBQUFBLFNBQVMsRUFBRUM7QUFQa0IsQ0FBWCxFQVFuQjtBQUNDQyxFQUFBQSxVQUFVLEVBQUU7QUFEYixDQVJtQixDQUF0Qjs7QUFZQWIsYUFBYSxDQUFDYyxNQUFkLENBQXFCQywwQkFBckI7QUFDQWYsYUFBYSxDQUFDZ0IsS0FBZCxDQUFvQjtBQUNoQkMsRUFBQUEsU0FBUyxFQUFFLENBREs7QUFFaEJDLEVBQUFBLFNBQVMsRUFBRTtBQUZLLENBQXBCOztBQUtBLE1BQU1DLFlBQVksR0FBR0Msa0JBQVNDLEtBQVQsQ0FBZSxTQUFmLEVBQTBCckIsYUFBMUIsQ0FBckI7OztBQUNBLE1BQU1zQixTQUFTLEdBQUcsaURBQW9CSCxZQUFwQixDQUFsQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbW9kZWxzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UsIHtTY2hlbWF9IGZyb20gXCJtb25nb29zZVwiO1xyXG5pbXBvcnQgdGltZXN0YW1wcyBmcm9tIFwibW9uZ29vc2UtdGltZXN0YW1wXCI7XHJcbmltcG9ydCB7Y29tcG9zZVdpdGhNb25nb29zZX0gZnJvbSBcImdyYXBocWwtY29tcG9zZS1tb25nb29zZVwiO1xyXG5cclxuY29uc3QgU2Vzc2lvblNjaGVtYSA9IG5ldyBTY2hlbWEoe1xyXG4gICAgdXNlcklkOiB7XHJcbiAgICAgICAgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgIHJlZjogXCJVc2VyXCIsXHJcbiAgICB9LFxyXG4gICAgand0VG9rZW46IFN0cmluZyxcclxuICAgIGV4cGlyYXRpb25EYXRlOiBEYXRlLFxyXG4gICAgdXNlckNvdW50OiBOdW1iZXIsXHJcbn0sIHtcclxuICAgIGNvbGxlY3Rpb246IFwic2Vzc2lvbnNcIixcclxufSk7XHJcblxyXG5TZXNzaW9uU2NoZW1hLnBsdWdpbih0aW1lc3RhbXBzKTtcclxuU2Vzc2lvblNjaGVtYS5pbmRleCh7XHJcbiAgICBjcmVhdGVkQXQ6IDEsXHJcbiAgICB1cGRhdGVkQXQ6IDEsXHJcbn0pO1xyXG5cclxuY29uc3QgU2Vzc2lvbk1vZGVsID0gbW9uZ29vc2UubW9kZWwoXCJTZXNzaW9uXCIsIFNlc3Npb25TY2hlbWEpO1xyXG5jb25zdCBTZXNzaW9uVEMgPSBjb21wb3NlV2l0aE1vbmdvb3NlKFNlc3Npb25Nb2RlbCk7XHJcblxyXG5leHBvcnQge1Nlc3Npb25Nb2RlbCwgU2Vzc2lvblRDLCBTZXNzaW9uU2NoZW1hfTtcclxuIl19","map":{"version":3,"sources":["session.js"],"names":["SessionSchema","Schema","userId","type","Types","ObjectId","ref","jwtToken","String","expirationDate","Date","userCount","Number","collection","plugin","timestamps","index","createdAt","updatedAt","SessionModel","mongoose","model","SessionTC"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,aAAa,GAAG,IAAIC,gBAAJ,CAAW;AAC7BC,EAAAA,MAAM,EAAE;AACJC,IAAAA,IAAI,EAAEF,iBAAOG,KAAP,CAAaC,QADf;AAEJC,IAAAA,GAAG,EAAE;AAFD,GADqB;AAK7BC,EAAAA,QAAQ,EAAEC,MALmB;AAM7BC,EAAAA,cAAc,EAAEC,IANa;AAO7BC,EAAAA,SAAS,EAAEC;AAPkB,CAAX,EAQnB;AACCC,EAAAA,UAAU,EAAE;AADb,CARmB,CAAtB;;AAYAb,aAAa,CAACc,MAAd,CAAqBC,0BAArB;AACAf,aAAa,CAACgB,KAAd,CAAoB;AAChBC,EAAAA,SAAS,EAAE,CADK;AAEhBC,EAAAA,SAAS,EAAE;AAFK,CAApB;;AAKA,MAAMC,YAAY,GAAGC,kBAASC,KAAT,CAAe,SAAf,EAA0BrB,aAA1B,CAArB;;;AACA,MAAMsB,SAAS,GAAG,iDAAoBH,YAApB,CAAlB","sourceRoot":"E:\\haleta-new-api\\src\\models\\","sourcesContent":["import mongoose, {Schema} from \"mongoose\";\r\nimport timestamps from \"mongoose-timestamp\";\r\nimport {composeWithMongoose} from \"graphql-compose-mongoose\";\r\n\r\nconst SessionSchema = new Schema({\r\n    userId: {\r\n        type: Schema.Types.ObjectId,\r\n        ref: \"User\",\r\n    },\r\n    jwtToken: String,\r\n    expirationDate: Date,\r\n    userCount: Number,\r\n}, {\r\n    collection: \"sessions\",\r\n});\r\n\r\nSessionSchema.plugin(timestamps);\r\nSessionSchema.index({\r\n    createdAt: 1,\r\n    updatedAt: 1,\r\n});\r\n\r\nconst SessionModel = mongoose.model(\"Session\", SessionSchema);\r\nconst SessionTC = composeWithMongoose(SessionModel);\r\n\r\nexport {SessionModel, SessionTC, SessionSchema};\r\n"]}},"mtime":1648685190383},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\data-access\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\data-access\\\\auth-data-access.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _session = require(\"../../../models/session\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\nconst signIn = async ({\n  phoneNumber,\n  password\n}) => {\n  try {\n    const user = await _user.UserModel.findOne({\n      phoneNumber\n    }); // const comparePassword = await user.comparePassword(password.toString());\n\n    const comparePassword = password.toString() === user.password;\n\n    if (!comparePassword) {\n      return Promise.reject(new Error(\"Password is incorrect.\"));\n    }\n\n    return user;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst saveNewSession = async (userId, jwtToken, tomorrowDate) => {\n  try {\n    const newSession = await new _session.SessionModel({\n      userId: userId,\n      jwtToken: jwtToken,\n      expirationDate: tomorrowDate,\n      userCount: 1\n    }).save();\n    return newSession;\n  } catch (error) {\n    console.log('error in saving new session');\n    console.log(error);\n    return Promise.reject(error);\n  }\n};\n\nconst findSession = async userId => {\n  try {\n    const session = await _session.SessionModel.findOne({\n      userId\n    });\n    return session;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst updateSession = async (count, session, updatedDate) => {\n  try {\n    session.userCount = count;\n    session.expirationDate = updatedDate;\n    const newSession = await session.save();\n    return newSession;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst deleteSession = async session => {\n  try {\n    console.log('remove');\n    await session.remove();\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst signUp = async ({\n  firstName,\n  middleName,\n  lastName,\n  phoneNumber,\n  password\n}) => {\n  try {\n    // let user = await UserModel.phoneNumberExist(phoneNumber);\n    // if (user) {\n    //     console.log(\"here 2\")\n    //     return Promise.reject(new Error(\"Phone Number has already been taken.\"));\n    // }\n    // user = await UserModel.emailExist(email);\n    // if (user) {\n    //   return Promise.reject(new Error(\"Email has already been taken.\"));\n    // }\n    // const salt = bcrypt.genSalt(10);\n    // const hash = bcrypt.hashSync(password, salt);\n    const user = await new _user.UserModel({\n      firstName,\n      middleName,\n      lastName,\n      phoneNumber,\n      password\n    }).save();\n    return user;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst logout = async ({\n  user,\n  accessToken\n}) => {\n  try {\n    const userId = user._id;\n    const session = await findSession(userId);\n    const count = session.userCount;\n\n    if (count > 1) {\n      count -= 1;\n      updateSession(count, session, session.expirationDate);\n    } //delete session\n    else if (count === 1) {\n      deleteSession(session);\n    }\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nconst changePassword = async ({\n  newPassword,\n  user,\n  accessToken\n}) => {\n  try {\n    console.log(\"sim user: \", user);\n    console.log(\"new password: \", newPassword);\n    console.log(\"pass: \", user.password);\n    const userphone = user.phoneNumber;\n    const userWith = await _user.UserModel.findOne({\n      userphone\n    });\n    const userId = userWith._id;\n    const session = await findSession(userId);\n    userWith.password = newPassword;\n    const updatedUser = await userWith.save(function (err) {\n      if (err) return handleErr(err); //user has been updated\n\n      console.log(\"success\");\n    });\n    const oldAccessTocken = accessToken; //delete session\n\n    await deleteSession(session);\n    return {\n      updatedUser,\n      oldAccessTocken\n    };\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nvar _default = {\n  signIn,\n  signUp,\n  saveNewSession,\n  findSession,\n  updateSession,\n  logout,\n  changePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtZGF0YS1hY2Nlc3MuanMiXSwibmFtZXMiOlsic2lnbkluIiwicGhvbmVOdW1iZXIiLCJwYXNzd29yZCIsInVzZXIiLCJVc2VyTW9kZWwiLCJmaW5kT25lIiwiY29tcGFyZVBhc3N3b3JkIiwidG9TdHJpbmciLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiLCJlcnJvciIsInNhdmVOZXdTZXNzaW9uIiwidXNlcklkIiwiand0VG9rZW4iLCJ0b21vcnJvd0RhdGUiLCJuZXdTZXNzaW9uIiwiU2Vzc2lvbk1vZGVsIiwiZXhwaXJhdGlvbkRhdGUiLCJ1c2VyQ291bnQiLCJzYXZlIiwiY29uc29sZSIsImxvZyIsImZpbmRTZXNzaW9uIiwic2Vzc2lvbiIsInVwZGF0ZVNlc3Npb24iLCJjb3VudCIsInVwZGF0ZWREYXRlIiwiZGVsZXRlU2Vzc2lvbiIsInJlbW92ZSIsInNpZ25VcCIsImZpcnN0TmFtZSIsIm1pZGRsZU5hbWUiLCJsYXN0TmFtZSIsImxvZ291dCIsImFjY2Vzc1Rva2VuIiwiX2lkIiwiY2hhbmdlUGFzc3dvcmQiLCJuZXdQYXNzd29yZCIsInVzZXJwaG9uZSIsInVzZXJXaXRoIiwidXBkYXRlZFVzZXIiLCJlcnIiLCJoYW5kbGVFcnIiLCJvbGRBY2Nlc3NUb2NrZW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7OztBQUNBO0FBRUEsTUFBTUEsTUFBTSxHQUFHLE9BQU87QUFBRUMsRUFBQUEsV0FBRjtBQUFlQyxFQUFBQTtBQUFmLENBQVAsS0FBcUM7QUFDbEQsTUFBSTtBQUNGLFVBQU1DLElBQUksR0FBRyxNQUFNQyxnQkFBVUMsT0FBVixDQUFrQjtBQUFFSixNQUFBQTtBQUFGLEtBQWxCLENBQW5CLENBREUsQ0FHRjs7QUFDQSxVQUFNSyxlQUFlLEdBQUlKLFFBQVEsQ0FBQ0ssUUFBVCxPQUF3QkosSUFBSSxDQUFDRCxRQUF0RDs7QUFDQSxRQUFJLENBQUNJLGVBQUwsRUFBc0I7QUFDcEIsYUFBT0UsT0FBTyxD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QUFWLENBQWtCO0FBQUVrQyxNQUFBQTtBQUFGLEtBQWxCLENBQXZCO0FBQ0EsVUFBTTFCLE1BQU0sR0FBRzJCLFFBQVEsQ0FBQ0osR0FBeEI7QUFDQSxVQUFNWixPQUFPLEdBQUcsTUFBTUQsV0FBVyxDQUFDVixNQUFELENBQWpDO0FBRUEyQixJQUFBQSxRQUFRLENBQUN0QyxRQUFULEdBQWtCb0MsV0FBbEI7QUFDQSxVQUFNRyxXQUFXLEdBQUcsTUFBTUQsUUFBUSxDQUFDcEIsSUFBVCxDQUFjLFVBQVNzQixHQUFULEVBQWE7QUFDbkQsVUFBR0EsR0FBSCxFQUFPLE9BQU9DLFNBQVMsQ0FBQ0QsR0FBRCxDQUFoQixDQUQ0QyxDQUVuRDs7QUFDQXJCLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFNBQVo7QUFDRCxLQUp5QixDQUExQjtBQUtBLFVBQU1zQixlQUFlLEdBQUdULFdBQXhCLENBZkUsQ0FnQkY7O0FBQ0EsVUFBTVAsYUFBYSxDQUFDSixPQUFELENBQW5CO0FBQ0UsV0FBTztBQUFDaUIsTUFBQUEsV0FBRDtBQUFjRyxNQUFBQTtBQUFkLEtBQVA7QUFDSCxHQW5CRCxDQW1CRSxPQUFPakMsS0FBUCxFQUFjO0FBQ2RVLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZWCxLQUFaO0FBQ0Q7QUFDRixDQXZCRDs7ZUF5QmU7QUFDYlgsRUFBQUEsTUFEYTtBQUViOEIsRUFBQUEsTUFGYTtBQUdibEIsRUFBQUEsY0FIYTtBQUliVyxFQUFBQSxXQUphO0FBS2JFLEVBQUFBLGFBTGE7QUFNYlMsRUFBQUEsTUFOYTtBQU9iRyxFQUFBQTtBQVBhLEMiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXHNlcnZpY2VzXFxhdXRoXFxkYXRhLWFjY2Vzc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcbmltcG9ydCB7IFVzZXJNb2RlbCB9IGZyb20gXCIuLi8uLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5pbXBvcnQge1Nlc3Npb25Nb2RlbH0gZnJvbSBcIi4uLy4uLy4uL21vZGVscy9zZXNzaW9uXCI7XHJcbi8vIGltcG9ydCBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xyXG5cclxuY29uc3Qgc2lnbkluID0gYXN5bmMgKHsgcGhvbmVOdW1iZXIsIHBhc3N3b3JkIH0pID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXJNb2RlbC5maW5kT25lKHsgcGhvbmVOdW1iZXIgfSk7XHJcblxyXG4gICAgLy8gY29uc3QgY29tcGFyZVBhc3N3b3JkID0gYXdhaXQgdXNlci5jb21wYXJlUGFzc3dvcmQocGFzc3dvcmQudG9TdHJpbmcoKSk7XHJcbiAgICBjb25zdCBjb21wYXJlUGFzc3dvcmQgPSAocGFzc3dvcmQudG9TdHJpbmcoKSA9PT0gdXNlci5wYXNzd29yZClcclxuICAgIGlmICghY29tcGFyZVBhc3N3b3JkKSB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJQYXNzd29yZCBpcyBpbmNvcnJlY3QuXCIpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdXNlcjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBzYXZlTmV3U2Vzc2lvbiA9IGFzeW5jKHVzZXJJZCxqd3RUb2tlbix0b21vcnJvd0RhdGUpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IG5ldyBTZXNzaW9uTW9kZWwoe1xyXG4gICAgICB1c2VySWQ6dXNlcklkLFxyXG4gICAgICBqd3RUb2tlbjpqd3RUb2tlbixcclxuICAgICAgZXhwaXJhdGlvbkRhdGU6dG9tb3Jyb3dEYXRlLFxyXG4gICAgICB1c2VyQ291bnQ6MVxyXG4gIH0pLnNhdmUoKTtcclxuICByZXR1cm4gbmV3U2Vzc2lvblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmxvZygnZXJyb3IgaW4gc2F2aW5nIG5ldyBzZXNzaW9uJylcclxuICAgIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGZpbmRTZXNzaW9uID0gYXN5bmModXNlcklkKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBTZXNzaW9uTW9kZWwuZmluZE9uZSh7dXNlcklkfSk7XHJcbiAgICByZXR1cm4gc2Vzc2lvbjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IHVwZGF0ZVNlc3Npb24gPSBhc3luYyhjb3VudCxzZXNzaW9uLHVwZGF0ZWREYXRlKSAgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBzZXNzaW9uLnVzZXJDb3VudCA9IGNvdW50XHJcbiAgICBzZXNzaW9uLmV4cGlyYXRpb25EYXRlID0gdXBkYXRlZERhdGVcclxuICAgIGNvbnN0IG5ld1Nlc3Npb24gPSBhd2FpdCBzZXNzaW9uLnNhdmUoKVxyXG4gICAgcmV0dXJuIG5ld1Nlc3Npb25cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGRlbGV0ZVNlc3Npb24gPSBhc3luYyhzZXNzaW9uKSAgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZygncmVtb3ZlJylcclxuICAgIGF3YWl0IHNlc3Npb24ucmVtb3ZlKClcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn1cclxuXHJcblxyXG5jb25zdCBzaWduVXAgPSBhc3luYyAoe1xyXG4gIGZpcnN0TmFtZSxcclxuICBtaWRkbGVOYW1lLFxyXG4gIGxhc3ROYW1lLFxyXG4gIHBob25lTnVtYmVyLFxyXG4gIHBhc3N3b3JkLFxyXG59KSA9PiB7XHJcbiAgdHJ5IHtcclxuXHJcbiAgICAvLyBsZXQgdXNlciA9IGF3YWl0IFVzZXJNb2RlbC5waG9uZU51bWJlckV4aXN0KHBob25lTnVtYmVyKTtcclxuICAgIC8vIGlmICh1c2VyKSB7XHJcbiAgICAvLyAgICAgY29uc29sZS5sb2coXCJoZXJlIDJcIilcclxuICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiUGhvbmUgTnVtYmVyIGhhcyBhbHJlYWR5IGJlZW4gdGFrZW4uXCIpKTtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyB1c2VyID0gYXdhaXQgVXNlck1vZGVsLmVtYWlsRXhpc3QoZW1haWwpO1xyXG4gICAgLy8gaWYgKHVzZXIpIHtcclxuICAgIC8vICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVtYWlsIGhhcyBhbHJlYWR5IGJlZW4gdGFrZW4uXCIpKTtcclxuICAgIC8vIH1cclxuICAgIC8vIGNvbnN0IHNhbHQgPSBiY3J5cHQuZ2VuU2FsdCgxMCk7XHJcbiAgICAvLyBjb25zdCBoYXNoID0gYmNyeXB0Lmhhc2hTeW5jKHBhc3N3b3JkLCBzYWx0KTtcclxuXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgbmV3IFVzZXJNb2RlbCh7XHJcbiAgICAgIGZpcnN0TmFtZSxcclxuICAgICAgbWlkZGxlTmFtZSxcclxuICAgICAgbGFzdE5hbWUsXHJcbiAgICAgIHBob25lTnVtYmVyLFxyXG4gICAgICBwYXNzd29yZCxcclxuICAgIH0pLnNhdmUoKTtcclxuXHJcbiAgICByZXR1cm4gdXNlcjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBsb2dvdXQgPSBhc3luYyh7dXNlciwgYWNjZXNzVG9rZW59KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXJJZCA9IHVzZXIuX2lkXHJcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZmluZFNlc3Npb24odXNlcklkKVxyXG4gICAgY29uc3QgY291bnQgPSBzZXNzaW9uLnVzZXJDb3VudFxyXG4gICAgaWYgKGNvdW50ID4gMSkge1xyXG4gICAgICBjb3VudCAtPSAxXHJcbiAgICAgIHVwZGF0ZVNlc3Npb24oY291bnQsc2Vzc2lvbixzZXNzaW9uLmV4cGlyYXRpb25EYXRlKVxyXG4gICAgfVxyXG4gICAgLy9kZWxldGUgc2Vzc2lvblxyXG4gICAgZWxzZSBpZiAoY291bnQgPT09IDEpIHtcclxuICAgICAgZGVsZXRlU2Vzc2lvbihzZXNzaW9uKVxyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGNoYW5nZVBhc3N3b3JkID0gYXN5bmMoe25ld1Bhc3N3b3JkLCB1c2VyLCBhY2Nlc3NUb2tlbn0pID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coXCJzaW0gdXNlcjogXCIsdXNlcilcclxuICAgIGNvbnNvbGUubG9nKFwibmV3IHBhc3N3b3JkOiBcIixuZXdQYXNzd29yZClcclxuICAgIGNvbnNvbGUubG9nKFwicGFzczogXCIsIHVzZXIucGFzc3dvcmQpXHJcbiAgICBjb25zdCB1c2VycGhvbmUgPSB1c2VyLnBob25lTnVtYmVyXHJcbiAgICBjb25zdCB1c2VyV2l0aCA9IGF3YWl0IFVzZXJNb2RlbC5maW5kT25lKHsgdXNlcnBob25lIH0pO1xyXG4gICAgY29uc3QgdXNlcklkID0gdXNlcldpdGguX2lkXHJcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZmluZFNlc3Npb24odXNlcklkKVxyXG5cclxuICAgIHVzZXJXaXRoLnBhc3N3b3JkPW5ld1Bhc3N3b3JkXHJcbiAgICBjb25zdCB1cGRhdGVkVXNlciA9IGF3YWl0IHVzZXJXaXRoLnNhdmUoZnVuY3Rpb24oZXJyKXtcclxuICAgICAgaWYoZXJyKXJldHVybiBoYW5kbGVFcnIoZXJyKTtcclxuICAgICAgLy91c2VyIGhhcyBiZWVuIHVwZGF0ZWRcclxuICAgICAgY29uc29sZS5sb2coXCJzdWNjZXNzXCIpXHJcbiAgICB9KVxyXG4gICAgY29uc3Qgb2xkQWNjZXNzVG9ja2VuID0gYWNjZXNzVG9rZW5cclxuICAgIC8vZGVsZXRlIHNlc3Npb25cclxuICAgIGF3YWl0IGRlbGV0ZVNlc3Npb24oc2Vzc2lvbilcclxuICAgICAgcmV0dXJuIHt1cGRhdGVkVXNlciwgb2xkQWNjZXNzVG9ja2VufTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5sb2coZXJyb3IpXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgc2lnbkluLFxyXG4gIHNpZ25VcCxcclxuICBzYXZlTmV3U2Vzc2lvbixcclxuICBmaW5kU2Vzc2lvbixcclxuICB1cGRhdGVTZXNzaW9uLFxyXG4gIGxvZ291dCxcclxuICBjaGFuZ2VQYXNzd29yZCxcclxufTtcclxuIl19","map":{"version":3,"sources":["auth-data-access.js"],"names":["signIn","phoneNumber","password","user","UserModel","findOne","comparePassword","toString","Promise","reject","Error","error","saveNewSession","userId","jwtToken","tomorrowDate","newSession","SessionModel","expirationDate","userCount","save","console","log","findSession","session","updateSession","count","updatedDate","deleteSession","remove","signUp","firstName","middleName","lastName","logout","accessToken","_id","changePassword","newPassword","userphone","userWith","updatedUser","err","handleErr","oldAccessTocken"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\services\\auth\\data-access\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { UserModel } from \"../../../models/user\";\r\nimport {SessionModel} from \"../../../models/session\";\r\n// import crypto from \"crypto\";\r\n\r\nconst signIn = async ({ phoneNumber, password }) => {\r\n  try {\r\n    const user = await UserModel.findOne({ phoneNumber });\r\n\r\n    // const comparePassword = await user.comparePassword(password.toString());\r\n    const comparePassword = (password.toString() === user.password)\r\n    if (!comparePassword) {\r\n      return Promise.reject(new Error(\"Password is incorrect.\"));\r\n    }\r\n\r\n    return user;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n\r\nconst saveNewSession = async(userId,jwtToken,tomorrowDate) => {\r\n  try {\r\n    const newSession = await new SessionModel({\r\n      userId:userId,\r\n      jwtToken:jwtToken,\r\n      expirationDate:tomorrowDate,\r\n      userCount:1\r\n  }).save();\r\n  return newSession\r\n  } catch (error) {\r\n    console.log('error in saving new session')\r\n    console.log(error)\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst findSession = async(userId) => {\r\n  try {\r\n    const session = await SessionModel.findOne({userId});\r\n    return session;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst updateSession = async(count,session,updatedDate)  => {\r\n  try {\r\n    session.userCount = count\r\n    session.expirationDate = updatedDate\r\n    const newSession = await session.save()\r\n    return newSession\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst deleteSession = async(session)  => {\r\n  try {\r\n    console.log('remove')\r\n    await session.remove()\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\n\r\nconst signUp = async ({\r\n  firstName,\r\n  middleName,\r\n  lastName,\r\n  phoneNumber,\r\n  password,\r\n}) => {\r\n  try {\r\n\r\n    // let user = await UserModel.phoneNumberExist(phoneNumber);\r\n    // if (user) {\r\n    //     console.log(\"here 2\")\r\n    //     return Promise.reject(new Error(\"Phone Number has already been taken.\"));\r\n    // }\r\n\r\n    // user = await UserModel.emailExist(email);\r\n    // if (user) {\r\n    //   return Promise.reject(new Error(\"Email has already been taken.\"));\r\n    // }\r\n    // const salt = bcrypt.genSalt(10);\r\n    // const hash = bcrypt.hashSync(password, salt);\r\n\r\n    const user = await new UserModel({\r\n      firstName,\r\n      middleName,\r\n      lastName,\r\n      phoneNumber,\r\n      password,\r\n    }).save();\r\n\r\n    return user;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n\r\nconst logout = async({user, accessToken}) => {\r\n  try {\r\n    const userId = user._id\r\n    const session = await findSession(userId)\r\n    const count = session.userCount\r\n    if (count > 1) {\r\n      count -= 1\r\n      updateSession(count,session,session.expirationDate)\r\n    }\r\n    //delete session\r\n    else if (count === 1) {\r\n      deleteSession(session)\r\n    }\r\n  } catch (error) {\r\n    console.log(error)\r\n  }\r\n}\r\n\r\nconst changePassword = async({newPassword, user, accessToken}) => {\r\n  try {\r\n    console.log(\"sim user: \",user)\r\n    console.log(\"new password: \",newPassword)\r\n    console.log(\"pass: \", user.password)\r\n    const userphone = user.phoneNumber\r\n    const userWith = await UserModel.findOne({ userphone });\r\n    const userId = userWith._id\r\n    const session = await findSession(userId)\r\n\r\n    userWith.password=newPassword\r\n    const updatedUser = await userWith.save(function(err){\r\n      if(err)return handleErr(err);\r\n      //user has been updated\r\n      console.log(\"success\")\r\n    })\r\n    const oldAccessTocken = accessToken\r\n    //delete session\r\n    await deleteSession(session)\r\n      return {updatedUser, oldAccessTocken};\r\n  } catch (error) {\r\n    console.log(error)\r\n  }\r\n}\r\n\r\nexport default {\r\n  signIn,\r\n  signUp,\r\n  saveNewSession,\r\n  findSession,\r\n  updateSession,\r\n  logout,\r\n  changePassword,\r\n};\r\n"]}},"mtime":1648764154564},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\redis-config.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _ioredis = _interopRequireDefault(require(\"ioredis\"));\n\nvar _winston = _interopRequireDefault(require(\"winston\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst client = new _ioredis.default({\n  host: process.env.REDIS_HOST,\n  port: process.env.REDIS_PORT //REDIS_PORT=6379\n\n});\nclient.on(\"error\", error => {\n  console.log('ðŸ˜’');\n  console.log(error);\n\n  _winston.default.error(error);\n\n  client.quit().then(e => console.log(e));\n});\nclient.on(\"connect\", () => _winston.default.info(\"Redis client connected\"));\nvar _default = client;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZGlzLWNvbmZpZy5qcyJdLCJuYW1lcyI6WyJjbGllbnQiLCJSZWRpcyIsImhvc3QiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfSE9TVCIsInBvcnQiLCJSRURJU19QT1JUIiwib24iLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJ3aW5zdG9uIiwicXVpdCIsInRoZW4iLCJlIiwiaW5mbyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHLElBQUlDLGdCQUFKLENBQVU7QUFDdkJDLEVBQUFBLElBQUksRUFBRUMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBREs7QUFFdkJDLEVBQUFBLElBQUksRUFBRUgsT0FBTyxDQUFDQyxHQUFSLENBQVlHLFVBRkssQ0FFTzs7QUFGUCxDQUFWLENBQWY7QUFLQVAsTUFBTSxDQUFDUSxFQUFQLENBQVUsT0FBVixFQUFvQkMsS0FBRCxJQUFXO0FBQzVCQyxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxJQUFaO0FBQ0FELEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixLQUFaOztBQUNBRyxtQkFBUUgsS0FBUixDQUFjQSxLQUFkOztBQUNBVCxFQUFBQSxNQUFNLENBQUNhLElBQVAsR0FBY0MsSUFBZCxDQUFvQkMsQ0FBRCxJQUFPTCxPQUFPLENBQUNDLEdBQVIsQ0FBWUksQ0FBWixDQUExQjtBQUNELENBTEQ7QUFPQWYsTUFBTSxDQUFDUSxFQUFQLENBQVUsU0FBVixFQUFxQixNQUFNSSxpQkFBUUksSUFBUixDQUFhLHdCQUFiLENBQTNCO2VBRWVoQixNIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxjb25maWdcXCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWRpcyBmcm9tIFwiaW9yZWRpc1wiO1xyXG5pbXBvcnQgd2luc3RvbiBmcm9tIFwid2luc3RvblwiO1xyXG5cclxuY29uc3QgY2xpZW50ID0gbmV3IFJlZGlzKHtcclxuICBob3N0OiBwcm9jZXNzLmVudi5SRURJU19IT1NULFxyXG4gIHBvcnQ6IHByb2Nlc3MuZW52LlJFRElTX1BPUlQsIC8vUkVESVNfUE9SVD02Mzc5XHJcbn0pO1xyXG5cclxuY2xpZW50Lm9uKFwiZXJyb3JcIiwgKGVycm9yKSA9PiB7XHJcbiAgY29uc29sZS5sb2coJ/CfmJInKVxyXG4gIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gIHdpbnN0b24uZXJyb3IoZXJyb3IpO1xyXG4gIGNsaWVudC5xdWl0KCkudGhlbigoZSkgPT4gY29uc29sZS5sb2coZSkpO1xyXG59KTtcclxuXHJcbmNsaWVudC5vbihcImNvbm5lY3RcIiwgKCkgPT4gd2luc3Rvbi5pbmZvKFwiUmVkaXMgY2xpZW50IGNvbm5lY3RlZFwiKSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnQ7XHJcbiJdfQ==","map":{"version":3,"sources":["redis-config.js"],"names":["client","Redis","host","process","env","REDIS_HOST","port","REDIS_PORT","on","error","console","log","winston","quit","then","e","info"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,MAAM,GAAG,IAAIC,gBAAJ,CAAU;AACvBC,EAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYC,UADK;AAEvBC,EAAAA,IAAI,EAAEH,OAAO,CAACC,GAAR,CAAYG,UAFK,CAEO;;AAFP,CAAV,CAAf;AAKAP,MAAM,CAACQ,EAAP,CAAU,OAAV,EAAoBC,KAAD,IAAW;AAC5BC,EAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACAD,EAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;;AACAG,mBAAQH,KAAR,CAAcA,KAAd;;AACAT,EAAAA,MAAM,CAACa,IAAP,GAAcC,IAAd,CAAoBC,CAAD,IAAOL,OAAO,CAACC,GAAR,CAAYI,CAAZ,CAA1B;AACD,CALD;AAOAf,MAAM,CAACQ,EAAP,CAAU,SAAV,EAAqB,MAAMI,iBAAQI,IAAR,CAAa,wBAAb,CAA3B;eAEehB,M","sourceRoot":"E:\\haleta-new-api\\src\\config\\","sourcesContent":["import Redis from \"ioredis\";\r\nimport winston from \"winston\";\r\n\r\nconst client = new Redis({\r\n  host: process.env.REDIS_HOST,\r\n  port: process.env.REDIS_PORT, //REDIS_PORT=6379\r\n});\r\n\r\nclient.on(\"error\", (error) => {\r\n  console.log('ðŸ˜’')\r\n  console.log(error)\r\n  winston.error(error);\r\n  client.quit().then((e) => console.log(e));\r\n});\r\n\r\nclient.on(\"connect\", () => winston.info(\"Redis client connected\"));\r\n\r\nexport default client;\r\n"]}},"mtime":1648685190379},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\redis\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\redis\\\\redis-services.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\n//add to redis\nconst storeNewSession = async (client, accessToken, session) => {\n  // store session information on Mongo db\n  // sync with redis cache (update redis) //add to redis\n  client.set(accessToken, JSON.stringify(session), (err, reply) => {\n    if (err) {\n      console.log(err.message);\n      console.log('errrr');\n      return Promise.reject(err);\n    }\n\n    return Promise.resolve(session);\n  });\n}; //delete single token data(token string)\n\n\nconst deleteSessionRedis = async (client, accessToken) => {\n  console.log('deleting session redis');\n  let userSession;\n  await client.get(accessToken, (err, sessionData) => {\n    if (sessionData) {\n      console.log('here');\n      userSession = sessionData;\n      console.log(sessionData);\n    } else if (err) {\n      console.log('errrr');\n      console.log(err);\n    }\n  });\n  console.log(accessToken);\n  console.log(userSession);\n  userSession = JSON.parse(userSession);\n  console.log(userSession);\n  console.log(userSession.userCount);\n  const count = userSession.userCount;\n\n  if (count > 1) {\n    userSession.count -= 1;\n    syncWithRedis(client, accessToken, userSession);\n  } //delete session\n  else if (count === 1) {\n    console.log('deleting from redis');\n    client.del(accessToken);\n  }\n};\n\nconst deleteSessionRedisForChangePassword = async (client, accessToken) => {\n  console.log('deleting session redis');\n  let userSession;\n  await client.get(accessToken, (err, sessionData) => {\n    if (sessionData) {\n      console.log('here');\n      userSession = sessionData;\n      console.log(sessionData);\n    } else if (err) {\n      console.log('errrr');\n      console.log(err);\n    }\n  });\n  console.log(accessToken);\n  console.log(userSession);\n  userSession = JSON.parse(userSession);\n  console.log(userSession);\n  console.log(userSession.userCount);\n  const count = userSession.userCount;\n  console.log('deleting from redis');\n  client.del(accessToken);\n}; //update single token data\n\n\nconst syncWithRedis = async (client, accessToken, session) => {\n  //fetch from mongodb\n  //update the whole cache\n  console.log(accessToken);\n  console.log('in sync wi redis', session);\n  client.set(accessToken, JSON.stringify(session), (err, reply) => {\n    if (err) {\n      console.log(err.message);\n      console.log('errrr');\n      return Promise.reject(err);\n    }\n\n    console.log('resolving');\n    return Promise.resolve(session);\n  });\n};\n\nvar _default = {\n  storeNewSession,\n  syncWithRedis,\n  deleteSessionRedis,\n  deleteSessionRedisForChangePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZGlzLXNlcnZpY2VzLmpzIl0sIm5hbWVzIjpbInN0b3JlTmV3U2Vzc2lvbiIsImNsaWVudCIsImFjY2Vzc1Rva2VuIiwic2Vzc2lvbiIsInNldCIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnIiLCJyZXBseSIsImNvbnNvbGUiLCJsb2ciLCJtZXNzYWdlIiwiUHJvbWlzZSIsInJlamVjdCIsInJlc29sdmUiLCJkZWxldGVTZXNzaW9uUmVkaXMiLCJ1c2VyU2Vzc2lvbiIsImdldCIsInNlc3Npb25EYXRhIiwicGFyc2UiLCJ1c2VyQ291bnQiLCJjb3VudCIsInN5bmNXaXRoUmVkaXMiLCJkZWwiLCJkZWxldGVTZXNzaW9uUmVkaXNGb3JDaGFuZ2VQYXNzd29yZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBQ0EsTUFBTUEsZUFBZSxHQUFHLE9BQU9DLE1BQVAsRUFBY0MsV0FBZCxFQUEwQkMsT0FBMUIsS0FBc0M7QUFDMUQ7QUFDQTtBQUNBRixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBV0YsV0FBWCxFQUF1QkcsSUFBSSxDQUFDQyxTQUFMLENBQWVILE9BQWYsQ0FBdkIsRUFBK0MsQ0FBQ0ksR0FBRCxFQUFLQyxLQUFMLEtBQWU7QUFDMUQsUUFBSUQsR0FBSixFQUFTO0FBQ0xFLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSCxHQUFHLENBQUNJLE9BQWhCO0FBQ0FGLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLE9BQVo7QUFDQSxhQUFPRSxPQUFPLENBQUNDLE1BQVIsQ0FBZU4sR0FBZixDQUFQO0FBQ0g7O0FBQ0QsV0FBT0ssT0FBTyxDQUFDRSxPQUFSLENBQWdCWCxPQUFoQixDQUFQO0FBQ0gsR0FQRDtBQVFILENBWEQsQyxDQWFBOzs7QUFDQSxNQUFNWSxrQkFBa0IsR0FBRyxPQUFPZCxNQUFQLEVBQWNDLFdBQWQsS0FBOEI7QUFDckRPLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHdCQUFaO0FBQ0EsTUFBSU0sV0FBSjtBQUNBLFFB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Q0MsR0FBUixDQUFZLGtCQUFaLEVBQStCUCxPQUEvQjtBQUNBRixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBV0YsV0FBWCxFQUF1QkcsSUFBSSxDQUFDQyxTQUFMLENBQWVILE9BQWYsQ0FBdkIsRUFBK0MsQ0FBQ0ksR0FBRCxFQUFLQyxLQUFMLEtBQWU7QUFDMUQsUUFBSUQsR0FBSixFQUFTO0FBQ0xFLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSCxHQUFHLENBQUNJLE9BQWhCO0FBQ0FGLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLE9BQVo7QUFDQSxhQUFPRSxPQUFPLENBQUNDLE1BQVIsQ0FBZU4sR0FBZixDQUFQO0FBQ0g7O0FBQ0RFLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFdBQVo7QUFDQSxXQUFPRSxPQUFPLENBQUNFLE9BQVIsQ0FBZ0JYLE9BQWhCLENBQVA7QUFDSCxHQVJEO0FBU0gsQ0FkRDs7ZUFnQmU7QUFDWEgsRUFBQUEsZUFEVztBQUVYc0IsRUFBQUEsYUFGVztBQUdYUCxFQUFBQSxrQkFIVztBQUlYUyxFQUFBQTtBQUpXLEMiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXHNlcnZpY2VzXFxyZWRpc1xcIiwic291cmNlc0NvbnRlbnQiOlsiLy9hZGQgdG8gcmVkaXNcclxuY29uc3Qgc3RvcmVOZXdTZXNzaW9uID0gYXN5bmMgKGNsaWVudCxhY2Nlc3NUb2tlbixzZXNzaW9uKSA9PiB7XHJcbiAgICAvLyBzdG9yZSBzZXNzaW9uIGluZm9ybWF0aW9uIG9uIE1vbmdvIGRiXHJcbiAgICAvLyBzeW5jIHdpdGggcmVkaXMgY2FjaGUgKHVwZGF0ZSByZWRpcykgLy9hZGQgdG8gcmVkaXNcclxuICAgIGNsaWVudC5zZXQoYWNjZXNzVG9rZW4sSlNPTi5zdHJpbmdpZnkoc2Vzc2lvbiksKGVycixyZXBseSkgPT4ge1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJycicpXHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoc2Vzc2lvbilcclxuICAgIH0pXHJcbn1cclxuXHJcbi8vZGVsZXRlIHNpbmdsZSB0b2tlbiBkYXRhKHRva2VuIHN0cmluZylcclxuY29uc3QgZGVsZXRlU2Vzc2lvblJlZGlzID0gYXN5bmMgKGNsaWVudCxhY2Nlc3NUb2tlbikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ2RlbGV0aW5nIHNlc3Npb24gcmVkaXMnKVxyXG4gICAgbGV0IHVzZXJTZXNzaW9uO1xyXG4gICAgYXdhaXQgY2xpZW50LmdldChhY2Nlc3NUb2tlbiwgKGVycixzZXNzaW9uRGF0YSkgPT4ge1xyXG4gICAgICAgIGlmIChzZXNzaW9uRGF0YSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaGVyZScpXHJcbiAgICAgICAgICAgIHVzZXJTZXNzaW9uID0gc2Vzc2lvbkRhdGFcclxuICAgICAgICAgICAgY29uc29sZS5sb2coc2Vzc2lvbkRhdGEpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGVycil7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJycicpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgY29uc29sZS5sb2coYWNjZXNzVG9rZW4pXHJcbiAgICBjb25zb2xlLmxvZyh1c2VyU2Vzc2lvbilcclxuICAgIHVzZXJTZXNzaW9uID0gSlNPTi5wYXJzZSh1c2VyU2Vzc2lvbilcclxuICAgIGNvbnNvbGUubG9nKHVzZXJTZXNzaW9uKVxyXG4gICAgY29uc29sZS5sb2codXNlclNlc3Npb24udXNlckNvdW50KVxyXG4gICAgY29uc3QgY291bnQgPSB1c2VyU2Vzc2lvbi51c2VyQ291bnRcclxuICAgIGlmIChjb3VudCA+IDEpIHtcclxuICAgICAgICB1c2VyU2Vzc2lvbi5jb3VudCAtPSAxXHJcbiAgICAgICAgc3luY1dpdGhSZWRpcyhjbGllbnQsYWNjZXNzVG9rZW4sdXNlclNlc3Npb24pXHJcbiAgICAgIH1cclxuICAgICAgLy9kZWxldGUgc2Vzc2lvblxyXG4gICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGluZyBmcm9tIHJlZGlzJylcclxuICAgICAgICBjbGllbnQuZGVsKGFjY2Vzc1Rva2VuKVxyXG4gICAgICB9XHJcbn1cclxuXHJcbmNvbnN0IGRlbGV0ZVNlc3Npb25SZWRpc0ZvckNoYW5nZVBhc3N3b3JkID0gYXN5bmMgKGNsaWVudCxhY2Nlc3NUb2tlbikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ2RlbGV0aW5nIHNlc3Npb24gcmVkaXMnKVxyXG4gICAgbGV0IHVzZXJTZXNzaW9uO1xyXG4gICAgYXdhaXQgY2xpZW50LmdldChhY2Nlc3NUb2tlbiwgKGVycixzZXNzaW9uRGF0YSkgPT4ge1xyXG4gICAgICAgIGlmIChzZXNzaW9uRGF0YSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaGVyZScpXHJcbiAgICAgICAgICAgIHVzZXJTZXNzaW9uID0gc2Vzc2lvbkRhdGFcclxuICAgICAgICAgICAgY29uc29sZS5sb2coc2Vzc2lvbkRhdGEpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGVycil7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJycicpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgY29uc29sZS5sb2coYWNjZXNzVG9rZW4pXHJcbiAgICBjb25zb2xlLmxvZyh1c2VyU2Vzc2lvbilcclxuICAgIHVzZXJTZXNzaW9uID0gSlNPTi5wYXJzZSh1c2VyU2Vzc2lvbilcclxuICAgIGNvbnNvbGUubG9nKHVzZXJTZXNzaW9uKVxyXG4gICAgY29uc29sZS5sb2codXNlclNlc3Npb24udXNlckNvdW50KVxyXG4gICAgY29uc3QgY291bnQgPSB1c2VyU2Vzc2lvbi51c2VyQ291bnRcclxuICAgIFxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGluZyBmcm9tIHJlZGlzJylcclxuICAgICAgICBjbGllbnQuZGVsKGFjY2Vzc1Rva2VuKVxyXG4gICAgICBcclxufVxyXG5cclxuLy91cGRhdGUgc2luZ2xlIHRva2VuIGRhdGFcclxuY29uc3Qgc3luY1dpdGhSZWRpcyA9IGFzeW5jICAoY2xpZW50LGFjY2Vzc1Rva2VuLHNlc3Npb24pID0+IHtcclxuICAgIC8vZmV0Y2ggZnJvbSBtb25nb2RiXHJcbiAgICAvL3VwZGF0ZSB0aGUgd2hvbGUgY2FjaGVcclxuICAgIGNvbnNvbGUubG9nKGFjY2Vzc1Rva2VuKVxyXG4gICAgY29uc29sZS5sb2coJ2luIHN5bmMgd2kgcmVkaXMnLHNlc3Npb24pXHJcbiAgICBjbGllbnQuc2V0KGFjY2Vzc1Rva2VuLEpTT04uc3RyaW5naWZ5KHNlc3Npb24pLChlcnIscmVwbHkpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZXJycnInKVxyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZygncmVzb2x2aW5nJylcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHNlc3Npb24pXHJcbiAgICB9KVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBzdG9yZU5ld1Nlc3Npb24sXHJcbiAgICBzeW5jV2l0aFJlZGlzLFxyXG4gICAgZGVsZXRlU2Vzc2lvblJlZGlzLFxyXG4gICAgZGVsZXRlU2Vzc2lvblJlZGlzRm9yQ2hhbmdlUGFzc3dvcmRcclxufSJdfQ==","map":{"version":3,"sources":["redis-services.js"],"names":["storeNewSession","client","accessToken","session","set","JSON","stringify","err","reply","console","log","message","Promise","reject","resolve","deleteSessionRedis","userSession","get","sessionData","parse","userCount","count","syncWithRedis","del","deleteSessionRedisForChangePassword"],"mappings":";;;;;;;AAAA;AACA,MAAMA,eAAe,GAAG,OAAOC,MAAP,EAAcC,WAAd,EAA0BC,OAA1B,KAAsC;AAC1D;AACA;AACAF,EAAAA,MAAM,CAACG,GAAP,CAAWF,WAAX,EAAuBG,IAAI,CAACC,SAAL,CAAeH,OAAf,CAAvB,EAA+C,CAACI,GAAD,EAAKC,KAAL,KAAe;AAC1D,QAAID,GAAJ,EAAS;AACLE,MAAAA,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,OAAhB;AACAF,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACA,aAAOE,OAAO,CAACC,MAAR,CAAeN,GAAf,CAAP;AACH;;AACD,WAAOK,OAAO,CAACE,OAAR,CAAgBX,OAAhB,CAAP;AACH,GAPD;AAQH,CAXD,C,CAaA;;;AACA,MAAMY,kBAAkB,GAAG,OAAOd,MAAP,EAAcC,WAAd,KAA8B;AACrDO,EAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AACA,MAAIM,WAAJ;AACA,QAAMf,MAAM,CAACgB,GAAP,CAAWf,WAAX,EAAwB,CAACK,GAAD,EAAKW,WAAL,KAAqB;AAC/C,QAAIA,WAAJ,EAAiB;AACbT,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACAM,MAAAA,WAAW,GAAGE,WAAd;AACAT,MAAAA,OAAO,CAACC,GAAR,CAAYQ,WAAZ;AACH,KAJD,MAKK,IAAIX,GAAJ,EAAQ;AACTE,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ;AACH;AACJ,GAVK,CAAN;AAWAE,EAAAA,OAAO,CAACC,GAAR,CAAYR,WAAZ;AACAO,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAZ;AACAA,EAAAA,WAAW,GAAGX,IAAI,CAACc,KAAL,CAAWH,WAAX,CAAd;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAZ;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAW,CAACI,SAAxB;AACA,QAAMC,KAAK,GAAGL,WAAW,CAACI,SAA1B;;AACA,MAAIC,KAAK,GAAG,CAAZ,EAAe;AACXL,IAAAA,WAAW,CAACK,KAAZ,IAAqB,CAArB;AACAC,IAAAA,aAAa,CAACrB,MAAD,EAAQC,WAAR,EAAoBc,WAApB,CAAb;AACD,GAHH,CAIE;AAJF,OAKO,IAAIK,KAAK,KAAK,CAAd,EAAiB;AACpBZ,IAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACAT,IAAAA,MAAM,CAACsB,GAAP,CAAWrB,WAAX;AACD;AACN,CA7BD;;AA+BA,MAAMsB,mCAAmC,GAAG,OAAOvB,MAAP,EAAcC,WAAd,KAA8B;AACtEO,EAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AACA,MAAIM,WAAJ;AACA,QAAMf,MAAM,CAACgB,GAAP,CAAWf,WAAX,EAAwB,CAACK,GAAD,EAAKW,WAAL,KAAqB;AAC/C,QAAIA,WAAJ,EAAiB;AACbT,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACAM,MAAAA,WAAW,GAAGE,WAAd;AACAT,MAAAA,OAAO,CAACC,GAAR,CAAYQ,WAAZ;AACH,KAJD,MAKK,IAAIX,GAAJ,EAAQ;AACTE,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ;AACH;AACJ,GAVK,CAAN;AAWAE,EAAAA,OAAO,CAACC,GAAR,CAAYR,WAAZ;AACAO,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAZ;AACAA,EAAAA,WAAW,GAAGX,IAAI,CAACc,KAAL,CAAWH,WAAX,CAAd;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAZ;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAW,CAACI,SAAxB;AACA,QAAMC,KAAK,GAAGL,WAAW,CAACI,SAA1B;AAEIX,EAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACAT,EAAAA,MAAM,CAACsB,GAAP,CAAWrB,WAAX;AAEP,CAxBD,C,CA0BA;;;AACA,MAAMoB,aAAa,GAAG,OAAQrB,MAAR,EAAeC,WAAf,EAA2BC,OAA3B,KAAuC;AACzD;AACA;AACAM,EAAAA,OAAO,CAACC,GAAR,CAAYR,WAAZ;AACAO,EAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAA+BP,OAA/B;AACAF,EAAAA,MAAM,CAACG,GAAP,CAAWF,WAAX,EAAuBG,IAAI,CAACC,SAAL,CAAeH,OAAf,CAAvB,EAA+C,CAACI,GAAD,EAAKC,KAAL,KAAe;AAC1D,QAAID,GAAJ,EAAS;AACLE,MAAAA,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,OAAhB;AACAF,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACA,aAAOE,OAAO,CAACC,MAAR,CAAeN,GAAf,CAAP;AACH;;AACDE,IAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACA,WAAOE,OAAO,CAACE,OAAR,CAAgBX,OAAhB,CAAP;AACH,GARD;AASH,CAdD;;eAgBe;AACXH,EAAAA,eADW;AAEXsB,EAAAA,aAFW;AAGXP,EAAAA,kBAHW;AAIXS,EAAAA;AAJW,C","sourceRoot":"E:\\haleta-new-api\\src\\services\\redis\\","sourcesContent":["//add to redis\r\nconst storeNewSession = async (client,accessToken,session) => {\r\n    // store session information on Mongo db\r\n    // sync with redis cache (update redis) //add to redis\r\n    client.set(accessToken,JSON.stringify(session),(err,reply) => {\r\n        if (err) {\r\n            console.log(err.message)\r\n            console.log('errrr')\r\n            return Promise.reject(err)\r\n        }\r\n        return Promise.resolve(session)\r\n    })\r\n}\r\n\r\n//delete single token data(token string)\r\nconst deleteSessionRedis = async (client,accessToken) => {\r\n    console.log('deleting session redis')\r\n    let userSession;\r\n    await client.get(accessToken, (err,sessionData) => {\r\n        if (sessionData) {\r\n            console.log('here')\r\n            userSession = sessionData\r\n            console.log(sessionData)\r\n        }\r\n        else if (err){\r\n            console.log('errrr')\r\n            console.log(err)\r\n        }\r\n    })\r\n    console.log(accessToken)\r\n    console.log(userSession)\r\n    userSession = JSON.parse(userSession)\r\n    console.log(userSession)\r\n    console.log(userSession.userCount)\r\n    const count = userSession.userCount\r\n    if (count > 1) {\r\n        userSession.count -= 1\r\n        syncWithRedis(client,accessToken,userSession)\r\n      }\r\n      //delete session\r\n      else if (count === 1) {\r\n        console.log('deleting from redis')\r\n        client.del(accessToken)\r\n      }\r\n}\r\n\r\nconst deleteSessionRedisForChangePassword = async (client,accessToken) => {\r\n    console.log('deleting session redis')\r\n    let userSession;\r\n    await client.get(accessToken, (err,sessionData) => {\r\n        if (sessionData) {\r\n            console.log('here')\r\n            userSession = sessionData\r\n            console.log(sessionData)\r\n        }\r\n        else if (err){\r\n            console.log('errrr')\r\n            console.log(err)\r\n        }\r\n    })\r\n    console.log(accessToken)\r\n    console.log(userSession)\r\n    userSession = JSON.parse(userSession)\r\n    console.log(userSession)\r\n    console.log(userSession.userCount)\r\n    const count = userSession.userCount\r\n    \r\n        console.log('deleting from redis')\r\n        client.del(accessToken)\r\n      \r\n}\r\n\r\n//update single token data\r\nconst syncWithRedis = async  (client,accessToken,session) => {\r\n    //fetch from mongodb\r\n    //update the whole cache\r\n    console.log(accessToken)\r\n    console.log('in sync wi redis',session)\r\n    client.set(accessToken,JSON.stringify(session),(err,reply) => {\r\n        if (err) {\r\n            console.log(err.message)\r\n            console.log('errrr')\r\n            return Promise.reject(err)\r\n        }\r\n        console.log('resolving')\r\n        return Promise.resolve(session)\r\n    })\r\n}\r\n\r\nexport default {\r\n    storeNewSession,\r\n    syncWithRedis,\r\n    deleteSessionRedis,\r\n    deleteSessionRedisForChangePassword\r\n}"]}},"mtime":1648761161078},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\typedefs\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\typedefs\\\\types.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nvar _graphqlCompose = require(\"graphql-compose\");\n\nvar _user = require(\"../../../models/user\");\n\n_graphqlCompose.schemaComposer.createObjectTC({\n  name: \"AccessToken\",\n  fields: {\n    accessToken: \"String!\",\n    user: _user.UserTC\n  }\n});\n\n_graphqlCompose.schemaComposer.createObjectTC({\n  name: \"Succeed\",\n  fields: {\n    succeed: \"Boolean!\"\n  }\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInR5cGVzLmpzIl0sIm5hbWVzIjpbInNjaGVtYUNvbXBvc2VyIiwiY3JlYXRlT2JqZWN0VEMiLCJuYW1lIiwiZmllbGRzIiwiYWNjZXNzVG9rZW4iLCJ1c2VyIiwiVXNlclRDIiwic3VjY2VlZCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQTs7QUFFQUEsK0JBQWVDLGNBQWYsQ0FBOEI7QUFDMUJDLEVBQUFBLElBQUksRUFBRSxhQURvQjtBQUUxQkMsRUFBQUEsTUFBTSxFQUFFO0FBQ0pDLElBQUFBLFdBQVcsRUFBRSxTQURUO0FBRUpDLElBQUFBLElBQUksRUFBRUM7QUFGRjtBQUZrQixDQUE5Qjs7QUFRQU4sK0JBQWVDLGNBQWYsQ0FBOEI7QUFDMUJDLEVBQUFBLElBQUksRUFBRSxTQURvQjtBQUUxQkMsRUFBQUEsTUFBTSxFQUFFO0FBQUNJLElBQUFBLE9BQU8sRUFBRTtBQUFWO0FBRmtCLENBQTlCIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxncmFwaHFsXFxhdXRoXFx0eXBlZGVmc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtzY2hlbWFDb21wb3Nlcn0gZnJvbSBcImdyYXBocWwtY29tcG9zZVwiO1xyXG5pbXBvcnQge1VzZXJUQ30gZnJvbSBcIi4uLy4uLy4uL21vZGVscy91c2VyXCI7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5jcmVhdGVPYmplY3RUQyh7XHJcbiAgICBuYW1lOiBcIkFjY2Vzc1Rva2VuXCIsXHJcbiAgICBmaWVsZHM6IHtcclxuICAgICAgICBhY2Nlc3NUb2tlbjogXCJTdHJpbmchXCIsXHJcbiAgICAgICAgdXNlcjogVXNlclRDLFxyXG4gICAgfSxcclxufSk7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5jcmVhdGVPYmplY3RUQyh7XHJcbiAgICBuYW1lOiBcIlN1Y2NlZWRcIixcclxuICAgIGZpZWxkczoge3N1Y2NlZWQ6IFwiQm9vbGVhbiFcIn0sXHJcbn0pOyJdfQ==","map":{"version":3,"sources":["types.js"],"names":["schemaComposer","createObjectTC","name","fields","accessToken","user","UserTC","succeed"],"mappings":";;AAAA;;AACA;;AAEAA,+BAAeC,cAAf,CAA8B;AAC1BC,EAAAA,IAAI,EAAE,aADoB;AAE1BC,EAAAA,MAAM,EAAE;AACJC,IAAAA,WAAW,EAAE,SADT;AAEJC,IAAAA,IAAI,EAAEC;AAFF;AAFkB,CAA9B;;AAQAN,+BAAeC,cAAf,CAA8B;AAC1BC,EAAAA,IAAI,EAAE,SADoB;AAE1BC,EAAAA,MAAM,EAAE;AAACI,IAAAA,OAAO,EAAE;AAAV;AAFkB,CAA9B","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\typedefs\\","sourcesContent":["import {schemaComposer} from \"graphql-compose\";\r\nimport {UserTC} from \"../../../models/user\";\r\n\r\nschemaComposer.createObjectTC({\r\n    name: \"AccessToken\",\r\n    fields: {\r\n        accessToken: \"String!\",\r\n        user: UserTC,\r\n    },\r\n});\r\n\r\nschemaComposer.createObjectTC({\r\n    name: \"Succeed\",\r\n    fields: {succeed: \"Boolean!\"},\r\n});"]}},"mtime":1648684433887},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _graphqlCompose = require(\"graphql-compose\");\n\nvar _auth = require(\"./auth\");\n\nvar _user = require(\"./user\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst schemaComposer = new _graphqlCompose.SchemaComposer();\nschemaComposer.Query.addFields(_objectSpread({}, _user.UserQuery));\nschemaComposer.Mutation.addFields(_objectSpread(_objectSpread({}, _auth.AuthMutation), _user.UserMutation));\nconst schema = schemaComposer.buildSchema();\nvar _default = schema;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInNjaGVtYUNvbXBvc2VyIiwiU2NoZW1hQ29tcG9zZXIiLCJRdWVyeSIsImFkZEZpZWxkcyIsIlVzZXJRdWVyeSIsIk11dGF0aW9uIiwiQXV0aE11dGF0aW9uIiwiVXNlck11dGF0aW9uIiwic2NoZW1hIiwiYnVpbGRTY2hlbWEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFFQSxNQUFNQSxjQUFjLEdBQUcsSUFBSUMsOEJBQUosRUFBdkI7QUFFQUQsY0FBYyxDQUFDRSxLQUFmLENBQXFCQyxTQUFyQixtQkFDT0MsZUFEUDtBQUlBSixjQUFjLENBQUNLLFFBQWYsQ0FBd0JGLFNBQXhCLGlDQUNPRyxrQkFEUCxHQUVPQyxrQkFGUDtBQUtBLE1BQU1DLE1BQU0sR0FBR1IsY0FBYyxDQUFDUyxXQUFmLEVBQWY7ZUFDZUQsTSIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtTY2hlbWFDb21wb3Nlcn0gZnJvbSBcImdyYXBocWwtY29tcG9zZVwiO1xyXG5pbXBvcnQge0F1dGhNdXRhdGlvbn0gZnJvbSBcIi4vYXV0aFwiO1xyXG5pbXBvcnQge1VzZXJNdXRhdGlvbiwgVXNlclF1ZXJ5fSBmcm9tIFwiLi91c2VyXCI7XHJcblxyXG5jb25zdCBzY2hlbWFDb21wb3NlciA9IG5ldyBTY2hlbWFDb21wb3NlcigpO1xyXG5cclxuc2NoZW1hQ29tcG9zZXIuUXVlcnkuYWRkRmllbGRzKHtcclxuICAgIC4uLlVzZXJRdWVyeSxcclxufSk7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5NdXRhdGlvbi5hZGRGaWVsZHMoe1xyXG4gICAgLi4uQXV0aE11dGF0aW9uLFxyXG4gICAgLi4uVXNlck11dGF0aW9uLFxyXG59KTtcclxuXHJcbmNvbnN0IHNjaGVtYSA9IHNjaGVtYUNvbXBvc2VyLmJ1aWxkU2NoZW1hKCk7XHJcbmV4cG9ydCBkZWZhdWx0IHNjaGVtYTtcclxuIl19","map":{"version":3,"sources":["index.js"],"names":["schemaComposer","SchemaComposer","Query","addFields","UserQuery","Mutation","AuthMutation","UserMutation","schema","buildSchema"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,cAAc,GAAG,IAAIC,8BAAJ,EAAvB;AAEAD,cAAc,CAACE,KAAf,CAAqBC,SAArB,mBACOC,eADP;AAIAJ,cAAc,CAACK,QAAf,CAAwBF,SAAxB,iCACOG,kBADP,GAEOC,kBAFP;AAKA,MAAMC,MAAM,GAAGR,cAAc,CAACS,WAAf,EAAf;eACeD,M","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\","sourcesContent":["import {SchemaComposer} from \"graphql-compose\";\r\nimport {AuthMutation} from \"./auth\";\r\nimport {UserMutation, UserQuery} from \"./user\";\r\n\r\nconst schemaComposer = new SchemaComposer();\r\n\r\nschemaComposer.Query.addFields({\r\n    ...UserQuery,\r\n});\r\n\r\nschemaComposer.Mutation.addFields({\r\n    ...AuthMutation,\r\n    ...UserMutation,\r\n});\r\n\r\nconst schema = schemaComposer.buildSchema();\r\nexport default schema;\r\n"]}},"mtime":1648684433887},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuthMutation = void 0;\n\nvar _user = require(\"../../models/user\");\n\nvar _middlewares = require(\"../../middlewares\");\n\nvar _authResolvers = _interopRequireDefault(require(\"./resolvers/auth-resolvers\"));\n\nrequire(\"./typedefs/types\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfor (const resolver in _authResolvers.default) {\n  _user.UserTC.addResolver(_authResolvers.default[resolver]);\n}\n\nconst AuthMutation = {\n  signIn: _user.UserTC.getResolver(\"signIn\", [_middlewares.authentication.isGuest, _middlewares.userValidator.signIn]),\n  signUp: _user.UserTC.getResolver(\"signUp\", [_middlewares.authentication.isGuest, _middlewares.userValidator.signUp]),\n  logout: _user.UserTC.getResolver('logout', [_middlewares.authentication.isAuth]),\n  // resetPassword: UserTC.getResolver(\"resetPassword\", [middleware.isGuest, validators.resetPassword]),\n  // newPassword: UserTC.getResolver(\"newPassword\", [middleware.isGuest, validators.newPassword]),\n  changePassword: _user.UserTC.getResolver(\"changePassword\", [_middlewares.authentication.isAuth, _middlewares.userValidator.changePassword])\n};\nexports.AuthMutation = AuthMutation;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInJlc29sdmVyIiwiUmVzb2x2ZXJzIiwiVXNlclRDIiwiYWRkUmVzb2x2ZXIiLCJBdXRoTXV0YXRpb24iLCJzaWduSW4iLCJnZXRSZXNvbHZlciIsImF1dGhlbnRpY2F0aW9uIiwiaXNHdWVzdCIsInVzZXJWYWxpZGF0b3IiLCJzaWduVXAiLCJsb2dvdXQiLCJpc0F1dGgiLCJjaGFuZ2VQYXNzd29yZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOztBQUVBOztBQUVBOzs7O0FBRUEsS0FBSyxNQUFNQSxRQUFYLElBQXVCQyxzQkFBdkIsRUFBa0M7QUFDOUJDLGVBQU9DLFdBQVAsQ0FBbUJGLHVCQUFVRCxRQUFWLENBQW5CO0FBQ0g7O0FBRUQsTUFBTUksWUFBWSxHQUFHO0FBQ2pCQyxFQUFBQSxNQUFNLEVBQUVILGFBQU9JLFdBQVAsQ0FBbUIsUUFBbkIsRUFBNkIsQ0FBQ0MsNEJBQWVDLE9BQWhCLEVBQXlCQywyQkFBY0osTUFBdkMsQ0FBN0IsQ0FEUztBQUVqQkssRUFBQUEsTUFBTSxFQUFFUixhQUFPSSxXQUFQLENBQW1CLFFBQW5CLEVBQTZCLENBQUNDLDRCQUFlQyxPQUFoQixFQUF5QkMsMkJBQWNDLE1BQXZDLENBQTdCLENBRlM7QUFHakJDLEVBQUFBLE1BQU0sRUFBRVQsYUFBT0ksV0FBUCxDQUFtQixRQUFuQixFQUE2QixDQUFDQyw0QkFBZUssTUFBaEIsQ0FBN0IsQ0FIUztBQUlqQjtBQUNBO0FBQ0FDLEVBQUFBLGNBQWMsRUFBRVgsYUFBT0ksV0FBUCxDQUFtQixnQkFBbkIsRUFBcUMsQ0FBQ0MsNEJBQWVLLE1BQWhCLEVBQXdCSCwyQkFBY0ksY0FBdEMsQ0FBckM7QUFOQyxDQUFyQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtVc2VyVEN9IGZyb20gXCIuLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5cclxuaW1wb3J0IHsgYXV0aGVudGljYXRpb24sIHVzZXJWYWxpZGF0b3IgfSBmcm9tIFwiLi4vLi4vbWlkZGxld2FyZXNcIjtcclxuXHJcbmltcG9ydCBSZXNvbHZlcnMgZnJvbSBcIi4vcmVzb2x2ZXJzL2F1dGgtcmVzb2x2ZXJzXCI7XHJcblxyXG5pbXBvcnQgXCIuL3R5cGVkZWZzL3R5cGVzXCJcclxuXHJcbmZvciAoY29uc3QgcmVzb2x2ZXIgaW4gUmVzb2x2ZXJzKSB7XHJcbiAgICBVc2VyVEMuYWRkUmVzb2x2ZXIoUmVzb2x2ZXJzW3Jlc29sdmVyXSk7XHJcbn1cclxuXHJcbmNvbnN0IEF1dGhNdXRhdGlvbiA9IHtcclxuICAgIHNpZ25JbjogVXNlclRDLmdldFJlc29sdmVyKFwic2lnbkluXCIsIFthdXRoZW50aWNhdGlvbi5pc0d1ZXN0LCB1c2VyVmFsaWRhdG9yLnNpZ25Jbl0pLFxyXG4gICAgc2lnblVwOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJzaWduVXBcIiwgW2F1dGhlbnRpY2F0aW9uLmlzR3Vlc3QsIHVzZXJWYWxpZGF0b3Iuc2lnblVwXSksXHJcbiAgICBsb2dvdXQ6IFVzZXJUQy5nZXRSZXNvbHZlcignbG9nb3V0JywgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aF0pLFxyXG4gICAgLy8gcmVzZXRQYXNzd29yZDogVXNlclRDLmdldFJlc29sdmVyKFwicmVzZXRQYXNzd29yZFwiLCBbbWlkZGxld2FyZS5pc0d1ZXN0LCB2YWxpZGF0b3JzLnJlc2V0UGFzc3dvcmRdKSxcclxuICAgIC8vIG5ld1Bhc3N3b3JkOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJuZXdQYXNzd29yZFwiLCBbbWlkZGxld2FyZS5pc0d1ZXN0LCB2YWxpZGF0b3JzLm5ld1Bhc3N3b3JkXSksXHJcbiAgICBjaGFuZ2VQYXNzd29yZDogVXNlclRDLmdldFJlc29sdmVyKFwiY2hhbmdlUGFzc3dvcmRcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgdXNlclZhbGlkYXRvci5jaGFuZ2VQYXNzd29yZF0pLFxyXG59O1xyXG5cclxuZXhwb3J0IHtBdXRoTXV0YXRpb259O1xyXG4iXX0=","map":{"version":3,"sources":["index.js"],"names":["resolver","Resolvers","UserTC","addResolver","AuthMutation","signIn","getResolver","authentication","isGuest","userValidator","signUp","logout","isAuth","changePassword"],"mappings":";;;;;;;AAAA;;AAEA;;AAEA;;AAEA;;;;AAEA,KAAK,MAAMA,QAAX,IAAuBC,sBAAvB,EAAkC;AAC9BC,eAAOC,WAAP,CAAmBF,uBAAUD,QAAV,CAAnB;AACH;;AAED,MAAMI,YAAY,GAAG;AACjBC,EAAAA,MAAM,EAAEH,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeC,OAAhB,EAAyBC,2BAAcJ,MAAvC,CAA7B,CADS;AAEjBK,EAAAA,MAAM,EAAER,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeC,OAAhB,EAAyBC,2BAAcC,MAAvC,CAA7B,CAFS;AAGjBC,EAAAA,MAAM,EAAET,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeK,MAAhB,CAA7B,CAHS;AAIjB;AACA;AACAC,EAAAA,cAAc,EAAEX,aAAOI,WAAP,CAAmB,gBAAnB,EAAqC,CAACC,4BAAeK,MAAhB,EAAwBH,2BAAcI,cAAtC,CAArC;AANC,CAArB","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\","sourcesContent":["import {UserTC} from \"../../models/user\";\r\n\r\nimport { authentication, userValidator } from \"../../middlewares\";\r\n\r\nimport Resolvers from \"./resolvers/auth-resolvers\";\r\n\r\nimport \"./typedefs/types\"\r\n\r\nfor (const resolver in Resolvers) {\r\n    UserTC.addResolver(Resolvers[resolver]);\r\n}\r\n\r\nconst AuthMutation = {\r\n    signIn: UserTC.getResolver(\"signIn\", [authentication.isGuest, userValidator.signIn]),\r\n    signUp: UserTC.getResolver(\"signUp\", [authentication.isGuest, userValidator.signUp]),\r\n    logout: UserTC.getResolver('logout', [authentication.isAuth]),\r\n    // resetPassword: UserTC.getResolver(\"resetPassword\", [middleware.isGuest, validators.resetPassword]),\r\n    // newPassword: UserTC.getResolver(\"newPassword\", [middleware.isGuest, validators.newPassword]),\r\n    changePassword: UserTC.getResolver(\"changePassword\", [authentication.isAuth, userValidator.changePassword]),\r\n};\r\n\r\nexport {AuthMutation};\r\n"]}},"mtime":1648755864085},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\user.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserTC = exports.UserSchema = exports.UserModel = void 0;\n\nvar _mongoose = _interopRequireWildcard(require(\"mongoose\"));\n\nvar _mongooseTimestamp = _interopRequireDefault(require(\"mongoose-timestamp\"));\n\nvar _graphqlComposeMongoose = require(\"graphql-compose-mongoose\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nconst UserSchema = new _mongoose.Schema({\n  firstName: String,\n  middleName: String,\n  lastName: String,\n  email: String,\n  phoneNumber: String,\n  image: String,\n  firebaseId: String,\n  password: String,\n  status: {\n    type: String,\n    default: \"ACTIVE\",\n    enum: [\"ACTIVE\", \"BLOCKED\"]\n  },\n  roles: {\n    type: String,\n    default: \"NORMAL\",\n    enum: [\"NORMAL\", \"OWNER\", \"ADMIN\", \"SALES\"]\n  },\n  account: {\n    verification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    emailVerification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    phoneVerification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    resetPassword: {\n      token: String,\n      expiresIn: Date\n    }\n  }\n}, {\n  collection: \"users\"\n});\nexports.UserSchema = UserSchema;\nUserSchema.plugin(_mongooseTimestamp.default);\nUserSchema.index({\n  createdAt: 1,\n  updatedAt: 1\n});\n\nUserSchema.statics.emailExist = function (email) {\n  return this.findOne({\n    email\n  });\n};\n\nUserSchema.statics.phoneNumberExist = function (phoneNumber) {\n  return this.findOne({\n    phoneNumber\n  });\n};\n\nUserSchema.methods.comparePassword = function (password) {\n  return bcrypt.compareSync(password, this.password);\n};\n\nconst UserModel = _mongoose.default.model(\"User\", UserSchema);\n\nexports.UserModel = UserModel;\nconst UserTC = (0, _graphqlComposeMongoose.composeWithMongoose)(UserModel); // const UserTC = composeWithMongoose(UserModel).removeField('password');\n\nexports.UserTC = UserTC;\nconst UserAccountTC = UserTC.getFieldTC(\"account\");\nUserAccountTC.getFieldTC(\"verification\").removeField([\"token\", \"expiresIn\"]); // UserAccountTC.removeField('resetPassword');\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsiVXNlclNjaGVtYSIsIlNjaGVtYSIsImZpcnN0TmFtZSIsIlN0cmluZyIsIm1pZGRsZU5hbWUiLCJsYXN0TmFtZSIsImVtYWlsIiwicGhvbmVOdW1iZXIiLCJpbWFnZSIsImZpcmViYXNlSWQiLCJwYXNzd29yZCIsInN0YXR1cyIsInR5cGUiLCJkZWZhdWx0IiwiZW51bSIsInJvbGVzIiwiYWNjb3VudCIsInZlcmlmaWNhdGlvbiIsInZlcmlmaWVkIiwiQm9vbGVhbiIsInRva2VuIiwiZXhwaXJlc0luIiwiRGF0ZSIsImVtYWlsVmVyaWZpY2F0aW9uIiwicGhvbmVWZXJpZmljYXRpb24iLCJyZXNldFBhc3N3b3JkIiwiY29sbGVjdGlvbiIsInBsdWdpbiIsInRpbWVzdGFtcHMiLCJpbmRleCIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInN0YXRpY3MiLCJlbWFpbEV4aXN0IiwiZmluZE9uZSIsInBob25lTnVtYmVyRXhpc3QiLCJtZXRob2RzIiwiY29tcGFyZVBhc3N3b3JkIiwiYmNyeXB0IiwiY29tcGFyZVN5bmMiLCJVc2VyTW9kZWwiLCJtb25nb29zZSIsIm1vZGVsIiwiVXNlclRDIiwiVXNlckFjY291bnRUQyIsImdldEZpZWxkVEMiLCJyZW1vdmVGaWVsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLE1BQU1BLFVBQVUsR0FBRyxJQUFJQyxnQkFBSixDQUFXO0FBQzFCQyxFQUFBQSxTQUFTLEVBQUVDLE1BRGU7QUFFMUJDLEVBQUFBLFVBQVUsRUFBRUQsTUFGYztBQUcxQkUsRUFBQUEsUUFBUSxFQUFFRixNQUhnQjtBQUkxQkcsRUFBQUEsS0FBSyxFQUFFSCxNQUptQjtBQUsxQkksRUFBQUEsV0FBVyxFQUFFSixNQUxhO0FBTTFCSyxFQUFBQSxLQUFLLEVBQUVMLE1BTm1CO0FBTzFCTSxFQUFBQSxVQUFVLEVBQUVOLE1BUGM7QUFRMUJPLEVBQUFBLFFBQVEsRUFBRVAsTUFSZ0I7QUFTMUJRLEVBQUFBLE1BQU0sRUFBRTtBQUNKQyxJQUFBQSxJQUFJLEVBQUVULE1BREY7QUFFSlUsSUFBQUEsT0FBTyxFQUFFLFFBRkw7QUFHSkMsSUFBQUEsSUFBSSxFQUFFLENBQUMsUUFBRCxFQUFXLFNBQVg7QUFIRixHQVRrQjtBQWMxQkMsRUFBQUEsS0FBSyxFQUFFO0FBQ0hILElBQUFBLElBQUksRUFBRVQsTUFESDtBQUVIVSxJQUFBQSxPQUFPLEVBQUUsUUFGTjtBQUdIQyxJQUFBQSxJQUFJLEVBQUUsQ0FBQyxRQUFELEVBQVcsT0FBWCxFQUFvQixPQUFwQixFQUE2QixPQUE3QjtBQUhILEdBZG1CO0FBbUIxQkUsRUFBQUEsT0FBTyxFQUFFO0FBQ0xDLElBQUFBLFlBQVksRUFBRTtBQUNWQyxNQUFBQSxRQUFRLEVBQUU7QUFDTk4sUUFBQUEsSUFBSSxFQUFFTyxPQURBO0FBRU5OLFFBQUFBLE9BQU8sRUFBRTtBQUZILE9BREE7QUFLVk8sTUFBQUEsS0FBSyxFQUFFakIsTUFMRztBQU1Wa0IsTUFBQUEsU0FBUyxFQUFFQztBQU5ELEtBRFQ7QUFTTEMsSUFBQUEsaUJBQWlCLEVBQUU7QUFDZkwsTUFBQUEsUUFBUSxFQUFFO0FBQ05OLFFBQUFBLElBQUksRUFBRU8sT0FEQTtBQUVOTixRQUFBQSxPQUFPLEVBQUU7QUFGSCxPQURLO0FBS2ZPLE1BQUFBLEtBQUssRUFBRWpCLE1BTFE7QUFNZmtCLE1BQUFBLFNBQVMsRUFBRUM7QUFOSSxLQVRkO0FBaUJMRSxJQUFBQSxpQkFBaUIsRUFBRTtBQUNmTixNQUFBQSxRQUFRLEVBQUU7QUFDTk4sUUFBQUEsSUFBSSxFQUFFTyxPQURBO0FBRU5OLFFBQUFBLE9BQU8sRUFBRTtBQUZILE9BREs7QUFLZk8sTUFBQUEsS0FBSyxFQUFFakIsTUFMUTtBQU1ma0IsTUFBQUEsU0FBUyxFQUFFQztBQU5JLEtBakJkO0FBeUJMRyxJQUFBQSxhQUFhLEVBQUU7QUFDWEwsTUFBQUEsS0FBSyxFQUFFakIsTUFESTtBQUVYa0IsTUFBQUEsU0FBUyxFQUFFQztBQUZBO0FBekJWO0FBbkJpQixDQUFYLEVBaURoQjtBQUNDSSxFQUFBQSxVQUFVLEVBQUU7QUFEYixDQWpEZ0IsQ0FBbkI7O0FBcURBMUIsVUFBVSxDQUFDMkIsTUFBWCxDQUFrQkMsMEJBQWxCO0FBQ0E1QixVQUFVLENBQUM2QixLQUFYLENBQWlCO0FBQ2JDLEVBQUFBLFNBQVMsRUFBRSxDQURFO0FBRWJDLEVBQUFBLFNBQVMsRUFBRTtBQUZFLENBQWpCOztBQUtBL0IsVUFBVSxDQUFDZ0MsT0FBWCxDQUFtQkMsVUFBbkIsR0FBZ0MsVUFBVTNCLEtBQVYsRUFBaUI7QUFDN0MsU0FBTyxLQUFLNEIsT0FBTCxDQUFhO0FBQUM1QixJQUFBQTtBQUFELEdBQWIsQ0FBUDtBQUNILENBRkQ7O0FBSUFOLFVBQVUsQ0FBQ2dDLE9BQVgsQ0FBbUJHLGdCQUFuQixHQUFzQyxVQUFVNUIsV0FBVixFQUF1QjtBQUN6RCxTQUFPLEtBQUsyQixPQUFMLENBQWE7QUFBQzNCLElBQUFBO0FBQUQsR0FBYixDQUFQO0FBQ0gsQ0FGRDs7QUFJQVAsVUFBVSxDQUFDb0MsT0FBWCxDQUFtQkMsZUFBbkIsR0FBcUMsVUFBVTNCLFFBQVYsRUFBb0I7QUFDckQsU0FBTzRCLE1BQU0sQ0FBQ0MsV0FBUCxDQUFtQjdCLFFBQW5CLEVBQTZCLEtBQUtBLFFBQWxDLENBQVA7QUFDSCxDQUZEOztBQUlBLE1BQU04QixTQUFTLEdBQUdDLGtCQUFTQyxLQUFULENBQWUsTUFBZixFQUF1QjFDLFVBQXZCLENBQWxCOzs7QUFDQSxNQUFNMkMsTUFBTSxHQUFHLGlEQUFvQkgsU0FBcEIsQ0FBZixDLENBQ0E7OztBQUVBLE1BQU1JLGFBQWEsR0FBR0QsTUFBTSxDQUFDRSxVQUFQLENBQWtCLFNBQWxCLENBQXRCO0FBRUFELGFBQWEsQ0FBQ0MsVUFBZCxDQUF5QixjQUF6QixFQUF5Q0MsV0FBekMsQ0FBcUQsQ0FBQyxPQUFELEVBQVUsV0FBVixDQUFyRCxFLENBRUEiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXG1vZGVsc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlLCB7U2NoZW1hfSBmcm9tIFwibW9uZ29vc2VcIjtcclxuaW1wb3J0IHRpbWVzdGFtcHMgZnJvbSBcIm1vbmdvb3NlLXRpbWVzdGFtcFwiO1xyXG5pbXBvcnQge2NvbXBvc2VXaXRoTW9uZ29vc2V9IGZyb20gXCJncmFwaHFsLWNvbXBvc2UtbW9uZ29vc2VcIjtcclxuXHJcbmNvbnN0IFVzZXJTY2hlbWEgPSBuZXcgU2NoZW1hKHtcclxuICAgIGZpcnN0TmFtZTogU3RyaW5nLFxyXG4gICAgbWlkZGxlTmFtZTogU3RyaW5nLFxyXG4gICAgbGFzdE5hbWU6IFN0cmluZyxcclxuICAgIGVtYWlsOiBTdHJpbmcsXHJcbiAgICBwaG9uZU51bWJlcjogU3RyaW5nLFxyXG4gICAgaW1hZ2U6IFN0cmluZyxcclxuICAgIGZpcmViYXNlSWQ6IFN0cmluZyxcclxuICAgIHBhc3N3b3JkOiBTdHJpbmcsXHJcbiAgICBzdGF0dXM6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZGVmYXVsdDogXCJBQ1RJVkVcIixcclxuICAgICAgICBlbnVtOiBbXCJBQ1RJVkVcIiwgXCJCTE9DS0VEXCJdLFxyXG4gICAgfSxcclxuICAgIHJvbGVzOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIGRlZmF1bHQ6IFwiTk9STUFMXCIsXHJcbiAgICAgICAgZW51bTogW1wiTk9STUFMXCIsIFwiT1dORVJcIiwgXCJBRE1JTlwiLCBcIlNBTEVTXCJdLFxyXG4gICAgfSxcclxuICAgIGFjY291bnQ6IHtcclxuICAgICAgICB2ZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW1haWxWZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcGhvbmVWZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVzZXRQYXNzd29yZDoge1xyXG4gICAgICAgICAgICB0b2tlbjogU3RyaW5nLFxyXG4gICAgICAgICAgICBleHBpcmVzSW46IERhdGUsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcbn0sIHtcclxuICAgIGNvbGxlY3Rpb246IFwidXNlcnNcIixcclxufSk7XHJcblxyXG5Vc2VyU2NoZW1hLnBsdWdpbih0aW1lc3RhbXBzKTtcclxuVXNlclNjaGVtYS5pbmRleCh7XHJcbiAgICBjcmVhdGVkQXQ6IDEsXHJcbiAgICB1cGRhdGVkQXQ6IDEsXHJcbn0pO1xyXG5cclxuVXNlclNjaGVtYS5zdGF0aWNzLmVtYWlsRXhpc3QgPSBmdW5jdGlvbiAoZW1haWwpIHtcclxuICAgIHJldHVybiB0aGlzLmZpbmRPbmUoe2VtYWlsfSk7XHJcbn07XHJcblxyXG5Vc2VyU2NoZW1hLnN0YXRpY3MucGhvbmVOdW1iZXJFeGlzdCA9IGZ1bmN0aW9uIChwaG9uZU51bWJlcikge1xyXG4gICAgcmV0dXJuIHRoaXMuZmluZE9uZSh7cGhvbmVOdW1iZXJ9KTtcclxufTtcclxuXHJcblVzZXJTY2hlbWEubWV0aG9kcy5jb21wYXJlUGFzc3dvcmQgPSBmdW5jdGlvbiAocGFzc3dvcmQpIHtcclxuICAgIHJldHVybiBiY3J5cHQuY29tcGFyZVN5bmMocGFzc3dvcmQsIHRoaXMucGFzc3dvcmQpO1xyXG59O1xyXG5cclxuY29uc3QgVXNlck1vZGVsID0gbW9uZ29vc2UubW9kZWwoXCJVc2VyXCIsIFVzZXJTY2hlbWEpO1xyXG5jb25zdCBVc2VyVEMgPSBjb21wb3NlV2l0aE1vbmdvb3NlKFVzZXJNb2RlbCk7XHJcbi8vIGNvbnN0IFVzZXJUQyA9IGNvbXBvc2VXaXRoTW9uZ29vc2UoVXNlck1vZGVsKS5yZW1vdmVGaWVsZCgncGFzc3dvcmQnKTtcclxuXHJcbmNvbnN0IFVzZXJBY2NvdW50VEMgPSBVc2VyVEMuZ2V0RmllbGRUQyhcImFjY291bnRcIik7XHJcblxyXG5Vc2VyQWNjb3VudFRDLmdldEZpZWxkVEMoXCJ2ZXJpZmljYXRpb25cIikucmVtb3ZlRmllbGQoW1widG9rZW5cIiwgXCJleHBpcmVzSW5cIl0pO1xyXG5cclxuLy8gVXNlckFjY291bnRUQy5yZW1vdmVGaWVsZCgncmVzZXRQYXNzd29yZCcpO1xyXG5cclxuZXhwb3J0IHtVc2VyTW9kZWwsIFVzZXJUQywgVXNlclNjaGVtYX07XHJcbiJdfQ==","map":{"version":3,"sources":["user.js"],"names":["UserSchema","Schema","firstName","String","middleName","lastName","email","phoneNumber","image","firebaseId","password","status","type","default","enum","roles","account","verification","verified","Boolean","token","expiresIn","Date","emailVerification","phoneVerification","resetPassword","collection","plugin","timestamps","index","createdAt","updatedAt","statics","emailExist","findOne","phoneNumberExist","methods","comparePassword","bcrypt","compareSync","UserModel","mongoose","model","UserTC","UserAccountTC","getFieldTC","removeField"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\models\\","sourcesContent":["import mongoose, {Schema} from \"mongoose\";\r\nimport timestamps from \"mongoose-timestamp\";\r\nimport {composeWithMongoose} from \"graphql-compose-mongoose\";\r\n\r\nconst UserSchema = new Schema({\r\n    firstName: String,\r\n    middleName: String,\r\n    lastName: String,\r\n    email: String,\r\n    phoneNumber: String,\r\n    image: String,\r\n    firebaseId: String,\r\n    password: String,\r\n    status: {\r\n        type: String,\r\n        default: \"ACTIVE\",\r\n        enum: [\"ACTIVE\", \"BLOCKED\"],\r\n    },\r\n    roles: {\r\n        type: String,\r\n        default: \"NORMAL\",\r\n        enum: [\"NORMAL\", \"OWNER\", \"ADMIN\", \"SALES\"],\r\n    },\r\n    account: {\r\n        verification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        emailVerification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        phoneVerification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        resetPassword: {\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n    },\r\n}, {\r\n    collection: \"users\",\r\n});\r\n\r\nUserSchema.plugin(timestamps);\r\nUserSchema.index({\r\n    createdAt: 1,\r\n    updatedAt: 1,\r\n});\r\n\r\nUserSchema.statics.emailExist = function (email) {\r\n    return this.findOne({email});\r\n};\r\n\r\nUserSchema.statics.phoneNumberExist = function (phoneNumber) {\r\n    return this.findOne({phoneNumber});\r\n};\r\n\r\nUserSchema.methods.comparePassword = function (password) {\r\n    return bcrypt.compareSync(password, this.password);\r\n};\r\n\r\nconst UserModel = mongoose.model(\"User\", UserSchema);\r\nconst UserTC = composeWithMongoose(UserModel);\r\n// const UserTC = composeWithMongoose(UserModel).removeField('password');\r\n\r\nconst UserAccountTC = UserTC.getFieldTC(\"account\");\r\n\r\nUserAccountTC.getFieldTC(\"verification\").removeField([\"token\", \"expiresIn\"]);\r\n\r\n// UserAccountTC.removeField('resetPassword');\r\n\r\nexport {UserModel, UserTC, UserSchema};\r\n"]}},"mtime":1648684433894},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"authentication\", {\n  enumerable: true,\n  get: function () {\n    return _authentication.default;\n  }\n});\nObject.defineProperty(exports, \"authorization\", {\n  enumerable: true,\n  get: function () {\n    return _authorization.default;\n  }\n});\nObject.defineProperty(exports, \"phoneVerification\", {\n  enumerable: true,\n  get: function () {\n    return _phoneVerification.default;\n  }\n});\nObject.defineProperty(exports, \"userValidator\", {\n  enumerable: true,\n  get: function () {\n    return _userValidator.default;\n  }\n});\nObject.defineProperty(exports, \"validateToken\", {\n  enumerable: true,\n  get: function () {\n    return _validateToken.default;\n  }\n});\n\nvar _authentication = _interopRequireDefault(require(\"./auth/authentication\"));\n\nvar _authorization = _interopRequireDefault(require(\"./auth/authorization\"));\n\nvar _validateToken = _interopRequireDefault(require(\"./auth/validate-token\"));\n\nvar _phoneVerification = _interopRequireDefault(require(\"./auth/phone-verification\"));\n\nvar _userValidator = _interopRequireDefault(require(\"./validators/user-validator\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF1dGhlbnRpY2F0aW9uIGZyb20gXCIuL2F1dGgvYXV0aGVudGljYXRpb25cIlxyXG5pbXBvcnQgYXV0aG9yaXphdGlvbiBmcm9tIFwiLi9hdXRoL2F1dGhvcml6YXRpb25cIlxyXG5pbXBvcnQgdmFsaWRhdGVUb2tlbiBmcm9tIFwiLi9hdXRoL3ZhbGlkYXRlLXRva2VuXCJcclxuaW1wb3J0IHBob25lVmVyaWZpY2F0aW9uIGZyb20gXCIuL2F1dGgvcGhvbmUtdmVyaWZpY2F0aW9uXCJcclxuaW1wb3J0IHVzZXJWYWxpZGF0b3IgZnJvbSBcIi4vdmFsaWRhdG9ycy91c2VyLXZhbGlkYXRvclwiO1xyXG5cclxuZXhwb3J0IHtcclxuICAgIGF1dGhlbnRpY2F0aW9uLFxyXG4gICAgYXV0aG9yaXphdGlvbixcclxuICAgIHZhbGlkYXRlVG9rZW4sXHJcbiAgICBwaG9uZVZlcmlmaWNhdGlvbixcclxuICAgIHVzZXJWYWxpZGF0b3IsXHJcbn0iXX0=","map":{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\","sourcesContent":["import authentication from \"./auth/authentication\"\r\nimport authorization from \"./auth/authorization\"\r\nimport validateToken from \"./auth/validate-token\"\r\nimport phoneVerification from \"./auth/phone-verification\"\r\nimport userValidator from \"./validators/user-validator\";\r\n\r\nexport {\r\n    authentication,\r\n    authorization,\r\n    validateToken,\r\n    phoneVerification,\r\n    userValidator,\r\n}"]}},"mtime":1648684433893},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\authentication.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nconst isAuth = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n\n  if (!user) {\n    return Promise.reject(new Error(\"You must be authorized.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nconst isGuest = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n\n  if (user) {\n    return Promise.reject(new Error(\"You have already authorized.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nvar _default = {\n  isAuth,\n  isGuest\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0aW9uLmpzIl0sIm5hbWVzIjpbImlzQXV0aCIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iLCJ1c2VyIiwiUHJvbWlzZSIsInJlamVjdCIsIkVycm9yIiwiaXNHdWVzdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLE1BQU1BLE1BQU0sR0FBRyxPQUFPQyxPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUMzRCxRQUFNO0FBQUNDLElBQUFBO0FBQUQsTUFBU0YsT0FBZjs7QUFDQSxNQUFJLENBQUNFLElBQUwsRUFBVztBQUNQLFdBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLElBQUlDLEtBQUosQ0FBVSx5QkFBVixDQUFmLENBQVA7QUFDSDs7QUFDRCxTQUFPUixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsQ0FORDs7QUFRQSxNQUFNSyxPQUFPLEdBQUcsT0FBT1QsT0FBUCxFQUFnQkMsTUFBaEIsRUFBd0JDLElBQXhCLEVBQThCQyxPQUE5QixFQUF1Q0MsSUFBdkMsS0FBZ0Q7QUFDNUQsUUFBTTtBQUFDQyxJQUFBQTtBQUFELE1BQVNGLE9BQWY7O0FBQ0EsTUFBSUUsSUFBSixFQUFVO0FBQ04sV0FBT0MsT0FBTyxDQUFDQyxNQUFSLENBQWUsSUFBSUMsS0FBSixDQUFVLDhCQUFWLENBQWYsQ0FBUDtBQUNIOztBQUNELFNBQU9SLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxDQU5EOztlQVFlO0FBQUNMLEVBQUFBLE1BQUQ7QUFBU1UsRUFBQUE7QUFBVCxDIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaXNBdXRoID0gYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgY29uc3Qge3VzZXJ9ID0gY29udGV4dDtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJZb3UgbXVzdCBiZSBhdXRob3JpemVkLlwiKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzb2x2ZShzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pO1xyXG59O1xyXG5cclxuY29uc3QgaXNHdWVzdCA9IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgIGNvbnN0IHt1c2VyfSA9IGNvbnRleHQ7XHJcbiAgICBpZiAodXNlcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJZb3UgaGF2ZSBhbHJlYWR5IGF1dGhvcml6ZWQuXCIpKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7aXNBdXRoLCBpc0d1ZXN0fTtcclxuIl19","map":{"version":3,"sources":["authentication.js"],"names":["isAuth","resolve","source","args","context","info","user","Promise","reject","Error","isGuest"],"mappings":";;;;;;;AAAA,MAAMA,MAAM,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC3D,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;;AACA,MAAI,CAACE,IAAL,EAAW;AACP,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,yBAAV,CAAf,CAAP;AACH;;AACD,SAAOR,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAND;;AAQA,MAAMK,OAAO,GAAG,OAAOT,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC5D,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;;AACA,MAAIE,IAAJ,EAAU;AACN,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,8BAAV,CAAf,CAAP;AACH;;AACD,SAAOR,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAND;;eAQe;AAACL,EAAAA,MAAD;AAASU,EAAAA;AAAT,C","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["const isAuth = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    if (!user) {\r\n        return Promise.reject(new Error(\"You must be authorized.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nconst isGuest = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    if (user) {\r\n        return Promise.reject(new Error(\"You have already authorized.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nexport default {isAuth, isGuest};\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\authorization.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n//list from redis, list of functions for each role\nconst accessList = {\n  ADMIN: [\"findMany\", \"createOne\"],\n  SUPER_ADMIN: [\"findMany\", \"createOne\"],\n  NORMAL: [],\n  TUTOR: [],\n  CUSTOMER_SERVICE: []\n};\n\nconst authorization = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n  const fieldName = info.fieldName;\n  let hasAccess = false; //list from redis, list of functions for each role\n\n  user.roles.forEach(role => {\n    if (accessList[role].includes(fieldName)) {\n      hasAccess = true;\n    }\n  });\n\n  if (!hasAccess) {\n    return Promise.reject(new Error(\"Access denied.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nvar _default = authorization;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6YXRpb24uanMiXSwibmFtZXMiOlsiYWNjZXNzTGlzdCIsIkFETUlOIiwiU1VQRVJfQURNSU4iLCJOT1JNQUwiLCJUVVRPUiIsIkNVU1RPTUVSX1NFUlZJQ0UiLCJhdXRob3JpemF0aW9uIiwicmVzb2x2ZSIsInNvdXJjZSIsImFyZ3MiLCJjb250ZXh0IiwiaW5mbyIsInVzZXIiLCJmaWVsZE5hbWUiLCJoYXNBY2Nlc3MiLCJyb2xlcyIsImZvckVhY2giLCJyb2xlIiwiaW5jbHVkZXMiLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0EsTUFBTUEsVUFBVSxHQUFHO0FBQ2ZDLEVBQUFBLEtBQUssRUFBRSxDQUFDLFVBQUQsRUFBYSxXQUFiLENBRFE7QUFFZkMsRUFBQUEsV0FBVyxFQUFFLENBQUMsVUFBRCxFQUFhLFdBQWIsQ0FGRTtBQUdmQyxFQUFBQSxNQUFNLEVBQUUsRUFITztBQUlmQyxFQUFBQSxLQUFLLEVBQUUsRUFKUTtBQUtmQyxFQUFBQSxnQkFBZ0IsRUFBRTtBQUxILENBQW5COztBQVFBLE1BQU1DLGFBQWEsR0FBRyxPQUFPQyxPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUNsRSxRQUFNO0FBQUNDLElBQUFBO0FBQUQsTUFBU0YsT0FBZjtBQUNBLFFBQU1HLFNBQVMsR0FBR0YsSUFBSSxDQUFDRSxTQUF2QjtBQUNBLE1BQUlDLFNBQVMsR0FBRyxLQUFoQixDQUhrRSxDQUlsRTs7QUFDQUYsRUFBQUEsSUFBSSxDQUFDRyxLQUFMLENBQVdDLE9BQVgsQ0FBbUJDLElBQUksSUFBSTtBQUN2QixRQUFHakIsVUFBVSxDQUFDaUIsSUFBRCxDQUFWLENBQWlCQyxRQUFqQixDQUEwQkwsU0FBMUIsQ0FBSCxFQUF3QztBQUNwQ0MsTUFBQUEsU0FBUyxHQUFHLElBQVo7QUFDSDtBQUNKLEdBSkQ7O0FBS0EsTUFBSSxDQUFDQSxTQUFMLEVBQWdCO0FBQ1osV0FBT0ssT0FBTyxDQUFDQyxNQUFSLENBQWUsSUFBSUMsS0FBSixDQUFVLGdCQUFWLENBQWYsQ0FBUDtBQUNIOztBQUNELFNBQU9kLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxDQWREOztlQWdCZUwsYSIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbWlkZGxld2FyZXNcXGF1dGhcXCIsInNvdXJjZXNDb250ZW50IjpbIi8vbGlzdCBmcm9tIHJlZGlzLCBsaXN0IG9mIGZ1bmN0aW9ucyBmb3IgZWFjaCByb2xlXHJcbmNvbnN0IGFjY2Vzc0xpc3QgPSB7XHJcbiAgICBBRE1JTjogW1wiZmluZE1hbnlcIiwgXCJjcmVhdGVPbmVcIl0sXHJcbiAgICBTVVBFUl9BRE1JTjogW1wiZmluZE1hbnlcIiwgXCJjcmVhdGVPbmVcIl0sXHJcbiAgICBOT1JNQUw6IFtdLFxyXG4gICAgVFVUT1I6IFtdLFxyXG4gICAgQ1VTVE9NRVJfU0VSVklDRTogW10sXHJcbn07XHJcblxyXG5jb25zdCBhdXRob3JpemF0aW9uID0gYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgY29uc3Qge3VzZXJ9ID0gY29udGV4dDtcclxuICAgIGNvbnN0IGZpZWxkTmFtZSA9IGluZm8uZmllbGROYW1lXHJcbiAgICBsZXQgaGFzQWNjZXNzID0gZmFsc2VcclxuICAgIC8vbGlzdCBmcm9tIHJlZGlzLCBsaXN0IG9mIGZ1bmN0aW9ucyBmb3IgZWFjaCByb2xlXHJcbiAgICB1c2VyLnJvbGVzLmZvckVhY2gocm9sZSA9PiB7XHJcbiAgICAgICAgaWYoYWNjZXNzTGlzdFtyb2xlXS5pbmNsdWRlcyhmaWVsZE5hbWUpKXtcclxuICAgICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICBpZiAoIWhhc0FjY2Vzcykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJBY2Nlc3MgZGVuaWVkLlwiKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzb2x2ZShzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXV0aG9yaXphdGlvbjtcclxuIl19","map":{"version":3,"sources":["authorization.js"],"names":["accessList","ADMIN","SUPER_ADMIN","NORMAL","TUTOR","CUSTOMER_SERVICE","authorization","resolve","source","args","context","info","user","fieldName","hasAccess","roles","forEach","role","includes","Promise","reject","Error"],"mappings":";;;;;;AAAA;AACA,MAAMA,UAAU,GAAG;AACfC,EAAAA,KAAK,EAAE,CAAC,UAAD,EAAa,WAAb,CADQ;AAEfC,EAAAA,WAAW,EAAE,CAAC,UAAD,EAAa,WAAb,CAFE;AAGfC,EAAAA,MAAM,EAAE,EAHO;AAIfC,EAAAA,KAAK,EAAE,EAJQ;AAKfC,EAAAA,gBAAgB,EAAE;AALH,CAAnB;;AAQA,MAAMC,aAAa,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAClE,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;AACA,QAAMG,SAAS,GAAGF,IAAI,CAACE,SAAvB;AACA,MAAIC,SAAS,GAAG,KAAhB,CAHkE,CAIlE;;AACAF,EAAAA,IAAI,CAACG,KAAL,CAAWC,OAAX,CAAmBC,IAAI,IAAI;AACvB,QAAGjB,UAAU,CAACiB,IAAD,CAAV,CAAiBC,QAAjB,CAA0BL,SAA1B,CAAH,EAAwC;AACpCC,MAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,GAJD;;AAKA,MAAI,CAACA,SAAL,EAAgB;AACZ,WAAOK,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,gBAAV,CAAf,CAAP;AACH;;AACD,SAAOd,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAdD;;eAgBeL,a","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["//list from redis, list of functions for each role\r\nconst accessList = {\r\n    ADMIN: [\"findMany\", \"createOne\"],\r\n    SUPER_ADMIN: [\"findMany\", \"createOne\"],\r\n    NORMAL: [],\r\n    TUTOR: [],\r\n    CUSTOMER_SERVICE: [],\r\n};\r\n\r\nconst authorization = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    const fieldName = info.fieldName\r\n    let hasAccess = false\r\n    //list from redis, list of functions for each role\r\n    user.roles.forEach(role => {\r\n        if(accessList[role].includes(fieldName)){\r\n            hasAccess = true\r\n        }\r\n    })\r\n    if (!hasAccess) {\r\n        return Promise.reject(new Error(\"Access denied.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nexport default authorization;\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\validate-token.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../models/user\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import redis from \"../config/redis-config\";\nconst validateToken = async (req, res, next) => {\n  try {\n    const authorization = req.headers.authorization;\n    console.log(\"authorization: \", authorization);\n    Object.assign(req.headers, {\n      user: null,\n      authorization: null\n    });\n\n    if (!authorization) {\n      return next();\n    }\n\n    const accessToken = authorization.split(\" \")[1];\n    console.log(\"accessTocken: \", accessToken);\n    let decoded;\n\n    if (accessToken) {\n      decoded = _jsonwebtoken.default.verify(accessToken, process.env.JWT_SECRET);\n    }\n\n    if (!decoded) {\n      // invalid token, remove the token from everywhere\n      //remove from database\n      //remove from redis\n      return next();\n    }\n\n    if (decoded.exp * 1000 < Date.now()) {\n      //remove from database\n      //remove from redis\n      return next();\n    } //check if token is in redis\n    //if NOT in redis call next()\n    //else check last update time if greater than or equals to 1hour update the token\n    // if less skip else update token\n    // authorization = new token\n\n\n    const user = await _user.UserModel.findById(decoded.userId);\n\n    if (!user) {\n      //remove from database\n      //remove from redis\n      return next();\n    } // if the token has come all this way everything is good just attach it to the request header\n\n\n    Object.assign(req.headers, {\n      user,\n      authorization\n    });\n    return next();\n  } catch (error) {\n    console.log(error);\n    return Promise.reject(new Error(\"Error Happened!\"));\n  }\n};\n\nvar _default = validateToken; // ------------- authorization ------------------\n// let check_user_action = async (req,action,resource) =>{\n//   if(!['updateOwn','deleteOwn'].includes(action)){\n//     return true\n//   }\n//\n//   const userResource = new Set()\n//\n//   if(resource == 'tender'){\n//     let userTender = await Tender.find({ creator_user: req.user._id })\n//     userTender.forEach(tender => userResource.add(`${tender._id}`))\n//\n//   }else if(resource == 'company'){\n//     let userCompany = await Company.find({ creator_user: req.user._id })\n//     userCompany.forEach(company => userResource.add( `${company._id}`))\n//\n//   }else if(resource == 'award'){\n//     let userAward = await Award.find({ creator_user: req.user._id })\n//     userAward.forEach(award => userResource.add(`${award._id}`))\n//   }\n//\n//   if(!userResource.has(req.params.id)){\n//     return false\n//   }\n//\n//   return true\n// }\n//\n//\n//\n// exports.authorize = function (action, resource) {\n//   return async (req, res, next) => {\n//     try {\n//       const permission = roles.can(req.user.role)[action](resource);\n//\n//       if (!permission.granted) {\n//         return res.status(401).send(\"You don't have enough permission to perform this action\");\n//       }\n//\n//       let result = await check_user_action(req,action,resource)\n//       if(!result){\n//         return res.status(401).send({ param: resource , msg: `You are not authorized to edit this ${resource}.` })\n//       }\n//\n//       next()\n//     } catch (error) {\n//       return res.status(401).send(\"You don't have enough permission to perform this action\")\n//     }\n//   }\n// }\n\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRlLXRva2VuLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlVG9rZW4iLCJyZXEiLCJyZXMiLCJuZXh0IiwiYXV0aG9yaXphdGlvbiIsImhlYWRlcnMiLCJjb25zb2xlIiwibG9nIiwiT2JqZWN0IiwiYXNzaWduIiwidXNlciIsImFjY2Vzc1Rva2VuIiwic3BsaXQiLCJkZWNvZGVkIiwiand0IiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJleHAiLCJEYXRlIiwibm93IiwiVXNlck1vZGVsIiwiZmluZEJ5SWQiLCJ1c2VySWQiLCJlcnJvciIsIlByb21pc2UiLCJyZWplY3QiLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUdBOzs7O0FBREE7QUFHQSxNQUFNQSxhQUFhLEdBQUcsT0FBT0MsR0FBUCxFQUFZQyxHQUFaLEVBQWlCQyxJQUFqQixLQUEwQjtBQUM1QyxNQUFJO0FBQ0EsVUFBTUMsYUFBYSxHQUFHSCxHQUFHLENBQUNJLE9BQUosQ0FBWUQsYUFBbEM7QUFDQUUsSUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksaUJBQVosRUFBOEJILGFBQTlCO0FBQ0FJLElBQUFBLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjUixHQUFHLENBQUNJLE9BQWxCLEVBQTJCO0FBQ3ZCSyxNQUFBQSxJQUFJLEVBQUUsSUFEaUI7QUFFdkJOLE1BQUFBLGFBQWEsRUFBRTtBQUZRLEtBQTNCOztBQUtBLFFBQUksQ0FBQ0EsYUFBTCxFQUFvQjtBQUNoQixhQUFPRCxJQUFJLEVBQVg7QUFDSDs7QUFFRCxVQUFNUSxXQUFXLEdBQUdQLGFBQWEsQ0FBQ1EsS0FBZCxDQUFvQixHQUFwQixFQUF5QixDQUF6QixDQUFwQjtBQUNBTixJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxnQkFBWixFQUE4QkksV0FBOUI7QUFDQSxRQUFJRSxPQUFKOztBQUNBLFFBQUlGLFdBQUosRUFBaUI7QUFDYkUsTUFBQUEsT0FBTyxHQUFHQyxzQkFBSUMsTUFBSixDQUFXSixXQUFYLEVBQXdCSyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsVUFBcEMsQ0FBVjtBQUNIOztBQUNELFFBQUksQ0FBQ0wsT0FBTCxFQUFjO0FBQ1Y7QUFDQTtBQUNBO0FBQ0EsYUFBT1YsSUFBSSxFQUFYO0FBQ0g7O0FBRUQsUUFBSVUsT0FBTyxDQUFDTSxHQUFSLEdBQWMsSUFBZCxHQUFxQkMsSUFBSSxDQUFDQyxHQUFMLEVBQXpCLEVBQXFDO0FBQ2pDO0FBQ0E7QUFDQSxhQUFPbEIsSUFBSSxFQUFYO0FBQ0gsS0E3QkQsQ0ErQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUEsVUFBTU8sSUFBSSxHQUFHLE1BQU1ZLGdCQUFVQyxRQUFWLENBQW1CVixPQUFPLENBQUNXLE1BQTNCLENBQW5COztBQUNBLFFBQUksQ0FBQ2QsSUFBTCxFQUFXO0FBQ1A7QUFDQTtBQUNBLGFBQU9QLElBQUksRUFBWDtBQUNILEtBMUNELENBNENBOzs7QUFDQUssSUFBQUEsTUFBTSxDQUFDQyxNQUFQLENBQWNSLEdBQUcsQ0FBQ0ksT0FBbEIsRUFBMkI7QUFDdkJLLE1BQUFBLElBRHVCO0FBRXZCTixNQUFBQTtBQUZ1QixLQUEzQjtBQUtBLFdBQU9ELElBQUksRUFBWDtBQUNILEdBbkRELENBbURFLE9BQU9zQixLQUFQLEVBQWM7QUFDWm5CLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZa0IsS0FBWjtBQUNBLFdBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLElBQUlDLEtBQUosQ0FBVSxpQkFBVixDQUFmLENBQVA7QUFDSDtBQUNKLENBeEREOztlQTBEZTVCLGEsRUFHZjtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcblxyXG4vLyBpbXBvcnQgcmVkaXMgZnJvbSBcIi4uL2NvbmZpZy9yZWRpcy1jb25maWdcIjtcclxuaW1wb3J0IHtVc2VyTW9kZWx9IGZyb20gXCIuLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5cclxuY29uc3QgdmFsaWRhdGVUb2tlbiA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBhdXRob3JpemF0aW9uID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvblxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiYXV0aG9yaXphdGlvbjogXCIsYXV0aG9yaXphdGlvbilcclxuICAgICAgICBPYmplY3QuYXNzaWduKHJlcS5oZWFkZXJzLCB7XHJcbiAgICAgICAgICAgIHVzZXI6IG51bGwsXHJcbiAgICAgICAgICAgIGF1dGhvcml6YXRpb246IG51bGwsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICghYXV0aG9yaXphdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhdXRob3JpemF0aW9uLnNwbGl0KFwiIFwiKVsxXTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImFjY2Vzc1RvY2tlbjogXCIsIGFjY2Vzc1Rva2VuKTtcclxuICAgICAgICBsZXQgZGVjb2RlZDtcclxuICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHtcclxuICAgICAgICAgICAgZGVjb2RlZCA9IGp3dC52ZXJpZnkoYWNjZXNzVG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWRlY29kZWQpIHtcclxuICAgICAgICAgICAgLy8gaW52YWxpZCB0b2tlbiwgcmVtb3ZlIHRoZSB0b2tlbiBmcm9tIGV2ZXJ5d2hlcmVcclxuICAgICAgICAgICAgLy9yZW1vdmUgZnJvbSBkYXRhYmFzZVxyXG4gICAgICAgICAgICAvL3JlbW92ZSBmcm9tIHJlZGlzXHJcbiAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZGVjb2RlZC5leHAgKiAxMDAwIDwgRGF0ZS5ub3coKSkge1xyXG4gICAgICAgICAgICAvL3JlbW92ZSBmcm9tIGRhdGFiYXNlXHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGZyb20gcmVkaXNcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vY2hlY2sgaWYgdG9rZW4gaXMgaW4gcmVkaXNcclxuICAgICAgICAvL2lmIE5PVCBpbiByZWRpcyBjYWxsIG5leHQoKVxyXG4gICAgICAgIC8vZWxzZSBjaGVjayBsYXN0IHVwZGF0ZSB0aW1lIGlmIGdyZWF0ZXIgdGhhbiBvciBlcXVhbHMgdG8gMWhvdXIgdXBkYXRlIHRoZSB0b2tlblxyXG4gICAgICAgIC8vIGlmIGxlc3Mgc2tpcCBlbHNlIHVwZGF0ZSB0b2tlblxyXG4gICAgICAgIC8vIGF1dGhvcml6YXRpb24gPSBuZXcgdG9rZW5cclxuXHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXJNb2RlbC5maW5kQnlJZChkZWNvZGVkLnVzZXJJZCk7XHJcbiAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGZyb20gZGF0YWJhc2VcclxuICAgICAgICAgICAgLy9yZW1vdmUgZnJvbSByZWRpc1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaWYgdGhlIHRva2VuIGhhcyBjb21lIGFsbCB0aGlzIHdheSBldmVyeXRoaW5nIGlzIGdvb2QganVzdCBhdHRhY2ggaXQgdG8gdGhlIHJlcXVlc3QgaGVhZGVyXHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihyZXEuaGVhZGVycywge1xyXG4gICAgICAgICAgICB1c2VyLFxyXG4gICAgICAgICAgICBhdXRob3JpemF0aW9uLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3IgSGFwcGVuZWQhXCIpKTtcclxuICAgIH1cclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHZhbGlkYXRlVG9rZW47XHJcblxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLSBhdXRob3JpemF0aW9uIC0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuLy8gbGV0IGNoZWNrX3VzZXJfYWN0aW9uID0gYXN5bmMgKHJlcSxhY3Rpb24scmVzb3VyY2UpID0+e1xyXG4vLyAgIGlmKCFbJ3VwZGF0ZU93bicsJ2RlbGV0ZU93biddLmluY2x1ZGVzKGFjdGlvbikpe1xyXG4vLyAgICAgcmV0dXJuIHRydWVcclxuLy8gICB9XHJcbi8vXHJcbi8vICAgY29uc3QgdXNlclJlc291cmNlID0gbmV3IFNldCgpXHJcbi8vXHJcbi8vICAgaWYocmVzb3VyY2UgPT0gJ3RlbmRlcicpe1xyXG4vLyAgICAgbGV0IHVzZXJUZW5kZXIgPSBhd2FpdCBUZW5kZXIuZmluZCh7IGNyZWF0b3JfdXNlcjogcmVxLnVzZXIuX2lkIH0pXHJcbi8vICAgICB1c2VyVGVuZGVyLmZvckVhY2godGVuZGVyID0+IHVzZXJSZXNvdXJjZS5hZGQoYCR7dGVuZGVyLl9pZH1gKSlcclxuLy9cclxuLy8gICB9ZWxzZSBpZihyZXNvdXJjZSA9PSAnY29tcGFueScpe1xyXG4vLyAgICAgbGV0IHVzZXJDb21wYW55ID0gYXdhaXQgQ29tcGFueS5maW5kKHsgY3JlYXRvcl91c2VyOiByZXEudXNlci5faWQgfSlcclxuLy8gICAgIHVzZXJDb21wYW55LmZvckVhY2goY29tcGFueSA9PiB1c2VyUmVzb3VyY2UuYWRkKCBgJHtjb21wYW55Ll9pZH1gKSlcclxuLy9cclxuLy8gICB9ZWxzZSBpZihyZXNvdXJjZSA9PSAnYXdhcmQnKXtcclxuLy8gICAgIGxldCB1c2VyQXdhcmQgPSBhd2FpdCBBd2FyZC5maW5kKHsgY3JlYXRvcl91c2VyOiByZXEudXNlci5faWQgfSlcclxuLy8gICAgIHVzZXJBd2FyZC5mb3JFYWNoKGF3YXJkID0+IHVzZXJSZXNvdXJjZS5hZGQoYCR7YXdhcmQuX2lkfWApKVxyXG4vLyAgIH1cclxuLy9cclxuLy8gICBpZighdXNlclJlc291cmNlLmhhcyhyZXEucGFyYW1zLmlkKSl7XHJcbi8vICAgICByZXR1cm4gZmFsc2VcclxuLy8gICB9XHJcbi8vXHJcbi8vICAgcmV0dXJuIHRydWVcclxuLy8gfVxyXG4vL1xyXG4vL1xyXG4vL1xyXG4vLyBleHBvcnRzLmF1dGhvcml6ZSA9IGZ1bmN0aW9uIChhY3Rpb24sIHJlc291cmNlKSB7XHJcbi8vICAgcmV0dXJuIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4vLyAgICAgdHJ5IHtcclxuLy8gICAgICAgY29uc3QgcGVybWlzc2lvbiA9IHJvbGVzLmNhbihyZXEudXNlci5yb2xlKVthY3Rpb25dKHJlc291cmNlKTtcclxuLy9cclxuLy8gICAgICAgaWYgKCFwZXJtaXNzaW9uLmdyYW50ZWQpIHtcclxuLy8gICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJZb3UgZG9uJ3QgaGF2ZSBlbm91Z2ggcGVybWlzc2lvbiB0byBwZXJmb3JtIHRoaXMgYWN0aW9uXCIpO1xyXG4vLyAgICAgICB9XHJcbi8vXHJcbi8vICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBjaGVja191c2VyX2FjdGlvbihyZXEsYWN0aW9uLHJlc291cmNlKVxyXG4vLyAgICAgICBpZighcmVzdWx0KXtcclxuLy8gICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoeyBwYXJhbTogcmVzb3VyY2UgLCBtc2c6IGBZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIGVkaXQgdGhpcyAke3Jlc291cmNlfS5gIH0pXHJcbi8vICAgICAgIH1cclxuLy9cclxuLy8gICAgICAgbmV4dCgpXHJcbi8vICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4vLyAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJZb3UgZG9uJ3QgaGF2ZSBlbm91Z2ggcGVybWlzc2lvbiB0byBwZXJmb3JtIHRoaXMgYWN0aW9uXCIpXHJcbi8vICAgICB9XHJcbi8vICAgfVxyXG4vLyB9XHJcbiJdfQ==","map":{"version":3,"sources":["validate-token.js"],"names":["validateToken","req","res","next","authorization","headers","console","log","Object","assign","user","accessToken","split","decoded","jwt","verify","process","env","JWT_SECRET","exp","Date","now","UserModel","findById","userId","error","Promise","reject","Error"],"mappings":";;;;;;;AAAA;;AAGA;;;;AADA;AAGA,MAAMA,aAAa,GAAG,OAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAC5C,MAAI;AACA,UAAMC,aAAa,GAAGH,GAAG,CAACI,OAAJ,CAAYD,aAAlC;AACAE,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA8BH,aAA9B;AACAI,IAAAA,MAAM,CAACC,MAAP,CAAcR,GAAG,CAACI,OAAlB,EAA2B;AACvBK,MAAAA,IAAI,EAAE,IADiB;AAEvBN,MAAAA,aAAa,EAAE;AAFQ,KAA3B;;AAKA,QAAI,CAACA,aAAL,EAAoB;AAChB,aAAOD,IAAI,EAAX;AACH;;AAED,UAAMQ,WAAW,GAAGP,aAAa,CAACQ,KAAd,CAAoB,GAApB,EAAyB,CAAzB,CAApB;AACAN,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BI,WAA9B;AACA,QAAIE,OAAJ;;AACA,QAAIF,WAAJ,EAAiB;AACbE,MAAAA,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,WAAX,EAAwBK,OAAO,CAACC,GAAR,CAAYC,UAApC,CAAV;AACH;;AACD,QAAI,CAACL,OAAL,EAAc;AACV;AACA;AACA;AACA,aAAOV,IAAI,EAAX;AACH;;AAED,QAAIU,OAAO,CAACM,GAAR,GAAc,IAAd,GAAqBC,IAAI,CAACC,GAAL,EAAzB,EAAqC;AACjC;AACA;AACA,aAAOlB,IAAI,EAAX;AACH,KA7BD,CA+BA;AACA;AACA;AACA;AACA;;;AAEA,UAAMO,IAAI,GAAG,MAAMY,gBAAUC,QAAV,CAAmBV,OAAO,CAACW,MAA3B,CAAnB;;AACA,QAAI,CAACd,IAAL,EAAW;AACP;AACA;AACA,aAAOP,IAAI,EAAX;AACH,KA1CD,CA4CA;;;AACAK,IAAAA,MAAM,CAACC,MAAP,CAAcR,GAAG,CAACI,OAAlB,EAA2B;AACvBK,MAAAA,IADuB;AAEvBN,MAAAA;AAFuB,KAA3B;AAKA,WAAOD,IAAI,EAAX;AACH,GAnDD,CAmDE,OAAOsB,KAAP,EAAc;AACZnB,IAAAA,OAAO,CAACC,GAAR,CAAYkB,KAAZ;AACA,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,iBAAV,CAAf,CAAP;AACH;AACJ,CAxDD;;eA0De5B,a,EAGf;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\n\r\n// import redis from \"../config/redis-config\";\r\nimport {UserModel} from \"../../models/user\";\r\n\r\nconst validateToken = async (req, res, next) => {\r\n    try {\r\n        const authorization = req.headers.authorization\r\n        console.log(\"authorization: \",authorization)\r\n        Object.assign(req.headers, {\r\n            user: null,\r\n            authorization: null,\r\n        });\r\n\r\n        if (!authorization) {\r\n            return next();\r\n        }\r\n\r\n        const accessToken = authorization.split(\" \")[1];\r\n        console.log(\"accessTocken: \", accessToken);\r\n        let decoded;\r\n        if (accessToken) {\r\n            decoded = jwt.verify(accessToken, process.env.JWT_SECRET);\r\n        }\r\n        if (!decoded) {\r\n            // invalid token, remove the token from everywhere\r\n            //remove from database\r\n            //remove from redis\r\n            return next();\r\n        }\r\n\r\n        if (decoded.exp * 1000 < Date.now()) {\r\n            //remove from database\r\n            //remove from redis\r\n            return next();\r\n        }\r\n\r\n        //check if token is in redis\r\n        //if NOT in redis call next()\r\n        //else check last update time if greater than or equals to 1hour update the token\r\n        // if less skip else update token\r\n        // authorization = new token\r\n\r\n        const user = await UserModel.findById(decoded.userId);\r\n        if (!user) {\r\n            //remove from database\r\n            //remove from redis\r\n            return next();\r\n        }\r\n\r\n        // if the token has come all this way everything is good just attach it to the request header\r\n        Object.assign(req.headers, {\r\n            user,\r\n            authorization,\r\n        });\r\n\r\n        return next();\r\n    } catch (error) {\r\n        console.log(error)\r\n        return Promise.reject(new Error(\"Error Happened!\"));\r\n    }\r\n};\r\n\r\nexport default validateToken;\r\n\r\n\r\n// ------------- authorization ------------------\r\n\r\n// let check_user_action = async (req,action,resource) =>{\r\n//   if(!['updateOwn','deleteOwn'].includes(action)){\r\n//     return true\r\n//   }\r\n//\r\n//   const userResource = new Set()\r\n//\r\n//   if(resource == 'tender'){\r\n//     let userTender = await Tender.find({ creator_user: req.user._id })\r\n//     userTender.forEach(tender => userResource.add(`${tender._id}`))\r\n//\r\n//   }else if(resource == 'company'){\r\n//     let userCompany = await Company.find({ creator_user: req.user._id })\r\n//     userCompany.forEach(company => userResource.add( `${company._id}`))\r\n//\r\n//   }else if(resource == 'award'){\r\n//     let userAward = await Award.find({ creator_user: req.user._id })\r\n//     userAward.forEach(award => userResource.add(`${award._id}`))\r\n//   }\r\n//\r\n//   if(!userResource.has(req.params.id)){\r\n//     return false\r\n//   }\r\n//\r\n//   return true\r\n// }\r\n//\r\n//\r\n//\r\n// exports.authorize = function (action, resource) {\r\n//   return async (req, res, next) => {\r\n//     try {\r\n//       const permission = roles.can(req.user.role)[action](resource);\r\n//\r\n//       if (!permission.granted) {\r\n//         return res.status(401).send(\"You don't have enough permission to perform this action\");\r\n//       }\r\n//\r\n//       let result = await check_user_action(req,action,resource)\r\n//       if(!result){\r\n//         return res.status(401).send({ param: resource , msg: `You are not authorized to edit this ${resource}.` })\r\n//       }\r\n//\r\n//       next()\r\n//     } catch (error) {\r\n//       return res.status(401).send(\"You don't have enough permission to perform this action\")\r\n//     }\r\n//   }\r\n// }\r\n"]}},"mtime":1648703549482},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\phone-verification.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\n// import admin from \"../../config/firebase-config\";\nconst phoneVerification = async (resolve, source, args, context, info) => {\n  // const {phoneVerification} = context;\n  // let phoneNumber = \"\";\n  //\n  // await admin\n  //     .auth()\n  //     .verifyIdToken(phoneVerification)\n  //     .then((decodedToken) => {\n  //         phoneNumber = decodedToken.phone_number;\n  //     })\n  //     .catch(() => Promise.reject(new Error(\"Error happened!\")));\n  // if (phoneNumber === \"\") {\n  //     return Promise.reject(new Error(\"Phone number not detected!\"));\n  // }\n  // context.phoneNumber = phoneNumber;\n  return resolve(source, args, context, info);\n};\n\nvar _default = phoneVerification;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBob25lLXZlcmlmaWNhdGlvbi5qcyJdLCJuYW1lcyI6WyJwaG9uZVZlcmlmaWNhdGlvbiIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUVBLE1BQU1BLGlCQUFpQixHQUFHLE9BQU9DLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFPSixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsQ0FoQkQ7O2VBa0JlTCxpQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbWlkZGxld2FyZXNcXGF1dGhcXCIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCBhZG1pbiBmcm9tIFwiLi4vLi4vY29uZmlnL2ZpcmViYXNlLWNvbmZpZ1wiO1xyXG5cclxuY29uc3QgcGhvbmVWZXJpZmljYXRpb24gPSBhc3luYyAocmVzb2x2ZSwgc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiB7XHJcbiAgICAvLyBjb25zdCB7cGhvbmVWZXJpZmljYXRpb259ID0gY29udGV4dDtcclxuICAgIC8vIGxldCBwaG9uZU51bWJlciA9IFwiXCI7XHJcbiAgICAvL1xyXG4gICAgLy8gYXdhaXQgYWRtaW5cclxuICAgIC8vICAgICAuYXV0aCgpXHJcbiAgICAvLyAgICAgLnZlcmlmeUlkVG9rZW4ocGhvbmVWZXJpZmljYXRpb24pXHJcbiAgICAvLyAgICAgLnRoZW4oKGRlY29kZWRUb2tlbikgPT4ge1xyXG4gICAgLy8gICAgICAgICBwaG9uZU51bWJlciA9IGRlY29kZWRUb2tlbi5waG9uZV9udW1iZXI7XHJcbiAgICAvLyAgICAgfSlcclxuICAgIC8vICAgICAuY2F0Y2goKCkgPT4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3IgaGFwcGVuZWQhXCIpKSk7XHJcbiAgICAvLyBpZiAocGhvbmVOdW1iZXIgPT09IFwiXCIpIHtcclxuICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiUGhvbmUgbnVtYmVyIG5vdCBkZXRlY3RlZCFcIikpO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gY29udGV4dC5waG9uZU51bWJlciA9IHBob25lTnVtYmVyO1xyXG4gICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgcGhvbmVWZXJpZmljYXRpb247XHJcbiJdfQ==","map":{"version":3,"sources":["phone-verification.js"],"names":["phoneVerification","resolve","source","args","context","info"],"mappings":";;;;;;;AAAA;AAEA,MAAMA,iBAAiB,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAOJ,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAhBD;;eAkBeL,iB","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["// import admin from \"../../config/firebase-config\";\r\n\r\nconst phoneVerification = async (resolve, source, args, context, info) => {\r\n    // const {phoneVerification} = context;\r\n    // let phoneNumber = \"\";\r\n    //\r\n    // await admin\r\n    //     .auth()\r\n    //     .verifyIdToken(phoneVerification)\r\n    //     .then((decodedToken) => {\r\n    //         phoneNumber = decodedToken.phone_number;\r\n    //     })\r\n    //     .catch(() => Promise.reject(new Error(\"Error happened!\")));\r\n    // if (phoneNumber === \"\") {\r\n    //     return Promise.reject(new Error(\"Phone number not detected!\"));\r\n    // }\r\n    // context.phoneNumber = phoneNumber;\r\n    return resolve(source, args, context, info);\r\n}\r\n\r\nexport default phoneVerification;\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\validators\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\validators\\\\user-validator.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n// import validator from \"validators\";\nconst userValidator = {\n  changePassword: async (resolve, source, args, context, info) => {\n    const {\n      newPassword\n    } = args; // if (!validator.isLength(newPassword, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: newPassword\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  newPassword: async (resolve, source, args, context, info) => {\n    const {\n      newPassword\n    } = args; // if (!validator.isLength(newPassword, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: newPassword\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  resetPassword: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = validator.normalizeEmail(email);\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    return resolve(source, args, context, info);\n  },\n  signIn: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = email.toString().toLowerCase();\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    return resolve(source, args, context, info);\n  },\n  signUp: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = email.toString().toLowerCase();\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    const {\n      password\n    } = args; // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\n    //     return Promise.reject(new Error(\"Error: email\"));\n    // }\n    //\n    // if (!validator.isLength(password, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: password\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  updateUser: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = validator.normalizeEmail(email);\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    const {\n      firstName,\n      lastName\n    } = args; // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\n    //     return Promise.reject(new Error(\"Error: email\"));\n    // }\n    // if (!validator.isLength(firstName, {min: 2})) {\n    //     return Promise.reject(new Error(\"Error: firstName\"));\n    // }\n    // if (!validator.isLength(lastName, {min: 2})) {\n    //     return Promise.reject(new Error(\"Error: lastName\"));\n    // }\n\n    return resolve(source, args, context, info);\n  }\n};\nvar _default = userValidator;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXItdmFsaWRhdG9yLmpzIl0sIm5hbWVzIjpbInVzZXJWYWxpZGF0b3IiLCJjaGFuZ2VQYXNzd29yZCIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iLCJuZXdQYXNzd29yZCIsInJlc2V0UGFzc3dvcmQiLCJlbWFpbCIsInNpZ25JbiIsInNpZ25VcCIsInBhc3N3b3JkIiwidXBkYXRlVXNlciIsImZpcnN0TmFtZSIsImxhc3ROYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUVBLE1BQU1BLGFBQWEsR0FBRztBQUNsQkMsRUFBQUEsY0FBYyxFQUFFLE9BQU9DLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQzVELFVBQU07QUFBQ0MsTUFBQUE7QUFBRCxRQUFnQkgsSUFBdEIsQ0FENEQsQ0FHNUQ7QUFDQTtBQUNBOztBQUVBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxHQVRpQjtBQVVsQkMsRUFBQUEsV0FBVyxFQUFFLE9BQU9MLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3pELFVBQU07QUFBQ0MsTUFBQUE7QUFBRCxRQUFnQkgsSUFBdEIsQ0FEeUQsQ0FHekQ7QUFDQTtBQUNBOztBQUVBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxHQWxCaUI7QUFtQmxCRSxFQUFBQSxhQUFhLEVBQUUsT0FBT04sT0FBUCxFQUFnQkMsTUFBaEIsRUFBd0JDLElBQXhCLEVBQThCQyxPQUE5QixFQUF1Q0MsSUFBdkMsS0FBZ0Q7QUFDM0QsUUFBSTtBQUFDRyxNQUFBQTtBQUFELFFBQVVMLElBQWQsQ0FEMkQsQ0FHM0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsV0FBT0YsT0FBTyxDQUFDQyxNQUFELEVBQVNDLElBQVQsRUFBZUMsT0FBZixFQUF3QkMsSUFBeEIsQ0FBZDtBQUNILEdBNUJpQjtBQTZCbEJJLEVBQUFBLE1BQU0sRUFBRSxPQUFPUixPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUNwRCxRQUFJO0FBQUNHLE1BQUFBO0FBQUQsUUFBVUwsSUFBZCxDQURvRCxDQUdwRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxXQUFPRixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsR0F0Q2lCO0FBdUNsQkssRUFBQUEsTUFBTSxFQUFFLE9BQU9ULE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3BELFFBQUk7QUFBQ0csTUFBQUE7QUFBRCxRQUFVTCxJQUFkLENBRG9ELENBR3BEO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFVBQU07QUFBQ1EsTUFBQUE7QUFBRCxRQUFhUixJQUFuQixDQVJvRCxDQVVwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxXQUFPRixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsR0ExRGlCO0FBMkRsQk8sRUFBQUEsVUFBVSxFQUFFLE9BQU9YLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3hELFFBQUk7QUFBQ0csTUFBQUE7QUFBRCxRQUFVTCxJQUFkLENBRHdELENBR3hEO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFVBQU07QUFDRlUsTUFBQUEsU0FERTtBQUVGQyxNQUFBQTtBQUZFLFFBR0ZYLElBSEosQ0FSd0QsQ0FheEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSDtBQWxGaUIsQ0FBdEI7ZUFxRmVOLGEiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXG1pZGRsZXdhcmVzXFx2YWxpZGF0b3JzXFwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgdmFsaWRhdG9yIGZyb20gXCJ2YWxpZGF0b3JzXCI7XHJcblxyXG5jb25zdCB1c2VyVmFsaWRhdG9yID0ge1xyXG4gICAgY2hhbmdlUGFzc3dvcmQ6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB7bmV3UGFzc3dvcmR9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgobmV3UGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IG5ld1Bhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgbmV3UGFzc3dvcmQ6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB7bmV3UGFzc3dvcmR9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgobmV3UGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IG5ld1Bhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgcmVzZXRQYXNzd29yZDogYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgICAgIGxldCB7ZW1haWx9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gZW1haWwgPSB2YWxpZGF0b3Iubm9ybWFsaXplRW1haWwoZW1haWwpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxuICAgIH0sXHJcbiAgICBzaWduSW46IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBsZXQge2VtYWlsfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGVtYWlsID0gZW1haWwudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxuICAgIH0sXHJcbiAgICBzaWduVXA6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBsZXQge2VtYWlsfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGVtYWlsID0gZW1haWwudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgY29uc3Qge3Bhc3N3b3JkfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGlmICghdmFsaWRhdG9yLmlzRW1haWwoZW1haWwsIHthbGxvd191dGY4X2xvY2FsX3BhcnQ6IGZhbHNlfSkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVycm9yOiBlbWFpbFwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgocGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IHBhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgdXBkYXRlVXNlcjogYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgICAgIGxldCB7ZW1haWx9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gZW1haWwgPSB2YWxpZGF0b3Iubm9ybWFsaXplRW1haWwoZW1haWwpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICBmaXJzdE5hbWUsXHJcbiAgICAgICAgICAgIGxhc3ROYW1lLFxyXG4gICAgICAgIH0gPSBhcmdzO1xyXG5cclxuICAgICAgICAvLyBpZiAoIXZhbGlkYXRvci5pc0VtYWlsKGVtYWlsLCB7YWxsb3dfdXRmOF9sb2NhbF9wYXJ0OiBmYWxzZX0pKSB7XHJcbiAgICAgICAgLy8gICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJFcnJvcjogZW1haWxcIikpO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyBpZiAoIXZhbGlkYXRvci5pc0xlbmd0aChmaXJzdE5hbWUsIHttaW46IDJ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IGZpcnN0TmFtZVwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vIGlmICghdmFsaWRhdG9yLmlzTGVuZ3RoKGxhc3ROYW1lLCB7bWluOiAyfSkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVycm9yOiBsYXN0TmFtZVwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlclZhbGlkYXRvcjtcclxuIl19","map":{"version":3,"sources":["user-validator.js"],"names":["userValidator","changePassword","resolve","source","args","context","info","newPassword","resetPassword","email","signIn","signUp","password","updateUser","firstName","lastName"],"mappings":";;;;;;AAAA;AAEA,MAAMA,aAAa,GAAG;AAClBC,EAAAA,cAAc,EAAE,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC5D,UAAM;AAACC,MAAAA;AAAD,QAAgBH,IAAtB,CAD4D,CAG5D;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GATiB;AAUlBC,EAAAA,WAAW,EAAE,OAAOL,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACzD,UAAM;AAACC,MAAAA;AAAD,QAAgBH,IAAtB,CADyD,CAGzD;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GAlBiB;AAmBlBE,EAAAA,aAAa,EAAE,OAAON,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC3D,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CAD2D,CAG3D;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GA5BiB;AA6BlBI,EAAAA,MAAM,EAAE,OAAOR,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACpD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADoD,CAGpD;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GAtCiB;AAuClBK,EAAAA,MAAM,EAAE,OAAOT,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACpD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADoD,CAGpD;AACA;AACA;AACA;;AAEA,UAAM;AAACQ,MAAAA;AAAD,QAAaR,IAAnB,CARoD,CAUpD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GA1DiB;AA2DlBO,EAAAA,UAAU,EAAE,OAAOX,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACxD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADwD,CAGxD;AACA;AACA;AACA;;AAEA,UAAM;AACFU,MAAAA,SADE;AAEFC,MAAAA;AAFE,QAGFX,IAHJ,CARwD,CAaxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH;AAlFiB,CAAtB;eAqFeN,a","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\validators\\","sourcesContent":["// import validator from \"validators\";\r\n\r\nconst userValidator = {\r\n    changePassword: async (resolve, source, args, context, info) => {\r\n        const {newPassword} = args;\r\n\r\n        // if (!validator.isLength(newPassword, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: newPassword\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    newPassword: async (resolve, source, args, context, info) => {\r\n        const {newPassword} = args;\r\n\r\n        // if (!validator.isLength(newPassword, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: newPassword\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    resetPassword: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = validator.normalizeEmail(email);\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    signIn: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = email.toString().toLowerCase();\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    signUp: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = email.toString().toLowerCase();\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        const {password} = args;\r\n\r\n        // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\r\n        //     return Promise.reject(new Error(\"Error: email\"));\r\n        // }\r\n        //\r\n        // if (!validator.isLength(password, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: password\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    updateUser: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = validator.normalizeEmail(email);\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        const {\r\n            firstName,\r\n            lastName,\r\n        } = args;\r\n\r\n        // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\r\n        //     return Promise.reject(new Error(\"Error: email\"));\r\n        // }\r\n        // if (!validator.isLength(firstName, {min: 2})) {\r\n        //     return Promise.reject(new Error(\"Error: firstName\"));\r\n        // }\r\n        // if (!validator.isLength(lastName, {min: 2})) {\r\n        //     return Promise.reject(new Error(\"Error: lastName\"));\r\n        // }\r\n        return resolve(source, args, context, info);\r\n    },\r\n};\r\n\r\nexport default userValidator;\r\n"]}},"mtime":1648684433893},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\resolvers\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\resolvers\\\\auth-resolvers.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _authUseCases = _interopRequireDefault(require(\"../../../services/auth/use-cases/auth-use-cases\"));\n\nvar _redisServices = _interopRequireDefault(require(\"../../../services/redis/redis-services\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\nconst signIn = {\n  name: \"signIn\",\n  type: \"AccessToken!\",\n  args: {\n    phoneNumber: \"String!\",\n    password: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      phoneNumber,\n      password\n    }\n  }) => {\n    try {\n      const {\n        user,\n        accessToken\n      } = await _authUseCases.default.signIn({\n        phoneNumber,\n        password\n      });\n      return {\n        accessToken,\n        user\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst signUp = {\n  name: \"signUp\",\n  type: \"AccessToken!\",\n  args: {\n    firstName: \"String!\",\n    middleName: \"String!\",\n    lastName: \"String!\",\n    password: \"String!\",\n    phoneNumber: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      firstName,\n      middleName,\n      lastName,\n      password,\n      phoneNumber\n    },\n    context: {\n      phoneVerification\n    }\n  }) => {\n    try {\n      const {\n        accessToken,\n        user\n      } = await _authUseCases.default.signUp({\n        firstName,\n        middleName,\n        lastName,\n        password,\n        phoneNumber\n      });\n      console.log(accessToken);\n      return {\n        accessToken,\n        // roles: user.roles,\n        user\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst logout = {\n  name: 'logout',\n  type: 'Succeed!',\n  resolve: async ({\n    context: {\n      user,\n      accessToken\n    }\n  }) => {\n    try {\n      // await redis.set(`expiredToken:${accessToken}`, user._id, 'EX', process.env.REDIS_TOKEN_EXPIRY);\n      await _authUseCases.default.logout({\n        user,\n        accessToken\n      });\n      return {\n        succeed: true\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst changePassword = {\n  name: \"changePassword\",\n  type: \"AccessToken!\",\n  args: {\n    newPassword: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      newPassword\n    },\n    context: {\n      user,\n      accessToken\n    }\n  }) => {\n    try {\n      console.log(\"changepassword\");\n      const {\n        updatedUser,\n        oldAccessTocken\n      } = await _authUseCases.default.changePassword({\n        newPassword,\n        user,\n        accessToken\n      });\n      return {\n        updatedUser,\n        oldAccessTocken\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nvar _default = {\n  signIn,\n  signUp,\n  logout,\n  changePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtcmVzb2x2ZXJzLmpzIl0sIm5hbWVzIjpbInNpZ25JbiIsIm5hbWUiLCJ0eXBlIiwiYXJncyIsInBob25lTnVtYmVyIiwicGFzc3dvcmQiLCJyZXNvbHZlIiwidXNlciIsImFjY2Vzc1Rva2VuIiwiYXV0aFNlcnZpY2VzIiwiZXJyb3IiLCJQcm9taXNlIiwicmVqZWN0Iiwic2lnblVwIiwiZmlyc3ROYW1lIiwibWlkZGxlTmFtZSIsImxhc3ROYW1lIiwiY29udGV4dCIsInBob25lVmVyaWZpY2F0aW9uIiwiY29uc29sZSIsImxvZyIsImxvZ291dCIsInN1Y2NlZWQiLCJjaGFuZ2VQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwidXBkYXRlZFVzZXIiLCJvbGRBY2Nlc3NUb2NrZW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUNBO0FBRUEsTUFBTUEsTUFBTSxHQUFHO0FBQ1hDLEVBQUFBLElBQUksRUFBRSxRQURLO0FBRVhDLEVBQUFBLElBQUksRUFBRSxjQUZLO0FBR1hDLEVBQUFBLElBQUksRUFBRTtBQUNGQyxJQUFBQSxXQUFXLEVBQUUsU0FEWDtBQUVGQyxJQUFBQSxRQUFRLEVBQUU7QUFGUixHQUhLO0FBT1hDLEVBQUFBLE9BQU8sRUFBRSxPQUFPO0FBQUNILElBQUFBLElBQUksRUFBRTtBQUFDQyxNQUFBQSxXQUFEO0FBQWNDLE1BQUFBO0FBQWQ7QUFBUCxHQUFQLEtBQTJDO0FBQ2hELFFBQUk7QUFFQSxZQUFNO0FBQUNFLFFBQUFBLElBQUQ7QUFBT0MsUUFBQUE7QUFBUCxVQUFzQixNQUFNQyxzQkFBYVQsTUFBYixDQUFvQjtBQUFDSSxRQUFBQSxXQUFEO0FBQWNDLFFBQUFBO0FBQWQsT0FBcEIsQ0FBbEM7QUFFQSxhQUFPO0FBQUNHLFFBQUFBLFdBQUQ7QUFBY0QsUUFBQUE7QUFBZCxPQUFQO0FBQ0gsS0FMRCxDQUtFLE9BQU9HLEtBQVAsRUFBYztBQUNaLGFBQU9DLE9BQU8sQ0FBQ0MsTUFBUixD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RUFBYztBQUNaLGFBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlRixLQUFmLENBQVA7QUFDSDtBQUNKO0FBZmtCLENBQXZCO2VBa0JlO0FBQ1hWLEVBQUFBLE1BRFc7QUFFWGEsRUFBQUEsTUFGVztBQUdYUSxFQUFBQSxNQUhXO0FBSVhFLEVBQUFBO0FBSlcsQyIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcYXV0aFxccmVzb2x2ZXJzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcclxuaW1wb3J0IHtVc2VyTW9kZWx9IGZyb20gXCIuLi8uLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5pbXBvcnQgYXV0aFNlcnZpY2VzIGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9hdXRoL3VzZS1jYXNlcy9hdXRoLXVzZS1jYXNlc1wiO1xyXG5pbXBvcnQgc3RvcmVOZXdTZXNzaW9uIGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9yZWRpcy9yZWRpcy1zZXJ2aWNlc1wiXHJcbi8vIGltcG9ydCBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xyXG5cclxuY29uc3Qgc2lnbkluID0ge1xyXG4gICAgbmFtZTogXCJzaWduSW5cIixcclxuICAgIHR5cGU6IFwiQWNjZXNzVG9rZW4hXCIsXHJcbiAgICBhcmdzOiB7XHJcbiAgICAgICAgcGhvbmVOdW1iZXI6IFwiU3RyaW5nIVwiLFxyXG4gICAgICAgIHBhc3N3b3JkOiBcIlN0cmluZyFcIixcclxuICAgIH0sXHJcbiAgICByZXNvbHZlOiBhc3luYyAoe2FyZ3M6IHtwaG9uZU51bWJlciwgcGFzc3dvcmR9fSkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB7dXNlciwgYWNjZXNzVG9rZW59ID0gYXdhaXQgYXV0aFNlcnZpY2VzLnNpZ25Jbih7cGhvbmVOdW1iZXIsIHBhc3N3b3JkfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4ge2FjY2Vzc1Rva2VuLCB1c2VyfTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn07XHJcblxyXG5cclxuY29uc3Qgc2lnblVwID0ge1xyXG4gICAgbmFtZTogXCJzaWduVXBcIixcclxuICAgIHR5cGU6IFwiQWNjZXNzVG9rZW4hXCIsXHJcbiAgICBhcmdzOiB7XHJcbiAgICAgICAgZmlyc3ROYW1lOiBcIlN0cmluZyFcIixcclxuICAgICAgICBtaWRkbGVOYW1lOiBcIlN0cmluZyFcIixcclxuICAgICAgICBsYXN0TmFtZTogXCJTdHJpbmchXCIsXHJcbiAgICAgICAgcGFzc3dvcmQ6IFwiU3RyaW5nIVwiLFxyXG4gICAgICAgIHBob25lTnVtYmVyOiBcIlN0cmluZyFcIixcclxuICAgIH0sXHJcbiAgICByZXNvbHZlOiBhc3luYyAoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcmdzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaWRkbGVOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzd29yZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBob25lTnVtYmVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBob25lVmVyaWZpY2F0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIH0pID0+IHtcclxuICAgICAgICB0cnkge1xyXG5cclxuICAgICAgICAgICAgY29uc3Qge2FjY2Vzc1Rva2VuLCB1c2VyfSA9IGF3YWl0IGF1dGhTZXJ2aWNlcy5zaWduVXAoe1xyXG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgbWlkZGxlTmFtZSxcclxuICAgICAgICAgICAgICAgIGxhc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICBwaG9uZU51bWJlcixcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGFjY2Vzc1Rva2VuKSAgIFxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4sXHJcbiAgICAgICAgICAgICAgICAvLyByb2xlczogdXNlci5yb2xlcyxcclxuICAgICAgICAgICAgICAgIHVzZXIsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59O1xyXG5cclxuY29uc3QgbG9nb3V0ID0ge1xyXG4gICAgbmFtZTogJ2xvZ291dCcsXHJcbiAgICB0eXBlOiAnU3VjY2VlZCEnLFxyXG4gICAgcmVzb2x2ZTogYXN5bmMgKHtjb250ZXh0OiB7dXNlciwgYWNjZXNzVG9rZW59fSkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIGF3YWl0IHJlZGlzLnNldChgZXhwaXJlZFRva2VuOiR7YWNjZXNzVG9rZW59YCwgdXNlci5faWQsICdFWCcsIHByb2Nlc3MuZW52LlJFRElTX1RPS0VOX0VYUElSWSk7XHJcbiAgICAgICAgICAgIGF3YWl0IGF1dGhTZXJ2aWNlcy5sb2dvdXQoe3VzZXIsYWNjZXNzVG9rZW59KVxyXG4gICAgICAgICAgICByZXR1cm4ge3N1Y2NlZWQ6IHRydWV9O1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuY29uc3QgY2hhbmdlUGFzc3dvcmQgPSB7XHJcbiAgICBuYW1lOiBcImNoYW5nZVBhc3N3b3JkXCIsXHJcbiAgICB0eXBlOiBcIkFjY2Vzc1Rva2VuIVwiLFxyXG4gICAgYXJnczoge1xyXG4gICAgICAgIG5ld1Bhc3N3b3JkOiBcIlN0cmluZyFcIixcclxuICAgIH0sXHJcbiAgICByZXNvbHZlOiBhc3luYyAoe2FyZ3M6IHtuZXdQYXNzd29yZH0sIGNvbnRleHQ6IHt1c2VyLCBhY2Nlc3NUb2tlbn19KSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuY29uc29sZS5sb2coXCJjaGFuZ2VwYXNzd29yZFwiKVxyXG4gICAgICAgICAgICBjb25zdCB7dXBkYXRlZFVzZXIsIG9sZEFjY2Vzc1RvY2tlbn0gPSBhd2FpdCBhdXRoU2VydmljZXMuY2hhbmdlUGFzc3dvcmQoe25ld1Bhc3N3b3JkLCB1c2VyLCBhY2Nlc3NUb2tlbn0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHt1cGRhdGVkVXNlciwgb2xkQWNjZXNzVG9ja2VufTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBzaWduSW4sXHJcbiAgICBzaWduVXAsXHJcbiAgICBsb2dvdXQsXHJcbiAgICBjaGFuZ2VQYXNzd29yZCxcclxufSJdfQ==","map":{"version":3,"sources":["auth-resolvers.js"],"names":["signIn","name","type","args","phoneNumber","password","resolve","user","accessToken","authServices","error","Promise","reject","signUp","firstName","middleName","lastName","context","phoneVerification","console","log","logout","succeed","changePassword","newPassword","updatedUser","oldAccessTocken"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\resolvers\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport {UserModel} from \"../../../models/user\";\r\nimport authServices from \"../../../services/auth/use-cases/auth-use-cases\";\r\nimport storeNewSession from \"../../../services/redis/redis-services\"\r\n// import crypto from \"crypto\";\r\n\r\nconst signIn = {\r\n    name: \"signIn\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        phoneNumber: \"String!\",\r\n        password: \"String!\",\r\n    },\r\n    resolve: async ({args: {phoneNumber, password}}) => {\r\n        try {\r\n\r\n            const {user, accessToken} = await authServices.signIn({phoneNumber, password});\r\n\r\n            return {accessToken, user};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\n\r\nconst signUp = {\r\n    name: \"signUp\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        firstName: \"String!\",\r\n        middleName: \"String!\",\r\n        lastName: \"String!\",\r\n        password: \"String!\",\r\n        phoneNumber: \"String!\",\r\n    },\r\n    resolve: async ({\r\n                        args: {\r\n                            firstName,\r\n                            middleName,\r\n                            lastName,\r\n                            password,\r\n                            phoneNumber\r\n                        },\r\n                        context: {\r\n                            phoneVerification,\r\n                        },\r\n                    }) => {\r\n        try {\r\n\r\n            const {accessToken, user} = await authServices.signUp({\r\n                firstName,\r\n                middleName,\r\n                lastName,\r\n                password,\r\n                phoneNumber,\r\n            });\r\n            console.log(accessToken)   \r\n            return {\r\n                accessToken,\r\n                // roles: user.roles,\r\n                user,\r\n            };\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\nconst logout = {\r\n    name: 'logout',\r\n    type: 'Succeed!',\r\n    resolve: async ({context: {user, accessToken}}) => {\r\n        try {\r\n            // await redis.set(`expiredToken:${accessToken}`, user._id, 'EX', process.env.REDIS_TOKEN_EXPIRY);\r\n            await authServices.logout({user,accessToken})\r\n            return {succeed: true};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    }\r\n};\r\n\r\nconst changePassword = {\r\n    name: \"changePassword\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        newPassword: \"String!\",\r\n    },\r\n    resolve: async ({args: {newPassword}, context: {user, accessToken}}) => {\r\n        try {\r\nconsole.log(\"changepassword\")\r\n            const {updatedUser, oldAccessTocken} = await authServices.changePassword({newPassword, user, accessToken});\r\n\r\n            return {updatedUser, oldAccessTocken};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\nexport default {\r\n    signIn,\r\n    signUp,\r\n    logout,\r\n    changePassword,\r\n}"]}},"mtime":1648763965272},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\user\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\user\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserQuery = exports.UserMutation = void 0;\n\nvar _user = require(\"../../models/user\");\n\nvar _middlewares = require(\"../../middlewares\");\n\n// import Resolvers from \"./use-cases\";\n//\n// for (const resolver in Resolvers) {\n//     UserTC.addResolver(Resolvers[resolver]);\n// }\nconst UserQuery = {\n  userById: _user.UserTC.getResolver(\"findById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userByIds: _user.UserTC.getResolver(\"findByIds\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userOne: _user.UserTC.getResolver(\"findOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userMany: _user.UserTC.getResolver(\"findMany\", [_middlewares.authentication.isAuth, _middlewares.authorization])\n};\nexports.UserQuery = UserQuery;\nconst UserMutation = {\n  userCreateOne: _user.UserTC.getResolver(\"createOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userCreateMany: _user.UserTC.getResolver(\"createMany\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateById: _user.UserTC.getResolver(\"updateById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateOne: _user.UserTC.getResolver(\"updateOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateMany: _user.UserTC.getResolver(\"updateMany\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveById: _user.UserTC.getResolver(\"removeById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveOne: _user.UserTC.getResolver(\"removeOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveMany: _user.UserTC.getResolver(\"removeMany\", [_middlewares.authentication.isAuth, _middlewares.authorization])\n};\nexports.UserMutation = UserMutation;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIlVzZXJRdWVyeSIsInVzZXJCeUlkIiwiVXNlclRDIiwiZ2V0UmVzb2x2ZXIiLCJhdXRoZW50aWNhdGlvbiIsImlzQXV0aCIsImF1dGhvcml6YXRpb24iLCJ1c2VyQnlJZHMiLCJ1c2VyT25lIiwidXNlck1hbnkiLCJVc2VyTXV0YXRpb24iLCJ1c2VyQ3JlYXRlT25lIiwidXNlckNyZWF0ZU1hbnkiLCJ1c2VyVXBkYXRlQnlJZCIsInVzZXJVcGRhdGVPbmUiLCJ1c2VyVXBkYXRlTWFueSIsInVzZXJSZW1vdmVCeUlkIiwidXNlclJlbW92ZU9uZSIsInVzZXJSZW1vdmVNYW55Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLE1BQU1BLFNBQVMsR0FBRztBQUNkQyxFQUFBQSxRQUFRLEVBQUVDLGFBQU9DLFdBQVAsQ0FBbUIsVUFBbkIsRUFBK0IsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBL0IsQ0FESTtBQUVkQyxFQUFBQSxTQUFTLEVBQUVMLGFBQU9DLFdBQVAsQ0FBbUIsV0FBbkIsRUFBZ0MsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBaEMsQ0FGRztBQUdkRSxFQUFBQSxPQUFPLEVBQUVOLGFBQU9DLFdBQVAsQ0FBbUIsU0FBbkIsRUFBOEIsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBOUIsQ0FISztBQUlkRyxFQUFBQSxRQUFRLEVBQUVQLGFBQU9DLFdBQVAsQ0FBbUIsVUFBbkIsRUFBK0IsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBL0I7QUFKSSxDQUFsQjs7QUFPQSxNQUFNSSxZQUFZLEdBQUc7QUFDakJDLEVBQUFBLGFBQWEsRUFBRVQsYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQURFO0FBRWpCTSxFQUFBQSxjQUFjLEVBQUVWLGFBQU9DLFdBQVAsQ0FBbUIsWUFBbkIsRUFBaUMsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBakMsQ0FGQztBQUdqQk8sRUFBQUEsY0FBYyxFQUFFWCxhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDLENBSEM7QUFJakJRLEVBQUFBLGFBQWEsRUFBRVosYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQUpFO0FBS2pCUyxFQUFBQSxjQUFjLEVBQUViLGFBQU9DLFdBQVAsQ0FBbUIsWUFBbkIsRUFBaUMsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBakMsQ0FMQztBQU1qQlUsRUFBQUEsY0FBYyxFQUFFZCxhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDLENBTkM7QUFPakJXLEVBQUFBLGFBQWEsRUFBRWYsYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQVBFO0FBUWpCWSxFQUFBQSxjQUFjLEVBQUVoQixhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDO0FBUkMsQ0FBckIiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXGdyYXBocWxcXHVzZXJcXCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7VXNlclRDfSBmcm9tIFwiLi4vLi4vbW9kZWxzL3VzZXJcIjtcclxuXHJcbmltcG9ydCB7YXV0aGVudGljYXRpb24sIGF1dGhvcml6YXRpb259IGZyb20gXCIuLi8uLi9taWRkbGV3YXJlc1wiO1xyXG4vLyBpbXBvcnQgUmVzb2x2ZXJzIGZyb20gXCIuL3VzZS1jYXNlc1wiO1xyXG4vL1xyXG4vLyBmb3IgKGNvbnN0IHJlc29sdmVyIGluIFJlc29sdmVycykge1xyXG4vLyAgICAgVXNlclRDLmFkZFJlc29sdmVyKFJlc29sdmVyc1tyZXNvbHZlcl0pO1xyXG4vLyB9XHJcblxyXG5jb25zdCBVc2VyUXVlcnkgPSB7XHJcbiAgICB1c2VyQnlJZDogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZEJ5SWRcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlckJ5SWRzOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJmaW5kQnlJZHNcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlck9uZTogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZE9uZVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyTWFueTogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZE1hbnlcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG59O1xyXG5cclxuY29uc3QgVXNlck11dGF0aW9uID0ge1xyXG4gICAgdXNlckNyZWF0ZU9uZTogVXNlclRDLmdldFJlc29sdmVyKFwiY3JlYXRlT25lXCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJDcmVhdGVNYW55OiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJjcmVhdGVNYW55XCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJVcGRhdGVCeUlkOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJ1cGRhdGVCeUlkXCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJVcGRhdGVPbmU6IFVzZXJUQy5nZXRSZXNvbHZlcihcInVwZGF0ZU9uZVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyVXBkYXRlTWFueTogVXNlclRDLmdldFJlc29sdmVyKFwidXBkYXRlTWFueVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyUmVtb3ZlQnlJZDogVXNlclRDLmdldFJlc29sdmVyKFwicmVtb3ZlQnlJZFwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyUmVtb3ZlT25lOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJyZW1vdmVPbmVcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlclJlbW92ZU1hbnk6IFVzZXJUQy5nZXRSZXNvbHZlcihcInJlbW92ZU1hbnlcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG59O1xyXG5cclxuZXhwb3J0IHtVc2VyUXVlcnksIFVzZXJNdXRhdGlvbn07XHJcbiJdfQ==","map":{"version":3,"sources":["index.js"],"names":["UserQuery","userById","UserTC","getResolver","authentication","isAuth","authorization","userByIds","userOne","userMany","UserMutation","userCreateOne","userCreateMany","userUpdateById","userUpdateOne","userUpdateMany","userRemoveById","userRemoveOne","userRemoveMany"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;AACA;AACA;AACA;AACA;AAEA,MAAMA,SAAS,GAAG;AACdC,EAAAA,QAAQ,EAAEC,aAAOC,WAAP,CAAmB,UAAnB,EAA+B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA/B,CADI;AAEdC,EAAAA,SAAS,EAAEL,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAFG;AAGdE,EAAAA,OAAO,EAAEN,aAAOC,WAAP,CAAmB,SAAnB,EAA8B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA9B,CAHK;AAIdG,EAAAA,QAAQ,EAAEP,aAAOC,WAAP,CAAmB,UAAnB,EAA+B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA/B;AAJI,CAAlB;;AAOA,MAAMI,YAAY,GAAG;AACjBC,EAAAA,aAAa,EAAET,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CADE;AAEjBM,EAAAA,cAAc,EAAEV,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CAFC;AAGjBO,EAAAA,cAAc,EAAEX,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CAHC;AAIjBQ,EAAAA,aAAa,EAAEZ,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAJE;AAKjBS,EAAAA,cAAc,EAAEb,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CALC;AAMjBU,EAAAA,cAAc,EAAEd,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CANC;AAOjBW,EAAAA,aAAa,EAAEf,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAPE;AAQjBY,EAAAA,cAAc,EAAEhB,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC;AARC,CAArB","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\user\\","sourcesContent":["import {UserTC} from \"../../models/user\";\r\n\r\nimport {authentication, authorization} from \"../../middlewares\";\r\n// import Resolvers from \"./use-cases\";\r\n//\r\n// for (const resolver in Resolvers) {\r\n//     UserTC.addResolver(Resolvers[resolver]);\r\n// }\r\n\r\nconst UserQuery = {\r\n    userById: UserTC.getResolver(\"findById\", [authentication.isAuth, authorization]),\r\n    userByIds: UserTC.getResolver(\"findByIds\", [authentication.isAuth, authorization]),\r\n    userOne: UserTC.getResolver(\"findOne\", [authentication.isAuth, authorization]),\r\n    userMany: UserTC.getResolver(\"findMany\", [authentication.isAuth, authorization]),\r\n};\r\n\r\nconst UserMutation = {\r\n    userCreateOne: UserTC.getResolver(\"createOne\", [authentication.isAuth, authorization]),\r\n    userCreateMany: UserTC.getResolver(\"createMany\", [authentication.isAuth, authorization]),\r\n    userUpdateById: UserTC.getResolver(\"updateById\", [authentication.isAuth, authorization]),\r\n    userUpdateOne: UserTC.getResolver(\"updateOne\", [authentication.isAuth, authorization]),\r\n    userUpdateMany: UserTC.getResolver(\"updateMany\", [authentication.isAuth, authorization]),\r\n    userRemoveById: UserTC.getResolver(\"removeById\", [authentication.isAuth, authorization]),\r\n    userRemoveOne: UserTC.getResolver(\"removeOne\", [authentication.isAuth, authorization]),\r\n    userRemoveMany: UserTC.getResolver(\"removeMany\", [authentication.isAuth, authorization]),\r\n};\r\n\r\nexport {UserQuery, UserMutation};\r\n"]}},"mtime":1648684433888},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\mongodb-config.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nvar _mongoose = _interopRequireDefault(require(\"mongoose\"));\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n_dotenv.default.config();\n\nmain().then(() => console.log(\"Mongoose connected\")).catch(err => console.log(err));\n\nasync function main() {\n  await _mongoose.default.connect(process.env.MONGODB_URI);\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vbmdvZGItY29uZmlnLmpzIl0sIm5hbWVzIjpbImRvdGVudiIsImNvbmZpZyIsIm1haW4iLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwibW9uZ29vc2UiLCJjb25uZWN0IiwicHJvY2VzcyIsImVudiIsIk1PTkdPREJfVVJJIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOzs7O0FBRUFBLGdCQUFPQyxNQUFQOztBQUVBQyxJQUFJLEdBQ0NDLElBREwsQ0FDVSxNQUFNQyxPQUFPLENBQUNDLEdBQVIsQ0FBWSxvQkFBWixDQURoQixFQUVLQyxLQUZMLENBRVdDLEdBQUcsSUFBSUgsT0FBTyxDQUFDQyxHQUFSLENBQVlFLEdBQVosQ0FGbEI7O0FBSUEsZUFBZUwsSUFBZixHQUFzQjtBQUNsQixRQUFNTSxrQkFBU0MsT0FBVCxDQUFpQkMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFdBQTdCLENBQU47QUFDSCIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcY29uZmlnXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XHJcbmltcG9ydCBkb3RlbnYgZnJvbSBcImRvdGVudlwiO1xyXG5cclxuZG90ZW52LmNvbmZpZygpO1xyXG5cclxubWFpbigpXHJcbiAgICAudGhlbigoKSA9PiBjb25zb2xlLmxvZyhcIk1vbmdvb3NlIGNvbm5lY3RlZFwiKSlcclxuICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBtYWluKCkge1xyXG4gICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdChwcm9jZXNzLmVudi5NT05HT0RCX1VSSSk7XHJcbn0iXX0=","map":{"version":3,"sources":["mongodb-config.js"],"names":["dotenv","config","main","then","console","log","catch","err","mongoose","connect","process","env","MONGODB_URI"],"mappings":";;AAAA;;AACA;;;;AAEAA,gBAAOC,MAAP;;AAEAC,IAAI,GACCC,IADL,CACU,MAAMC,OAAO,CAACC,GAAR,CAAY,oBAAZ,CADhB,EAEKC,KAFL,CAEWC,GAAG,IAAIH,OAAO,CAACC,GAAR,CAAYE,GAAZ,CAFlB;;AAIA,eAAeL,IAAf,GAAsB;AAClB,QAAMM,kBAASC,OAAT,CAAiBC,OAAO,CAACC,GAAR,CAAYC,WAA7B,CAAN;AACH","sourceRoot":"E:\\haleta-new-api\\src\\config\\","sourcesContent":["import mongoose from \"mongoose\";\r\nimport dotenv from \"dotenv\";\r\n\r\ndotenv.config();\r\n\r\nmain()\r\n    .then(() => console.log(\"Mongoose connected\"))\r\n    .catch(err => console.log(err));\r\n\r\nasync function main() {\r\n    await mongoose.connect(process.env.MONGODB_URI);\r\n}"]}},"mtime":1648684433884},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\use-cases\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\use-cases\\\\auth-use-cases.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _session = require(\"../../../models/session\");\n\nvar _authDataAccess = _interopRequireDefault(require(\"../data-access/auth-data-access\"));\n\nvar _redisConfig = _interopRequireDefault(require(\"../../../config/redis-config\"));\n\nvar _redisServices = _interopRequireDefault(require(\"../../redis/redis-services\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\n//load our .env file\nrequire('dotenv').config();\n\nconst moment = require(\"moment\");\n\nconst signIn = async ({\n  phoneNumber,\n  password\n}) => {\n  try {\n    const user = await _authDataAccess.default.signIn({\n      phoneNumber,\n      password\n    });\n    const userId = user._id; //check if session exists in mongodb \n\n    const session = await _authDataAccess.default.findSession(userId);\n    console.log(session);\n    let accessToken;\n\n    if (session) {\n      //session exists in mongodb'\n      console.log('sessison exists');\n      let updatedDate = session.expirationDate;\n      accessToken = session.jwtToken;\n      const updatedAt = moment(session.updatedAt);\n      const now = moment(new Date());\n      const duration = moment.duration(now.diff(updatedAt)).asHours();\n      console.log(duration);\n\n      if (duration >= 1) {\n        updatedDate = moment(session.expirationDate).add(1, 'days').toDate();\n      } // increase count and date of session\n\n\n      const newSession = await _authDataAccess.default.updateSession(session.userCount + 1, session, updatedDate);\n      console.log('new session', newSession);\n      await _redisServices.default.syncWithRedis(_redisConfig.default, accessToken, newSession); //     let dataInRedis;\n      //     await client.get(accessToken, async(err,sessionData) => {\n      //        if (sessionData) {\n      //            dataInRedis = sessionData\n      //            console.log(sessionData)\n      //        }\n      //        else if (err){\n      //            console.log('errrr')\n      //            console.log(err)\n      //        }\n      //    })\n      //    console.log('data in redis ', dataInRedis)\n    } else {\n      console.log(\"session does not exit\"); //session doesn't exist create a new one\n\n      accessToken = await _jsonwebtoken.default.sign(user.toJSON(), process.env.JWT_SECRET, {\n        expiresIn: process.env.JWT_EXPIRATION\n      });\n      const tomorrowDate = moment().clone().add(1, 'days').toDate(); // save session in mongodb\n\n      const newSession = await _authDataAccess.default.saveNewSession(userId, accessToken, tomorrowDate);\n      console.log(newSession);\n      await _redisServices.default.syncWithRedis(_redisConfig.default, accessToken, newSession); // // store session in redis\n      // redisService.storeNewSession(client,session)\n    }\n\n    return {\n      accessToken,\n      user\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst signUp = async ({\n  firstName,\n  middleName,\n  lastName,\n  password,\n  phoneNumber\n}) => {\n  try {\n    const user = await _authDataAccess.default.signUp({\n      firstName,\n      middleName,\n      lastName,\n      password,\n      phoneNumber\n    });\n    const userId = user._id; //check if there is an error\n\n    const accessToken = await _jsonwebtoken.default.sign(JSON.parse(JSON.stringify(user)), // roles: user.roles,\n    process.env.JWT_SECRET, {\n      expiresIn: process.env.JWT_EXPIRATION\n    }); // storeNewSession(token, user information(id), count, last update)\n\n    const tomorrowDate = moment().clone().add(1, 'days').toDate(); // save session in mongodb\n\n    const newSession = await _authDataAccess.default.saveNewSession(userId, accessToken, tomorrowDate);\n    console.log(\"In auth us case\", accessToken);\n    await _redisServices.default.syncWithRedis(_redisConfig.default, accessToken, newSession);\n    return {\n      accessToken,\n      user\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst logout = async ({\n  user,\n  accessToken\n}) => {\n  try {\n    await _authDataAccess.default.logout({\n      user,\n      accessToken\n    });\n    await _redisServices.default.deleteSessionRedis(_redisConfig.default, accessToken);\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst changePassword = async ({\n  newPassword,\n  user,\n  accessToken\n}) => {\n  try {\n    const {\n      updatedUser,\n      oldAccessTocken\n    } = await _authDataAccess.default.changePassword({\n      newPassword,\n      user,\n      accessToken\n    });\n    await _redisServices.default.deleteSessionRedisForChangePassword(_redisConfig.default, accessToken);\n    return {\n      updatedUser,\n      oldAccessTocken\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nvar _default = {\n  signIn,\n  signUp,\n  logout,\n  changePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtdXNlLWNhc2VzLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJtb21lbnQiLCJzaWduSW4iLCJwaG9uZU51bWJlciIsInBhc3N3b3JkIiwidXNlciIsImF1dGhSZXBvc2l0b3J5IiwidXNlcklkIiwiX2lkIiwic2Vzc2lvbiIsImZpbmRTZXNzaW9uIiwiY29uc29sZSIsImxvZyIsImFjY2Vzc1Rva2VuIiwidXBkYXRlZERhdGUiLCJleHBpcmF0aW9uRGF0ZSIsImp3dFRva2VuIiwidXBkYXRlZEF0Iiwibm93IiwiRGF0ZSIsImR1cmF0aW9uIiwiZGlmZiIsImFzSG91cnMiLCJhZGQiLCJ0b0RhdGUiLCJuZXdTZXNzaW9uIiwidXBkYXRlU2Vzc2lvbiIsInVzZXJDb3VudCIsInJlZGlzU2VydmljZSIsInN5bmNXaXRoUmVkaXMiLCJjbGllbnQiLCJqd3QiLCJzaWduIiwidG9KU09OIiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJleHBpcmVzSW4iLCJKV1RfRVhQSVJBVElPTiIsInRvbW9ycm93RGF0ZSIsImNsb25lIiwic2F2ZU5ld1Nlc3Npb24iLCJlcnJvciIsIlByb21pc2UiLCJyZWplY3QiLCJzaWduVXAiLCJmaXJzdE5hbWUiLCJtaWRkbGVOYW1lIiwibGFzdE5hbWUiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJsb2dvdXQiLCJkZWxldGVTZXNzaW9uUmVkaXMiLCJjaGFuZ2VQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwidXBkYXRlZFVzZXIiLCJvbGRBY2Nlc3NUb2NrZW4iLCJkZWxldGVTZXNzaW9uUmVkaXNGb3JDaGFuZ2VQYXNzd29yZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOzs7O0FBSEE7QUFJQTtBQUNBQSxPQUFPLENBQUMsUUFBRCxDQUFQLENBQWtCQyxNQUFsQjs7QUFFQSxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQyxRQUFELENBQXRC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QUFBY0MsTUFBQUE7QUFBZCxLQUFQO0FBQ0gsR0FKRCxDQUlFLE9BQU9mLEtBQVAsRUFBYztBQUNaLFdBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlRixLQUFmLENBQVA7QUFDSDtBQUNKLENBUkQ7O2VBVWU7QUFDWHhDLEVBQUFBLE1BRFc7QUFFWDJDLEVBQUFBLE1BRlc7QUFHWE8sRUFBQUEsTUFIVztBQUlYRSxFQUFBQTtBQUpXLEMiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXHNlcnZpY2VzXFxhdXRoXFx1c2UtY2FzZXNcXCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xyXG5pbXBvcnQge1VzZXJNb2RlbH0gZnJvbSBcIi4uLy4uLy4uL21vZGVscy91c2VyXCI7XHJcbmltcG9ydCB7U2Vzc2lvbk1vZGVsfSBmcm9tIFwiLi4vLi4vLi4vbW9kZWxzL3Nlc3Npb25cIjtcclxuLy8gaW1wb3J0IGNyeXB0byBmcm9tIFwiY3J5cHRvXCI7XHJcbmltcG9ydCBhdXRoUmVwb3NpdG9yeSBmcm9tIFwiLi4vZGF0YS1hY2Nlc3MvYXV0aC1kYXRhLWFjY2Vzc1wiO1xyXG5pbXBvcnQgY2xpZW50IGZyb20gXCIuLi8uLi8uLi9jb25maWcvcmVkaXMtY29uZmlnXCI7XHJcbmltcG9ydCByZWRpc1NlcnZpY2UgZnJvbSBcIi4uLy4uL3JlZGlzL3JlZGlzLXNlcnZpY2VzXCJcclxuLy9sb2FkIG91ciAuZW52IGZpbGVcclxucmVxdWlyZSgnZG90ZW52JykuY29uZmlnKClcclxuXHJcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoXCJtb21lbnRcIilcclxuXHJcbmNvbnN0IHNpZ25JbiA9IGFzeW5jICh7cGhvbmVOdW1iZXIsIHBhc3N3b3JkfSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgYXV0aFJlcG9zaXRvcnkuc2lnbkluKHtwaG9uZU51bWJlciwgcGFzc3dvcmR9KTtcclxuICAgICAgICBjb25zdCB1c2VySWQgPSB1c2VyLl9pZFxyXG4gICAgICAgIC8vY2hlY2sgaWYgc2Vzc2lvbiBleGlzdHMgaW4gbW9uZ29kYiBcclxuICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aFJlcG9zaXRvcnkuZmluZFNlc3Npb24odXNlcklkKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKHNlc3Npb24pXHJcbiAgICAgICAgbGV0IGFjY2Vzc1Rva2VuO1xyXG5cclxuICAgICAgICBpZiAoc2Vzc2lvbikge1xyXG4gICAgICAgICAgICAvL3Nlc3Npb24gZXhpc3RzIGluIG1vbmdvZGInXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZXNzaXNvbiBleGlzdHMnKVxyXG4gICAgICAgICAgICBsZXQgdXBkYXRlZERhdGUgPSBzZXNzaW9uLmV4cGlyYXRpb25EYXRlO1xyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IHNlc3Npb24uand0VG9rZW5cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRBdCA9IG1vbWVudChzZXNzaW9uLnVwZGF0ZWRBdClcclxuICAgICAgICAgICAgY29uc3Qgbm93ID0gbW9tZW50KG5ldyBEYXRlKCkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSAobW9tZW50LmR1cmF0aW9uKG5vdy5kaWZmKHVwZGF0ZWRBdCkpKS5hc0hvdXJzKClcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZHVyYXRpb24pXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoZHVyYXRpb24gPj0gMSkge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlZERhdGUgPSAobW9tZW50KHNlc3Npb24uZXhwaXJhdGlvbkRhdGUpLmFkZCgxLCdkYXlzJykpLnRvRGF0ZSgpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gaW5jcmVhc2UgY291bnQgYW5kIGRhdGUgb2Ygc2Vzc2lvblxyXG4gICAgICAgICAgICBjb25zdCBuZXdTZXNzaW9uID0gYXdhaXQgYXV0aFJlcG9zaXRvcnkudXBkYXRlU2Vzc2lvbihzZXNzaW9uLnVzZXJDb3VudCsxLHNlc3Npb24sdXBkYXRlZERhdGUpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCduZXcgc2Vzc2lvbicsIG5ld1Nlc3Npb24pXHJcbiAgICAgICAgICAgIGF3YWl0IHJlZGlzU2VydmljZS5zeW5jV2l0aFJlZGlzKGNsaWVudCxhY2Nlc3NUb2tlbixuZXdTZXNzaW9uKVxyXG4gICAgICAgIC8vICAgICBsZXQgZGF0YUluUmVkaXM7XHJcbiAgICAgICAgLy8gICAgIGF3YWl0IGNsaWVudC5nZXQoYWNjZXNzVG9rZW4sIGFzeW5jKGVycixzZXNzaW9uRGF0YSkgPT4ge1xyXG4gICAgICAgIC8vICAgICAgICBpZiAoc2Vzc2lvbkRhdGEpIHtcclxuICAgICAgICAvLyAgICAgICAgICAgIGRhdGFJblJlZGlzID0gc2Vzc2lvbkRhdGFcclxuICAgICAgICAvLyAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlc3Npb25EYXRhKVxyXG4gICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgICAgIGVsc2UgaWYgKGVycil7XHJcbiAgICAgICAgLy8gICAgICAgICAgICBjb25zb2xlLmxvZygnZXJycnInKVxyXG4gICAgICAgIC8vICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxyXG4gICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgfSlcclxuICAgICAgICAvLyAgICBjb25zb2xlLmxvZygnZGF0YSBpbiByZWRpcyAnLCBkYXRhSW5SZWRpcylcclxuICAgICAgICB9XHJcbiBcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzZXNzaW9uIGRvZXMgbm90IGV4aXRcIilcclxuICAgICAgICAgICAgLy9zZXNzaW9uIGRvZXNuJ3QgZXhpc3QgY3JlYXRlIGEgbmV3IG9uZVxyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IGF3YWl0IGp3dC5zaWduKHVzZXIudG9KU09OKCksIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQsIHtcclxuICAgICAgICAgICAgICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSQVRJT04sXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgICAgICAgY29uc3QgdG9tb3Jyb3dEYXRlID0gKG1vbWVudCgpLmNsb25lKCkuYWRkKDEsJ2RheXMnKSkudG9EYXRlKClcclxuICAgICAgICAgICAgLy8gc2F2ZSBzZXNzaW9uIGluIG1vbmdvZGJcclxuICAgICAgICAgICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IGF1dGhSZXBvc2l0b3J5LnNhdmVOZXdTZXNzaW9uKHVzZXJJZCxhY2Nlc3NUb2tlbix0b21vcnJvd0RhdGUpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG5ld1Nlc3Npb24pXHJcbiAgICAgICAgICAgIGF3YWl0IHJlZGlzU2VydmljZS5zeW5jV2l0aFJlZGlzKGNsaWVudCxhY2Nlc3NUb2tlbixuZXdTZXNzaW9uKVxyXG4gICAgICAgICAgICAvLyAvLyBzdG9yZSBzZXNzaW9uIGluIHJlZGlzXHJcbiAgICAgICAgICAgIC8vIHJlZGlzU2VydmljZS5zdG9yZU5ld1Nlc3Npb24oY2xpZW50LHNlc3Npb24pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuLFxyXG4gICAgICAgICAgICB1c2VyLFxyXG4gICAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IHNpZ25VcCA9IGFzeW5jICh7Zmlyc3ROYW1lLG1pZGRsZU5hbWUsbGFzdE5hbWUscGFzc3dvcmQscGhvbmVOdW1iZXJ9KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5zaWduVXAoe2ZpcnN0TmFtZSxtaWRkbGVOYW1lLGxhc3ROYW1lLHBhc3N3b3JkLHBob25lTnVtYmVyfSlcclxuICAgICAgICBjb25zdCB1c2VySWQgPSB1c2VyLl9pZFxyXG4gICAgICAgIC8vY2hlY2sgaWYgdGhlcmUgaXMgYW4gZXJyb3JcclxuXHJcbiAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBqd3Quc2lnbihcclxuICAgICAgICAgICAgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh1c2VyKSksXHJcbiAgICAgICAgICAgIC8vIHJvbGVzOiB1c2VyLnJvbGVzLFxyXG4gICAgICAgICAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVULCB7XHJcbiAgICAgICAgICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSQVRJT04sXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIHN0b3JlTmV3U2Vzc2lvbih0b2tlbiwgdXNlciBpbmZvcm1hdGlvbihpZCksIGNvdW50LCBsYXN0IHVwZGF0ZSlcclxuICAgICAgICBjb25zdCB0b21vcnJvd0RhdGUgPSAobW9tZW50KCkuY2xvbmUoKS5hZGQoMSwnZGF5cycpKS50b0RhdGUoKVxyXG4gICAgICAgIC8vIHNhdmUgc2Vzc2lvbiBpbiBtb25nb2RiXHJcbiAgICAgICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IGF1dGhSZXBvc2l0b3J5LnNhdmVOZXdTZXNzaW9uKHVzZXJJZCxhY2Nlc3NUb2tlbix0b21vcnJvd0RhdGUpXHJcbiAgICAgICAgY29uc29sZS5sb2coXCJJbiBhdXRoIHVzIGNhc2VcIixhY2Nlc3NUb2tlbilcclxuICAgICAgICBhd2FpdCByZWRpc1NlcnZpY2Uuc3luY1dpdGhSZWRpcyhjbGllbnQsYWNjZXNzVG9rZW4sbmV3U2Vzc2lvbilcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgdXNlcixcclxuICAgICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBsb2dvdXQgPSBhc3luYyAoe3VzZXIsIGFjY2Vzc1Rva2VufSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBhd2FpdCBhdXRoUmVwb3NpdG9yeS5sb2dvdXQoe3VzZXIsIGFjY2Vzc1Rva2VufSlcclxuICAgICAgICBhd2FpdCByZWRpc1NlcnZpY2UuZGVsZXRlU2Vzc2lvblJlZGlzKGNsaWVudCxhY2Nlc3NUb2tlbilcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgIH1cclxufVxyXG5cclxuY29uc3QgY2hhbmdlUGFzc3dvcmQgPSBhc3luYyAoe25ld1Bhc3N3b3JkLCB1c2VyLCBhY2Nlc3NUb2tlbn0pID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3Qge3VwZGF0ZWRVc2VyLCBvbGRBY2Nlc3NUb2NrZW59ID0gYXdhaXQgYXV0aFJlcG9zaXRvcnkuY2hhbmdlUGFzc3dvcmQoe25ld1Bhc3N3b3JkLCB1c2VyLCBhY2Nlc3NUb2tlbn0pXHJcbiAgICAgICAgYXdhaXQgcmVkaXNTZXJ2aWNlLmRlbGV0ZVNlc3Npb25SZWRpc0ZvckNoYW5nZVBhc3N3b3JkKGNsaWVudCxhY2Nlc3NUb2tlbilcclxuICAgICAgICByZXR1cm4ge3VwZGF0ZWRVc2VyLCBvbGRBY2Nlc3NUb2NrZW59O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBzaWduSW4sXHJcbiAgICBzaWduVXAsXHJcbiAgICBsb2dvdXQsXHJcbiAgICBjaGFuZ2VQYXNzd29yZCxcclxufSJdfQ==","map":{"version":3,"sources":["auth-use-cases.js"],"names":["require","config","moment","signIn","phoneNumber","password","user","authRepository","userId","_id","session","findSession","console","log","accessToken","updatedDate","expirationDate","jwtToken","updatedAt","now","Date","duration","diff","asHours","add","toDate","newSession","updateSession","userCount","redisService","syncWithRedis","client","jwt","sign","toJSON","process","env","JWT_SECRET","expiresIn","JWT_EXPIRATION","tomorrowDate","clone","saveNewSession","error","Promise","reject","signUp","firstName","middleName","lastName","JSON","parse","stringify","logout","deleteSessionRedis","changePassword","newPassword","updatedUser","oldAccessTocken","deleteSessionRedisForChangePassword"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\services\\auth\\use-cases\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport {UserModel} from \"../../../models/user\";\r\nimport {SessionModel} from \"../../../models/session\";\r\n// import crypto from \"crypto\";\r\nimport authRepository from \"../data-access/auth-data-access\";\r\nimport client from \"../../../config/redis-config\";\r\nimport redisService from \"../../redis/redis-services\"\r\n//load our .env file\r\nrequire('dotenv').config()\r\n\r\nconst moment = require(\"moment\")\r\n\r\nconst signIn = async ({phoneNumber, password}) => {\r\n    try {\r\n        const user = await authRepository.signIn({phoneNumber, password});\r\n        const userId = user._id\r\n        //check if session exists in mongodb \r\n        const session = await authRepository.findSession(userId)\r\n        console.log(session)\r\n        let accessToken;\r\n\r\n        if (session) {\r\n            //session exists in mongodb'\r\n            console.log('sessison exists')\r\n            let updatedDate = session.expirationDate;\r\n            accessToken = session.jwtToken\r\n\r\n            const updatedAt = moment(session.updatedAt)\r\n            const now = moment(new Date());\r\n            \r\n            const duration = (moment.duration(now.diff(updatedAt))).asHours()\r\n            console.log(duration)\r\n            \r\n            if (duration >= 1) {\r\n                updatedDate = (moment(session.expirationDate).add(1,'days')).toDate()\r\n            }\r\n            // increase count and date of session\r\n            const newSession = await authRepository.updateSession(session.userCount+1,session,updatedDate)\r\n            console.log('new session', newSession)\r\n            await redisService.syncWithRedis(client,accessToken,newSession)\r\n        //     let dataInRedis;\r\n        //     await client.get(accessToken, async(err,sessionData) => {\r\n        //        if (sessionData) {\r\n        //            dataInRedis = sessionData\r\n        //            console.log(sessionData)\r\n        //        }\r\n        //        else if (err){\r\n        //            console.log('errrr')\r\n        //            console.log(err)\r\n        //        }\r\n        //    })\r\n        //    console.log('data in redis ', dataInRedis)\r\n        }\r\n \r\n        else {\r\n            console.log(\"session does not exit\")\r\n            //session doesn't exist create a new one\r\n            accessToken = await jwt.sign(user.toJSON(), process.env.JWT_SECRET, {\r\n                expiresIn: process.env.JWT_EXPIRATION,\r\n            });\r\n      \r\n            const tomorrowDate = (moment().clone().add(1,'days')).toDate()\r\n            // save session in mongodb\r\n            const newSession = await authRepository.saveNewSession(userId,accessToken,tomorrowDate)\r\n            console.log(newSession)\r\n            await redisService.syncWithRedis(client,accessToken,newSession)\r\n            // // store session in redis\r\n            // redisService.storeNewSession(client,session)\r\n        }\r\n        \r\n        return {\r\n            accessToken,\r\n            user,\r\n        };\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst signUp = async ({firstName,middleName,lastName,password,phoneNumber}) => {\r\n    try {\r\n        const user = await authRepository.signUp({firstName,middleName,lastName,password,phoneNumber})\r\n        const userId = user._id\r\n        //check if there is an error\r\n\r\n        const accessToken = await jwt.sign(\r\n            JSON.parse(JSON.stringify(user)),\r\n            // roles: user.roles,\r\n            process.env.JWT_SECRET, {\r\n            expiresIn: process.env.JWT_EXPIRATION,\r\n        });\r\n\r\n        // storeNewSession(token, user information(id), count, last update)\r\n        const tomorrowDate = (moment().clone().add(1,'days')).toDate()\r\n        // save session in mongodb\r\n        const newSession = await authRepository.saveNewSession(userId,accessToken,tomorrowDate)\r\n        console.log(\"In auth us case\",accessToken)\r\n        await redisService.syncWithRedis(client,accessToken,newSession)\r\n        return {\r\n            accessToken,\r\n            user,\r\n        };\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst logout = async ({user, accessToken}) => {\r\n    try {\r\n        await authRepository.logout({user, accessToken})\r\n        await redisService.deleteSessionRedis(client,accessToken)\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst changePassword = async ({newPassword, user, accessToken}) => {\r\n    try {\r\n        const {updatedUser, oldAccessTocken} = await authRepository.changePassword({newPassword, user, accessToken})\r\n        await redisService.deleteSessionRedisForChangePassword(client,accessToken)\r\n        return {updatedUser, oldAccessTocken};\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nexport default {\r\n    signIn,\r\n    signUp,\r\n    logout,\r\n    changePassword,\r\n}"]}},"mtime":1648764184647},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\session.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SessionTC = exports.SessionSchema = exports.SessionModel = void 0;\n\nvar _mongoose = _interopRequireWildcard(require(\"mongoose\"));\n\nvar _mongooseTimestamp = _interopRequireDefault(require(\"mongoose-timestamp\"));\n\nvar _graphqlComposeMongoose = require(\"graphql-compose-mongoose\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nconst SessionSchema = new _mongoose.Schema({\n  userId: {\n    type: _mongoose.Schema.Types.ObjectId,\n    ref: \"User\"\n  },\n  jwtToken: String,\n  expirationDate: Date,\n  userCount: Number\n}, {\n  collection: \"sessions\"\n});\nexports.SessionSchema = SessionSchema;\nSessionSchema.plugin(_mongooseTimestamp.default);\nSessionSchema.index({\n  createdAt: 1,\n  updatedAt: 1\n});\n\nconst SessionModel = _mongoose.default.model(\"Session\", SessionSchema);\n\nexports.SessionModel = SessionModel;\nconst SessionTC = (0, _graphqlComposeMongoose.composeWithMongoose)(SessionModel);\nexports.SessionTC = SessionTC;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlc3Npb24uanMiXSwibmFtZXMiOlsiU2Vzc2lvblNjaGVtYSIsIlNjaGVtYSIsInVzZXJJZCIsInR5cGUiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwiand0VG9rZW4iLCJTdHJpbmciLCJleHBpcmF0aW9uRGF0ZSIsIkRhdGUiLCJ1c2VyQ291bnQiLCJOdW1iZXIiLCJjb2xsZWN0aW9uIiwicGx1Z2luIiwidGltZXN0YW1wcyIsImluZGV4IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwiU2Vzc2lvbk1vZGVsIiwibW9uZ29vc2UiLCJtb2RlbCIsIlNlc3Npb25UQyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLE1BQU1BLGFBQWEsR0FBRyxJQUFJQyxnQkFBSixDQUFXO0FBQzdCQyxFQUFBQSxNQUFNLEVBQUU7QUFDSkMsSUFBQUEsSUFBSSxFQUFFRixpQkFBT0csS0FBUCxDQUFhQyxRQURmO0FBRUpDLElBQUFBLEdBQUcsRUFBRTtBQUZELEdBRHFCO0FBSzdCQyxFQUFBQSxRQUFRLEVBQUVDLE1BTG1CO0FBTTdCQyxFQUFBQSxjQUFjLEVBQUVDLElBTmE7QUFPN0JDLEVBQUFBLFNBQVMsRUFBRUM7QUFQa0IsQ0FBWCxFQVFuQjtBQUNDQyxFQUFBQSxVQUFVLEVBQUU7QUFEYixDQVJtQixDQUF0Qjs7QUFZQWIsYUFBYSxDQUFDYyxNQUFkLENBQXFCQywwQkFBckI7QUFDQWYsYUFBYSxDQUFDZ0IsS0FBZCxDQUFvQjtBQUNoQkMsRUFBQUEsU0FBUyxFQUFFLENBREs7QUFFaEJDLEVBQUFBLFNBQVMsRUFBRTtBQUZLLENBQXBCOztBQUtBLE1BQU1DLFlBQVksR0FBR0Msa0JBQVNDLEtBQVQsQ0FBZSxTQUFmLEVBQTBCckIsYUFBMUIsQ0FBckI7OztBQUNBLE1BQU1zQixTQUFTLEdBQUcsaURBQW9CSCxZQUFwQixDQUFsQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbW9kZWxzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UsIHtTY2hlbWF9IGZyb20gXCJtb25nb29zZVwiO1xyXG5pbXBvcnQgdGltZXN0YW1wcyBmcm9tIFwibW9uZ29vc2UtdGltZXN0YW1wXCI7XHJcbmltcG9ydCB7Y29tcG9zZVdpdGhNb25nb29zZX0gZnJvbSBcImdyYXBocWwtY29tcG9zZS1tb25nb29zZVwiO1xyXG5cclxuY29uc3QgU2Vzc2lvblNjaGVtYSA9IG5ldyBTY2hlbWEoe1xyXG4gICAgdXNlcklkOiB7XHJcbiAgICAgICAgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgIHJlZjogXCJVc2VyXCIsXHJcbiAgICB9LFxyXG4gICAgand0VG9rZW46IFN0cmluZyxcclxuICAgIGV4cGlyYXRpb25EYXRlOiBEYXRlLFxyXG4gICAgdXNlckNvdW50OiBOdW1iZXIsXHJcbn0sIHtcclxuICAgIGNvbGxlY3Rpb246IFwic2Vzc2lvbnNcIixcclxufSk7XHJcblxyXG5TZXNzaW9uU2NoZW1hLnBsdWdpbih0aW1lc3RhbXBzKTtcclxuU2Vzc2lvblNjaGVtYS5pbmRleCh7XHJcbiAgICBjcmVhdGVkQXQ6IDEsXHJcbiAgICB1cGRhdGVkQXQ6IDEsXHJcbn0pO1xyXG5cclxuY29uc3QgU2Vzc2lvbk1vZGVsID0gbW9uZ29vc2UubW9kZWwoXCJTZXNzaW9uXCIsIFNlc3Npb25TY2hlbWEpO1xyXG5jb25zdCBTZXNzaW9uVEMgPSBjb21wb3NlV2l0aE1vbmdvb3NlKFNlc3Npb25Nb2RlbCk7XHJcblxyXG5leHBvcnQge1Nlc3Npb25Nb2RlbCwgU2Vzc2lvblRDLCBTZXNzaW9uU2NoZW1hfTtcclxuIl19","map":{"version":3,"sources":["session.js"],"names":["SessionSchema","Schema","userId","type","Types","ObjectId","ref","jwtToken","String","expirationDate","Date","userCount","Number","collection","plugin","timestamps","index","createdAt","updatedAt","SessionModel","mongoose","model","SessionTC"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,aAAa,GAAG,IAAIC,gBAAJ,CAAW;AAC7BC,EAAAA,MAAM,EAAE;AACJC,IAAAA,IAAI,EAAEF,iBAAOG,KAAP,CAAaC,QADf;AAEJC,IAAAA,GAAG,EAAE;AAFD,GADqB;AAK7BC,EAAAA,QAAQ,EAAEC,MALmB;AAM7BC,EAAAA,cAAc,EAAEC,IANa;AAO7BC,EAAAA,SAAS,EAAEC;AAPkB,CAAX,EAQnB;AACCC,EAAAA,UAAU,EAAE;AADb,CARmB,CAAtB;;AAYAb,aAAa,CAACc,MAAd,CAAqBC,0BAArB;AACAf,aAAa,CAACgB,KAAd,CAAoB;AAChBC,EAAAA,SAAS,EAAE,CADK;AAEhBC,EAAAA,SAAS,EAAE;AAFK,CAApB;;AAKA,MAAMC,YAAY,GAAGC,kBAASC,KAAT,CAAe,SAAf,EAA0BrB,aAA1B,CAArB;;;AACA,MAAMsB,SAAS,GAAG,iDAAoBH,YAApB,CAAlB","sourceRoot":"E:\\haleta-new-api\\src\\models\\","sourcesContent":["import mongoose, {Schema} from \"mongoose\";\r\nimport timestamps from \"mongoose-timestamp\";\r\nimport {composeWithMongoose} from \"graphql-compose-mongoose\";\r\n\r\nconst SessionSchema = new Schema({\r\n    userId: {\r\n        type: Schema.Types.ObjectId,\r\n        ref: \"User\",\r\n    },\r\n    jwtToken: String,\r\n    expirationDate: Date,\r\n    userCount: Number,\r\n}, {\r\n    collection: \"sessions\",\r\n});\r\n\r\nSessionSchema.plugin(timestamps);\r\nSessionSchema.index({\r\n    createdAt: 1,\r\n    updatedAt: 1,\r\n});\r\n\r\nconst SessionModel = mongoose.model(\"Session\", SessionSchema);\r\nconst SessionTC = composeWithMongoose(SessionModel);\r\n\r\nexport {SessionModel, SessionTC, SessionSchema};\r\n"]}},"mtime":1648685190383},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\data-access\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\data-access\\\\auth-data-access.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _session = require(\"../../../models/session\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\nconst signIn = async ({\n  phoneNumber,\n  password\n}) => {\n  try {\n    const user = await _user.UserModel.findOne({\n      phoneNumber\n    }); // const comparePassword = await user.comparePassword(password.toString());\n\n    const comparePassword = password.toString() === user.password;\n\n    if (!comparePassword) {\n      return Promise.reject(new Error(\"Password is incorrect.\"));\n    }\n\n    return user;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst saveNewSession = async (userId, jwtToken, tomorrowDate) => {\n  try {\n    const newSession = await new _session.SessionModel({\n      userId: userId,\n      jwtToken: jwtToken,\n      expirationDate: tomorrowDate,\n      userCount: 1\n    }).save();\n    return newSession;\n  } catch (error) {\n    console.log('error in saving new session');\n    console.log(error);\n    return Promise.reject(error);\n  }\n};\n\nconst findSession = async userId => {\n  try {\n    const session = await _session.SessionModel.findOne({\n      userId\n    });\n    return session;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst updateSession = async (count, session, updatedDate) => {\n  try {\n    session.userCount = count;\n    session.expirationDate = updatedDate;\n    const newSession = await session.save();\n    return newSession;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst deleteSession = async session => {\n  try {\n    console.log('remove');\n    await session.remove();\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst signUp = async ({\n  firstName,\n  middleName,\n  lastName,\n  phoneNumber,\n  password\n}) => {\n  try {\n    // let user = await UserModel.phoneNumberExist(phoneNumber);\n    // if (user) {\n    //     console.log(\"here 2\")\n    //     return Promise.reject(new Error(\"Phone Number has already been taken.\"));\n    // }\n    // user = await UserModel.emailExist(email);\n    // if (user) {\n    //   return Promise.reject(new Error(\"Email has already been taken.\"));\n    // }\n    // const salt = bcrypt.genSalt(10);\n    // const hash = bcrypt.hashSync(password, salt);\n    const user = await new _user.UserModel({\n      firstName,\n      middleName,\n      lastName,\n      phoneNumber,\n      password\n    }).save();\n    return user;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst logout = async ({\n  user,\n  accessToken\n}) => {\n  try {\n    const userId = user._id;\n    const session = await findSession(userId);\n    const count = session.userCount;\n\n    if (count > 1) {\n      count -= 1;\n      updateSession(count, session, session.expirationDate);\n    } //delete session\n    else if (count === 1) {\n      deleteSession(session);\n    }\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nconst changePassword = async ({\n  newPassword,\n  user,\n  accessToken\n}) => {\n  try {\n    console.log(\"sim user: \", user);\n    console.log(\"new password: \", newPassword);\n    console.log(\"pass: \", user.password);\n    const userphone = user.phoneNumber;\n    const userWith = await _user.UserModel.findOne({\n      userphone\n    });\n    const userId = userWith._id;\n    const session = await findSession(userId);\n    userWith.password = newPassword;\n    const updatedUser = await userWith.save(function (err) {\n      if (err) return handleErr(err); //user has been updated\n\n      console.log(\"success\");\n    });\n    const oldAccessTocken = accessToken; //delete session\n\n    await deleteSession(session);\n    return {\n      updatedUser,\n      oldAccessTocken\n    };\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nvar _default = {\n  signIn,\n  signUp,\n  saveNewSession,\n  findSession,\n  updateSession,\n  logout,\n  changePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtZGF0YS1hY2Nlc3MuanMiXSwibmFtZXMiOlsic2lnbkluIiwicGhvbmVOdW1iZXIiLCJwYXNzd29yZCIsInVzZXIiLCJVc2VyTW9kZWwiLCJmaW5kT25lIiwiY29tcGFyZVBhc3N3b3JkIiwidG9TdHJpbmciLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiLCJlcnJvciIsInNhdmVOZXdTZXNzaW9uIiwidXNlcklkIiwiand0VG9rZW4iLCJ0b21vcnJvd0RhdGUiLCJuZXdTZXNzaW9uIiwiU2Vzc2lvbk1vZGVsIiwiZXhwaXJhdGlvbkRhdGUiLCJ1c2VyQ291bnQiLCJzYXZlIiwiY29uc29sZSIsImxvZyIsImZpbmRTZXNzaW9uIiwic2Vzc2lvbiIsInVwZGF0ZVNlc3Npb24iLCJjb3VudCIsInVwZGF0ZWREYXRlIiwiZGVsZXRlU2Vzc2lvbiIsInJlbW92ZSIsInNpZ25VcCIsImZpcnN0TmFtZSIsIm1pZGRsZU5hbWUiLCJsYXN0TmFtZSIsImxvZ291dCIsImFjY2Vzc1Rva2VuIiwiX2lkIiwiY2hhbmdlUGFzc3dvcmQiLCJuZXdQYXNzd29yZCIsInVzZXJwaG9uZSIsInVzZXJXaXRoIiwidXBkYXRlZFVzZXIiLCJlcnIiLCJoYW5kbGVFcnIiLCJvbGRBY2Nlc3NUb2NrZW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7OztBQUNBO0FBRUEsTUFBTUEsTUFBTSxHQUFHLE9BQU87QUFBRUMsRUFBQUEsV0FBRjtBQUFlQyxFQUFBQTtBQUFmLENBQVAsS0FBcUM7QUFDbEQsTUFBSTtBQUNGLFVBQU1DLElBQUksR0FBRyxNQUFNQyxnQkFBVUMsT0FBVixDQUFrQjtBQUFFSixNQUFBQTtBQUFGLEtBQWxCLENBQW5CLENBREUsQ0FHRjs7QUFDQSxVQUFNSyxlQUFlLEdBQUlKLFFBQVEsQ0FBQ0ssUUFBVCxPQUF3QkosSUFBSSxDQUFDRCxRQUF0RDs7QUFDQSxRQUFJLENBQUNJLGVBQUwsRUFBc0I7QUFDcEIsYUFBT0UsT0FBTyxD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QUFWLENBQWtCO0FBQUVrQyxNQUFBQTtBQUFGLEtBQWxCLENBQXZCO0FBQ0EsVUFBTTFCLE1BQU0sR0FBRzJCLFFBQVEsQ0FBQ0osR0FBeEI7QUFDQSxVQUFNWixPQUFPLEdBQUcsTUFBTUQsV0FBVyxDQUFDVixNQUFELENBQWpDO0FBRUEyQixJQUFBQSxRQUFRLENBQUN0QyxRQUFULEdBQWtCb0MsV0FBbEI7QUFDQSxVQUFNRyxXQUFXLEdBQUcsTUFBTUQsUUFBUSxDQUFDcEIsSUFBVCxDQUFjLFVBQVNzQixHQUFULEVBQWE7QUFDbkQsVUFBR0EsR0FBSCxFQUFPLE9BQU9DLFNBQVMsQ0FBQ0QsR0FBRCxDQUFoQixDQUQ0QyxDQUVuRDs7QUFDQXJCLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFNBQVo7QUFDRCxLQUp5QixDQUExQjtBQUtBLFVBQU1zQixlQUFlLEdBQUdULFdBQXhCLENBZkUsQ0FnQkY7O0FBQ0EsVUFBTVAsYUFBYSxDQUFDSixPQUFELENBQW5CO0FBQ0UsV0FBTztBQUFDaUIsTUFBQUEsV0FBRDtBQUFjRyxNQUFBQTtBQUFkLEtBQVA7QUFDSCxHQW5CRCxDQW1CRSxPQUFPakMsS0FBUCxFQUFjO0FBQ2RVLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZWCxLQUFaO0FBQ0Q7QUFDRixDQXZCRDs7ZUF5QmU7QUFDYlgsRUFBQUEsTUFEYTtBQUViOEIsRUFBQUEsTUFGYTtBQUdibEIsRUFBQUEsY0FIYTtBQUliVyxFQUFBQSxXQUphO0FBS2JFLEVBQUFBLGFBTGE7QUFNYlMsRUFBQUEsTUFOYTtBQU9iRyxFQUFBQTtBQVBhLEMiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXHNlcnZpY2VzXFxhdXRoXFxkYXRhLWFjY2Vzc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcbmltcG9ydCB7IFVzZXJNb2RlbCB9IGZyb20gXCIuLi8uLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5pbXBvcnQge1Nlc3Npb25Nb2RlbH0gZnJvbSBcIi4uLy4uLy4uL21vZGVscy9zZXNzaW9uXCI7XHJcbi8vIGltcG9ydCBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xyXG5cclxuY29uc3Qgc2lnbkluID0gYXN5bmMgKHsgcGhvbmVOdW1iZXIsIHBhc3N3b3JkIH0pID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXJNb2RlbC5maW5kT25lKHsgcGhvbmVOdW1iZXIgfSk7XHJcblxyXG4gICAgLy8gY29uc3QgY29tcGFyZVBhc3N3b3JkID0gYXdhaXQgdXNlci5jb21wYXJlUGFzc3dvcmQocGFzc3dvcmQudG9TdHJpbmcoKSk7XHJcbiAgICBjb25zdCBjb21wYXJlUGFzc3dvcmQgPSAocGFzc3dvcmQudG9TdHJpbmcoKSA9PT0gdXNlci5wYXNzd29yZClcclxuICAgIGlmICghY29tcGFyZVBhc3N3b3JkKSB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJQYXNzd29yZCBpcyBpbmNvcnJlY3QuXCIpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdXNlcjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBzYXZlTmV3U2Vzc2lvbiA9IGFzeW5jKHVzZXJJZCxqd3RUb2tlbix0b21vcnJvd0RhdGUpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IG5ldyBTZXNzaW9uTW9kZWwoe1xyXG4gICAgICB1c2VySWQ6dXNlcklkLFxyXG4gICAgICBqd3RUb2tlbjpqd3RUb2tlbixcclxuICAgICAgZXhwaXJhdGlvbkRhdGU6dG9tb3Jyb3dEYXRlLFxyXG4gICAgICB1c2VyQ291bnQ6MVxyXG4gIH0pLnNhdmUoKTtcclxuICByZXR1cm4gbmV3U2Vzc2lvblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmxvZygnZXJyb3IgaW4gc2F2aW5nIG5ldyBzZXNzaW9uJylcclxuICAgIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGZpbmRTZXNzaW9uID0gYXN5bmModXNlcklkKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBTZXNzaW9uTW9kZWwuZmluZE9uZSh7dXNlcklkfSk7XHJcbiAgICByZXR1cm4gc2Vzc2lvbjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IHVwZGF0ZVNlc3Npb24gPSBhc3luYyhjb3VudCxzZXNzaW9uLHVwZGF0ZWREYXRlKSAgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBzZXNzaW9uLnVzZXJDb3VudCA9IGNvdW50XHJcbiAgICBzZXNzaW9uLmV4cGlyYXRpb25EYXRlID0gdXBkYXRlZERhdGVcclxuICAgIGNvbnN0IG5ld1Nlc3Npb24gPSBhd2FpdCBzZXNzaW9uLnNhdmUoKVxyXG4gICAgcmV0dXJuIG5ld1Nlc3Npb25cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGRlbGV0ZVNlc3Npb24gPSBhc3luYyhzZXNzaW9uKSAgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZygncmVtb3ZlJylcclxuICAgIGF3YWl0IHNlc3Npb24ucmVtb3ZlKClcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn1cclxuXHJcblxyXG5jb25zdCBzaWduVXAgPSBhc3luYyAoe1xyXG4gIGZpcnN0TmFtZSxcclxuICBtaWRkbGVOYW1lLFxyXG4gIGxhc3ROYW1lLFxyXG4gIHBob25lTnVtYmVyLFxyXG4gIHBhc3N3b3JkLFxyXG59KSA9PiB7XHJcbiAgdHJ5IHtcclxuXHJcbiAgICAvLyBsZXQgdXNlciA9IGF3YWl0IFVzZXJNb2RlbC5waG9uZU51bWJlckV4aXN0KHBob25lTnVtYmVyKTtcclxuICAgIC8vIGlmICh1c2VyKSB7XHJcbiAgICAvLyAgICAgY29uc29sZS5sb2coXCJoZXJlIDJcIilcclxuICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiUGhvbmUgTnVtYmVyIGhhcyBhbHJlYWR5IGJlZW4gdGFrZW4uXCIpKTtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyB1c2VyID0gYXdhaXQgVXNlck1vZGVsLmVtYWlsRXhpc3QoZW1haWwpO1xyXG4gICAgLy8gaWYgKHVzZXIpIHtcclxuICAgIC8vICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVtYWlsIGhhcyBhbHJlYWR5IGJlZW4gdGFrZW4uXCIpKTtcclxuICAgIC8vIH1cclxuICAgIC8vIGNvbnN0IHNhbHQgPSBiY3J5cHQuZ2VuU2FsdCgxMCk7XHJcbiAgICAvLyBjb25zdCBoYXNoID0gYmNyeXB0Lmhhc2hTeW5jKHBhc3N3b3JkLCBzYWx0KTtcclxuXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgbmV3IFVzZXJNb2RlbCh7XHJcbiAgICAgIGZpcnN0TmFtZSxcclxuICAgICAgbWlkZGxlTmFtZSxcclxuICAgICAgbGFzdE5hbWUsXHJcbiAgICAgIHBob25lTnVtYmVyLFxyXG4gICAgICBwYXNzd29yZCxcclxuICAgIH0pLnNhdmUoKTtcclxuXHJcbiAgICByZXR1cm4gdXNlcjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBsb2dvdXQgPSBhc3luYyh7dXNlciwgYWNjZXNzVG9rZW59KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXJJZCA9IHVzZXIuX2lkXHJcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZmluZFNlc3Npb24odXNlcklkKVxyXG4gICAgY29uc3QgY291bnQgPSBzZXNzaW9uLnVzZXJDb3VudFxyXG4gICAgaWYgKGNvdW50ID4gMSkge1xyXG4gICAgICBjb3VudCAtPSAxXHJcbiAgICAgIHVwZGF0ZVNlc3Npb24oY291bnQsc2Vzc2lvbixzZXNzaW9uLmV4cGlyYXRpb25EYXRlKVxyXG4gICAgfVxyXG4gICAgLy9kZWxldGUgc2Vzc2lvblxyXG4gICAgZWxzZSBpZiAoY291bnQgPT09IDEpIHtcclxuICAgICAgZGVsZXRlU2Vzc2lvbihzZXNzaW9uKVxyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGNoYW5nZVBhc3N3b3JkID0gYXN5bmMoe25ld1Bhc3N3b3JkLCB1c2VyLCBhY2Nlc3NUb2tlbn0pID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coXCJzaW0gdXNlcjogXCIsdXNlcilcclxuICAgIGNvbnNvbGUubG9nKFwibmV3IHBhc3N3b3JkOiBcIixuZXdQYXNzd29yZClcclxuICAgIGNvbnNvbGUubG9nKFwicGFzczogXCIsIHVzZXIucGFzc3dvcmQpXHJcbiAgICBjb25zdCB1c2VycGhvbmUgPSB1c2VyLnBob25lTnVtYmVyXHJcbiAgICBjb25zdCB1c2VyV2l0aCA9IGF3YWl0IFVzZXJNb2RlbC5maW5kT25lKHsgdXNlcnBob25lIH0pO1xyXG4gICAgY29uc3QgdXNlcklkID0gdXNlcldpdGguX2lkXHJcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZmluZFNlc3Npb24odXNlcklkKVxyXG5cclxuICAgIHVzZXJXaXRoLnBhc3N3b3JkPW5ld1Bhc3N3b3JkXHJcbiAgICBjb25zdCB1cGRhdGVkVXNlciA9IGF3YWl0IHVzZXJXaXRoLnNhdmUoZnVuY3Rpb24oZXJyKXtcclxuICAgICAgaWYoZXJyKXJldHVybiBoYW5kbGVFcnIoZXJyKTtcclxuICAgICAgLy91c2VyIGhhcyBiZWVuIHVwZGF0ZWRcclxuICAgICAgY29uc29sZS5sb2coXCJzdWNjZXNzXCIpXHJcbiAgICB9KVxyXG4gICAgY29uc3Qgb2xkQWNjZXNzVG9ja2VuID0gYWNjZXNzVG9rZW5cclxuICAgIC8vZGVsZXRlIHNlc3Npb25cclxuICAgIGF3YWl0IGRlbGV0ZVNlc3Npb24oc2Vzc2lvbilcclxuICAgICAgcmV0dXJuIHt1cGRhdGVkVXNlciwgb2xkQWNjZXNzVG9ja2VufTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5sb2coZXJyb3IpXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgc2lnbkluLFxyXG4gIHNpZ25VcCxcclxuICBzYXZlTmV3U2Vzc2lvbixcclxuICBmaW5kU2Vzc2lvbixcclxuICB1cGRhdGVTZXNzaW9uLFxyXG4gIGxvZ291dCxcclxuICBjaGFuZ2VQYXNzd29yZCxcclxufTtcclxuIl19","map":{"version":3,"sources":["auth-data-access.js"],"names":["signIn","phoneNumber","password","user","UserModel","findOne","comparePassword","toString","Promise","reject","Error","error","saveNewSession","userId","jwtToken","tomorrowDate","newSession","SessionModel","expirationDate","userCount","save","console","log","findSession","session","updateSession","count","updatedDate","deleteSession","remove","signUp","firstName","middleName","lastName","logout","accessToken","_id","changePassword","newPassword","userphone","userWith","updatedUser","err","handleErr","oldAccessTocken"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\services\\auth\\data-access\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { UserModel } from \"../../../models/user\";\r\nimport {SessionModel} from \"../../../models/session\";\r\n// import crypto from \"crypto\";\r\n\r\nconst signIn = async ({ phoneNumber, password }) => {\r\n  try {\r\n    const user = await UserModel.findOne({ phoneNumber });\r\n\r\n    // const comparePassword = await user.comparePassword(password.toString());\r\n    const comparePassword = (password.toString() === user.password)\r\n    if (!comparePassword) {\r\n      return Promise.reject(new Error(\"Password is incorrect.\"));\r\n    }\r\n\r\n    return user;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n\r\nconst saveNewSession = async(userId,jwtToken,tomorrowDate) => {\r\n  try {\r\n    const newSession = await new SessionModel({\r\n      userId:userId,\r\n      jwtToken:jwtToken,\r\n      expirationDate:tomorrowDate,\r\n      userCount:1\r\n  }).save();\r\n  return newSession\r\n  } catch (error) {\r\n    console.log('error in saving new session')\r\n    console.log(error)\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst findSession = async(userId) => {\r\n  try {\r\n    const session = await SessionModel.findOne({userId});\r\n    return session;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst updateSession = async(count,session,updatedDate)  => {\r\n  try {\r\n    session.userCount = count\r\n    session.expirationDate = updatedDate\r\n    const newSession = await session.save()\r\n    return newSession\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst deleteSession = async(session)  => {\r\n  try {\r\n    console.log('remove')\r\n    await session.remove()\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\n\r\nconst signUp = async ({\r\n  firstName,\r\n  middleName,\r\n  lastName,\r\n  phoneNumber,\r\n  password,\r\n}) => {\r\n  try {\r\n\r\n    // let user = await UserModel.phoneNumberExist(phoneNumber);\r\n    // if (user) {\r\n    //     console.log(\"here 2\")\r\n    //     return Promise.reject(new Error(\"Phone Number has already been taken.\"));\r\n    // }\r\n\r\n    // user = await UserModel.emailExist(email);\r\n    // if (user) {\r\n    //   return Promise.reject(new Error(\"Email has already been taken.\"));\r\n    // }\r\n    // const salt = bcrypt.genSalt(10);\r\n    // const hash = bcrypt.hashSync(password, salt);\r\n\r\n    const user = await new UserModel({\r\n      firstName,\r\n      middleName,\r\n      lastName,\r\n      phoneNumber,\r\n      password,\r\n    }).save();\r\n\r\n    return user;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n\r\nconst logout = async({user, accessToken}) => {\r\n  try {\r\n    const userId = user._id\r\n    const session = await findSession(userId)\r\n    const count = session.userCount\r\n    if (count > 1) {\r\n      count -= 1\r\n      updateSession(count,session,session.expirationDate)\r\n    }\r\n    //delete session\r\n    else if (count === 1) {\r\n      deleteSession(session)\r\n    }\r\n  } catch (error) {\r\n    console.log(error)\r\n  }\r\n}\r\n\r\nconst changePassword = async({newPassword, user, accessToken}) => {\r\n  try {\r\n    console.log(\"sim user: \",user)\r\n    console.log(\"new password: \",newPassword)\r\n    console.log(\"pass: \", user.password)\r\n    const userphone = user.phoneNumber\r\n    const userWith = await UserModel.findOne({ userphone });\r\n    const userId = userWith._id\r\n    const session = await findSession(userId)\r\n\r\n    userWith.password=newPassword\r\n    const updatedUser = await userWith.save(function(err){\r\n      if(err)return handleErr(err);\r\n      //user has been updated\r\n      console.log(\"success\")\r\n    })\r\n    const oldAccessTocken = accessToken\r\n    //delete session\r\n    await deleteSession(session)\r\n      return {updatedUser, oldAccessTocken};\r\n  } catch (error) {\r\n    console.log(error)\r\n  }\r\n}\r\n\r\nexport default {\r\n  signIn,\r\n  signUp,\r\n  saveNewSession,\r\n  findSession,\r\n  updateSession,\r\n  logout,\r\n  changePassword,\r\n};\r\n"]}},"mtime":1648764154564},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\redis-config.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _ioredis = _interopRequireDefault(require(\"ioredis\"));\n\nvar _winston = _interopRequireDefault(require(\"winston\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst client = new _ioredis.default({\n  host: process.env.REDIS_HOST,\n  port: process.env.REDIS_PORT //REDIS_PORT=6379\n\n});\nclient.on(\"error\", error => {\n  console.log('ðŸ˜’');\n  console.log(error);\n\n  _winston.default.error(error);\n\n  client.quit().then(e => console.log(e));\n});\nclient.on(\"connect\", () => _winston.default.info(\"Redis client connected\"));\nvar _default = client;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZGlzLWNvbmZpZy5qcyJdLCJuYW1lcyI6WyJjbGllbnQiLCJSZWRpcyIsImhvc3QiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfSE9TVCIsInBvcnQiLCJSRURJU19QT1JUIiwib24iLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJ3aW5zdG9uIiwicXVpdCIsInRoZW4iLCJlIiwiaW5mbyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHLElBQUlDLGdCQUFKLENBQVU7QUFDdkJDLEVBQUFBLElBQUksRUFBRUMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBREs7QUFFdkJDLEVBQUFBLElBQUksRUFBRUgsT0FBTyxDQUFDQyxHQUFSLENBQVlHLFVBRkssQ0FFTzs7QUFGUCxDQUFWLENBQWY7QUFLQVAsTUFBTSxDQUFDUSxFQUFQLENBQVUsT0FBVixFQUFvQkMsS0FBRCxJQUFXO0FBQzVCQyxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxJQUFaO0FBQ0FELEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixLQUFaOztBQUNBRyxtQkFBUUgsS0FBUixDQUFjQSxLQUFkOztBQUNBVCxFQUFBQSxNQUFNLENBQUNhLElBQVAsR0FBY0MsSUFBZCxDQUFvQkMsQ0FBRCxJQUFPTCxPQUFPLENBQUNDLEdBQVIsQ0FBWUksQ0FBWixDQUExQjtBQUNELENBTEQ7QUFPQWYsTUFBTSxDQUFDUSxFQUFQLENBQVUsU0FBVixFQUFxQixNQUFNSSxpQkFBUUksSUFBUixDQUFhLHdCQUFiLENBQTNCO2VBRWVoQixNIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxjb25maWdcXCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWRpcyBmcm9tIFwiaW9yZWRpc1wiO1xyXG5pbXBvcnQgd2luc3RvbiBmcm9tIFwid2luc3RvblwiO1xyXG5cclxuY29uc3QgY2xpZW50ID0gbmV3IFJlZGlzKHtcclxuICBob3N0OiBwcm9jZXNzLmVudi5SRURJU19IT1NULFxyXG4gIHBvcnQ6IHByb2Nlc3MuZW52LlJFRElTX1BPUlQsIC8vUkVESVNfUE9SVD02Mzc5XHJcbn0pO1xyXG5cclxuY2xpZW50Lm9uKFwiZXJyb3JcIiwgKGVycm9yKSA9PiB7XHJcbiAgY29uc29sZS5sb2coJ/CfmJInKVxyXG4gIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gIHdpbnN0b24uZXJyb3IoZXJyb3IpO1xyXG4gIGNsaWVudC5xdWl0KCkudGhlbigoZSkgPT4gY29uc29sZS5sb2coZSkpO1xyXG59KTtcclxuXHJcbmNsaWVudC5vbihcImNvbm5lY3RcIiwgKCkgPT4gd2luc3Rvbi5pbmZvKFwiUmVkaXMgY2xpZW50IGNvbm5lY3RlZFwiKSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnQ7XHJcbiJdfQ==","map":{"version":3,"sources":["redis-config.js"],"names":["client","Redis","host","process","env","REDIS_HOST","port","REDIS_PORT","on","error","console","log","winston","quit","then","e","info"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,MAAM,GAAG,IAAIC,gBAAJ,CAAU;AACvBC,EAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYC,UADK;AAEvBC,EAAAA,IAAI,EAAEH,OAAO,CAACC,GAAR,CAAYG,UAFK,CAEO;;AAFP,CAAV,CAAf;AAKAP,MAAM,CAACQ,EAAP,CAAU,OAAV,EAAoBC,KAAD,IAAW;AAC5BC,EAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACAD,EAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;;AACAG,mBAAQH,KAAR,CAAcA,KAAd;;AACAT,EAAAA,MAAM,CAACa,IAAP,GAAcC,IAAd,CAAoBC,CAAD,IAAOL,OAAO,CAACC,GAAR,CAAYI,CAAZ,CAA1B;AACD,CALD;AAOAf,MAAM,CAACQ,EAAP,CAAU,SAAV,EAAqB,MAAMI,iBAAQI,IAAR,CAAa,wBAAb,CAA3B;eAEehB,M","sourceRoot":"E:\\haleta-new-api\\src\\config\\","sourcesContent":["import Redis from \"ioredis\";\r\nimport winston from \"winston\";\r\n\r\nconst client = new Redis({\r\n  host: process.env.REDIS_HOST,\r\n  port: process.env.REDIS_PORT, //REDIS_PORT=6379\r\n});\r\n\r\nclient.on(\"error\", (error) => {\r\n  console.log('ðŸ˜’')\r\n  console.log(error)\r\n  winston.error(error);\r\n  client.quit().then((e) => console.log(e));\r\n});\r\n\r\nclient.on(\"connect\", () => winston.info(\"Redis client connected\"));\r\n\r\nexport default client;\r\n"]}},"mtime":1648685190379},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\redis\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\redis\\\\redis-services.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\n//add to redis\nconst storeNewSession = async (client, accessToken, session) => {\n  // store session information on Mongo db\n  // sync with redis cache (update redis) //add to redis\n  client.set(accessToken, JSON.stringify(session), (err, reply) => {\n    if (err) {\n      console.log(err.message);\n      console.log('errrr');\n      return Promise.reject(err);\n    }\n\n    return Promise.resolve(session);\n  });\n}; //delete single token data(token string)\n\n\nconst deleteSessionRedis = async (client, accessToken) => {\n  console.log('deleting session redis');\n  let userSession;\n  await client.get(accessToken, (err, sessionData) => {\n    if (sessionData) {\n      console.log('here');\n      userSession = sessionData;\n      console.log(sessionData);\n    } else if (err) {\n      console.log('errrr');\n      console.log(err);\n    }\n  });\n  console.log(accessToken);\n  console.log(userSession);\n  userSession = JSON.parse(userSession);\n  console.log(userSession);\n  console.log(userSession.userCount);\n  const count = userSession.userCount;\n\n  if (count > 1) {\n    userSession.count -= 1;\n    syncWithRedis(client, accessToken, userSession);\n  } //delete session\n  else if (count === 1) {\n    console.log('deleting from redis');\n    client.del(accessToken);\n  }\n};\n\nconst deleteSessionRedisForChangePassword = async (client, accessToken) => {\n  console.log('deleting session redis');\n  let userSession;\n  await client.get(accessToken, (err, sessionData) => {\n    if (sessionData) {\n      console.log('here');\n      userSession = sessionData;\n      console.log(sessionData);\n    } else if (err) {\n      console.log('errrr');\n      console.log(err);\n    }\n  });\n  console.log(accessToken);\n  console.log(userSession);\n  userSession = JSON.parse(userSession);\n  console.log(userSession);\n  console.log(userSession.userCount);\n  const count = userSession.userCount;\n  console.log('deleting from redis');\n  client.del(accessToken);\n}; //update single token data\n\n\nconst syncWithRedis = async (client, accessToken, session) => {\n  //fetch from mongodb\n  //update the whole cache\n  console.log(accessToken);\n  console.log('in sync wi redis', session);\n  client.set(accessToken, JSON.stringify(session), (err, reply) => {\n    if (err) {\n      console.log(err.message);\n      console.log('errrr');\n      return Promise.reject(err);\n    }\n\n    console.log('resolving');\n    return Promise.resolve(session);\n  });\n};\n\nvar _default = {\n  storeNewSession,\n  syncWithRedis,\n  deleteSessionRedis,\n  deleteSessionRedisForChangePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZGlzLXNlcnZpY2VzLmpzIl0sIm5hbWVzIjpbInN0b3JlTmV3U2Vzc2lvbiIsImNsaWVudCIsImFjY2Vzc1Rva2VuIiwic2Vzc2lvbiIsInNldCIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnIiLCJyZXBseSIsImNvbnNvbGUiLCJsb2ciLCJtZXNzYWdlIiwiUHJvbWlzZSIsInJlamVjdCIsInJlc29sdmUiLCJkZWxldGVTZXNzaW9uUmVkaXMiLCJ1c2VyU2Vzc2lvbiIsImdldCIsInNlc3Npb25EYXRhIiwicGFyc2UiLCJ1c2VyQ291bnQiLCJjb3VudCIsInN5bmNXaXRoUmVkaXMiLCJkZWwiLCJkZWxldGVTZXNzaW9uUmVkaXNGb3JDaGFuZ2VQYXNzd29yZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBQ0EsTUFBTUEsZUFBZSxHQUFHLE9BQU9DLE1BQVAsRUFBY0MsV0FBZCxFQUEwQkMsT0FBMUIsS0FBc0M7QUFDMUQ7QUFDQTtBQUNBRixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBV0YsV0FBWCxFQUF1QkcsSUFBSSxDQUFDQyxTQUFMLENBQWVILE9BQWYsQ0FBdkIsRUFBK0MsQ0FBQ0ksR0FBRCxFQUFLQyxLQUFMLEtBQWU7QUFDMUQsUUFBSUQsR0FBSixFQUFTO0FBQ0xFLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSCxHQUFHLENBQUNJLE9BQWhCO0FBQ0FGLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLE9BQVo7QUFDQSxhQUFPRSxPQUFPLENBQUNDLE1BQVIsQ0FBZU4sR0FBZixDQUFQO0FBQ0g7O0FBQ0QsV0FBT0ssT0FBTyxDQUFDRSxPQUFSLENBQWdCWCxPQUFoQixDQUFQO0FBQ0gsR0FQRDtBQVFILENBWEQsQyxDQWFBOzs7QUFDQSxNQUFNWSxrQkFBa0IsR0FBRyxPQUFPZCxNQUFQLEVBQWNDLFdBQWQsS0FBOEI7QUFDckRPLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHdCQUFaO0FBQ0EsTUFBSU0sV0FBSjtBQUNBLFFB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Q0MsR0FBUixDQUFZLGtCQUFaLEVBQStCUCxPQUEvQjtBQUNBRixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBV0YsV0FBWCxFQUF1QkcsSUFBSSxDQUFDQyxTQUFMLENBQWVILE9BQWYsQ0FBdkIsRUFBK0MsQ0FBQ0ksR0FBRCxFQUFLQyxLQUFMLEtBQWU7QUFDMUQsUUFBSUQsR0FBSixFQUFTO0FBQ0xFLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSCxHQUFHLENBQUNJLE9BQWhCO0FBQ0FGLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLE9BQVo7QUFDQSxhQUFPRSxPQUFPLENBQUNDLE1BQVIsQ0FBZU4sR0FBZixDQUFQO0FBQ0g7O0FBQ0RFLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFdBQVo7QUFDQSxXQUFPRSxPQUFPLENBQUNFLE9BQVIsQ0FBZ0JYLE9BQWhCLENBQVA7QUFDSCxHQVJEO0FBU0gsQ0FkRDs7ZUFnQmU7QUFDWEgsRUFBQUEsZUFEVztBQUVYc0IsRUFBQUEsYUFGVztBQUdYUCxFQUFBQSxrQkFIVztBQUlYUyxFQUFBQTtBQUpXLEMiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXHNlcnZpY2VzXFxyZWRpc1xcIiwic291cmNlc0NvbnRlbnQiOlsiLy9hZGQgdG8gcmVkaXNcclxuY29uc3Qgc3RvcmVOZXdTZXNzaW9uID0gYXN5bmMgKGNsaWVudCxhY2Nlc3NUb2tlbixzZXNzaW9uKSA9PiB7XHJcbiAgICAvLyBzdG9yZSBzZXNzaW9uIGluZm9ybWF0aW9uIG9uIE1vbmdvIGRiXHJcbiAgICAvLyBzeW5jIHdpdGggcmVkaXMgY2FjaGUgKHVwZGF0ZSByZWRpcykgLy9hZGQgdG8gcmVkaXNcclxuICAgIGNsaWVudC5zZXQoYWNjZXNzVG9rZW4sSlNPTi5zdHJpbmdpZnkoc2Vzc2lvbiksKGVycixyZXBseSkgPT4ge1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyLm1lc3NhZ2UpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJycicpXHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoc2Vzc2lvbilcclxuICAgIH0pXHJcbn1cclxuXHJcbi8vZGVsZXRlIHNpbmdsZSB0b2tlbiBkYXRhKHRva2VuIHN0cmluZylcclxuY29uc3QgZGVsZXRlU2Vzc2lvblJlZGlzID0gYXN5bmMgKGNsaWVudCxhY2Nlc3NUb2tlbikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ2RlbGV0aW5nIHNlc3Npb24gcmVkaXMnKVxyXG4gICAgbGV0IHVzZXJTZXNzaW9uO1xyXG4gICAgYXdhaXQgY2xpZW50LmdldChhY2Nlc3NUb2tlbiwgKGVycixzZXNzaW9uRGF0YSkgPT4ge1xyXG4gICAgICAgIGlmIChzZXNzaW9uRGF0YSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaGVyZScpXHJcbiAgICAgICAgICAgIHVzZXJTZXNzaW9uID0gc2Vzc2lvbkRhdGFcclxuICAgICAgICAgICAgY29uc29sZS5sb2coc2Vzc2lvbkRhdGEpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGVycil7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJycicpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgY29uc29sZS5sb2coYWNjZXNzVG9rZW4pXHJcbiAgICBjb25zb2xlLmxvZyh1c2VyU2Vzc2lvbilcclxuICAgIHVzZXJTZXNzaW9uID0gSlNPTi5wYXJzZSh1c2VyU2Vzc2lvbilcclxuICAgIGNvbnNvbGUubG9nKHVzZXJTZXNzaW9uKVxyXG4gICAgY29uc29sZS5sb2codXNlclNlc3Npb24udXNlckNvdW50KVxyXG4gICAgY29uc3QgY291bnQgPSB1c2VyU2Vzc2lvbi51c2VyQ291bnRcclxuICAgIGlmIChjb3VudCA+IDEpIHtcclxuICAgICAgICB1c2VyU2Vzc2lvbi5jb3VudCAtPSAxXHJcbiAgICAgICAgc3luY1dpdGhSZWRpcyhjbGllbnQsYWNjZXNzVG9rZW4sdXNlclNlc3Npb24pXHJcbiAgICAgIH1cclxuICAgICAgLy9kZWxldGUgc2Vzc2lvblxyXG4gICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGluZyBmcm9tIHJlZGlzJylcclxuICAgICAgICBjbGllbnQuZGVsKGFjY2Vzc1Rva2VuKVxyXG4gICAgICB9XHJcbn1cclxuXHJcbmNvbnN0IGRlbGV0ZVNlc3Npb25SZWRpc0ZvckNoYW5nZVBhc3N3b3JkID0gYXN5bmMgKGNsaWVudCxhY2Nlc3NUb2tlbikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ2RlbGV0aW5nIHNlc3Npb24gcmVkaXMnKVxyXG4gICAgbGV0IHVzZXJTZXNzaW9uO1xyXG4gICAgYXdhaXQgY2xpZW50LmdldChhY2Nlc3NUb2tlbiwgKGVycixzZXNzaW9uRGF0YSkgPT4ge1xyXG4gICAgICAgIGlmIChzZXNzaW9uRGF0YSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaGVyZScpXHJcbiAgICAgICAgICAgIHVzZXJTZXNzaW9uID0gc2Vzc2lvbkRhdGFcclxuICAgICAgICAgICAgY29uc29sZS5sb2coc2Vzc2lvbkRhdGEpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGVycil7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJycicpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgY29uc29sZS5sb2coYWNjZXNzVG9rZW4pXHJcbiAgICBjb25zb2xlLmxvZyh1c2VyU2Vzc2lvbilcclxuICAgIHVzZXJTZXNzaW9uID0gSlNPTi5wYXJzZSh1c2VyU2Vzc2lvbilcclxuICAgIGNvbnNvbGUubG9nKHVzZXJTZXNzaW9uKVxyXG4gICAgY29uc29sZS5sb2codXNlclNlc3Npb24udXNlckNvdW50KVxyXG4gICAgY29uc3QgY291bnQgPSB1c2VyU2Vzc2lvbi51c2VyQ291bnRcclxuICAgIFxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGluZyBmcm9tIHJlZGlzJylcclxuICAgICAgICBjbGllbnQuZGVsKGFjY2Vzc1Rva2VuKVxyXG4gICAgICBcclxufVxyXG5cclxuLy91cGRhdGUgc2luZ2xlIHRva2VuIGRhdGFcclxuY29uc3Qgc3luY1dpdGhSZWRpcyA9IGFzeW5jICAoY2xpZW50LGFjY2Vzc1Rva2VuLHNlc3Npb24pID0+IHtcclxuICAgIC8vZmV0Y2ggZnJvbSBtb25nb2RiXHJcbiAgICAvL3VwZGF0ZSB0aGUgd2hvbGUgY2FjaGVcclxuICAgIGNvbnNvbGUubG9nKGFjY2Vzc1Rva2VuKVxyXG4gICAgY29uc29sZS5sb2coJ2luIHN5bmMgd2kgcmVkaXMnLHNlc3Npb24pXHJcbiAgICBjbGllbnQuc2V0KGFjY2Vzc1Rva2VuLEpTT04uc3RyaW5naWZ5KHNlc3Npb24pLChlcnIscmVwbHkpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZXJycnInKVxyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZygncmVzb2x2aW5nJylcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHNlc3Npb24pXHJcbiAgICB9KVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBzdG9yZU5ld1Nlc3Npb24sXHJcbiAgICBzeW5jV2l0aFJlZGlzLFxyXG4gICAgZGVsZXRlU2Vzc2lvblJlZGlzLFxyXG4gICAgZGVsZXRlU2Vzc2lvblJlZGlzRm9yQ2hhbmdlUGFzc3dvcmRcclxufSJdfQ==","map":{"version":3,"sources":["redis-services.js"],"names":["storeNewSession","client","accessToken","session","set","JSON","stringify","err","reply","console","log","message","Promise","reject","resolve","deleteSessionRedis","userSession","get","sessionData","parse","userCount","count","syncWithRedis","del","deleteSessionRedisForChangePassword"],"mappings":";;;;;;;AAAA;AACA,MAAMA,eAAe,GAAG,OAAOC,MAAP,EAAcC,WAAd,EAA0BC,OAA1B,KAAsC;AAC1D;AACA;AACAF,EAAAA,MAAM,CAACG,GAAP,CAAWF,WAAX,EAAuBG,IAAI,CAACC,SAAL,CAAeH,OAAf,CAAvB,EAA+C,CAACI,GAAD,EAAKC,KAAL,KAAe;AAC1D,QAAID,GAAJ,EAAS;AACLE,MAAAA,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,OAAhB;AACAF,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACA,aAAOE,OAAO,CAACC,MAAR,CAAeN,GAAf,CAAP;AACH;;AACD,WAAOK,OAAO,CAACE,OAAR,CAAgBX,OAAhB,CAAP;AACH,GAPD;AAQH,CAXD,C,CAaA;;;AACA,MAAMY,kBAAkB,GAAG,OAAOd,MAAP,EAAcC,WAAd,KAA8B;AACrDO,EAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AACA,MAAIM,WAAJ;AACA,QAAMf,MAAM,CAACgB,GAAP,CAAWf,WAAX,EAAwB,CAACK,GAAD,EAAKW,WAAL,KAAqB;AAC/C,QAAIA,WAAJ,EAAiB;AACbT,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACAM,MAAAA,WAAW,GAAGE,WAAd;AACAT,MAAAA,OAAO,CAACC,GAAR,CAAYQ,WAAZ;AACH,KAJD,MAKK,IAAIX,GAAJ,EAAQ;AACTE,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ;AACH;AACJ,GAVK,CAAN;AAWAE,EAAAA,OAAO,CAACC,GAAR,CAAYR,WAAZ;AACAO,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAZ;AACAA,EAAAA,WAAW,GAAGX,IAAI,CAACc,KAAL,CAAWH,WAAX,CAAd;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAZ;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAW,CAACI,SAAxB;AACA,QAAMC,KAAK,GAAGL,WAAW,CAACI,SAA1B;;AACA,MAAIC,KAAK,GAAG,CAAZ,EAAe;AACXL,IAAAA,WAAW,CAACK,KAAZ,IAAqB,CAArB;AACAC,IAAAA,aAAa,CAACrB,MAAD,EAAQC,WAAR,EAAoBc,WAApB,CAAb;AACD,GAHH,CAIE;AAJF,OAKO,IAAIK,KAAK,KAAK,CAAd,EAAiB;AACpBZ,IAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACAT,IAAAA,MAAM,CAACsB,GAAP,CAAWrB,WAAX;AACD;AACN,CA7BD;;AA+BA,MAAMsB,mCAAmC,GAAG,OAAOvB,MAAP,EAAcC,WAAd,KAA8B;AACtEO,EAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AACA,MAAIM,WAAJ;AACA,QAAMf,MAAM,CAACgB,GAAP,CAAWf,WAAX,EAAwB,CAACK,GAAD,EAAKW,WAAL,KAAqB;AAC/C,QAAIA,WAAJ,EAAiB;AACbT,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACAM,MAAAA,WAAW,GAAGE,WAAd;AACAT,MAAAA,OAAO,CAACC,GAAR,CAAYQ,WAAZ;AACH,KAJD,MAKK,IAAIX,GAAJ,EAAQ;AACTE,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ;AACH;AACJ,GAVK,CAAN;AAWAE,EAAAA,OAAO,CAACC,GAAR,CAAYR,WAAZ;AACAO,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAZ;AACAA,EAAAA,WAAW,GAAGX,IAAI,CAACc,KAAL,CAAWH,WAAX,CAAd;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAZ;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYM,WAAW,CAACI,SAAxB;AACA,QAAMC,KAAK,GAAGL,WAAW,CAACI,SAA1B;AAEIX,EAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACAT,EAAAA,MAAM,CAACsB,GAAP,CAAWrB,WAAX;AAEP,CAxBD,C,CA0BA;;;AACA,MAAMoB,aAAa,GAAG,OAAQrB,MAAR,EAAeC,WAAf,EAA2BC,OAA3B,KAAuC;AACzD;AACA;AACAM,EAAAA,OAAO,CAACC,GAAR,CAAYR,WAAZ;AACAO,EAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAA+BP,OAA/B;AACAF,EAAAA,MAAM,CAACG,GAAP,CAAWF,WAAX,EAAuBG,IAAI,CAACC,SAAL,CAAeH,OAAf,CAAvB,EAA+C,CAACI,GAAD,EAAKC,KAAL,KAAe;AAC1D,QAAID,GAAJ,EAAS;AACLE,MAAAA,OAAO,CAACC,GAAR,CAAYH,GAAG,CAACI,OAAhB;AACAF,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACA,aAAOE,OAAO,CAACC,MAAR,CAAeN,GAAf,CAAP;AACH;;AACDE,IAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACA,WAAOE,OAAO,CAACE,OAAR,CAAgBX,OAAhB,CAAP;AACH,GARD;AASH,CAdD;;eAgBe;AACXH,EAAAA,eADW;AAEXsB,EAAAA,aAFW;AAGXP,EAAAA,kBAHW;AAIXS,EAAAA;AAJW,C","sourceRoot":"E:\\haleta-new-api\\src\\services\\redis\\","sourcesContent":["//add to redis\r\nconst storeNewSession = async (client,accessToken,session) => {\r\n    // store session information on Mongo db\r\n    // sync with redis cache (update redis) //add to redis\r\n    client.set(accessToken,JSON.stringify(session),(err,reply) => {\r\n        if (err) {\r\n            console.log(err.message)\r\n            console.log('errrr')\r\n            return Promise.reject(err)\r\n        }\r\n        return Promise.resolve(session)\r\n    })\r\n}\r\n\r\n//delete single token data(token string)\r\nconst deleteSessionRedis = async (client,accessToken) => {\r\n    console.log('deleting session redis')\r\n    let userSession;\r\n    await client.get(accessToken, (err,sessionData) => {\r\n        if (sessionData) {\r\n            console.log('here')\r\n            userSession = sessionData\r\n            console.log(sessionData)\r\n        }\r\n        else if (err){\r\n            console.log('errrr')\r\n            console.log(err)\r\n        }\r\n    })\r\n    console.log(accessToken)\r\n    console.log(userSession)\r\n    userSession = JSON.parse(userSession)\r\n    console.log(userSession)\r\n    console.log(userSession.userCount)\r\n    const count = userSession.userCount\r\n    if (count > 1) {\r\n        userSession.count -= 1\r\n        syncWithRedis(client,accessToken,userSession)\r\n      }\r\n      //delete session\r\n      else if (count === 1) {\r\n        console.log('deleting from redis')\r\n        client.del(accessToken)\r\n      }\r\n}\r\n\r\nconst deleteSessionRedisForChangePassword = async (client,accessToken) => {\r\n    console.log('deleting session redis')\r\n    let userSession;\r\n    await client.get(accessToken, (err,sessionData) => {\r\n        if (sessionData) {\r\n            console.log('here')\r\n            userSession = sessionData\r\n            console.log(sessionData)\r\n        }\r\n        else if (err){\r\n            console.log('errrr')\r\n            console.log(err)\r\n        }\r\n    })\r\n    console.log(accessToken)\r\n    console.log(userSession)\r\n    userSession = JSON.parse(userSession)\r\n    console.log(userSession)\r\n    console.log(userSession.userCount)\r\n    const count = userSession.userCount\r\n    \r\n        console.log('deleting from redis')\r\n        client.del(accessToken)\r\n      \r\n}\r\n\r\n//update single token data\r\nconst syncWithRedis = async  (client,accessToken,session) => {\r\n    //fetch from mongodb\r\n    //update the whole cache\r\n    console.log(accessToken)\r\n    console.log('in sync wi redis',session)\r\n    client.set(accessToken,JSON.stringify(session),(err,reply) => {\r\n        if (err) {\r\n            console.log(err.message)\r\n            console.log('errrr')\r\n            return Promise.reject(err)\r\n        }\r\n        console.log('resolving')\r\n        return Promise.resolve(session)\r\n    })\r\n}\r\n\r\nexport default {\r\n    storeNewSession,\r\n    syncWithRedis,\r\n    deleteSessionRedis,\r\n    deleteSessionRedisForChangePassword\r\n}"]}},"mtime":1648761161078},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\typedefs\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\typedefs\\\\types.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nvar _graphqlCompose = require(\"graphql-compose\");\n\nvar _user = require(\"../../../models/user\");\n\n_graphqlCompose.schemaComposer.createObjectTC({\n  name: \"AccessToken\",\n  fields: {\n    accessToken: \"String!\",\n    user: _user.UserTC\n  }\n});\n\n_graphqlCompose.schemaComposer.createObjectTC({\n  name: \"Succeed\",\n  fields: {\n    succeed: \"Boolean!\"\n  }\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInR5cGVzLmpzIl0sIm5hbWVzIjpbInNjaGVtYUNvbXBvc2VyIiwiY3JlYXRlT2JqZWN0VEMiLCJuYW1lIiwiZmllbGRzIiwiYWNjZXNzVG9rZW4iLCJ1c2VyIiwiVXNlclRDIiwic3VjY2VlZCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQTs7QUFFQUEsK0JBQWVDLGNBQWYsQ0FBOEI7QUFDMUJDLEVBQUFBLElBQUksRUFBRSxhQURvQjtBQUUxQkMsRUFBQUEsTUFBTSxFQUFFO0FBQ0pDLElBQUFBLFdBQVcsRUFBRSxTQURUO0FBRUpDLElBQUFBLElBQUksRUFBRUM7QUFGRjtBQUZrQixDQUE5Qjs7QUFRQU4sK0JBQWVDLGNBQWYsQ0FBOEI7QUFDMUJDLEVBQUFBLElBQUksRUFBRSxTQURvQjtBQUUxQkMsRUFBQUEsTUFBTSxFQUFFO0FBQUNJLElBQUFBLE9BQU8sRUFBRTtBQUFWO0FBRmtCLENBQTlCIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxncmFwaHFsXFxhdXRoXFx0eXBlZGVmc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtzY2hlbWFDb21wb3Nlcn0gZnJvbSBcImdyYXBocWwtY29tcG9zZVwiO1xyXG5pbXBvcnQge1VzZXJUQ30gZnJvbSBcIi4uLy4uLy4uL21vZGVscy91c2VyXCI7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5jcmVhdGVPYmplY3RUQyh7XHJcbiAgICBuYW1lOiBcIkFjY2Vzc1Rva2VuXCIsXHJcbiAgICBmaWVsZHM6IHtcclxuICAgICAgICBhY2Nlc3NUb2tlbjogXCJTdHJpbmchXCIsXHJcbiAgICAgICAgdXNlcjogVXNlclRDLFxyXG4gICAgfSxcclxufSk7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5jcmVhdGVPYmplY3RUQyh7XHJcbiAgICBuYW1lOiBcIlN1Y2NlZWRcIixcclxuICAgIGZpZWxkczoge3N1Y2NlZWQ6IFwiQm9vbGVhbiFcIn0sXHJcbn0pOyJdfQ==","map":{"version":3,"sources":["types.js"],"names":["schemaComposer","createObjectTC","name","fields","accessToken","user","UserTC","succeed"],"mappings":";;AAAA;;AACA;;AAEAA,+BAAeC,cAAf,CAA8B;AAC1BC,EAAAA,IAAI,EAAE,aADoB;AAE1BC,EAAAA,MAAM,EAAE;AACJC,IAAAA,WAAW,EAAE,SADT;AAEJC,IAAAA,IAAI,EAAEC;AAFF;AAFkB,CAA9B;;AAQAN,+BAAeC,cAAf,CAA8B;AAC1BC,EAAAA,IAAI,EAAE,SADoB;AAE1BC,EAAAA,MAAM,EAAE;AAACI,IAAAA,OAAO,EAAE;AAAV;AAFkB,CAA9B","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\typedefs\\","sourcesContent":["import {schemaComposer} from \"graphql-compose\";\r\nimport {UserTC} from \"../../../models/user\";\r\n\r\nschemaComposer.createObjectTC({\r\n    name: \"AccessToken\",\r\n    fields: {\r\n        accessToken: \"String!\",\r\n        user: UserTC,\r\n    },\r\n});\r\n\r\nschemaComposer.createObjectTC({\r\n    name: \"Succeed\",\r\n    fields: {succeed: \"Boolean!\"},\r\n});"]}},"mtime":1648684433887},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\user\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\user\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserQuery = exports.UserMutation = void 0;\n\nvar _user = require(\"../../models/user\");\n\nvar _middlewares = require(\"../../middlewares\");\n\n// import Resolvers from \"./use-cases\";\n//\n// for (const resolver in Resolvers) {\n//     UserTC.addResolver(Resolvers[resolver]);\n// }\nconst UserQuery = {\n  userById: _user.UserTC.getResolver(\"findById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userByIds: _user.UserTC.getResolver(\"findByIds\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userOne: _user.UserTC.getResolver(\"findOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userMany: _user.UserTC.getResolver(\"findMany\", [_middlewares.authentication.isAuth, _middlewares.authorization])\n};\nexports.UserQuery = UserQuery;\nconst UserMutation = {\n  userCreateOne: _user.UserTC.getResolver(\"createOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userCreateMany: _user.UserTC.getResolver(\"createMany\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateById: _user.UserTC.getResolver(\"updateById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateOne: _user.UserTC.getResolver(\"updateOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateMany: _user.UserTC.getResolver(\"updateMany\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveById: _user.UserTC.getResolver(\"removeById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveOne: _user.UserTC.getResolver(\"removeOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveMany: _user.UserTC.getResolver(\"removeMany\", [_middlewares.authentication.isAuth, _middlewares.authorization])\n};\nexports.UserMutation = UserMutation;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIlVzZXJRdWVyeSIsInVzZXJCeUlkIiwiVXNlclRDIiwiZ2V0UmVzb2x2ZXIiLCJhdXRoZW50aWNhdGlvbiIsImlzQXV0aCIsImF1dGhvcml6YXRpb24iLCJ1c2VyQnlJZHMiLCJ1c2VyT25lIiwidXNlck1hbnkiLCJVc2VyTXV0YXRpb24iLCJ1c2VyQ3JlYXRlT25lIiwidXNlckNyZWF0ZU1hbnkiLCJ1c2VyVXBkYXRlQnlJZCIsInVzZXJVcGRhdGVPbmUiLCJ1c2VyVXBkYXRlTWFueSIsInVzZXJSZW1vdmVCeUlkIiwidXNlclJlbW92ZU9uZSIsInVzZXJSZW1vdmVNYW55Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLE1BQU1BLFNBQVMsR0FBRztBQUNkQyxFQUFBQSxRQUFRLEVBQUVDLGFBQU9DLFdBQVAsQ0FBbUIsVUFBbkIsRUFBK0IsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBL0IsQ0FESTtBQUVkQyxFQUFBQSxTQUFTLEVBQUVMLGFBQU9DLFdBQVAsQ0FBbUIsV0FBbkIsRUFBZ0MsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBaEMsQ0FGRztBQUdkRSxFQUFBQSxPQUFPLEVBQUVOLGFBQU9DLFdBQVAsQ0FBbUIsU0FBbkIsRUFBOEIsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBOUIsQ0FISztBQUlkRyxFQUFBQSxRQUFRLEVBQUVQLGFBQU9DLFdBQVAsQ0FBbUIsVUFBbkIsRUFBK0IsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBL0I7QUFKSSxDQUFsQjs7QUFPQSxNQUFNSSxZQUFZLEdBQUc7QUFDakJDLEVBQUFBLGFBQWEsRUFBRVQsYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQURFO0FBRWpCTSxFQUFBQSxjQUFjLEVBQUVWLGFBQU9DLFdBQVAsQ0FBbUIsWUFBbkIsRUFBaUMsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBakMsQ0FGQztBQUdqQk8sRUFBQUEsY0FBYyxFQUFFWCxhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDLENBSEM7QUFJakJRLEVBQUFBLGFBQWEsRUFBRVosYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQUpFO0FBS2pCUyxFQUFBQSxjQUFjLEVBQUViLGFBQU9DLFdBQVAsQ0FBbUIsWUFBbkIsRUFBaUMsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBakMsQ0FMQztBQU1qQlUsRUFBQUEsY0FBYyxFQUFFZCxhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDLENBTkM7QUFPakJXLEVBQUFBLGFBQWEsRUFBRWYsYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQVBFO0FBUWpCWSxFQUFBQSxjQUFjLEVBQUVoQixhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDO0FBUkMsQ0FBckIiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXGdyYXBocWxcXHVzZXJcXCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7VXNlclRDfSBmcm9tIFwiLi4vLi4vbW9kZWxzL3VzZXJcIjtcclxuXHJcbmltcG9ydCB7YXV0aGVudGljYXRpb24sIGF1dGhvcml6YXRpb259IGZyb20gXCIuLi8uLi9taWRkbGV3YXJlc1wiO1xyXG4vLyBpbXBvcnQgUmVzb2x2ZXJzIGZyb20gXCIuL3VzZS1jYXNlc1wiO1xyXG4vL1xyXG4vLyBmb3IgKGNvbnN0IHJlc29sdmVyIGluIFJlc29sdmVycykge1xyXG4vLyAgICAgVXNlclRDLmFkZFJlc29sdmVyKFJlc29sdmVyc1tyZXNvbHZlcl0pO1xyXG4vLyB9XHJcblxyXG5jb25zdCBVc2VyUXVlcnkgPSB7XHJcbiAgICB1c2VyQnlJZDogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZEJ5SWRcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlckJ5SWRzOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJmaW5kQnlJZHNcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlck9uZTogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZE9uZVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyTWFueTogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZE1hbnlcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG59O1xyXG5cclxuY29uc3QgVXNlck11dGF0aW9uID0ge1xyXG4gICAgdXNlckNyZWF0ZU9uZTogVXNlclRDLmdldFJlc29sdmVyKFwiY3JlYXRlT25lXCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJDcmVhdGVNYW55OiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJjcmVhdGVNYW55XCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJVcGRhdGVCeUlkOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJ1cGRhdGVCeUlkXCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJVcGRhdGVPbmU6IFVzZXJUQy5nZXRSZXNvbHZlcihcInVwZGF0ZU9uZVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyVXBkYXRlTWFueTogVXNlclRDLmdldFJlc29sdmVyKFwidXBkYXRlTWFueVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyUmVtb3ZlQnlJZDogVXNlclRDLmdldFJlc29sdmVyKFwicmVtb3ZlQnlJZFwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyUmVtb3ZlT25lOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJyZW1vdmVPbmVcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlclJlbW92ZU1hbnk6IFVzZXJUQy5nZXRSZXNvbHZlcihcInJlbW92ZU1hbnlcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG59O1xyXG5cclxuZXhwb3J0IHtVc2VyUXVlcnksIFVzZXJNdXRhdGlvbn07XHJcbiJdfQ==","map":{"version":3,"sources":["index.js"],"names":["UserQuery","userById","UserTC","getResolver","authentication","isAuth","authorization","userByIds","userOne","userMany","UserMutation","userCreateOne","userCreateMany","userUpdateById","userUpdateOne","userUpdateMany","userRemoveById","userRemoveOne","userRemoveMany"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;AACA;AACA;AACA;AACA;AAEA,MAAMA,SAAS,GAAG;AACdC,EAAAA,QAAQ,EAAEC,aAAOC,WAAP,CAAmB,UAAnB,EAA+B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA/B,CADI;AAEdC,EAAAA,SAAS,EAAEL,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAFG;AAGdE,EAAAA,OAAO,EAAEN,aAAOC,WAAP,CAAmB,SAAnB,EAA8B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA9B,CAHK;AAIdG,EAAAA,QAAQ,EAAEP,aAAOC,WAAP,CAAmB,UAAnB,EAA+B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA/B;AAJI,CAAlB;;AAOA,MAAMI,YAAY,GAAG;AACjBC,EAAAA,aAAa,EAAET,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CADE;AAEjBM,EAAAA,cAAc,EAAEV,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CAFC;AAGjBO,EAAAA,cAAc,EAAEX,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CAHC;AAIjBQ,EAAAA,aAAa,EAAEZ,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAJE;AAKjBS,EAAAA,cAAc,EAAEb,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CALC;AAMjBU,EAAAA,cAAc,EAAEd,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CANC;AAOjBW,EAAAA,aAAa,EAAEf,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAPE;AAQjBY,EAAAA,cAAc,EAAEhB,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC;AARC,CAArB","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\user\\","sourcesContent":["import {UserTC} from \"../../models/user\";\r\n\r\nimport {authentication, authorization} from \"../../middlewares\";\r\n// import Resolvers from \"./use-cases\";\r\n//\r\n// for (const resolver in Resolvers) {\r\n//     UserTC.addResolver(Resolvers[resolver]);\r\n// }\r\n\r\nconst UserQuery = {\r\n    userById: UserTC.getResolver(\"findById\", [authentication.isAuth, authorization]),\r\n    userByIds: UserTC.getResolver(\"findByIds\", [authentication.isAuth, authorization]),\r\n    userOne: UserTC.getResolver(\"findOne\", [authentication.isAuth, authorization]),\r\n    userMany: UserTC.getResolver(\"findMany\", [authentication.isAuth, authorization]),\r\n};\r\n\r\nconst UserMutation = {\r\n    userCreateOne: UserTC.getResolver(\"createOne\", [authentication.isAuth, authorization]),\r\n    userCreateMany: UserTC.getResolver(\"createMany\", [authentication.isAuth, authorization]),\r\n    userUpdateById: UserTC.getResolver(\"updateById\", [authentication.isAuth, authorization]),\r\n    userUpdateOne: UserTC.getResolver(\"updateOne\", [authentication.isAuth, authorization]),\r\n    userUpdateMany: UserTC.getResolver(\"updateMany\", [authentication.isAuth, authorization]),\r\n    userRemoveById: UserTC.getResolver(\"removeById\", [authentication.isAuth, authorization]),\r\n    userRemoveOne: UserTC.getResolver(\"removeOne\", [authentication.isAuth, authorization]),\r\n    userRemoveMany: UserTC.getResolver(\"removeMany\", [authentication.isAuth, authorization]),\r\n};\r\n\r\nexport {UserQuery, UserMutation};\r\n"]}},"mtime":1648684433888},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\mongodb-config.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nvar _mongoose = _interopRequireDefault(require(\"mongoose\"));\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n_dotenv.default.config();\n\nmain().then(() => console.log(\"Mongoose connected\")).catch(err => console.log(err));\n\nasync function main() {\n  await _mongoose.default.connect(process.env.MONGODB_URI);\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vbmdvZGItY29uZmlnLmpzIl0sIm5hbWVzIjpbImRvdGVudiIsImNvbmZpZyIsIm1haW4iLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwibW9uZ29vc2UiLCJjb25uZWN0IiwicHJvY2VzcyIsImVudiIsIk1PTkdPREJfVVJJIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOzs7O0FBRUFBLGdCQUFPQyxNQUFQOztBQUVBQyxJQUFJLEdBQ0NDLElBREwsQ0FDVSxNQUFNQyxPQUFPLENBQUNDLEdBQVIsQ0FBWSxvQkFBWixDQURoQixFQUVLQyxLQUZMLENBRVdDLEdBQUcsSUFBSUgsT0FBTyxDQUFDQyxHQUFSLENBQVlFLEdBQVosQ0FGbEI7O0FBSUEsZUFBZUwsSUFBZixHQUFzQjtBQUNsQixRQUFNTSxrQkFBU0MsT0FBVCxDQUFpQkMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFdBQTdCLENBQU47QUFDSCIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcY29uZmlnXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XHJcbmltcG9ydCBkb3RlbnYgZnJvbSBcImRvdGVudlwiO1xyXG5cclxuZG90ZW52LmNvbmZpZygpO1xyXG5cclxubWFpbigpXHJcbiAgICAudGhlbigoKSA9PiBjb25zb2xlLmxvZyhcIk1vbmdvb3NlIGNvbm5lY3RlZFwiKSlcclxuICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBtYWluKCkge1xyXG4gICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdChwcm9jZXNzLmVudi5NT05HT0RCX1VSSSk7XHJcbn0iXX0=","map":{"version":3,"sources":["mongodb-config.js"],"names":["dotenv","config","main","then","console","log","catch","err","mongoose","connect","process","env","MONGODB_URI"],"mappings":";;AAAA;;AACA;;;;AAEAA,gBAAOC,MAAP;;AAEAC,IAAI,GACCC,IADL,CACU,MAAMC,OAAO,CAACC,GAAR,CAAY,oBAAZ,CADhB,EAEKC,KAFL,CAEWC,GAAG,IAAIH,OAAO,CAACC,GAAR,CAAYE,GAAZ,CAFlB;;AAIA,eAAeL,IAAf,GAAsB;AAClB,QAAMM,kBAASC,OAAT,CAAiBC,OAAO,CAACC,GAAR,CAAYC,WAA7B,CAAN;AACH","sourceRoot":"E:\\haleta-new-api\\src\\config\\","sourcesContent":["import mongoose from \"mongoose\";\r\nimport dotenv from \"dotenv\";\r\n\r\ndotenv.config();\r\n\r\nmain()\r\n    .then(() => console.log(\"Mongoose connected\"))\r\n    .catch(err => console.log(err));\r\n\r\nasync function main() {\r\n    await mongoose.connect(process.env.MONGODB_URI);\r\n}"]}},"mtime":1648684433884}}