{"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _apolloServerExpress = require(\"apollo-server-express\");\n\nvar _graphql = _interopRequireDefault(require(\"./graphql\"));\n\nvar _validateToken = _interopRequireDefault(require(\"./middlewares/auth/validate-token\"));\n\nrequire(\"./config/mongodb-config\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst client = require(\"./config/redis-config\");\n\n_dotenv.default.config();\n\nconst app = (0, _express.default)();\n\nasync function startApolloServer() {\n  const server = new _apolloServerExpress.ApolloServer({\n    schema: _graphql.default,\n    playground: true,\n    introspection: true,\n    tracing: true,\n    path: \"/\",\n    context: ({\n      req\n    }) => {\n      return {\n        user: req.headers.user,\n        headers: req.headers,\n        phoneVerification: req.headers.phoneverification || \"\",\n        // context: { client },\n        accessToken: req.headers.authorization || \"\"\n      };\n    }\n  });\n  app.use(_validateToken.default);\n  await server.start();\n  server.applyMiddleware({\n    app,\n    path: \"/\",\n    cors: \"no-cors\"\n  });\n  app.listen({\n    port: process.env.PORT\n  }, () => {\n    console.log(`ðŸš€ Server listening on port ${process.env.PORT}`);\n  });\n}\n\nstartApolloServer().then(() => {\n  console.log(\"Apollo server started\");\n}).catch(err => {\n  console.log(`ðŸš€ Server Error: ${err.message}`);\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImNsaWVudCIsInJlcXVpcmUiLCJkb3RlbnYiLCJjb25maWciLCJhcHAiLCJzdGFydEFwb2xsb1NlcnZlciIsInNlcnZlciIsIkFwb2xsb1NlcnZlciIsInNjaGVtYSIsInBsYXlncm91bmQiLCJpbnRyb3NwZWN0aW9uIiwidHJhY2luZyIsInBhdGgiLCJjb250ZXh0IiwicmVxIiwidXNlciIsImhlYWRlcnMiLCJwaG9uZVZlcmlmaWNhdGlvbiIsInBob25ldmVyaWZpY2F0aW9uIiwiYWNjZXNzVG9rZW4iLCJhdXRob3JpemF0aW9uIiwidXNlIiwidmFsaWRhdGVUb2tlbiIsInN0YXJ0IiwiYXBwbHlNaWRkbGV3YXJlIiwiY29ycyIsImxpc3RlbiIsInBvcnQiLCJwcm9jZXNzIiwiZW52IiwiUE9SVCIsImNvbnNvbGUiLCJsb2ciLCJ0aGVuIiwiY2F0Y2giLCJlcnIiLCJtZXNzYWdlIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsdUJBQUQsQ0FBdEI7O0FBRUFDLGdCQUFPQyxNQUFQOztBQUNBLE1BQU1DLEdBQUcsR0FBRyx1QkFBWjs7QUFFQSxlQUFlQyxpQkFBZixHQUFtQztBQUMvQixRQUFNQyxNQUFNLEdBQUcsSUFBSUMsaUNBQUosQ0FBaUI7QUFDNUJDLElBQUFBLE1BQU0sRUFBTkEsZ0JBRDRCO0FBRTVCQyxJQUFBQSxVQUFVLEVBQUUsSUFGZ0I7QUFHNUJDLElBQUFBLGFBQWEsRUFBRSxJQUhhO0FBSTVCQyxJQUFBQSxPQUFPLEVBQUUsSUFKbUI7QUFLNUJDLElBQUFBLElBQUksRUFBRSxHQUxzQjtBQU01QkMsSUFBQUEsT0FBTyxFQUFFLENBQUM7QUFBQ0MsTUFBQUE7QUFBRCxLQUFELEtBQVc7QUFDaEIsYUFBTztBQUNIQyxRQUFBQSxJQUFJLEVBQUVELEdBQUcsQ0FBQ0UsT0FBSixDQUFZRCxJQURmO0FBRUhDLFFBQUFBLE9BQU8sRUFBRUYsR0FBRyxDQUFDRSxPQUZWO0FBR0hDLFFBQUFBLGlCQUFpQixFQUFFSCxHQUFHLENBQUNFLE9BQUosQ0FBWUUsaUJBQVosSUFBaUMsRUFIakQ7QUFJSDtBQUNBQyxRQUFBQSxXQUFXLEVBQUVMLEdBQUcsQ0FBQ0UsT0FBSixDQUFZSSxhQUFaLElBQTZCO0FBTHZDLE9BQVA7QUFPSDtBQWQyQixHQUFqQixDQUFmO0FBaUJBaEIsRUFBQUEsR0FBRyxDQUFDaUIsR0FBSixDQUFRQyxzQkFBUjtBQUVBLFFBQU1oQixNQUFNLENBQUNpQixLQUFQLEVBQU47QUFFQWpCLEVBQUFBLE1BQU0sQ0FBQ2tCLGVBQVAsQ0FBdUI7QUFDbkJwQixJQUFBQSxHQURtQjtBQUVuQlEsSUFBQUEsSUFBSSxFQUFFLEdBRmE7QUFHbkJhLElBQUFBLElBQUksRUFBRTtBQUhhLEdBQXZCO0FBTUFyQixFQUFBQSxHQUFHLENBQUNzQixNQUFKLENBQVc7QUFBQ0MsSUFBQUEsSUFBSSxFQUFFQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUM7QUFBbkIsR0FBWCxFQUFxQyxNQUFNO0FBQ3ZDQyxJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBYSwrQkFBOEJKLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxJQUFLLEVBQTVEO0FBQ0gsR0FGRDtBQUdIOztBQUVEekIsaUJBQWlCLEdBQUc0QixJQUFwQixDQUF5QixNQUFNO0FBQzNCRixFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSx1QkFBWjtBQUNILENBRkQsRUFFR0UsS0FGSCxDQUVVQyxHQUFELElBQVM7QUFDZEosRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQWEsb0JBQW1CRyxHQUFHLENBQUNDLE9BQVEsRUFBNUM7QUFDSCxDQUpEIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZG90ZW52IGZyb20gXCJkb3RlbnZcIjtcclxuaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcclxuaW1wb3J0IHtBcG9sbG9TZXJ2ZXJ9IGZyb20gXCJhcG9sbG8tc2VydmVyLWV4cHJlc3NcIjtcclxuaW1wb3J0IHNjaGVtYSBmcm9tIFwiLi9ncmFwaHFsXCI7XHJcbmltcG9ydCB2YWxpZGF0ZVRva2VuIGZyb20gXCIuL21pZGRsZXdhcmVzL2F1dGgvdmFsaWRhdGUtdG9rZW5cIjtcclxuaW1wb3J0IFwiLi9jb25maWcvbW9uZ29kYi1jb25maWdcIjtcclxuXHJcbmNvbnN0IGNsaWVudCA9IHJlcXVpcmUoXCIuL2NvbmZpZy9yZWRpcy1jb25maWdcIik7XHJcblxyXG5kb3RlbnYuY29uZmlnKCk7XHJcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0QXBvbGxvU2VydmVyKCkge1xyXG4gICAgY29uc3Qgc2VydmVyID0gbmV3IEFwb2xsb1NlcnZlcih7XHJcbiAgICAgICAgc2NoZW1hLFxyXG4gICAgICAgIHBsYXlncm91bmQ6IHRydWUsXHJcbiAgICAgICAgaW50cm9zcGVjdGlvbjogdHJ1ZSxcclxuICAgICAgICB0cmFjaW5nOiB0cnVlLFxyXG4gICAgICAgIHBhdGg6IFwiL1wiLFxyXG4gICAgICAgIGNvbnRleHQ6ICh7cmVxfSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgdXNlcjogcmVxLmhlYWRlcnMudXNlcixcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHJlcS5oZWFkZXJzLFxyXG4gICAgICAgICAgICAgICAgcGhvbmVWZXJpZmljYXRpb246IHJlcS5oZWFkZXJzLnBob25ldmVyaWZpY2F0aW9uIHx8IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAvLyBjb250ZXh0OiB7IGNsaWVudCB9LFxyXG4gICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24gfHwgXCJcIlxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICBhcHAudXNlKHZhbGlkYXRlVG9rZW4pXHJcblxyXG4gICAgYXdhaXQgc2VydmVyLnN0YXJ0KCk7XHJcblxyXG4gICAgc2VydmVyLmFwcGx5TWlkZGxld2FyZSh7XHJcbiAgICAgICAgYXBwLFxyXG4gICAgICAgIHBhdGg6IFwiL1wiLFxyXG4gICAgICAgIGNvcnM6IFwibm8tY29yc1wiLFxyXG4gICAgfSk7XHJcblxyXG4gICAgYXBwLmxpc3Rlbih7cG9ydDogcHJvY2Vzcy5lbnYuUE9SVH0sICgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhg8J+agCBTZXJ2ZXIgbGlzdGVuaW5nIG9uIHBvcnQgJHtwcm9jZXNzLmVudi5QT1JUfWApO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbnN0YXJ0QXBvbGxvU2VydmVyKCkudGhlbigoKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkFwb2xsbyBzZXJ2ZXIgc3RhcnRlZFwiKTtcclxufSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coYPCfmoAgU2VydmVyIEVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xyXG59KSJdfQ==","map":{"version":3,"sources":["index.js"],"names":["client","require","dotenv","config","app","startApolloServer","server","ApolloServer","schema","playground","introspection","tracing","path","context","req","user","headers","phoneVerification","phoneverification","accessToken","authorization","use","validateToken","start","applyMiddleware","cors","listen","port","process","env","PORT","console","log","then","catch","err","message"],"mappings":";;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,MAAM,GAAGC,OAAO,CAAC,uBAAD,CAAtB;;AAEAC,gBAAOC,MAAP;;AACA,MAAMC,GAAG,GAAG,uBAAZ;;AAEA,eAAeC,iBAAf,GAAmC;AAC/B,QAAMC,MAAM,GAAG,IAAIC,iCAAJ,CAAiB;AAC5BC,IAAAA,MAAM,EAANA,gBAD4B;AAE5BC,IAAAA,UAAU,EAAE,IAFgB;AAG5BC,IAAAA,aAAa,EAAE,IAHa;AAI5BC,IAAAA,OAAO,EAAE,IAJmB;AAK5BC,IAAAA,IAAI,EAAE,GALsB;AAM5BC,IAAAA,OAAO,EAAE,CAAC;AAACC,MAAAA;AAAD,KAAD,KAAW;AAChB,aAAO;AACHC,QAAAA,IAAI,EAAED,GAAG,CAACE,OAAJ,CAAYD,IADf;AAEHC,QAAAA,OAAO,EAAEF,GAAG,CAACE,OAFV;AAGHC,QAAAA,iBAAiB,EAAEH,GAAG,CAACE,OAAJ,CAAYE,iBAAZ,IAAiC,EAHjD;AAIH;AACAC,QAAAA,WAAW,EAAEL,GAAG,CAACE,OAAJ,CAAYI,aAAZ,IAA6B;AALvC,OAAP;AAOH;AAd2B,GAAjB,CAAf;AAiBAhB,EAAAA,GAAG,CAACiB,GAAJ,CAAQC,sBAAR;AAEA,QAAMhB,MAAM,CAACiB,KAAP,EAAN;AAEAjB,EAAAA,MAAM,CAACkB,eAAP,CAAuB;AACnBpB,IAAAA,GADmB;AAEnBQ,IAAAA,IAAI,EAAE,GAFa;AAGnBa,IAAAA,IAAI,EAAE;AAHa,GAAvB;AAMArB,EAAAA,GAAG,CAACsB,MAAJ,CAAW;AAACC,IAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYC;AAAnB,GAAX,EAAqC,MAAM;AACvCC,IAAAA,OAAO,CAACC,GAAR,CAAa,+BAA8BJ,OAAO,CAACC,GAAR,CAAYC,IAAK,EAA5D;AACH,GAFD;AAGH;;AAEDzB,iBAAiB,GAAG4B,IAApB,CAAyB,MAAM;AAC3BF,EAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AACH,CAFD,EAEGE,KAFH,CAEUC,GAAD,IAAS;AACdJ,EAAAA,OAAO,CAACC,GAAR,CAAa,oBAAmBG,GAAG,CAACC,OAAQ,EAA5C;AACH,CAJD","sourceRoot":"E:\\haleta-new-api\\src\\","sourcesContent":["import dotenv from \"dotenv\";\r\nimport express from \"express\";\r\nimport {ApolloServer} from \"apollo-server-express\";\r\nimport schema from \"./graphql\";\r\nimport validateToken from \"./middlewares/auth/validate-token\";\r\nimport \"./config/mongodb-config\";\r\n\r\nconst client = require(\"./config/redis-config\");\r\n\r\ndotenv.config();\r\nconst app = express();\r\n\r\nasync function startApolloServer() {\r\n    const server = new ApolloServer({\r\n        schema,\r\n        playground: true,\r\n        introspection: true,\r\n        tracing: true,\r\n        path: \"/\",\r\n        context: ({req}) => {\r\n            return {\r\n                user: req.headers.user,\r\n                headers: req.headers,\r\n                phoneVerification: req.headers.phoneverification || \"\",\r\n                // context: { client },\r\n                accessToken: req.headers.authorization || \"\"\r\n            };\r\n        },\r\n    });\r\n\r\n    app.use(validateToken)\r\n\r\n    await server.start();\r\n\r\n    server.applyMiddleware({\r\n        app,\r\n        path: \"/\",\r\n        cors: \"no-cors\",\r\n    });\r\n\r\n    app.listen({port: process.env.PORT}, () => {\r\n        console.log(`ðŸš€ Server listening on port ${process.env.PORT}`);\r\n    });\r\n}\r\n\r\nstartApolloServer().then(() => {\r\n    console.log(\"Apollo server started\");\r\n}).catch((err) => {\r\n    console.log(`ðŸš€ Server Error: ${err.message}`);\r\n})"]}},"mtime":1648763898292},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _graphqlCompose = require(\"graphql-compose\");\n\nvar _auth = require(\"./auth\");\n\nvar _user = require(\"./user\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst schemaComposer = new _graphqlCompose.SchemaComposer();\nschemaComposer.Query.addFields(_objectSpread({}, _user.UserQuery));\nschemaComposer.Mutation.addFields(_objectSpread(_objectSpread({}, _auth.AuthMutation), _user.UserMutation));\nconst schema = schemaComposer.buildSchema();\nvar _default = schema;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInNjaGVtYUNvbXBvc2VyIiwiU2NoZW1hQ29tcG9zZXIiLCJRdWVyeSIsImFkZEZpZWxkcyIsIlVzZXJRdWVyeSIsIk11dGF0aW9uIiwiQXV0aE11dGF0aW9uIiwiVXNlck11dGF0aW9uIiwic2NoZW1hIiwiYnVpbGRTY2hlbWEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFFQSxNQUFNQSxjQUFjLEdBQUcsSUFBSUMsOEJBQUosRUFBdkI7QUFFQUQsY0FBYyxDQUFDRSxLQUFmLENBQXFCQyxTQUFyQixtQkFDT0MsZUFEUDtBQUlBSixjQUFjLENBQUNLLFFBQWYsQ0FBd0JGLFNBQXhCLGlDQUNPRyxrQkFEUCxHQUVPQyxrQkFGUDtBQUtBLE1BQU1DLE1BQU0sR0FBR1IsY0FBYyxDQUFDUyxXQUFmLEVBQWY7ZUFDZUQsTSIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtTY2hlbWFDb21wb3Nlcn0gZnJvbSBcImdyYXBocWwtY29tcG9zZVwiO1xyXG5pbXBvcnQge0F1dGhNdXRhdGlvbn0gZnJvbSBcIi4vYXV0aFwiO1xyXG5pbXBvcnQge1VzZXJNdXRhdGlvbiwgVXNlclF1ZXJ5fSBmcm9tIFwiLi91c2VyXCI7XHJcblxyXG5jb25zdCBzY2hlbWFDb21wb3NlciA9IG5ldyBTY2hlbWFDb21wb3NlcigpO1xyXG5cclxuc2NoZW1hQ29tcG9zZXIuUXVlcnkuYWRkRmllbGRzKHtcclxuICAgIC4uLlVzZXJRdWVyeSxcclxufSk7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5NdXRhdGlvbi5hZGRGaWVsZHMoe1xyXG4gICAgLi4uQXV0aE11dGF0aW9uLFxyXG4gICAgLi4uVXNlck11dGF0aW9uLFxyXG59KTtcclxuXHJcbmNvbnN0IHNjaGVtYSA9IHNjaGVtYUNvbXBvc2VyLmJ1aWxkU2NoZW1hKCk7XHJcbmV4cG9ydCBkZWZhdWx0IHNjaGVtYTtcclxuIl19","map":{"version":3,"sources":["index.js"],"names":["schemaComposer","SchemaComposer","Query","addFields","UserQuery","Mutation","AuthMutation","UserMutation","schema","buildSchema"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,cAAc,GAAG,IAAIC,8BAAJ,EAAvB;AAEAD,cAAc,CAACE,KAAf,CAAqBC,SAArB,mBACOC,eADP;AAIAJ,cAAc,CAACK,QAAf,CAAwBF,SAAxB,iCACOG,kBADP,GAEOC,kBAFP;AAKA,MAAMC,MAAM,GAAGR,cAAc,CAACS,WAAf,EAAf;eACeD,M","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\","sourcesContent":["import {SchemaComposer} from \"graphql-compose\";\r\nimport {AuthMutation} from \"./auth\";\r\nimport {UserMutation, UserQuery} from \"./user\";\r\n\r\nconst schemaComposer = new SchemaComposer();\r\n\r\nschemaComposer.Query.addFields({\r\n    ...UserQuery,\r\n});\r\n\r\nschemaComposer.Mutation.addFields({\r\n    ...AuthMutation,\r\n    ...UserMutation,\r\n});\r\n\r\nconst schema = schemaComposer.buildSchema();\r\nexport default schema;\r\n"]}},"mtime":1648684433887},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuthMutation = void 0;\n\nvar _user = require(\"../../models/user\");\n\nvar _middlewares = require(\"../../middlewares\");\n\nvar _authResolvers = _interopRequireDefault(require(\"./resolvers/auth-resolvers\"));\n\nrequire(\"./typedefs/types\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfor (const resolver in _authResolvers.default) {\n  _user.UserTC.addResolver(_authResolvers.default[resolver]);\n}\n\nconst AuthMutation = {\n  signIn: _user.UserTC.getResolver(\"signIn\", [_middlewares.authentication.isGuest, _middlewares.userValidator.signIn]),\n  signUp: _user.UserTC.getResolver(\"signUp\", [_middlewares.authentication.isGuest, _middlewares.userValidator.signUp]),\n  logout: _user.UserTC.getResolver('logout', [_middlewares.authentication.isAuth]),\n  // resetPassword: UserTC.getResolver(\"resetPassword\", [middleware.isGuest, validators.resetPassword]),\n  // newPassword: UserTC.getResolver(\"newPassword\", [middleware.isGuest, validators.newPassword]),\n  changePassword: _user.UserTC.getResolver(\"changePassword\", [_middlewares.authentication.isAuth, _middlewares.userValidator.changePassword])\n};\nexports.AuthMutation = AuthMutation;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInJlc29sdmVyIiwiUmVzb2x2ZXJzIiwiVXNlclRDIiwiYWRkUmVzb2x2ZXIiLCJBdXRoTXV0YXRpb24iLCJzaWduSW4iLCJnZXRSZXNvbHZlciIsImF1dGhlbnRpY2F0aW9uIiwiaXNHdWVzdCIsInVzZXJWYWxpZGF0b3IiLCJzaWduVXAiLCJsb2dvdXQiLCJpc0F1dGgiLCJjaGFuZ2VQYXNzd29yZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOztBQUVBOztBQUVBOzs7O0FBRUEsS0FBSyxNQUFNQSxRQUFYLElBQXVCQyxzQkFBdkIsRUFBa0M7QUFDOUJDLGVBQU9DLFdBQVAsQ0FBbUJGLHVCQUFVRCxRQUFWLENBQW5CO0FBQ0g7O0FBRUQsTUFBTUksWUFBWSxHQUFHO0FBQ2pCQyxFQUFBQSxNQUFNLEVBQUVILGFBQU9JLFdBQVAsQ0FBbUIsUUFBbkIsRUFBNkIsQ0FBQ0MsNEJBQWVDLE9BQWhCLEVBQXlCQywyQkFBY0osTUFBdkMsQ0FBN0IsQ0FEUztBQUVqQkssRUFBQUEsTUFBTSxFQUFFUixhQUFPSSxXQUFQLENBQW1CLFFBQW5CLEVBQTZCLENBQUNDLDRCQUFlQyxPQUFoQixFQUF5QkMsMkJBQWNDLE1BQXZDLENBQTdCLENBRlM7QUFHakJDLEVBQUFBLE1BQU0sRUFBRVQsYUFBT0ksV0FBUCxDQUFtQixRQUFuQixFQUE2QixDQUFDQyw0QkFBZUssTUFBaEIsQ0FBN0IsQ0FIUztBQUlqQjtBQUNBO0FBQ0FDLEVBQUFBLGNBQWMsRUFBRVgsYUFBT0ksV0FBUCxDQUFtQixnQkFBbkIsRUFBcUMsQ0FBQ0MsNEJBQWVLLE1BQWhCLEVBQXdCSCwyQkFBY0ksY0FBdEMsQ0FBckM7QUFOQyxDQUFyQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtVc2VyVEN9IGZyb20gXCIuLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5cclxuaW1wb3J0IHsgYXV0aGVudGljYXRpb24sIHVzZXJWYWxpZGF0b3IgfSBmcm9tIFwiLi4vLi4vbWlkZGxld2FyZXNcIjtcclxuXHJcbmltcG9ydCBSZXNvbHZlcnMgZnJvbSBcIi4vcmVzb2x2ZXJzL2F1dGgtcmVzb2x2ZXJzXCI7XHJcblxyXG5pbXBvcnQgXCIuL3R5cGVkZWZzL3R5cGVzXCJcclxuXHJcbmZvciAoY29uc3QgcmVzb2x2ZXIgaW4gUmVzb2x2ZXJzKSB7XHJcbiAgICBVc2VyVEMuYWRkUmVzb2x2ZXIoUmVzb2x2ZXJzW3Jlc29sdmVyXSk7XHJcbn1cclxuXHJcbmNvbnN0IEF1dGhNdXRhdGlvbiA9IHtcclxuICAgIHNpZ25JbjogVXNlclRDLmdldFJlc29sdmVyKFwic2lnbkluXCIsIFthdXRoZW50aWNhdGlvbi5pc0d1ZXN0LCB1c2VyVmFsaWRhdG9yLnNpZ25Jbl0pLFxyXG4gICAgc2lnblVwOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJzaWduVXBcIiwgW2F1dGhlbnRpY2F0aW9uLmlzR3Vlc3QsIHVzZXJWYWxpZGF0b3Iuc2lnblVwXSksXHJcbiAgICBsb2dvdXQ6IFVzZXJUQy5nZXRSZXNvbHZlcignbG9nb3V0JywgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aF0pLFxyXG4gICAgLy8gcmVzZXRQYXNzd29yZDogVXNlclRDLmdldFJlc29sdmVyKFwicmVzZXRQYXNzd29yZFwiLCBbbWlkZGxld2FyZS5pc0d1ZXN0LCB2YWxpZGF0b3JzLnJlc2V0UGFzc3dvcmRdKSxcclxuICAgIC8vIG5ld1Bhc3N3b3JkOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJuZXdQYXNzd29yZFwiLCBbbWlkZGxld2FyZS5pc0d1ZXN0LCB2YWxpZGF0b3JzLm5ld1Bhc3N3b3JkXSksXHJcbiAgICBjaGFuZ2VQYXNzd29yZDogVXNlclRDLmdldFJlc29sdmVyKFwiY2hhbmdlUGFzc3dvcmRcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgdXNlclZhbGlkYXRvci5jaGFuZ2VQYXNzd29yZF0pLFxyXG59O1xyXG5cclxuZXhwb3J0IHtBdXRoTXV0YXRpb259O1xyXG4iXX0=","map":{"version":3,"sources":["index.js"],"names":["resolver","Resolvers","UserTC","addResolver","AuthMutation","signIn","getResolver","authentication","isGuest","userValidator","signUp","logout","isAuth","changePassword"],"mappings":";;;;;;;AAAA;;AAEA;;AAEA;;AAEA;;;;AAEA,KAAK,MAAMA,QAAX,IAAuBC,sBAAvB,EAAkC;AAC9BC,eAAOC,WAAP,CAAmBF,uBAAUD,QAAV,CAAnB;AACH;;AAED,MAAMI,YAAY,GAAG;AACjBC,EAAAA,MAAM,EAAEH,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeC,OAAhB,EAAyBC,2BAAcJ,MAAvC,CAA7B,CADS;AAEjBK,EAAAA,MAAM,EAAER,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeC,OAAhB,EAAyBC,2BAAcC,MAAvC,CAA7B,CAFS;AAGjBC,EAAAA,MAAM,EAAET,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeK,MAAhB,CAA7B,CAHS;AAIjB;AACA;AACAC,EAAAA,cAAc,EAAEX,aAAOI,WAAP,CAAmB,gBAAnB,EAAqC,CAACC,4BAAeK,MAAhB,EAAwBH,2BAAcI,cAAtC,CAArC;AANC,CAArB","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\","sourcesContent":["import {UserTC} from \"../../models/user\";\r\n\r\nimport { authentication, userValidator } from \"../../middlewares\";\r\n\r\nimport Resolvers from \"./resolvers/auth-resolvers\";\r\n\r\nimport \"./typedefs/types\"\r\n\r\nfor (const resolver in Resolvers) {\r\n    UserTC.addResolver(Resolvers[resolver]);\r\n}\r\n\r\nconst AuthMutation = {\r\n    signIn: UserTC.getResolver(\"signIn\", [authentication.isGuest, userValidator.signIn]),\r\n    signUp: UserTC.getResolver(\"signUp\", [authentication.isGuest, userValidator.signUp]),\r\n    logout: UserTC.getResolver('logout', [authentication.isAuth]),\r\n    // resetPassword: UserTC.getResolver(\"resetPassword\", [middleware.isGuest, validators.resetPassword]),\r\n    // newPassword: UserTC.getResolver(\"newPassword\", [middleware.isGuest, validators.newPassword]),\r\n    changePassword: UserTC.getResolver(\"changePassword\", [authentication.isAuth, userValidator.changePassword]),\r\n};\r\n\r\nexport {AuthMutation};\r\n"]}},"mtime":1648755864085},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\user.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserTC = exports.UserSchema = exports.UserModel = void 0;\n\nvar _mongoose = _interopRequireWildcard(require(\"mongoose\"));\n\nvar _mongooseTimestamp = _interopRequireDefault(require(\"mongoose-timestamp\"));\n\nvar _graphqlComposeMongoose = require(\"graphql-compose-mongoose\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nconst UserSchema = new _mongoose.Schema({\n  firstName: String,\n  middleName: String,\n  lastName: String,\n  email: String,\n  phoneNumber: String,\n  image: String,\n  firebaseId: String,\n  password: String,\n  status: {\n    type: String,\n    default: \"ACTIVE\",\n    enum: [\"ACTIVE\", \"BLOCKED\"]\n  },\n  roles: {\n    type: String,\n    default: \"NORMAL\",\n    enum: [\"NORMAL\", \"OWNER\", \"ADMIN\", \"SALES\"]\n  },\n  account: {\n    verification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    emailVerification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    phoneVerification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    resetPassword: {\n      token: String,\n      expiresIn: Date\n    }\n  }\n}, {\n  collection: \"users\"\n});\nexports.UserSchema = UserSchema;\nUserSchema.plugin(_mongooseTimestamp.default);\nUserSchema.index({\n  createdAt: 1,\n  updatedAt: 1\n});\n\nUserSchema.statics.emailExist = function (email) {\n  return this.findOne({\n    email\n  });\n};\n\nUserSchema.statics.phoneNumberExist = function (phoneNumber) {\n  return this.findOne({\n    phoneNumber\n  });\n};\n\nUserSchema.methods.comparePassword = function (password) {\n  return bcrypt.compareSync(password, this.password);\n};\n\nconst UserModel = _mongoose.default.model(\"User\", UserSchema);\n\nexports.UserModel = UserModel;\nconst UserTC = (0, _graphqlComposeMongoose.composeWithMongoose)(UserModel); // const UserTC = composeWithMongoose(UserModel).removeField('password');\n\nexports.UserTC = UserTC;\nconst UserAccountTC = UserTC.getFieldTC(\"account\");\nUserAccountTC.getFieldTC(\"verification\").removeField([\"token\", \"expiresIn\"]); // UserAccountTC.removeField('resetPassword');\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsiVXNlclNjaGVtYSIsIlNjaGVtYSIsImZpcnN0TmFtZSIsIlN0cmluZyIsIm1pZGRsZU5hbWUiLCJsYXN0TmFtZSIsImVtYWlsIiwicGhvbmVOdW1iZXIiLCJpbWFnZSIsImZpcmViYXNlSWQiLCJwYXNzd29yZCIsInN0YXR1cyIsInR5cGUiLCJkZWZhdWx0IiwiZW51bSIsInJvbGVzIiwiYWNjb3VudCIsInZlcmlmaWNhdGlvbiIsInZlcmlmaWVkIiwiQm9vbGVhbiIsInRva2VuIiwiZXhwaXJlc0luIiwiRGF0ZSIsImVtYWlsVmVyaWZpY2F0aW9uIiwicGhvbmVWZXJpZmljYXRpb24iLCJyZXNldFBhc3N3b3JkIiwiY29sbGVjdGlvbiIsInBsdWdpbiIsInRpbWVzdGFtcHMiLCJpbmRleCIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInN0YXRpY3MiLCJlbWFpbEV4aXN0IiwiZmluZE9uZSIsInBob25lTnVtYmVyRXhpc3QiLCJtZXRob2RzIiwiY29tcGFyZVBhc3N3b3JkIiwiYmNyeXB0IiwiY29tcGFyZVN5bmMiLCJVc2VyTW9kZWwiLCJtb25nb29zZSIsIm1vZGVsIiwiVXNlclRDIiwiVXNlckFjY291bnRUQyIsImdldEZpZWxkVEMiLCJyZW1vdmVGaWVsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLE1BQU1BLFVBQVUsR0FBRyxJQUFJQyxnQkFBSixDQUFXO0FBQzFCQyxFQUFBQSxTQUFTLEVBQUVDLE1BRGU7QUFFMUJDLEVBQUFBLFVBQVUsRUFBRUQsTUFGYztBQUcxQkUsRUFBQUEsUUFBUSxFQUFFRixNQUhnQjtBQUkxQkcsRUFBQUEsS0FBSyxFQUFFSCxNQUptQjtBQUsxQkksRUFBQUEsV0FBVyxFQUFFSixNQUxhO0FBTTFCSyxFQUFBQSxLQUFLLEVBQUVMLE1BTm1CO0FBTzFCTSxFQUFBQSxVQUFVLEVBQUVOLE1BUGM7QUFRMUJPLEVBQUFBLFFBQVEsRUFBRVAs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Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlLCB7U2NoZW1hfSBmcm9tIFwibW9uZ29vc2VcIjtcclxuaW1wb3J0IHRpbWVzdGFtcHMgZnJvbSBcIm1vbmdvb3NlLXRpbWVzdGFtcFwiO1xyXG5pbXBvcnQge2NvbXBvc2VXaXRoTW9uZ29vc2V9IGZyb20gXCJncmFwaHFsLWNvbXBvc2UtbW9uZ29vc2VcIjtcclxuXHJcbmNvbnN0IFVzZXJTY2hlbWEgPSBuZXcgU2NoZW1hKHtcclxuICAgIGZpcnN0TmFtZTogU3RyaW5nLFxyXG4gICAgbWlkZGxlTmFtZTogU3RyaW5nLFxyXG4gICAgbGFzdE5hbWU6IFN0cmluZyxcclxuICAgIGVtYWlsOiBTdHJpbmcsXHJcbiAgICBwaG9uZU51bWJlcjogU3RyaW5nLFxyXG4gICAgaW1hZ2U6IFN0cmluZyxcclxuICAgIGZpcmViYXNlSWQ6IFN0cmluZyxcclxuICAgIHBhc3N3b3JkOiBTdHJpbmcsXHJcbiAgICBzdGF0dXM6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZGVmYXVsdDogXCJBQ1RJVkVcIixcclxuICAgICAgICBlbnVtOiBbXCJBQ1RJVkVcIiwgXCJCTE9DS0VEXCJdLFxyXG4gICAgfSxcclxuICAgIHJvbGVzOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIGRlZmF1bHQ6IFwiTk9STUFMXCIsXHJcbiAgICAgICAgZW51bTogW1wiTk9STUFMXCIsIFwiT1dORVJcIiwgXCJBRE1JTlwiLCBcIlNBTEVTXCJdLFxyXG4gICAgfSxcclxuICAgIGFjY291bnQ6IHtcclxuICAgICAgICB2ZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW1haWxWZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcGhvbmVWZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVzZXRQYXNzd29yZDoge1xyXG4gICAgICAgICAgICB0b2tlbjogU3RyaW5nLFxyXG4gICAgICAgICAgICBleHBpcmVzSW46IERhdGUsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcbn0sIHtcclxuICAgIGNvbGxlY3Rpb246IFwidXNlcnNcIixcclxufSk7XHJcblxyXG5Vc2VyU2NoZW1hLnBsdWdpbih0aW1lc3RhbXBzKTtcclxuVXNlclNjaGVtYS5pbmRleCh7XHJcbiAgICBjcmVhdGVkQXQ6IDEsXHJcbiAgICB1cGRhdGVkQXQ6IDEsXHJcbn0pO1xyXG5cclxuVXNlclNjaGVtYS5zdGF0aWNzLmVtYWlsRXhpc3QgPSBmdW5jdGlvbiAoZW1haWwpIHtcclxuICAgIHJldHVybiB0aGlzLmZpbmRPbmUoe2VtYWlsfSk7XHJcbn07XHJcblxyXG5Vc2VyU2NoZW1hLnN0YXRpY3MucGhvbmVOdW1iZXJFeGlzdCA9IGZ1bmN0aW9uIChwaG9uZU51bWJlcikge1xyXG4gICAgcmV0dXJuIHRoaXMuZmluZE9uZSh7cGhvbmVOdW1iZXJ9KTtcclxufTtcclxuXHJcblVzZXJTY2hlbWEubWV0aG9kcy5jb21wYXJlUGFzc3dvcmQgPSBmdW5jdGlvbiAocGFzc3dvcmQpIHtcclxuICAgIHJldHVybiBiY3J5cHQuY29tcGFyZVN5bmMocGFzc3dvcmQsIHRoaXMucGFzc3dvcmQpO1xyXG59O1xyXG5cclxuY29uc3QgVXNlck1vZGVsID0gbW9uZ29vc2UubW9kZWwoXCJVc2VyXCIsIFVzZXJTY2hlbWEpO1xyXG5jb25zdCBVc2VyVEMgPSBjb21wb3NlV2l0aE1vbmdvb3NlKFVzZXJNb2RlbCk7XHJcbi8vIGNvbnN0IFVzZXJUQyA9IGNvbXBvc2VXaXRoTW9uZ29vc2UoVXNlck1vZGVsKS5yZW1vdmVGaWVsZCgncGFzc3dvcmQnKTtcclxuXHJcbmNvbnN0IFVzZXJBY2NvdW50VEMgPSBVc2VyVEMuZ2V0RmllbGRUQyhcImFjY291bnRcIik7XHJcblxyXG5Vc2VyQWNjb3VudFRDLmdldEZpZWxkVEMoXCJ2ZXJpZmljYXRpb25cIikucmVtb3ZlRmllbGQoW1widG9rZW5cIiwgXCJleHBpcmVzSW5cIl0pO1xyXG5cclxuLy8gVXNlckFjY291bnRUQy5yZW1vdmVGaWVsZCgncmVzZXRQYXNzd29yZCcpO1xyXG5cclxuZXhwb3J0IHtVc2VyTW9kZWwsIFVzZXJUQywgVXNlclNjaGVtYX07XHJcbiJdfQ==","map":{"version":3,"sources":["user.js"],"names":["UserSchema","Schema","firstName","String","middleName","lastName","email","phoneNumber","image","firebaseId","password","status","type","default","enum","roles","account","verification","verified","Boolean","token","expiresIn","Date","emailVerification","phoneVerification","resetPassword","collection","plugin","timestamps","index","createdAt","updatedAt","statics","emailExist","findOne","phoneNumberExist","methods","comparePassword","bcrypt","compareSync","UserModel","mongoose","model","UserTC","UserAccountTC","getFieldTC","removeField"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\models\\","sourcesContent":["import mongoose, {Schema} from \"mongoose\";\r\nimport timestamps from \"mongoose-timestamp\";\r\nimport {composeWithMongoose} from \"graphql-compose-mongoose\";\r\n\r\nconst UserSchema = new Schema({\r\n    firstName: String,\r\n    middleName: String,\r\n    lastName: String,\r\n    email: String,\r\n    phoneNumber: String,\r\n    image: String,\r\n    firebaseId: String,\r\n    password: String,\r\n    status: {\r\n        type: String,\r\n        default: \"ACTIVE\",\r\n        enum: [\"ACTIVE\", \"BLOCKED\"],\r\n    },\r\n    roles: {\r\n        type: String,\r\n        default: \"NORMAL\",\r\n        enum: [\"NORMAL\", \"OWNER\", \"ADMIN\", \"SALES\"],\r\n    },\r\n    account: {\r\n        verification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        emailVerification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        phoneVerification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        resetPassword: {\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n    },\r\n}, {\r\n    collection: \"users\",\r\n});\r\n\r\nUserSchema.plugin(timestamps);\r\nUserSchema.index({\r\n    createdAt: 1,\r\n    updatedAt: 1,\r\n});\r\n\r\nUserSchema.statics.emailExist = function (email) {\r\n    return this.findOne({email});\r\n};\r\n\r\nUserSchema.statics.phoneNumberExist = function (phoneNumber) {\r\n    return this.findOne({phoneNumber});\r\n};\r\n\r\nUserSchema.methods.comparePassword = function (password) {\r\n    return bcrypt.compareSync(password, this.password);\r\n};\r\n\r\nconst UserModel = mongoose.model(\"User\", UserSchema);\r\nconst UserTC = composeWithMongoose(UserModel);\r\n// const UserTC = composeWithMongoose(UserModel).removeField('password');\r\n\r\nconst UserAccountTC = UserTC.getFieldTC(\"account\");\r\n\r\nUserAccountTC.getFieldTC(\"verification\").removeField([\"token\", \"expiresIn\"]);\r\n\r\n// UserAccountTC.removeField('resetPassword');\r\n\r\nexport {UserModel, UserTC, UserSchema};\r\n"]}},"mtime":1648684433894},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"authentication\", {\n  enumerable: true,\n  get: function () {\n    return _authentication.default;\n  }\n});\nObject.defineProperty(exports, \"authorization\", {\n  enumerable: true,\n  get: function () {\n    return _authorization.default;\n  }\n});\nObject.defineProperty(exports, \"phoneVerification\", {\n  enumerable: true,\n  get: function () {\n    return _phoneVerification.default;\n  }\n});\nObject.defineProperty(exports, \"userValidator\", {\n  enumerable: true,\n  get: function () {\n    return _userValidator.default;\n  }\n});\nObject.defineProperty(exports, \"validateToken\", {\n  enumerable: true,\n  get: function () {\n    return _validateToken.default;\n  }\n});\n\nvar _authentication = _interopRequireDefault(require(\"./auth/authentication\"));\n\nvar _authorization = _interopRequireDefault(require(\"./auth/authorization\"));\n\nvar _validateToken = _interopRequireDefault(require(\"./auth/validate-token\"));\n\nvar _phoneVerification = _interopRequireDefault(require(\"./auth/phone-verification\"));\n\nvar _userValidator = _interopRequireDefault(require(\"./validators/user-validator\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF1dGhlbnRpY2F0aW9uIGZyb20gXCIuL2F1dGgvYXV0aGVudGljYXRpb25cIlxyXG5pbXBvcnQgYXV0aG9yaXphdGlvbiBmcm9tIFwiLi9hdXRoL2F1dGhvcml6YXRpb25cIlxyXG5pbXBvcnQgdmFsaWRhdGVUb2tlbiBmcm9tIFwiLi9hdXRoL3ZhbGlkYXRlLXRva2VuXCJcclxuaW1wb3J0IHBob25lVmVyaWZpY2F0aW9uIGZyb20gXCIuL2F1dGgvcGhvbmUtdmVyaWZpY2F0aW9uXCJcclxuaW1wb3J0IHVzZXJWYWxpZGF0b3IgZnJvbSBcIi4vdmFsaWRhdG9ycy91c2VyLXZhbGlkYXRvclwiO1xyXG5cclxuZXhwb3J0IHtcclxuICAgIGF1dGhlbnRpY2F0aW9uLFxyXG4gICAgYXV0aG9yaXphdGlvbixcclxuICAgIHZhbGlkYXRlVG9rZW4sXHJcbiAgICBwaG9uZVZlcmlmaWNhdGlvbixcclxuICAgIHVzZXJWYWxpZGF0b3IsXHJcbn0iXX0=","map":{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\","sourcesContent":["import authentication from \"./auth/authentication\"\r\nimport authorization from \"./auth/authorization\"\r\nimport validateToken from \"./auth/validate-token\"\r\nimport phoneVerification from \"./auth/phone-verification\"\r\nimport userValidator from \"./validators/user-validator\";\r\n\r\nexport {\r\n    authentication,\r\n    authorization,\r\n    validateToken,\r\n    phoneVerification,\r\n    userValidator,\r\n}"]}},"mtime":1648684433893},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\authentication.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nconst isAuth = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n\n  if (!user) {\n    return Promise.reject(new Error(\"You must be authorized.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nconst isGuest = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n\n  if (user) {\n    return Promise.reject(new Error(\"You have already authorized.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nvar _default = {\n  isAuth,\n  isGuest\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0aW9uLmpzIl0sIm5hbWVzIjpbImlzQXV0aCIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iLCJ1c2VyIiwiUHJvbWlzZSIsInJlamVjdCIsIkVycm9yIiwiaXNHdWVzdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLE1BQU1BLE1BQU0sR0FBRyxPQUFPQyxPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUMzRCxRQUFNO0FBQUNDLElBQUFBO0FBQUQsTUFBU0YsT0FBZjs7QUFDQSxNQUFJLENBQUNFLElBQUwsRUFBVztBQUNQLFdBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLElBQUlDLEtBQUosQ0FBVSx5QkFBVixDQUFmLENBQVA7QUFDSDs7QUFDRCxTQUFPUixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsQ0FORDs7QUFRQSxNQUFNSyxPQUFPLEdBQUcsT0FBT1QsT0FBUCxFQUFnQkMsTUFBaEIsRUFBd0JDLElBQXhCLEVBQThCQyxPQUE5QixFQUF1Q0MsSUFBdkMsS0FBZ0Q7QUFDNUQsUUFBTTtBQUFDQyxJQUFBQTtBQUFELE1BQVNGLE9BQWY7O0FBQ0EsTUFBSUUsSUFBSixFQUFVO0FBQ04sV0FBT0MsT0FBTyxDQUFDQyxNQUFSLENBQWUsSUFBSUMsS0FBSixDQUFVLDhCQUFWLENBQWYsQ0FBUDtBQUNIOztBQUNELFNBQU9SLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxDQU5EOztlQVFlO0FBQUNMLEVBQUFBLE1BQUQ7QUFBU1UsRUFBQUE7QUFBVCxDIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaXNBdXRoID0gYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgY29uc3Qge3VzZXJ9ID0gY29udGV4dDtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJZb3UgbXVzdCBiZSBhdXRob3JpemVkLlwiKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzb2x2ZShzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pO1xyXG59O1xyXG5cclxuY29uc3QgaXNHdWVzdCA9IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgIGNvbnN0IHt1c2VyfSA9IGNvbnRleHQ7XHJcbiAgICBpZiAodXNlcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJZb3UgaGF2ZSBhbHJlYWR5IGF1dGhvcml6ZWQuXCIpKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7aXNBdXRoLCBpc0d1ZXN0fTtcclxuIl19","map":{"version":3,"sources":["authentication.js"],"names":["isAuth","resolve","source","args","context","info","user","Promise","reject","Error","isGuest"],"mappings":";;;;;;;AAAA,MAAMA,MAAM,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC3D,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;;AACA,MAAI,CAACE,IAAL,EAAW;AACP,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,yBAAV,CAAf,CAAP;AACH;;AACD,SAAOR,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAND;;AAQA,MAAMK,OAAO,GAAG,OAAOT,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC5D,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;;AACA,MAAIE,IAAJ,EAAU;AACN,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,8BAAV,CAAf,CAAP;AACH;;AACD,SAAOR,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAND;;eAQe;AAACL,EAAAA,MAAD;AAASU,EAAAA;AAAT,C","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["const isAuth = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    if (!user) {\r\n        return Promise.reject(new Error(\"You must be authorized.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nconst isGuest = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    if (user) {\r\n        return Promise.reject(new Error(\"You have already authorized.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nexport default {isAuth, isGuest};\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\authorization.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n//list from redis, list of functions for each role\nconst accessList = {\n  ADMIN: [\"findMany\", \"createOne\"],\n  SUPER_ADMIN: [\"findMany\", \"createOne\"],\n  NORMAL: [],\n  TUTOR: [],\n  CUSTOMER_SERVICE: []\n};\n\nconst authorization = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n  const fieldName = info.fieldName;\n  let hasAccess = false; //list from redis, list of functions for each role\n\n  user.roles.forEach(role => {\n    if (accessList[role].includes(fieldName)) {\n      hasAccess = true;\n    }\n  });\n\n  if (!hasAccess) {\n    return Promise.reject(new Error(\"Access denied.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nvar _default = authorization;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6YXRpb24uanMiXSwibmFtZXMiOlsiYWNjZXNzTGlzdCIsIkFETUlOIiwiU1VQRVJfQURNSU4iLCJOT1JNQUwiLCJUVVRPUiIsIkNVU1RPTUVSX1NFUlZJQ0UiLCJhdXRob3JpemF0aW9uIiwicmVzb2x2ZSIsInNvdXJjZSIsImFyZ3MiLCJjb250ZXh0IiwiaW5mbyIsInVzZXIiLCJmaWVsZE5hbWUiLCJoYXNBY2Nlc3MiLCJyb2xlcyIsImZvckVhY2giLCJyb2xlIiwiaW5jbHVkZXMiLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0EsTUFBTUEsVUFBVSxHQUFHO0FBQ2ZDLEVBQUFBLEtBQUssRUFBRSxDQUFDLFVBQUQsRUFBYSxXQUFiLENBRFE7QUFFZkMsRUFBQUEsV0FBVyxFQUFFLENBQUMsVUFBRCxFQUFhLFdBQWIsQ0FGRTtBQUdmQyxFQUFBQSxNQUFNLEVBQUUsRUFITztBQUlmQyxFQUFBQSxLQUFLLEVBQUUsRUFKUTtBQUtmQyxFQUFBQSxnQkFBZ0IsRUFBRTtBQUxILENBQW5COztBQVFBLE1BQU1DLGFBQWEsR0FBRyxPQUFPQyxPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUNsRSxRQUFNO0FBQUNDLElBQUFBO0FBQUQsTUFBU0YsT0FBZjtBQUNBLFFBQU1HLFNBQVMsR0FBR0YsSUFBSSxDQUFDRSxTQUF2QjtBQUNBLE1BQUlDLFNBQVMsR0FBRyxLQUFoQixDQUhrRSxDQUlsRTs7QUFDQUYsRUFBQUEsSUFBSSxDQUFDRyxLQUFMLENBQVdDLE9BQVgsQ0FBbUJDLElBQUksSUFBSTtBQUN2QixRQUFHakIsVUFBVSxDQUFDaUIsSUFBRCxDQUFWLENBQWlCQyxRQUFqQixDQUEwQkwsU0FBMUIsQ0FBSCxFQUF3QztBQUNwQ0MsTUFBQUEsU0FBUyxHQUFHLElBQVo7QUFDSDtBQUNKLEdBSkQ7O0FBS0EsTUFBSSxDQUFDQSxTQUFMLEVBQWdCO0FBQ1osV0FBT0ssT0FBTyxDQUFDQyxNQUFSLENBQWUsSUFBSUMsS0FBSixDQUFVLGdCQUFWLENBQWYsQ0FBUDtBQUNIOztBQUNELFNBQU9kLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxDQWREOztlQWdCZUwsYSIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbWlkZGxld2FyZXNcXGF1dGhcXCIsInNvdXJjZXNDb250ZW50IjpbIi8vbGlzdCBmcm9tIHJlZGlzLCBsaXN0IG9mIGZ1bmN0aW9ucyBmb3IgZWFjaCByb2xlXHJcbmNvbnN0IGFjY2Vzc0xpc3QgPSB7XHJcbiAgICBBRE1JTjogW1wiZmluZE1hbnlcIiwgXCJjcmVhdGVPbmVcIl0sXHJcbiAgICBTVVBFUl9BRE1JTjogW1wiZmluZE1hbnlcIiwgXCJjcmVhdGVPbmVcIl0sXHJcbiAgICBOT1JNQUw6IFtdLFxyXG4gICAgVFVUT1I6IFtdLFxyXG4gICAgQ1VTVE9NRVJfU0VSVklDRTogW10sXHJcbn07XHJcblxyXG5jb25zdCBhdXRob3JpemF0aW9uID0gYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgY29uc3Qge3VzZXJ9ID0gY29udGV4dDtcclxuICAgIGNvbnN0IGZpZWxkTmFtZSA9IGluZm8uZmllbGROYW1lXHJcbiAgICBsZXQgaGFzQWNjZXNzID0gZmFsc2VcclxuICAgIC8vbGlzdCBmcm9tIHJlZGlzLCBsaXN0IG9mIGZ1bmN0aW9ucyBmb3IgZWFjaCByb2xlXHJcbiAgICB1c2VyLnJvbGVzLmZvckVhY2gocm9sZSA9PiB7XHJcbiAgICAgICAgaWYoYWNjZXNzTGlzdFtyb2xlXS5pbmNsdWRlcyhmaWVsZE5hbWUpKXtcclxuICAgICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICBpZiAoIWhhc0FjY2Vzcykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJBY2Nlc3MgZGVuaWVkLlwiKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzb2x2ZShzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXV0aG9yaXphdGlvbjtcclxuIl19","map":{"version":3,"sources":["authorization.js"],"names":["accessList","ADMIN","SUPER_ADMIN","NORMAL","TUTOR","CUSTOMER_SERVICE","authorization","resolve","source","args","context","info","user","fieldName","hasAccess","roles","forEach","role","includes","Promise","reject","Error"],"mappings":";;;;;;AAAA;AACA,MAAMA,UAAU,GAAG;AACfC,EAAAA,KAAK,EAAE,CAAC,UAAD,EAAa,WAAb,CADQ;AAEfC,EAAAA,WAAW,EAAE,CAAC,UAAD,EAAa,WAAb,CAFE;AAGfC,EAAAA,MAAM,EAAE,EAHO;AAIfC,EAAAA,KAAK,EAAE,EAJQ;AAKfC,EAAAA,gBAAgB,EAAE;AALH,CAAnB;;AAQA,MAAMC,aAAa,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAClE,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;AACA,QAAMG,SAAS,GAAGF,IAAI,CAACE,SAAvB;AACA,MAAIC,SAAS,GAAG,KAAhB,CAHkE,CAIlE;;AACAF,EAAAA,IAAI,CAACG,KAAL,CAAWC,OAAX,CAAmBC,IAAI,IAAI;AACvB,QAAGjB,UAAU,CAACiB,IAAD,CAAV,CAAiBC,QAAjB,CAA0BL,SAA1B,CAAH,EAAwC;AACpCC,MAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,GAJD;;AAKA,MAAI,CAACA,SAAL,EAAgB;AACZ,WAAOK,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,gBAAV,CAAf,CAAP;AACH;;AACD,SAAOd,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAdD;;eAgBeL,a","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["//list from redis, list of functions for each role\r\nconst accessList = {\r\n    ADMIN: [\"findMany\", \"createOne\"],\r\n    SUPER_ADMIN: [\"findMany\", \"createOne\"],\r\n    NORMAL: [],\r\n    TUTOR: [],\r\n    CUSTOMER_SERVICE: [],\r\n};\r\n\r\nconst authorization = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    const fieldName = info.fieldName\r\n    let hasAccess = false\r\n    //list from redis, list of functions for each role\r\n    user.roles.forEach(role => {\r\n        if(accessList[role].includes(fieldName)){\r\n            hasAccess = true\r\n        }\r\n    })\r\n    if (!hasAccess) {\r\n        return Promise.reject(new Error(\"Access denied.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nexport default authorization;\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\validate-token.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../models/user\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import redis from \"../config/redis-config\";\nconst validateToken = async (req, res, next) => {\n  try {\n    const authorization = req.headers.authorization;\n    console.log(\"authorization: \", authorization);\n    Object.assign(req.headers, {\n      user: null,\n      authorization: null\n    });\n\n    if (!authorization) {\n      return next();\n    }\n\n    const accessToken = authorization.split(\" \")[1];\n    console.log(\"accessTocken: \", accessToken);\n    let decoded;\n\n    if (accessToken) {\n      decoded = _jsonwebtoken.default.verify(accessToken, process.env.JWT_SECRET);\n    }\n\n    if (!decoded) {\n      // invalid token, remove the token from everywhere\n      //remove from database\n      //remove from redis\n      return next();\n    }\n\n    if (decoded.exp * 1000 < Date.now()) {\n      //remove from database\n      //remove from redis\n      return next();\n    } //check if token is in redis\n    //if NOT in redis call next()\n    //else check last update time if greater than or equals to 1hour update the token\n    // if less skip else update token\n    // authorization = new token\n\n\n    const user = await _user.UserModel.findById(decoded.userId);\n\n    if (!user) {\n      //remove from database\n      //remove from redis\n      return next();\n    } // if the token has come all this way everything is good just attach it to the request header\n\n\n    Object.assign(req.headers, {\n      user,\n      authorization\n    });\n    return next();\n  } catch (error) {\n    console.log(error);\n    return Promise.reject(new Error(\"Error Happened!\"));\n  }\n};\n\nvar _default = validateToken; // ------------- authorization ------------------\n// let check_user_action = async (req,action,resource) =>{\n//   if(!['updateOwn','deleteOwn'].includes(action)){\n//     return true\n//   }\n//\n//   const userResource = new Set()\n//\n//   if(resource == 'tender'){\n//     let userTender = await Tender.find({ creator_user: req.user._id })\n//     userTender.forEach(tender => userResource.add(`${tender._id}`))\n//\n//   }else if(resource == 'company'){\n//     let userCompany = await Company.find({ creator_user: req.user._id })\n//     userCompany.forEach(company => userResource.add( `${company._id}`))\n//\n//   }else if(resource == 'award'){\n//     let userAward = await Award.find({ creator_user: req.user._id })\n//     userAward.forEach(award => userResource.add(`${award._id}`))\n//   }\n//\n//   if(!userResource.has(req.params.id)){\n//     return false\n//   }\n//\n//   return true\n// }\n//\n//\n//\n// exports.authorize = function (action, resource) {\n//   return async (req, res, next) => {\n//     try {\n//       const permission = roles.can(req.user.role)[action](resource);\n//\n//       if (!permission.granted) {\n//         return res.status(401).send(\"You don't have enough permission to perform this action\");\n//       }\n//\n//       let result = await check_user_action(req,action,resource)\n//       if(!result){\n//         return res.status(401).send({ param: resource , msg: `You are not authorized to edit this ${resource}.` })\n//       }\n//\n//       next()\n//     } catch (error) {\n//       return res.status(401).send(\"You don't have enough permission to perform this action\")\n//     }\n//   }\n// }\n\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRlLXRva2VuLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlVG9rZW4iLCJyZXEiLCJyZXMiLCJuZXh0IiwiYXV0aG9yaXphdGlvbiIsImhlYWRlcnMiLCJjb25zb2xlIiwibG9nIiwiT2JqZWN0IiwiYXNzaWduIiwidXNlciIsImFjY2Vzc1Rva2VuIiwic3BsaXQiLCJkZWNvZGVkIiwiand0IiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJleHAiLCJEYXRlIiwibm93IiwiVXNlck1vZGVsIiwiZmluZEJ5SWQiLCJ1c2VySWQiLCJlcnJvciIsIlByb21pc2UiLCJyZWplY3QiLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUdBOzs7O0FBREE7QUFHQSxNQUFNQSxhQUFhLEdBQUcsT0FBT0MsR0FBUCxFQUFZQyxHQUFaLEVBQWlCQyxJQUFqQixLQUEwQjtBQUM1QyxNQUFJO0FBQ0EsVUFBTUMsYUFBYSxHQUFHSCxHQUFHLENBQUNJLE9BQUosQ0FBWUQsYUFBbEM7QUFDQUUsSUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksaUJBQVosRUFBOEJILGFBQTlCO0FBQ0FJLElBQUFBLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjUixHQUFHLENBQUNJLE9BQWxCLEVBQTJCO0FBQ3ZCSyxNQUFBQSxJQUFJLEVBQUUsSUFEaUI7QUFFdkJOLE1BQUFBLGFBQWEsRUFBRTtBQUZRLEtBQTNCOztBQUtBLFFBQUksQ0FBQ0EsYUFBTCxFQUFvQjtBQUNoQixhQUFPRCxJQUFJLEVBQVg7QUFDSDs7QUFFRCxVQUFNUSxXQUFXLEdBQUdQLGFBQWEsQ0FBQ1EsS0FBZCxDQUFvQixHQUFwQixFQUF5QixDQUF6QixDQUFwQjtBQUNBTixJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxnQkFBWixFQUE4QkksV0FBOUI7QUFDQSxRQUFJRSxPQUFKOztBQUNBLFFBQUlGLFdBQUosRUFBaUI7QUFDYkUsTUFBQUEsT0FBTyxHQUFHQyxzQkFBSUMsTUFBSixDQUFXSixXQUFYLEVBQXdCSyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsVUFBcEMsQ0FBVjtBQUNIOztBQUNELFFBQUksQ0FBQ0wsT0FBTCxFQUFjO0FBQ1Y7QUFDQTtBQUNBO0FBQ0EsYUFBT1YsSUFBSSxFQUFYO0FBQ0g7O0FBRUQsUUFBSVUsT0FBTyxDQUFDTSxHQUFSLEdBQWMsSUFBZCxHQUFxQkMsSUFBSSxDQUFDQyxHQUFMLEVBQXpCLEVBQXFDO0FBQ2pDO0FBQ0E7QUFDQSxhQUFPbEIsSUFBSSxFQUFYO0FBQ0gsS0E3QkQsQ0ErQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUEsVUFBTU8sSUFBSSxHQUFHLE1BQU1ZLGdCQUFVQyxRQUFWLENBQW1CVixPQUFPLENBQUNXLE1BQTNCLENBQW5COztBQUNBLFFBQUksQ0FBQ2QsSUFBTCxFQUFXO0FBQ1A7QUFDQTtBQUNBLGFBQU9QLElBQUksRUFBWDtBQUNILEtBMUNELENBNENBOzs7QUFDQUssSUFBQUEsTUFBTSxDQUFDQyxNQUFQLENBQWNSLEdBQUcsQ0FBQ0ksT0FBbEIsRUFBMkI7QUFDdkJLLE1BQUFBLElBRHVCO0FBRXZCTixNQUFBQTtBQUZ1QixLQUEzQjtBQUtBLFdBQU9ELElBQUksRUFBWDtBQUNILEdBbkRELENBbURFLE9BQU9zQixLQUFQLEVBQWM7QUFDWm5CLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZa0IsS0FBWjtBQUNBLFdBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLElBQUlDLEtBQUosQ0FBVSxpQkFBVixDQUFmLENBQVA7QUFDSDtBQUNKLENBeEREOztlQTBEZTVCLGEsRUFHZjtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcblxyXG4vLyBpbXBvcnQgcmVkaXMgZnJvbSBcIi4uL2NvbmZpZy9yZWRpcy1jb25maWdcIjtcclxuaW1wb3J0IHtVc2VyTW9kZWx9IGZyb20gXCIuLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5cclxuY29uc3QgdmFsaWRhdGVUb2tlbiA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBhdXRob3JpemF0aW9uID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvblxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiYXV0aG9yaXphdGlvbjogXCIsYXV0aG9yaXphdGlvbilcclxuICAgICAgICBPYmplY3QuYXNzaWduKHJlcS5oZWFkZXJzLCB7XHJcbiAgICAgICAgICAgIHVzZXI6IG51bGwsXHJcbiAgICAgICAgICAgIGF1dGhvcml6YXRpb246IG51bGwsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmICghYXV0aG9yaXphdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhdXRob3JpemF0aW9uLnNwbGl0KFwiIFwiKVsxXTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImFjY2Vzc1RvY2tlbjogXCIsIGFjY2Vzc1Rva2VuKTtcclxuICAgICAgICBsZXQgZGVjb2RlZDtcclxuICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHtcclxuICAgICAgICAgICAgZGVjb2RlZCA9IGp3dC52ZXJpZnkoYWNjZXNzVG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWRlY29kZWQpIHtcclxuICAgICAgICAgICAgLy8gaW52YWxpZCB0b2tlbiwgcmVtb3ZlIHRoZSB0b2tlbiBmcm9tIGV2ZXJ5d2hlcmVcclxuICAgICAgICAgICAgLy9yZW1vdmUgZnJvbSBkYXRhYmFzZVxyXG4gICAgICAgICAgICAvL3JlbW92ZSBmcm9tIHJlZGlzXHJcbiAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZGVjb2RlZC5leHAgKiAxMDAwIDwgRGF0ZS5ub3coKSkge1xyXG4gICAgICAgICAgICAvL3JlbW92ZSBmcm9tIGRhdGFiYXNlXHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGZyb20gcmVkaXNcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vY2hlY2sgaWYgdG9rZW4gaXMgaW4gcmVkaXNcclxuICAgICAgICAvL2lmIE5PVCBpbiByZWRpcyBjYWxsIG5leHQoKVxyXG4gICAgICAgIC8vZWxzZSBjaGVjayBsYXN0IHVwZGF0ZSB0aW1lIGlmIGdyZWF0ZXIgdGhhbiBvciBlcXVhbHMgdG8gMWhvdXIgdXBkYXRlIHRoZSB0b2tlblxyXG4gICAgICAgIC8vIGlmIGxlc3Mgc2tpcCBlbHNlIHVwZGF0ZSB0b2tlblxyXG4gICAgICAgIC8vIGF1dGhvcml6YXRpb24gPSBuZXcgdG9rZW5cclxuXHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXJNb2RlbC5maW5kQnlJZChkZWNvZGVkLnVzZXJJZCk7XHJcbiAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGZyb20gZGF0YWJhc2VcclxuICAgICAgICAgICAgLy9yZW1vdmUgZnJvbSByZWRpc1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaWYgdGhlIHRva2VuIGhhcyBjb21lIGFsbCB0aGlzIHdheSBldmVyeXRoaW5nIGlzIGdvb2QganVzdCBhdHRhY2ggaXQgdG8gdGhlIHJlcXVlc3QgaGVhZGVyXHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihyZXEuaGVhZGVycywge1xyXG4gICAgICAgICAgICB1c2VyLFxyXG4gICAgICAgICAgICBhdXRob3JpemF0aW9uLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3IgSGFwcGVuZWQhXCIpKTtcclxuICAgIH1cclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHZhbGlkYXRlVG9rZW47XHJcblxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLSBhdXRob3JpemF0aW9uIC0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuLy8gbGV0IGNoZWNrX3VzZXJfYWN0aW9uID0gYXN5bmMgKHJlcSxhY3Rpb24scmVzb3VyY2UpID0+e1xyXG4vLyAgIGlmKCFbJ3VwZGF0ZU93bicsJ2RlbGV0ZU93biddLmluY2x1ZGVzKGFjdGlvbikpe1xyXG4vLyAgICAgcmV0dXJuIHRydWVcclxuLy8gICB9XHJcbi8vXHJcbi8vICAgY29uc3QgdXNlclJlc291cmNlID0gbmV3IFNldCgpXHJcbi8vXHJcbi8vICAgaWYocmVzb3VyY2UgPT0gJ3RlbmRlcicpe1xyXG4vLyAgICAgbGV0IHVzZXJUZW5kZXIgPSBhd2FpdCBUZW5kZXIuZmluZCh7IGNyZWF0b3JfdXNlcjogcmVxLnVzZXIuX2lkIH0pXHJcbi8vICAgICB1c2VyVGVuZGVyLmZvckVhY2godGVuZGVyID0+IHVzZXJSZXNvdXJjZS5hZGQoYCR7dGVuZGVyLl9pZH1gKSlcclxuLy9cclxuLy8gICB9ZWxzZSBpZihyZXNvdXJjZSA9PSAnY29tcGFueScpe1xyXG4vLyAgICAgbGV0IHVzZXJDb21wYW55ID0gYXdhaXQgQ29tcGFueS5maW5kKHsgY3JlYXRvcl91c2VyOiByZXEudXNlci5faWQgfSlcclxuLy8gICAgIHVzZXJDb21wYW55LmZvckVhY2goY29tcGFueSA9PiB1c2VyUmVzb3VyY2UuYWRkKCBgJHtjb21wYW55Ll9pZH1gKSlcclxuLy9cclxuLy8gICB9ZWxzZSBpZihyZXNvdXJjZSA9PSAnYXdhcmQnKXtcclxuLy8gICAgIGxldCB1c2VyQXdhcmQgPSBhd2FpdCBBd2FyZC5maW5kKHsgY3JlYXRvcl91c2VyOiByZXEudXNlci5faWQgfSlcclxuLy8gICAgIHVzZXJBd2FyZC5mb3JFYWNoKGF3YXJkID0+IHVzZXJSZXNvdXJjZS5hZGQoYCR7YXdhcmQuX2lkfWApKVxyXG4vLyAgIH1cclxuLy9cclxuLy8gICBpZighdXNlclJlc291cmNlLmhhcyhyZXEucGFyYW1zLmlkKSl7XHJcbi8vICAgICByZXR1cm4gZmFsc2VcclxuLy8gICB9XHJcbi8vXHJcbi8vICAgcmV0dXJuIHRydWVcclxuLy8gfVxyXG4vL1xyXG4vL1xyXG4vL1xyXG4vLyBleHBvcnRzLmF1dGhvcml6ZSA9IGZ1bmN0aW9uIChhY3Rpb24sIHJlc291cmNlKSB7XHJcbi8vICAgcmV0dXJuIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4vLyAgICAgdHJ5IHtcclxuLy8gICAgICAgY29uc3QgcGVybWlzc2lvbiA9IHJvbGVzLmNhbihyZXEudXNlci5yb2xlKVthY3Rpb25dKHJlc291cmNlKTtcclxuLy9cclxuLy8gICAgICAgaWYgKCFwZXJtaXNzaW9uLmdyYW50ZWQpIHtcclxuLy8gICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJZb3UgZG9uJ3QgaGF2ZSBlbm91Z2ggcGVybWlzc2lvbiB0byBwZXJmb3JtIHRoaXMgYWN0aW9uXCIpO1xyXG4vLyAgICAgICB9XHJcbi8vXHJcbi8vICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBjaGVja191c2VyX2FjdGlvbihyZXEsYWN0aW9uLHJlc291cmNlKVxyXG4vLyAgICAgICBpZighcmVzdWx0KXtcclxuLy8gICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoeyBwYXJhbTogcmVzb3VyY2UgLCBtc2c6IGBZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIGVkaXQgdGhpcyAke3Jlc291cmNlfS5gIH0pXHJcbi8vICAgICAgIH1cclxuLy9cclxuLy8gICAgICAgbmV4dCgpXHJcbi8vICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4vLyAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJZb3UgZG9uJ3QgaGF2ZSBlbm91Z2ggcGVybWlzc2lvbiB0byBwZXJmb3JtIHRoaXMgYWN0aW9uXCIpXHJcbi8vICAgICB9XHJcbi8vICAgfVxyXG4vLyB9XHJcbiJdfQ==","map":{"version":3,"sources":["validate-token.js"],"names":["validateToken","req","res","next","authorization","headers","console","log","Object","assign","user","accessToken","split","decoded","jwt","verify","process","env","JWT_SECRET","exp","Date","now","UserModel","findById","userId","error","Promise","reject","Error"],"mappings":";;;;;;;AAAA;;AAGA;;;;AADA;AAGA,MAAMA,aAAa,GAAG,OAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB,KAA0B;AAC5C,MAAI;AACA,UAAMC,aAAa,GAAGH,GAAG,CAACI,OAAJ,CAAYD,aAAlC;AACAE,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA8BH,aAA9B;AACAI,IAAAA,MAAM,CAACC,MAAP,CAAcR,GAAG,CAACI,OAAlB,EAA2B;AACvBK,MAAAA,IAAI,EAAE,IADiB;AAEvBN,MAAAA,aAAa,EAAE;AAFQ,KAA3B;;AAKA,QAAI,CAACA,aAAL,EAAoB;AAChB,aAAOD,IAAI,EAAX;AACH;;AAED,UAAMQ,WAAW,GAAGP,aAAa,CAACQ,KAAd,CAAoB,GAApB,EAAyB,CAAzB,CAApB;AACAN,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8BI,WAA9B;AACA,QAAIE,OAAJ;;AACA,QAAIF,WAAJ,EAAiB;AACbE,MAAAA,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,WAAX,EAAwBK,OAAO,CAACC,GAAR,CAAYC,UAApC,CAAV;AACH;;AACD,QAAI,CAACL,OAAL,EAAc;AACV;AACA;AACA;AACA,aAAOV,IAAI,EAAX;AACH;;AAED,QAAIU,OAAO,CAACM,GAAR,GAAc,IAAd,GAAqBC,IAAI,CAACC,GAAL,EAAzB,EAAqC;AACjC;AACA;AACA,aAAOlB,IAAI,EAAX;AACH,KA7BD,CA+BA;AACA;AACA;AACA;AACA;;;AAEA,UAAMO,IAAI,GAAG,MAAMY,gBAAUC,QAAV,CAAmBV,OAAO,CAACW,MAA3B,CAAnB;;AACA,QAAI,CAACd,IAAL,EAAW;AACP;AACA;AACA,aAAOP,IAAI,EAAX;AACH,KA1CD,CA4CA;;;AACAK,IAAAA,MAAM,CAACC,MAAP,CAAcR,GAAG,CAACI,OAAlB,EAA2B;AACvBK,MAAAA,IADuB;AAEvBN,MAAAA;AAFuB,KAA3B;AAKA,WAAOD,IAAI,EAAX;AACH,GAnDD,CAmDE,OAAOsB,KAAP,EAAc;AACZnB,IAAAA,OAAO,CAACC,GAAR,CAAYkB,KAAZ;AACA,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,iBAAV,CAAf,CAAP;AACH;AACJ,CAxDD;;eA0De5B,a,EAGf;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\n\r\n// import redis from \"../config/redis-config\";\r\nimport {UserModel} from \"../../models/user\";\r\n\r\nconst validateToken = async (req, res, next) => {\r\n    try {\r\n        const authorization = req.headers.authorization\r\n        console.log(\"authorization: \",authorization)\r\n        Object.assign(req.headers, {\r\n            user: null,\r\n            authorization: null,\r\n        });\r\n\r\n        if (!authorization) {\r\n            return next();\r\n        }\r\n\r\n        const accessToken = authorization.split(\" \")[1];\r\n        console.log(\"accessTocken: \", accessToken);\r\n        let decoded;\r\n        if (accessToken) {\r\n            decoded = jwt.verify(accessToken, process.env.JWT_SECRET);\r\n        }\r\n        if (!decoded) {\r\n            // invalid token, remove the token from everywhere\r\n            //remove from database\r\n            //remove from redis\r\n            return next();\r\n        }\r\n\r\n        if (decoded.exp * 1000 < Date.now()) {\r\n            //remove from database\r\n            //remove from redis\r\n            return next();\r\n        }\r\n\r\n        //check if token is in redis\r\n        //if NOT in redis call next()\r\n        //else check last update time if greater than or equals to 1hour update the token\r\n        // if less skip else update token\r\n        // authorization = new token\r\n\r\n        const user = await UserModel.findById(decoded.userId);\r\n        if (!user) {\r\n            //remove from database\r\n            //remove from redis\r\n            return next();\r\n        }\r\n\r\n        // if the token has come all this way everything is good just attach it to the request header\r\n        Object.assign(req.headers, {\r\n            user,\r\n            authorization,\r\n        });\r\n\r\n        return next();\r\n    } catch (error) {\r\n        console.log(error)\r\n        return Promise.reject(new Error(\"Error Happened!\"));\r\n    }\r\n};\r\n\r\nexport default validateToken;\r\n\r\n\r\n// ------------- authorization ------------------\r\n\r\n// let check_user_action = async (req,action,resource) =>{\r\n//   if(!['updateOwn','deleteOwn'].includes(action)){\r\n//     return true\r\n//   }\r\n//\r\n//   const userResource = new Set()\r\n//\r\n//   if(resource == 'tender'){\r\n//     let userTender = await Tender.find({ creator_user: req.user._id })\r\n//     userTender.forEach(tender => userResource.add(`${tender._id}`))\r\n//\r\n//   }else if(resource == 'company'){\r\n//     let userCompany = await Company.find({ creator_user: req.user._id })\r\n//     userCompany.forEach(company => userResource.add( `${company._id}`))\r\n//\r\n//   }else if(resource == 'award'){\r\n//     let userAward = await Award.find({ creator_user: req.user._id })\r\n//     userAward.forEach(award => userResource.add(`${award._id}`))\r\n//   }\r\n//\r\n//   if(!userResource.has(req.params.id)){\r\n//     return false\r\n//   }\r\n//\r\n//   return true\r\n// }\r\n//\r\n//\r\n//\r\n// exports.authorize = function (action, resource) {\r\n//   return async (req, res, next) => {\r\n//     try {\r\n//       const permission = roles.can(req.user.role)[action](resource);\r\n//\r\n//       if (!permission.granted) {\r\n//         return res.status(401).send(\"You don't have enough permission to perform this action\");\r\n//       }\r\n//\r\n//       let result = await check_user_action(req,action,resource)\r\n//       if(!result){\r\n//         return res.status(401).send({ param: resource , msg: `You are not authorized to edit this ${resource}.` })\r\n//       }\r\n//\r\n//       next()\r\n//     } catch (error) {\r\n//       return res.status(401).send(\"You don't have enough permission to perform this action\")\r\n//     }\r\n//   }\r\n// }\r\n"]}},"mtime":1648703549482},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\phone-verification.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\n// import admin from \"../../config/firebase-config\";\nconst phoneVerification = async (resolve, source, args, context, info) => {\n  // const {phoneVerification} = context;\n  // let phoneNumber = \"\";\n  //\n  // await admin\n  //     .auth()\n  //     .verifyIdToken(phoneVerification)\n  //     .then((decodedToken) => {\n  //         phoneNumber = decodedToken.phone_number;\n  //     })\n  //     .catch(() => Promise.reject(new Error(\"Error happened!\")));\n  // if (phoneNumber === \"\") {\n  //     return Promise.reject(new Error(\"Phone number not detected!\"));\n  // }\n  // context.phoneNumber = phoneNumber;\n  return resolve(source, args, context, info);\n};\n\nvar _default = phoneVerification;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBob25lLXZlcmlmaWNhdGlvbi5qcyJdLCJuYW1lcyI6WyJwaG9uZVZlcmlmaWNhdGlvbiIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUVBLE1BQU1BLGlCQUFpQixHQUFHLE9BQU9DLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFPSixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsQ0FoQkQ7O2VBa0JlTCxpQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbWlkZGxld2FyZXNcXGF1dGhcXCIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCBhZG1pbiBmcm9tIFwiLi4vLi4vY29uZmlnL2ZpcmViYXNlLWNvbmZpZ1wiO1xyXG5cclxuY29uc3QgcGhvbmVWZXJpZmljYXRpb24gPSBhc3luYyAocmVzb2x2ZSwgc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiB7XHJcbiAgICAvLyBjb25zdCB7cGhvbmVWZXJpZmljYXRpb259ID0gY29udGV4dDtcclxuICAgIC8vIGxldCBwaG9uZU51bWJlciA9IFwiXCI7XHJcbiAgICAvL1xyXG4gICAgLy8gYXdhaXQgYWRtaW5cclxuICAgIC8vICAgICAuYXV0aCgpXHJcbiAgICAvLyAgICAgLnZlcmlmeUlkVG9rZW4ocGhvbmVWZXJpZmljYXRpb24pXHJcbiAgICAvLyAgICAgLnRoZW4oKGRlY29kZWRUb2tlbikgPT4ge1xyXG4gICAgLy8gICAgICAgICBwaG9uZU51bWJlciA9IGRlY29kZWRUb2tlbi5waG9uZV9udW1iZXI7XHJcbiAgICAvLyAgICAgfSlcclxuICAgIC8vICAgICAuY2F0Y2goKCkgPT4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3IgaGFwcGVuZWQhXCIpKSk7XHJcbiAgICAvLyBpZiAocGhvbmVOdW1iZXIgPT09IFwiXCIpIHtcclxuICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiUGhvbmUgbnVtYmVyIG5vdCBkZXRlY3RlZCFcIikpO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gY29udGV4dC5waG9uZU51bWJlciA9IHBob25lTnVtYmVyO1xyXG4gICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgcGhvbmVWZXJpZmljYXRpb247XHJcbiJdfQ==","map":{"version":3,"sources":["phone-verification.js"],"names":["phoneVerification","resolve","source","args","context","info"],"mappings":";;;;;;;AAAA;AAEA,MAAMA,iBAAiB,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAOJ,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAhBD;;eAkBeL,iB","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["// import admin from \"../../config/firebase-config\";\r\n\r\nconst phoneVerification = async (resolve, source, args, context, info) => {\r\n    // const {phoneVerification} = context;\r\n    // let phoneNumber = \"\";\r\n    //\r\n    // await admin\r\n    //     .auth()\r\n    //     .verifyIdToken(phoneVerification)\r\n    //     .then((decodedToken) => {\r\n    //         phoneNumber = decodedToken.phone_number;\r\n    //     })\r\n    //     .catch(() => Promise.reject(new Error(\"Error happened!\")));\r\n    // if (phoneNumber === \"\") {\r\n    //     return Promise.reject(new Error(\"Phone number not detected!\"));\r\n    // }\r\n    // context.phoneNumber = phoneNumber;\r\n    return resolve(source, args, context, info);\r\n}\r\n\r\nexport default phoneVerification;\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\validators\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\validators\\\\user-validator.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n// import validator from \"validators\";\nconst userValidator = {\n  changePassword: async (resolve, source, args, context, info) => {\n    const {\n      newPassword\n    } = args; // if (!validator.isLength(newPassword, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: newPassword\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  newPassword: async (resolve, source, args, context, info) => {\n    const {\n      newPassword\n    } = args; // if (!validator.isLength(newPassword, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: newPassword\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  resetPassword: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = validator.normalizeEmail(email);\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    return resolve(source, args, context, info);\n  },\n  signIn: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = email.toString().toLowerCase();\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    return resolve(source, args, context, info);\n  },\n  signUp: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = email.toString().toLowerCase();\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    const {\n      password\n    } = args; // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\n    //     return Promise.reject(new Error(\"Error: email\"));\n    // }\n    //\n    // if (!validator.isLength(password, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: password\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  updateUser: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = validator.normalizeEmail(email);\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    const {\n      firstName,\n      lastName\n    } = args; // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\n    //     return Promise.reject(new Error(\"Error: email\"));\n    // }\n    // if (!validator.isLength(firstName, {min: 2})) {\n    //     return Promise.reject(new Error(\"Error: firstName\"));\n    // }\n    // if (!validator.isLength(lastName, {min: 2})) {\n    //     return Promise.reject(new Error(\"Error: lastName\"));\n    // }\n\n    return resolve(source, args, context, info);\n  }\n};\nvar _default = userValidator;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXItdmFsaWRhdG9yLmpzIl0sIm5hbWVzIjpbInVzZXJWYWxpZGF0b3IiLCJjaGFuZ2VQYXNzd29yZCIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iLCJuZXdQYXNzd29yZCIsInJlc2V0UGFzc3dvcmQiLCJlbWFpbCIsInNpZ25JbiIsInNpZ25VcCIsInBhc3N3b3JkIiwidXBkYXRlVXNlciIsImZpcnN0TmFtZSIsImxhc3ROYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUVBLE1BQU1BLGFBQWEsR0FBRztBQUNsQkMsRUFBQUEsY0FBYyxFQUFFLE9BQU9DLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQzVELFVBQU07QUFBQ0MsTUFBQUE7QUFBRCxRQUFnQkgsSUFBdEIsQ0FENEQsQ0FHNUQ7QUFDQTtBQUNBOztBQUVBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxHQVRpQjtBQVVsQkMsRUFBQUEsV0FBVyxFQUFFLE9BQU9MLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3pELFVBQU07QUFBQ0MsTUFBQUE7QUFBRCxRQUFnQkgsSUFBdEIsQ0FEeUQsQ0FHekQ7QUFDQTtBQUNBOztBQUVBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxHQWxCaUI7QUFtQmxCRSxFQUFBQSxhQUFhLEVBQUUsT0FBT04sT0FBUCxFQUFnQkMsTUFBaEIsRUFBd0JDLElBQXhCLEVBQThCQyxPQUE5QixFQUF1Q0MsSUFBdkMsS0FBZ0Q7QUFDM0QsUUFBSTtBQUFDRyxNQUFBQTtBQUFELFFBQVVMLElBQWQsQ0FEMkQsQ0FHM0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsV0FBT0YsT0FBTyxDQUFDQyxNQUFELEVBQVNDLElBQVQsRUFBZUMsT0FBZixFQUF3QkMsSUFBeEIsQ0FBZDtBQUNILEdBNUJpQjtBQTZCbEJJLEVBQUFBLE1BQU0sRUFBRSxPQUFPUixPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUNwRCxRQUFJO0FBQUNHLE1BQUFBO0FBQUQsUUFBVUwsSUFBZCxDQURvRCxDQUdwRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxXQUFPRixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsR0F0Q2lCO0FBdUNsQkssRUFBQUEsTUFBTSxFQUFFLE9BQU9ULE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3BELFFBQUk7QUFBQ0csTUFBQUE7QUFBRCxRQUFVTCxJQUFkLENBRG9ELENBR3BEO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFVBQU07QUFBQ1EsTUFBQUE7QUFBRCxRQUFhUixJQUFuQixDQVJvRCxDQVVwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxXQUFPRixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsR0ExRGlCO0FBMkRsQk8sRUFBQUEsVUFBVSxFQUFFLE9BQU9YLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3hELFFBQUk7QUFBQ0csTUFBQUE7QUFBRCxRQUFVTCxJQUFkLENBRHdELENBR3hEO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFVBQU07QUFDRlUsTUFBQUEsU0FERTtBQUVGQyxNQUFBQTtBQUZFLFFBR0ZYLElBSEosQ0FSd0QsQ0FheEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSDtBQWxGaUIsQ0FBdEI7ZUFxRmVOLGEiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXG1pZGRsZXdhcmVzXFx2YWxpZGF0b3JzXFwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgdmFsaWRhdG9yIGZyb20gXCJ2YWxpZGF0b3JzXCI7XHJcblxyXG5jb25zdCB1c2VyVmFsaWRhdG9yID0ge1xyXG4gICAgY2hhbmdlUGFzc3dvcmQ6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB7bmV3UGFzc3dvcmR9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgobmV3UGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IG5ld1Bhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgbmV3UGFzc3dvcmQ6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB7bmV3UGFzc3dvcmR9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgobmV3UGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IG5ld1Bhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgcmVzZXRQYXNzd29yZDogYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgICAgIGxldCB7ZW1haWx9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gZW1haWwgPSB2YWxpZGF0b3Iubm9ybWFsaXplRW1haWwoZW1haWwpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxuICAgIH0sXHJcbiAgICBzaWduSW46IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBsZXQge2VtYWlsfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGVtYWlsID0gZW1haWwudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxuICAgIH0sXHJcbiAgICBzaWduVXA6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBsZXQge2VtYWlsfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGVtYWlsID0gZW1haWwudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgY29uc3Qge3Bhc3N3b3JkfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGlmICghdmFsaWRhdG9yLmlzRW1haWwoZW1haWwsIHthbGxvd191dGY4X2xvY2FsX3BhcnQ6IGZhbHNlfSkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVycm9yOiBlbWFpbFwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgocGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IHBhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgdXBkYXRlVXNlcjogYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgICAgIGxldCB7ZW1haWx9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gZW1haWwgPSB2YWxpZGF0b3Iubm9ybWFsaXplRW1haWwoZW1haWwpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICBmaXJzdE5hbWUsXHJcbiAgICAgICAgICAgIGxhc3ROYW1lLFxyXG4gICAgICAgIH0gPSBhcmdzO1xyXG5cclxuICAgICAgICAvLyBpZiAoIXZhbGlkYXRvci5pc0VtYWlsKGVtYWlsLCB7YWxsb3dfdXRmOF9sb2NhbF9wYXJ0OiBmYWxzZX0pKSB7XHJcbiAgICAgICAgLy8gICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJFcnJvcjogZW1haWxcIikpO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyBpZiAoIXZhbGlkYXRvci5pc0xlbmd0aChmaXJzdE5hbWUsIHttaW46IDJ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IGZpcnN0TmFtZVwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vIGlmICghdmFsaWRhdG9yLmlzTGVuZ3RoKGxhc3ROYW1lLCB7bWluOiAyfSkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVycm9yOiBsYXN0TmFtZVwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlclZhbGlkYXRvcjtcclxuIl19","map":{"version":3,"sources":["user-validator.js"],"names":["userValidator","changePassword","resolve","source","args","context","info","newPassword","resetPassword","email","signIn","signUp","password","updateUser","firstName","lastName"],"mappings":";;;;;;AAAA;AAEA,MAAMA,aAAa,GAAG;AAClBC,EAAAA,cAAc,EAAE,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC5D,UAAM;AAACC,MAAAA;AAAD,QAAgBH,IAAtB,CAD4D,CAG5D;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GATiB;AAUlBC,EAAAA,WAAW,EAAE,OAAOL,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACzD,UAAM;AAACC,MAAAA;AAAD,QAAgBH,IAAtB,CADyD,CAGzD;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GAlBiB;AAmBlBE,EAAAA,aAAa,EAAE,OAAON,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC3D,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CAD2D,CAG3D;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GA5BiB;AA6BlBI,EAAAA,MAAM,EAAE,OAAOR,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACpD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADoD,CAGpD;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GAtCiB;AAuClBK,EAAAA,MAAM,EAAE,OAAOT,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACpD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADoD,CAGpD;AACA;AACA;AACA;;AAEA,UAAM;AAACQ,MAAAA;AAAD,QAAaR,IAAnB,CARoD,CAUpD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GA1DiB;AA2DlBO,EAAAA,UAAU,EAAE,OAAOX,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACxD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADwD,CAGxD;AACA;AACA;AACA;;AAEA,UAAM;AACFU,MAAAA,SADE;AAEFC,MAAAA;AAFE,QAGFX,IAHJ,CARwD,CAaxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH;AAlFiB,CAAtB;eAqFeN,a","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\validators\\","sourcesContent":["// import validator from \"validators\";\r\n\r\nconst userValidator = {\r\n    changePassword: async (resolve, source, args, context, info) => {\r\n        const {newPassword} = args;\r\n\r\n        // if (!validator.isLength(newPassword, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: newPassword\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    newPassword: async (resolve, source, args, context, info) => {\r\n        const {newPassword} = args;\r\n\r\n        // if (!validator.isLength(newPassword, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: newPassword\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    resetPassword: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = validator.normalizeEmail(email);\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    signIn: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = email.toString().toLowerCase();\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    signUp: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = email.toString().toLowerCase();\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        const {password} = args;\r\n\r\n        // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\r\n        //     return Promise.reject(new Error(\"Error: email\"));\r\n        // }\r\n        //\r\n        // if (!validator.isLength(password, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: password\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    updateUser: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = validator.normalizeEmail(email);\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        const {\r\n            firstName,\r\n            lastName,\r\n        } = args;\r\n\r\n        // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\r\n        //     return Promise.reject(new Error(\"Error: email\"));\r\n        // }\r\n        // if (!validator.isLength(firstName, {min: 2})) {\r\n        //     return Promise.reject(new Error(\"Error: firstName\"));\r\n        // }\r\n        // if (!validator.isLength(lastName, {min: 2})) {\r\n        //     return Promise.reject(new Error(\"Error: lastName\"));\r\n        // }\r\n        return resolve(source, args, context, info);\r\n    },\r\n};\r\n\r\nexport default userValidator;\r\n"]}},"mtime":1648684433893},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\resolvers\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\resolvers\\\\auth-resolvers.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _authUseCases = _interopRequireDefault(require(\"../../../services/auth/use-cases/auth-use-cases\"));\n\nvar _redisServices = _interopRequireDefault(require(\"../../../services/redis/redis-services\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\nconst signIn = {\n  name: \"signIn\",\n  type: \"AccessToken!\",\n  args: {\n    phoneNumber: \"String!\",\n    password: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      phoneNumber,\n      password\n    }\n  }) => {\n    try {\n      const {\n        user,\n        accessToken\n      } = await _authUseCases.default.signIn({\n        phoneNumber,\n        password\n      });\n      return {\n        accessToken,\n        user\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst signUp = {\n  name: \"signUp\",\n  type: \"AccessToken!\",\n  args: {\n    firstName: \"String!\",\n    middleName: \"String!\",\n    lastName: \"String!\",\n    password: \"String!\",\n    phoneNumber: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      firstName,\n      middleName,\n      lastName,\n      password,\n      phoneNumber\n    },\n    context: {\n      phoneVerification\n    }\n  }) => {\n    try {\n      const {\n        accessToken,\n        user\n      } = await _authUseCases.default.signUp({\n        firstName,\n        middleName,\n        lastName,\n        password,\n        phoneNumber\n      });\n      console.log(accessToken);\n      return {\n        accessToken,\n        // roles: user.roles,\n        user\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst logout = {\n  name: 'logout',\n  type: 'Succeed!',\n  resolve: async ({\n    context: {\n      user,\n      accessToken\n    }\n  }) => {\n    try {\n      // await redis.set(`expiredToken:${accessToken}`, user._id, 'EX', process.env.REDIS_TOKEN_EXPIRY);\n      await _authUseCases.default.logout({\n        user,\n        accessToken\n      });\n      return {\n        succeed: true\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst changePassword = {\n  name: \"changePassword\",\n  type: \"AccessToken!\",\n  args: {\n    newPassword: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      newPassword\n    },\n    context: {\n      user,\n      accessToken\n    }\n  }) => {\n    try {\n      console.log(\"changepassword\");\n      const {\n        updatedUser,\n        oldAccessTocken\n      } = await _authUseCases.default.changePassword({\n        newPassword,\n        user,\n        accessToken\n      });\n      return {\n        updatedUser,\n        oldAccessTocken\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nvar _default = {\n  signIn,\n  signUp,\n  logout,\n  changePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtcmVzb2x2ZXJzLmpzIl0sIm5hbWVzIjpbInNpZ25JbiIsIm5hbWUiLCJ0eXBlIiwiYXJncyIsInBob25lTnVtYmVyIiwicGFzc3dvcmQiLCJyZXNvbHZlIiwidXNlciIsImFjY2Vzc1Rva2VuIiwiYXV0aFNlcnZpY2VzIiwiZXJyb3IiLCJQcm9taXNlIiwicmVqZWN0Iiwic2lnblVwIiwiZmlyc3ROYW1lIiwibWlkZGxlTmFtZSIsImxhc3ROYW1lIiwiY29udGV4dCIsInBob25lVmVyaWZpY2F0aW9uIiwiY29uc29sZSIsImxvZyIsImxvZ291dCIsInN1Y2NlZWQiLCJjaGFuZ2VQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwidXBkYXRlZFVzZXIiLCJvbGRBY2Nlc3NUb2NrZW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBO0FBRUEsTUFBTUEsTUFBTSxHQUFHO0FBQ1hDLEVBQUFBLElBQUksRUFBRSxRQURLO0FBRVhDLEVBQUFBLElBQUksRUFBRSxjQUZLO0FBR1hDLEVBQUFBLElBQUksRUFBRTtBQUNGQyxJQUFBQSxXQUFXLEVBQUUsU0FEWDtBQUVGQyxJQUFBQSxRQUFRLEVBQUU7QUFGUixHQUhLO0FBT1hDLEVBQUFBLE9BQU8sRUFBRSxPQUFPO0FBQUNILElBQUFBLElBQUksRUFBRTtBQUFDQyxNQUFBQSxXQUFEO0FBQWNDLE1BQUFBO0FBQWQ7QUFBUCxHQUFQLEtBQTJDO0FBQ2hELFFBQUk7QUFFQSxZQUFNO0FBQUNFLFFBQUFBLElBQUQ7QUFBT0MsUUFBQUE7QUFBUCxVQUFzQixNQUFNQyxzQkFBYVQsTUFBYixDQUFvQjtBQUFDSSxRQUFBQSxXQUFEO0FBQWNDLFFBQUFBO0FBQWQsT0FBcEIsQ0FBbEM7QUFFQSxhQUFPO0FBQUNHLFFBQUFBLFdBQUQ7QUFBY0QsUUFBQUE7QUFBZCxPQUFQO0FBQ0gsS0FMRCxDQUtFLE9BQU9HLEtBQVAsRUFBYztBQUNaLGFBQU9DLE9BQU8sQ0FBQ0MsTUFBUixD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RUFBYztBQUNaLGFBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlRixLQUFmLENBQVA7QUFDSDtBQUNKO0FBZmtCLENBQXZCO2VBa0JlO0FBQ1hWLEVBQUFBLE1BRFc7QUFFWGEsRUFBQUEsTUFGVztBQUdYUSxFQUFBQSxNQUhXO0FBSVhFLEVBQUFBO0FBSlcsQyIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcYXV0aFxccmVzb2x2ZXJzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcclxuaW1wb3J0IHtVc2VyTW9kZWx9IGZyb20gXCIuLi8uLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5pbXBvcnQgYXV0aFNlcnZpY2VzIGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9hdXRoL3VzZS1jYXNlcy9hdXRoLXVzZS1jYXNlc1wiO1xyXG5pbXBvcnQgc3RvcmVOZXdTZXNzaW9uIGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9yZWRpcy9yZWRpcy1zZXJ2aWNlc1wiXHJcblxyXG4vLyBpbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcclxuXHJcbmNvbnN0IHNpZ25JbiA9IHtcclxuICAgIG5hbWU6IFwic2lnbkluXCIsXHJcbiAgICB0eXBlOiBcIkFjY2Vzc1Rva2VuIVwiLFxyXG4gICAgYXJnczoge1xyXG4gICAgICAgIHBob25lTnVtYmVyOiBcIlN0cmluZyFcIixcclxuICAgICAgICBwYXNzd29yZDogXCJTdHJpbmchXCIsXHJcbiAgICB9LFxyXG4gICAgcmVzb2x2ZTogYXN5bmMgKHthcmdzOiB7cGhvbmVOdW1iZXIsIHBhc3N3b3JkfX0pID0+IHtcclxuICAgICAgICB0cnkge1xyXG5cclxuICAgICAgICAgICAgY29uc3Qge3VzZXIsIGFjY2Vzc1Rva2VufSA9IGF3YWl0IGF1dGhTZXJ2aWNlcy5zaWduSW4oe3Bob25lTnVtYmVyLCBwYXNzd29yZH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHthY2Nlc3NUb2tlbiwgdXNlcn07XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59O1xyXG5cclxuXHJcbmNvbnN0IHNpZ25VcCA9IHtcclxuICAgIG5hbWU6IFwic2lnblVwXCIsXHJcbiAgICB0eXBlOiBcIkFjY2Vzc1Rva2VuIVwiLFxyXG4gICAgYXJnczoge1xyXG4gICAgICAgIGZpcnN0TmFtZTogXCJTdHJpbmchXCIsXHJcbiAgICAgICAgbWlkZGxlTmFtZTogXCJTdHJpbmchXCIsXHJcbiAgICAgICAgbGFzdE5hbWU6IFwiU3RyaW5nIVwiLFxyXG4gICAgICAgIHBhc3N3b3JkOiBcIlN0cmluZyFcIixcclxuICAgICAgICBwaG9uZU51bWJlcjogXCJTdHJpbmchXCIsXHJcbiAgICB9LFxyXG4gICAgcmVzb2x2ZTogYXN5bmMgKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJnczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWlkZGxlTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG9uZU51bWJlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG9uZVZlcmlmaWNhdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB9KSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHthY2Nlc3NUb2tlbiwgdXNlcn0gPSBhd2FpdCBhdXRoU2VydmljZXMuc2lnblVwKHtcclxuICAgICAgICAgICAgICAgIGZpcnN0TmFtZSxcclxuICAgICAgICAgICAgICAgIG1pZGRsZU5hbWUsXHJcbiAgICAgICAgICAgICAgICBsYXN0TmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkLFxyXG4gICAgICAgICAgICAgICAgcGhvbmVOdW1iZXIsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhY2Nlc3NUb2tlbikgICBcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuLFxyXG4gICAgICAgICAgICAgICAgLy8gcm9sZXM6IHVzZXIucm9sZXMsXHJcbiAgICAgICAgICAgICAgICB1c2VyLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxufTtcclxuXHJcbmNvbnN0IGxvZ291dCA9IHtcclxuICAgIG5hbWU6ICdsb2dvdXQnLFxyXG4gICAgdHlwZTogJ1N1Y2NlZWQhJyxcclxuICAgIHJlc29sdmU6IGFzeW5jICh7Y29udGV4dDoge3VzZXIsIGFjY2Vzc1Rva2VufX0pID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBhd2FpdCByZWRpcy5zZXQoYGV4cGlyZWRUb2tlbjoke2FjY2Vzc1Rva2VufWAsIHVzZXIuX2lkLCAnRVgnLCBwcm9jZXNzLmVudi5SRURJU19UT0tFTl9FWFBJUlkpO1xyXG4gICAgICAgICAgICBhd2FpdCBhdXRoU2VydmljZXMubG9nb3V0KHt1c2VyLGFjY2Vzc1Rva2VufSlcclxuICAgICAgICAgICAgcmV0dXJuIHtzdWNjZWVkOiB0cnVlfTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbmNvbnN0IGNoYW5nZVBhc3N3b3JkID0ge1xyXG4gICAgbmFtZTogXCJjaGFuZ2VQYXNzd29yZFwiLFxyXG4gICAgdHlwZTogXCJBY2Nlc3NUb2tlbiFcIixcclxuICAgIGFyZ3M6IHtcclxuICAgICAgICBuZXdQYXNzd29yZDogXCJTdHJpbmchXCIsXHJcbiAgICB9LFxyXG4gICAgcmVzb2x2ZTogYXN5bmMgKHthcmdzOiB7bmV3UGFzc3dvcmR9LCBjb250ZXh0OiB7dXNlciwgYWNjZXNzVG9rZW59fSkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbmNvbnNvbGUubG9nKFwiY2hhbmdlcGFzc3dvcmRcIilcclxuICAgICAgICAgICAgY29uc3Qge3VwZGF0ZWRVc2VyLCBvbGRBY2Nlc3NUb2NrZW59ID0gYXdhaXQgYXV0aFNlcnZpY2VzLmNoYW5nZVBhc3N3b3JkKHtuZXdQYXNzd29yZCwgdXNlciwgYWNjZXNzVG9rZW59KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB7dXBkYXRlZFVzZXIsIG9sZEFjY2Vzc1RvY2tlbn07XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQge1xyXG4gICAgc2lnbkluLFxyXG4gICAgc2lnblVwLFxyXG4gICAgbG9nb3V0LFxyXG4gICAgY2hhbmdlUGFzc3dvcmQsXHJcbn0iXX0=","map":{"version":3,"sources":["auth-resolvers.js"],"names":["signIn","name","type","args","phoneNumber","password","resolve","user","accessToken","authServices","error","Promise","reject","signUp","firstName","middleName","lastName","context","phoneVerification","console","log","logout","succeed","changePassword","newPassword","updatedUser","oldAccessTocken"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\resolvers\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport {UserModel} from \"../../../models/user\";\r\nimport authServices from \"../../../services/auth/use-cases/auth-use-cases\";\r\nimport storeNewSession from \"../../../services/redis/redis-services\"\r\n\r\n// import crypto from \"crypto\";\r\n\r\nconst signIn = {\r\n    name: \"signIn\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        phoneNumber: \"String!\",\r\n        password: \"String!\",\r\n    },\r\n    resolve: async ({args: {phoneNumber, password}}) => {\r\n        try {\r\n\r\n            const {user, accessToken} = await authServices.signIn({phoneNumber, password});\r\n\r\n            return {accessToken, user};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\n\r\nconst signUp = {\r\n    name: \"signUp\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        firstName: \"String!\",\r\n        middleName: \"String!\",\r\n        lastName: \"String!\",\r\n        password: \"String!\",\r\n        phoneNumber: \"String!\",\r\n    },\r\n    resolve: async ({\r\n                        args: {\r\n                            firstName,\r\n                            middleName,\r\n                            lastName,\r\n                            password,\r\n                            phoneNumber\r\n                        },\r\n                        context: {\r\n                            phoneVerification,\r\n                        },\r\n                    }) => {\r\n        try {\r\n\r\n            const {accessToken, user} = await authServices.signUp({\r\n                firstName,\r\n                middleName,\r\n                lastName,\r\n                password,\r\n                phoneNumber,\r\n            });\r\n            console.log(accessToken)   \r\n            return {\r\n                accessToken,\r\n                // roles: user.roles,\r\n                user,\r\n            };\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\nconst logout = {\r\n    name: 'logout',\r\n    type: 'Succeed!',\r\n    resolve: async ({context: {user, accessToken}}) => {\r\n        try {\r\n            // await redis.set(`expiredToken:${accessToken}`, user._id, 'EX', process.env.REDIS_TOKEN_EXPIRY);\r\n            await authServices.logout({user,accessToken})\r\n            return {succeed: true};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    }\r\n};\r\n\r\nconst changePassword = {\r\n    name: \"changePassword\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        newPassword: \"String!\",\r\n    },\r\n    resolve: async ({args: {newPassword}, context: {user, accessToken}}) => {\r\n        try {\r\nconsole.log(\"changepassword\")\r\n            const {updatedUser, oldAccessTocken} = await authServices.changePassword({newPassword, user, accessToken});\r\n\r\n            return {updatedUser, oldAccessTocken};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\nexport default {\r\n    signIn,\r\n    signUp,\r\n    logout,\r\n    changePassword,\r\n}"]}},"mtime":1648765826720},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\use-cases\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\use-cases\\\\auth-use-cases.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _session = require(\"../../../models/session\");\n\nvar _authDataAccess = _interopRequireDefault(require(\"../data-access/auth-data-access\"));\n\nvar _redisConfig = _interopRequireDefault(require(\"../../../config/redis-config\"));\n\nvar _redisServices = _interopRequireDefault(require(\"../../redis/redis-services\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\n//load our .env file\nrequire('dotenv').config();\n\nconst moment = require(\"moment\");\n\nconst signIn = async ({\n  phoneNumber,\n  password\n}) => {\n  try {\n    const user = await _authDataAccess.default.signIn({\n      phoneNumber,\n      password\n    });\n    const userId = user._id; //check if session exists in mongodb \n\n    const session = await _authDataAccess.default.findSession(userId);\n    console.log(session);\n    let accessToken;\n\n    if (session) {\n      //session exists in mongodb'\n      console.log('sessison exists');\n      let updatedDate = session.expirationDate;\n      accessToken = session.jwtToken;\n      const updatedAt = moment(session.updatedAt);\n      const now = moment(new Date());\n      const duration = moment.duration(now.diff(updatedAt)).asHours();\n      console.log(duration);\n\n      if (duration >= 1) {\n        updatedDate = moment(session.expirationDate).add(1, 'days').toDate();\n      } // increase count and date of session\n\n\n      const newSession = await _authDataAccess.default.updateSession(session.userCount + 1, session, updatedDate);\n      console.log('new session', newSession);\n      await _redisServices.default.storeNewSession(accessToken, newSession); //     let dataInRedis;\n      //     await client.get(accessToken, async(err,sessionData) => {\n      //        if (sessionData) {\n      //            dataInRedis = sessionData\n      //            console.log(sessionData)\n      //        }\n      //        else if (err){\n      //            console.log('errrr')\n      //            console.log(err)\n      //        }\n      //    })\n      //    console.log('data in redis ', dataInRedis)\n    } else {\n      console.log(\"session does not exit\"); //session doesn't exist create a new one\n\n      accessToken = await _jsonwebtoken.default.sign(user.toJSON(), process.env.JWT_SECRET, {\n        expiresIn: process.env.JWT_EXPIRATION\n      });\n      const tomorrowDate = moment().clone().add(1, 'days').toDate(); // save session in mongodb\n\n      const newSession = await _authDataAccess.default.saveNewSession(userId, accessToken, tomorrowDate);\n      console.log(newSession);\n      await _redisServices.default.storeNewSession(accessToken, newSession); // // store session in redis\n      // redisService.storeNewSession(client,session)\n    }\n\n    return {\n      accessToken,\n      user\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst signUp = async ({\n  firstName,\n  middleName,\n  lastName,\n  password,\n  phoneNumber\n}) => {\n  try {\n    const user = await _authDataAccess.default.signUp({\n      firstName,\n      middleName,\n      lastName,\n      password,\n      phoneNumber\n    });\n    const userId = user._id; //check if there is an error\n\n    if (!user) {\n      return Promise.reject(new Error(\"user doesn't exist\"));\n    } //we only need firstName, fathersName, lastName, role\n    //define a new function to sign user information\n\n\n    const accessToken = jwtSign({\n      firstName: user.firstName,\n      lastName: user.lastName,\n      _id: user._id\n    }); // storeNewSession(token, user information(id), count, last update)\n\n    const tomorrowDate = moment().clone().add(process.env.JWT_EXPIRATION, 'days').toDate(); // save session in mongodb\n\n    const newSession = await _authDataAccess.default.saveNewSession(userId, accessToken, tomorrowDate);\n    console.log(\"In auth us case\", accessToken);\n    await _redisServices.default.storeNewSession(accessToken, newSession);\n    return {\n      accessToken,\n      user\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst logout = async ({\n  user,\n  accessToken\n}) => {\n  try {\n    await _authDataAccess.default.logout({\n      user,\n      accessToken\n    });\n    await _redisServices.default.updateSession(accessToken);\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst changePassword = async ({\n  newPassword,\n  user,\n  accessToken\n}) => {\n  try {\n    const {\n      updatedUser,\n      oldAccessTocken\n    } = await _authDataAccess.default.changePassword({\n      newPassword,\n      user,\n      accessToken\n    });\n    await _redisServices.default.deleteSessionCompletely(accessToken);\n    return {\n      updatedUser,\n      oldAccessTocken\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst jwtSign = user => {\n  return _jsonwebtoken.default.sign(JSON.parse(JSON.stringify(user)), // roles: user.roles,\n  process.env.JWT_SECRET);\n};\n\nvar _default = {\n  signIn,\n  signUp,\n  logout,\n  changePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtdXNlLWNhc2VzLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJtb21lbnQiLCJzaWduSW4iLCJwaG9uZU51bWJlciIsInBhc3N3b3JkIiwidXNlciIsImF1dGhSZXBvc2l0b3J5IiwidXNlcklkIiwiX2lkIiwic2Vzc2lvbiIsImZpbmRTZXNzaW9uIiwiY29uc29sZSIsImxvZyIsImFjY2Vzc1Rva2VuIiwidXBkYXRlZERhdGUiLCJleHBpcmF0aW9uRGF0ZSIsImp3dFRva2VuIiwidXBkYXRlZEF0Iiwibm93IiwiRGF0ZSIsImR1cmF0aW9uIiwiZGlmZiIsImFzSG91cnMiLCJhZGQiLCJ0b0RhdGUiLCJuZXdTZXNzaW9uIiwidXBkYXRlU2Vzc2lvbiIsInVzZXJDb3VudCIsInJlZGlzU2VydmljZSIsInN0b3JlTmV3U2Vzc2lvbiIsImp3dCIsInNpZ24iLCJ0b0pTT04iLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsIkpXVF9FWFBJUkFUSU9OIiwidG9tb3Jyb3dEYXRlIiwiY2xvbmUiLCJzYXZlTmV3U2Vzc2lvbiIsImVycm9yIiwiUHJvbWlzZSIsInJlamVjdCIsInNpZ25VcCIsImZpcnN0TmFtZSIsIm1pZGRsZU5hbWUiLCJsYXN0TmFtZSIsIkVycm9yIiwiand0U2lnbiIsImxvZ291dCIsImNoYW5nZVBhc3N3b3JkIiwibmV3UGFzc3dvcmQiLCJ1cGRhdGVkVXNlciIsIm9sZEFjY2Vzc1RvY2tlbiIsImRlbGV0ZVNlc3Npb25Db21wbGV0ZWx5IiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7Ozs7QUFIQTtBQUlBO0FBQ0FBLE9BQU8sQ0FBQyxRQUFELENBQVAsQ0FBa0JDLE1BQWxCOztBQUVBLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDLFFBQUQsQ0FBdEI7O0FBRUEsTUFBTUcsTUFBTSxHQUFH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QTtBQUFkLEtBQVA7QUFDSCxHQUpELENBSUUsT0FBT2IsS0FBUCxFQUFjO0FBQ1osV0FBT0MsT0FBTyxDQUFDQyxNQUFSLENBQWVGLEtBQWYsQ0FBUDtBQUNIO0FBQ0osQ0FSRDs7QUFVQSxNQUFNUSxPQUFPLEdBQUk1QyxJQUFELElBQVE7QUFDcEIsU0FBT3lCLHNCQUFJQyxJQUFKLENBQ0h5QixJQUFJLENBQUNDLEtBQUwsQ0FBV0QsSUFBSSxDQUFDRSxTQUFMLENBQWVyRCxJQUFmLENBQVgsQ0FERyxFQUVIO0FBQ0E0QixFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsVUFIVCxDQUFQO0FBSUgsQ0FMRDs7ZUFPZTtBQUNYakMsRUFBQUEsTUFEVztBQUVYMEMsRUFBQUEsTUFGVztBQUdYTSxFQUFBQSxNQUhXO0FBSVhDLEVBQUFBO0FBSlcsQyIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcc2VydmljZXNcXGF1dGhcXHVzZS1jYXNlc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcbmltcG9ydCB7VXNlck1vZGVsfSBmcm9tIFwiLi4vLi4vLi4vbW9kZWxzL3VzZXJcIjtcclxuaW1wb3J0IHtTZXNzaW9uTW9kZWx9IGZyb20gXCIuLi8uLi8uLi9tb2RlbHMvc2Vzc2lvblwiO1xyXG4vLyBpbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcclxuaW1wb3J0IGF1dGhSZXBvc2l0b3J5IGZyb20gXCIuLi9kYXRhLWFjY2Vzcy9hdXRoLWRhdGEtYWNjZXNzXCI7XHJcbmltcG9ydCBjbGllbnQgZnJvbSBcIi4uLy4uLy4uL2NvbmZpZy9yZWRpcy1jb25maWdcIjtcclxuaW1wb3J0IHJlZGlzU2VydmljZSBmcm9tIFwiLi4vLi4vcmVkaXMvcmVkaXMtc2VydmljZXNcIlxyXG4vL2xvYWQgb3VyIC5lbnYgZmlsZVxyXG5yZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKVxyXG5cclxuY29uc3QgbW9tZW50ID0gcmVxdWlyZShcIm1vbWVudFwiKVxyXG5cclxuY29uc3Qgc2lnbkluID0gYXN5bmMgKHtwaG9uZU51bWJlciwgcGFzc3dvcmR9KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5zaWduSW4oe3Bob25lTnVtYmVyLCBwYXNzd29yZH0pO1xyXG4gICAgICAgIGNvbnN0IHVzZXJJZCA9IHVzZXIuX2lkXHJcbiAgICAgICAgLy9jaGVjayBpZiBzZXNzaW9uIGV4aXN0cyBpbiBtb25nb2RiIFxyXG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5maW5kU2Vzc2lvbih1c2VySWQpXHJcbiAgICAgICAgY29uc29sZS5sb2coc2Vzc2lvbilcclxuICAgICAgICBsZXQgYWNjZXNzVG9rZW47XHJcblxyXG4gICAgICAgIGlmIChzZXNzaW9uKSB7XHJcbiAgICAgICAgICAgIC8vc2Vzc2lvbiBleGlzdHMgaW4gbW9uZ29kYidcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Nlc3Npc29uIGV4aXN0cycpXHJcbiAgICAgICAgICAgIGxldCB1cGRhdGVkRGF0ZSA9IHNlc3Npb24uZXhwaXJhdGlvbkRhdGU7XHJcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gc2Vzc2lvbi5qd3RUb2tlblxyXG5cclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEF0ID0gbW9tZW50KHNlc3Npb24udXBkYXRlZEF0KVxyXG4gICAgICAgICAgICBjb25zdCBub3cgPSBtb21lbnQobmV3IERhdGUoKSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IChtb21lbnQuZHVyYXRpb24obm93LmRpZmYodXBkYXRlZEF0KSkpLmFzSG91cnMoKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkdXJhdGlvbilcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChkdXJhdGlvbiA+PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVkRGF0ZSA9IChtb21lbnQoc2Vzc2lvbi5leHBpcmF0aW9uRGF0ZSkuYWRkKDEsJ2RheXMnKSkudG9EYXRlKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBpbmNyZWFzZSBjb3VudCBhbmQgZGF0ZSBvZiBzZXNzaW9uXHJcbiAgICAgICAgICAgIGNvbnN0IG5ld1Nlc3Npb24gPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS51cGRhdGVTZXNzaW9uKHNlc3Npb24udXNlckNvdW50KzEsc2Vzc2lvbix1cGRhdGVkRGF0ZSlcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ25ldyBzZXNzaW9uJywgbmV3U2Vzc2lvbilcclxuICAgICAgICAgICAgYXdhaXQgcmVkaXNTZXJ2aWNlLnN0b3JlTmV3U2Vzc2lvbihhY2Nlc3NUb2tlbixuZXdTZXNzaW9uKVxyXG4gICAgICAgIC8vICAgICBsZXQgZGF0YUluUmVkaXM7XHJcbiAgICAgICAgLy8gICAgIGF3YWl0IGNsaWVudC5nZXQoYWNjZXNzVG9rZW4sIGFzeW5jKGVycixzZXNzaW9uRGF0YSkgPT4ge1xyXG4gICAgICAgIC8vICAgICAgICBpZiAoc2Vzc2lvbkRhdGEpIHtcclxuICAgICAgICAvLyAgICAgICAgICAgIGRhdGFJblJlZGlzID0gc2Vzc2lvbkRhdGFcclxuICAgICAgICAvLyAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlc3Npb25EYXRhKVxyXG4gICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgICAgIGVsc2UgaWYgKGVycil7XHJcbiAgICAgICAgLy8gICAgICAgICAgICBjb25zb2xlLmxvZygnZXJycnInKVxyXG4gICAgICAgIC8vICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxyXG4gICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgfSlcclxuICAgICAgICAvLyAgICBjb25zb2xlLmxvZygnZGF0YSBpbiByZWRpcyAnLCBkYXRhSW5SZWRpcylcclxuICAgICAgICB9XHJcbiBcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzZXNzaW9uIGRvZXMgbm90IGV4aXRcIilcclxuICAgICAgICAgICAgLy9zZXNzaW9uIGRvZXNuJ3QgZXhpc3QgY3JlYXRlIGEgbmV3IG9uZVxyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IGF3YWl0IGp3dC5zaWduKHVzZXIudG9KU09OKCksIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQsIHtcclxuICAgICAgICAgICAgICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSQVRJT04sXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgICAgICAgY29uc3QgdG9tb3Jyb3dEYXRlID0gKG1vbWVudCgpLmNsb25lKCkuYWRkKDEsJ2RheXMnKSkudG9EYXRlKClcclxuICAgICAgICAgICAgLy8gc2F2ZSBzZXNzaW9uIGluIG1vbmdvZGJcclxuICAgICAgICAgICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IGF1dGhSZXBvc2l0b3J5LnNhdmVOZXdTZXNzaW9uKHVzZXJJZCxhY2Nlc3NUb2tlbix0b21vcnJvd0RhdGUpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG5ld1Nlc3Npb24pXHJcbiAgICAgICAgICAgIGF3YWl0IHJlZGlzU2VydmljZS5zdG9yZU5ld1Nlc3Npb24oYWNjZXNzVG9rZW4sbmV3U2Vzc2lvbilcclxuICAgICAgICAgICAgLy8gLy8gc3RvcmUgc2Vzc2lvbiBpbiByZWRpc1xyXG4gICAgICAgICAgICAvLyByZWRpc1NlcnZpY2Uuc3RvcmVOZXdTZXNzaW9uKGNsaWVudCxzZXNzaW9uKVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgdXNlcixcclxuICAgICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBzaWduVXAgPSBhc3luYyAoe2ZpcnN0TmFtZSxtaWRkbGVOYW1lLGxhc3ROYW1lLHBhc3N3b3JkLHBob25lTnVtYmVyfSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgYXV0aFJlcG9zaXRvcnkuc2lnblVwKHtmaXJzdE5hbWUsbWlkZGxlTmFtZSxsYXN0TmFtZSxwYXNzd29yZCxwaG9uZU51bWJlcn0pXHJcbiAgICAgICAgY29uc3QgdXNlcklkID0gdXNlci5faWRcclxuICAgICAgICAvL2NoZWNrIGlmIHRoZXJlIGlzIGFuIGVycm9yXHJcbiAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJ1c2VyIGRvZXNuJ3QgZXhpc3RcIikpO1xyXG4gICAgICAgIH1cclxuICAgIC8vd2Ugb25seSBuZWVkIGZpcnN0TmFtZSwgZmF0aGVyc05hbWUsIGxhc3ROYW1lLCByb2xlXHJcbiAgICAgICAgICAgIC8vZGVmaW5lIGEgbmV3IGZ1bmN0aW9uIHRvIHNpZ24gdXNlciBpbmZvcm1hdGlvblxyXG5cclxuICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBqd3RTaWduKHtmaXJzdE5hbWU6dXNlci5maXJzdE5hbWUsIGxhc3ROYW1lOnVzZXIubGFzdE5hbWUsIF9pZDp1c2VyLl9pZH0pO1xyXG4gICAgICAgIC8vIHN0b3JlTmV3U2Vzc2lvbih0b2tlbiwgdXNlciBpbmZvcm1hdGlvbihpZCksIGNvdW50LCBsYXN0IHVwZGF0ZSlcclxuICAgICAgICBjb25zdCB0b21vcnJvd0RhdGUgPSAobW9tZW50KCkuY2xvbmUoKS5hZGQocHJvY2Vzcy5lbnYuSldUX0VYUElSQVRJT04sJ2RheXMnKSkudG9EYXRlKClcclxuICAgICAgICAvLyBzYXZlIHNlc3Npb24gaW4gbW9uZ29kYlxyXG4gICAgICAgIGNvbnN0IG5ld1Nlc3Npb24gPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5zYXZlTmV3U2Vzc2lvbih1c2VySWQsYWNjZXNzVG9rZW4sdG9tb3Jyb3dEYXRlKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiSW4gYXV0aCB1cyBjYXNlXCIsYWNjZXNzVG9rZW4pXHJcbiAgICAgICAgYXdhaXQgcmVkaXNTZXJ2aWNlLnN0b3JlTmV3U2Vzc2lvbihhY2Nlc3NUb2tlbixuZXdTZXNzaW9uKVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuLFxyXG4gICAgICAgICAgICB1c2VyLFxyXG4gICAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IGxvZ291dCA9IGFzeW5jICh7dXNlciwgYWNjZXNzVG9rZW59KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IGF1dGhSZXBvc2l0b3J5LmxvZ291dCh7dXNlciwgYWNjZXNzVG9rZW59KVxyXG4gICAgICAgIGF3YWl0IHJlZGlzU2VydmljZS51cGRhdGVTZXNzaW9uKGFjY2Vzc1Rva2VuKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBjaGFuZ2VQYXNzd29yZCA9IGFzeW5jICh7bmV3UGFzc3dvcmQsIHVzZXIsIGFjY2Vzc1Rva2VufSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7dXBkYXRlZFVzZXIsIG9sZEFjY2Vzc1RvY2tlbn0gPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5jaGFuZ2VQYXNzd29yZCh7bmV3UGFzc3dvcmQsIHVzZXIsIGFjY2Vzc1Rva2VufSlcclxuICAgICAgICBhd2FpdCByZWRpc1NlcnZpY2UuZGVsZXRlU2Vzc2lvbkNvbXBsZXRlbHkoYWNjZXNzVG9rZW4pXHJcbiAgICAgICAgcmV0dXJuIHt1cGRhdGVkVXNlciwgb2xkQWNjZXNzVG9ja2VufTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgIH1cclxufVxyXG5cclxuY29uc3Qgand0U2lnbiA9ICh1c2VyKT0+e1xyXG4gICAgcmV0dXJuIGp3dC5zaWduKFxyXG4gICAgICAgIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodXNlcikpLFxyXG4gICAgICAgIC8vIHJvbGVzOiB1c2VyLnJvbGVzLFxyXG4gICAgICAgIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBzaWduSW4sXHJcbiAgICBzaWduVXAsXHJcbiAgICBsb2dvdXQsXHJcbiAgICBjaGFuZ2VQYXNzd29yZCxcclxufSJdfQ==","map":{"version":3,"sources":["auth-use-cases.js"],"names":["require","config","moment","signIn","phoneNumber","password","user","authRepository","userId","_id","session","findSession","console","log","accessToken","updatedDate","expirationDate","jwtToken","updatedAt","now","Date","duration","diff","asHours","add","toDate","newSession","updateSession","userCount","redisService","storeNewSession","jwt","sign","toJSON","process","env","JWT_SECRET","expiresIn","JWT_EXPIRATION","tomorrowDate","clone","saveNewSession","error","Promise","reject","signUp","firstName","middleName","lastName","Error","jwtSign","logout","changePassword","newPassword","updatedUser","oldAccessTocken","deleteSessionCompletely","JSON","parse","stringify"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\services\\auth\\use-cases\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport {UserModel} from \"../../../models/user\";\r\nimport {SessionModel} from \"../../../models/session\";\r\n// import crypto from \"crypto\";\r\nimport authRepository from \"../data-access/auth-data-access\";\r\nimport client from \"../../../config/redis-config\";\r\nimport redisService from \"../../redis/redis-services\"\r\n//load our .env file\r\nrequire('dotenv').config()\r\n\r\nconst moment = require(\"moment\")\r\n\r\nconst signIn = async ({phoneNumber, password}) => {\r\n    try {\r\n        const user = await authRepository.signIn({phoneNumber, password});\r\n        const userId = user._id\r\n        //check if session exists in mongodb \r\n        const session = await authRepository.findSession(userId)\r\n        console.log(session)\r\n        let accessToken;\r\n\r\n        if (session) {\r\n            //session exists in mongodb'\r\n            console.log('sessison exists')\r\n            let updatedDate = session.expirationDate;\r\n            accessToken = session.jwtToken\r\n\r\n            const updatedAt = moment(session.updatedAt)\r\n            const now = moment(new Date());\r\n            \r\n            const duration = (moment.duration(now.diff(updatedAt))).asHours()\r\n            console.log(duration)\r\n            \r\n            if (duration >= 1) {\r\n                updatedDate = (moment(session.expirationDate).add(1,'days')).toDate()\r\n            }\r\n            // increase count and date of session\r\n            const newSession = await authRepository.updateSession(session.userCount+1,session,updatedDate)\r\n            console.log('new session', newSession)\r\n            await redisService.storeNewSession(accessToken,newSession)\r\n        //     let dataInRedis;\r\n        //     await client.get(accessToken, async(err,sessionData) => {\r\n        //        if (sessionData) {\r\n        //            dataInRedis = sessionData\r\n        //            console.log(sessionData)\r\n        //        }\r\n        //        else if (err){\r\n        //            console.log('errrr')\r\n        //            console.log(err)\r\n        //        }\r\n        //    })\r\n        //    console.log('data in redis ', dataInRedis)\r\n        }\r\n \r\n        else {\r\n            console.log(\"session does not exit\")\r\n            //session doesn't exist create a new one\r\n            accessToken = await jwt.sign(user.toJSON(), process.env.JWT_SECRET, {\r\n                expiresIn: process.env.JWT_EXPIRATION,\r\n            });\r\n      \r\n            const tomorrowDate = (moment().clone().add(1,'days')).toDate()\r\n            // save session in mongodb\r\n            const newSession = await authRepository.saveNewSession(userId,accessToken,tomorrowDate)\r\n            console.log(newSession)\r\n            await redisService.storeNewSession(accessToken,newSession)\r\n            // // store session in redis\r\n            // redisService.storeNewSession(client,session)\r\n        }\r\n        \r\n        return {\r\n            accessToken,\r\n            user,\r\n        };\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst signUp = async ({firstName,middleName,lastName,password,phoneNumber}) => {\r\n    try {\r\n        const user = await authRepository.signUp({firstName,middleName,lastName,password,phoneNumber})\r\n        const userId = user._id\r\n        //check if there is an error\r\n        if (!user) {\r\n            return Promise.reject(new Error(\"user doesn't exist\"));\r\n        }\r\n    //we only need firstName, fathersName, lastName, role\r\n            //define a new function to sign user information\r\n\r\n            const accessToken = jwtSign({firstName:user.firstName, lastName:user.lastName, _id:user._id});\r\n        // storeNewSession(token, user information(id), count, last update)\r\n        const tomorrowDate = (moment().clone().add(process.env.JWT_EXPIRATION,'days')).toDate()\r\n        // save session in mongodb\r\n        const newSession = await authRepository.saveNewSession(userId,accessToken,tomorrowDate)\r\n        console.log(\"In auth us case\",accessToken)\r\n        await redisService.storeNewSession(accessToken,newSession)\r\n        return {\r\n            accessToken,\r\n            user,\r\n        };\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst logout = async ({user, accessToken}) => {\r\n    try {\r\n        await authRepository.logout({user, accessToken})\r\n        await redisService.updateSession(accessToken)\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst changePassword = async ({newPassword, user, accessToken}) => {\r\n    try {\r\n        const {updatedUser, oldAccessTocken} = await authRepository.changePassword({newPassword, user, accessToken})\r\n        await redisService.deleteSessionCompletely(accessToken)\r\n        return {updatedUser, oldAccessTocken};\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst jwtSign = (user)=>{\r\n    return jwt.sign(\r\n        JSON.parse(JSON.stringify(user)),\r\n        // roles: user.roles,\r\n        process.env.JWT_SECRET);\r\n}\r\n\r\nexport default {\r\n    signIn,\r\n    signUp,\r\n    logout,\r\n    changePassword,\r\n}"]}},"mtime":1648792585823},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\session.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SessionTC = exports.SessionSchema = exports.SessionModel = void 0;\n\nvar _mongoose = _interopRequireWildcard(require(\"mongoose\"));\n\nvar _mongooseTimestamp = _interopRequireDefault(require(\"mongoose-timestamp\"));\n\nvar _graphqlComposeMongoose = require(\"graphql-compose-mongoose\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nconst SessionSchema = new _mongoose.Schema({\n  userId: {\n    type: _mongoose.Schema.Types.ObjectId,\n    ref: \"User\"\n  },\n  jwtToken: String,\n  expirationDate: Date,\n  userCount: Number\n}, {\n  collection: \"sessions\"\n});\nexports.SessionSchema = SessionSchema;\nSessionSchema.plugin(_mongooseTimestamp.default);\nSessionSchema.index({\n  createdAt: 1,\n  updatedAt: 1\n});\n\nconst SessionModel = _mongoose.default.model(\"Session\", SessionSchema);\n\nexports.SessionModel = SessionModel;\nconst SessionTC = (0, _graphqlComposeMongoose.composeWithMongoose)(SessionModel);\nexports.SessionTC = SessionTC;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlc3Npb24uanMiXSwibmFtZXMiOlsiU2Vzc2lvblNjaGVtYSIsIlNjaGVtYSIsInVzZXJJZCIsInR5cGUiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwiand0VG9rZW4iLCJTdHJpbmciLCJleHBpcmF0aW9uRGF0ZSIsIkRhdGUiLCJ1c2VyQ291bnQiLCJOdW1iZXIiLCJjb2xsZWN0aW9uIiwicGx1Z2luIiwidGltZXN0YW1wcyIsImluZGV4IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwiU2Vzc2lvbk1vZGVsIiwibW9uZ29vc2UiLCJtb2RlbCIsIlNlc3Npb25UQyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLE1BQU1BLGFBQWEsR0FBRyxJQUFJQyxnQkFBSixDQUFXO0FBQzdCQyxFQUFBQSxNQUFNLEVBQUU7QUFDSkMsSUFBQUEsSUFBSSxFQUFFRixpQkFBT0csS0FBUCxDQUFhQyxRQURmO0FBRUpDLElBQUFBLEdBQUcsRUFBRTtBQUZELEdBRHFCO0FBSzdCQyxFQUFBQSxRQUFRLEVBQUVDLE1BTG1CO0FBTTdCQyxFQUFBQSxjQUFjLEVBQUVDLElBTmE7QUFPN0JDLEVBQUFBLFNBQVMsRUFBRUM7QUFQa0IsQ0FBWCxFQVFuQjtBQUNDQyxFQUFBQSxVQUFVLEVBQUU7QUFEYixDQVJtQixDQUF0Qjs7QUFZQWIsYUFBYSxDQUFDYyxNQUFkLENBQXFCQywwQkFBckI7QUFDQWYsYUFBYSxDQUFDZ0IsS0FBZCxDQUFvQjtBQUNoQkMsRUFBQUEsU0FBUyxFQUFFLENBREs7QUFFaEJDLEVBQUFBLFNBQVMsRUFBRTtBQUZLLENBQXBCOztBQUtBLE1BQU1DLFlBQVksR0FBR0Msa0JBQVNDLEtBQVQsQ0FBZSxTQUFmLEVBQTBCckIsYUFBMUIsQ0FBckI7OztBQUNBLE1BQU1zQixTQUFTLEdBQUcsaURBQW9CSCxZQUFwQixDQUFsQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbW9kZWxzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UsIHtTY2hlbWF9IGZyb20gXCJtb25nb29zZVwiO1xyXG5pbXBvcnQgdGltZXN0YW1wcyBmcm9tIFwibW9uZ29vc2UtdGltZXN0YW1wXCI7XHJcbmltcG9ydCB7Y29tcG9zZVdpdGhNb25nb29zZX0gZnJvbSBcImdyYXBocWwtY29tcG9zZS1tb25nb29zZVwiO1xyXG5cclxuY29uc3QgU2Vzc2lvblNjaGVtYSA9IG5ldyBTY2hlbWEoe1xyXG4gICAgdXNlcklkOiB7XHJcbiAgICAgICAgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgIHJlZjogXCJVc2VyXCIsXHJcbiAgICB9LFxyXG4gICAgand0VG9rZW46IFN0cmluZyxcclxuICAgIGV4cGlyYXRpb25EYXRlOiBEYXRlLFxyXG4gICAgdXNlckNvdW50OiBOdW1iZXIsXHJcbn0sIHtcclxuICAgIGNvbGxlY3Rpb246IFwic2Vzc2lvbnNcIixcclxufSk7XHJcblxyXG5TZXNzaW9uU2NoZW1hLnBsdWdpbih0aW1lc3RhbXBzKTtcclxuU2Vzc2lvblNjaGVtYS5pbmRleCh7XHJcbiAgICBjcmVhdGVkQXQ6IDEsXHJcbiAgICB1cGRhdGVkQXQ6IDEsXHJcbn0pO1xyXG5cclxuY29uc3QgU2Vzc2lvbk1vZGVsID0gbW9uZ29vc2UubW9kZWwoXCJTZXNzaW9uXCIsIFNlc3Npb25TY2hlbWEpO1xyXG5jb25zdCBTZXNzaW9uVEMgPSBjb21wb3NlV2l0aE1vbmdvb3NlKFNlc3Npb25Nb2RlbCk7XHJcblxyXG5leHBvcnQge1Nlc3Npb25Nb2RlbCwgU2Vzc2lvblRDLCBTZXNzaW9uU2NoZW1hfTtcclxuIl19","map":{"version":3,"sources":["session.js"],"names":["SessionSchema","Schema","userId","type","Types","ObjectId","ref","jwtToken","String","expirationDate","Date","userCount","Number","collection","plugin","timestamps","index","createdAt","updatedAt","SessionModel","mongoose","model","SessionTC"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,aAAa,GAAG,IAAIC,gBAAJ,CAAW;AAC7BC,EAAAA,MAAM,EAAE;AACJC,IAAAA,IAAI,EAAEF,iBAAOG,KAAP,CAAaC,QADf;AAEJC,IAAAA,GAAG,EAAE;AAFD,GADqB;AAK7BC,EAAAA,QAAQ,EAAEC,MALmB;AAM7BC,EAAAA,cAAc,EAAEC,IANa;AAO7BC,EAAAA,SAAS,EAAEC;AAPkB,CAAX,EAQnB;AACCC,EAAAA,UAAU,EAAE;AADb,CARmB,CAAtB;;AAYAb,aAAa,CAACc,MAAd,CAAqBC,0BAArB;AACAf,aAAa,CAACgB,KAAd,CAAoB;AAChBC,EAAAA,SAAS,EAAE,CADK;AAEhBC,EAAAA,SAAS,EAAE;AAFK,CAApB;;AAKA,MAAMC,YAAY,GAAGC,kBAASC,KAAT,CAAe,SAAf,EAA0BrB,aAA1B,CAArB;;;AACA,MAAMsB,SAAS,GAAG,iDAAoBH,YAApB,CAAlB","sourceRoot":"E:\\haleta-new-api\\src\\models\\","sourcesContent":["import mongoose, {Schema} from \"mongoose\";\r\nimport timestamps from \"mongoose-timestamp\";\r\nimport {composeWithMongoose} from \"graphql-compose-mongoose\";\r\n\r\nconst SessionSchema = new Schema({\r\n    userId: {\r\n        type: Schema.Types.ObjectId,\r\n        ref: \"User\",\r\n    },\r\n    jwtToken: String,\r\n    expirationDate: Date,\r\n    userCount: Number,\r\n}, {\r\n    collection: \"sessions\",\r\n});\r\n\r\nSessionSchema.plugin(timestamps);\r\nSessionSchema.index({\r\n    createdAt: 1,\r\n    updatedAt: 1,\r\n});\r\n\r\nconst SessionModel = mongoose.model(\"Session\", SessionSchema);\r\nconst SessionTC = composeWithMongoose(SessionModel);\r\n\r\nexport {SessionModel, SessionTC, SessionSchema};\r\n"]}},"mtime":1648685190383},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\data-access\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\data-access\\\\auth-data-access.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _session = require(\"../../../models/session\");\n\nvar _bcrypt = _interopRequireDefault(require(\"bcrypt\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\nconst signIn = async ({\n  phoneNumber,\n  password\n}) => {\n  try {\n    const user = await _user.UserModel.findOne({\n      phoneNumber\n    }); // const comparePassword = await user.comparePassword(password.toString());\n\n    const comparePassword = password.toString() === user.password;\n\n    if (!comparePassword) {\n      return Promise.reject(new Error(\"Password is incorrect.\"));\n    }\n\n    return user;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst saveNewSession = async (userId, jwtToken, tomorrowDate) => {\n  try {\n    const newSession = await new _session.SessionModel({\n      userId: userId,\n      jwtToken: jwtToken,\n      expirationDate: tomorrowDate,\n      userCount: 1\n    }).save();\n    return newSession;\n  } catch (error) {\n    console.log('error in saving new session');\n    console.log(error);\n    return Promise.reject(error);\n  }\n};\n\nconst findSession = async userId => {\n  try {\n    const session = await _session.SessionModel.findOne({\n      userId\n    });\n    return session;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst updateSession = async (count, session, updatedDate) => {\n  try {\n    session.userCount = count;\n    session.expirationDate = updatedDate;\n    const newSession = await session.save();\n    return newSession;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst deleteSession = async session => {\n  try {\n    console.log('remove');\n    await session.remove();\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst signUp = async ({\n  firstName,\n  middleName,\n  lastName,\n  phoneNumber,\n  password\n}) => {\n  try {\n    let user = await _user.UserModel.phoneNumberExist(phoneNumber);\n\n    if (user) {\n      console.log(\"here 2\");\n      return Promise.reject(new Error(\"Phone Number has already been taken.\"));\n    } // user = await UserModel.emailExist(email);\n    // if (user) {\n    //   return Promise.reject(new Error(\"Email has already been taken.\"));\n    // }\n\n\n    const salt = _bcrypt.default.genSalt(10);\n\n    const hash = _bcrypt.default.hashSync(password, salt);\n\n    user = await new _user.UserModel({\n      firstName,\n      middleName,\n      lastName,\n      phoneNumber,\n      hash\n    }).save();\n    return user;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst logout = async ({\n  user,\n  accessToken\n}) => {\n  try {\n    const userId = user._id;\n    const session = await findSession(userId);\n    const count = session.userCount;\n\n    if (count > 1) {\n      count -= 1;\n      updateSession(count, session, session.expirationDate);\n    } //delete session\n    else if (count === 1) {\n      deleteSession(session);\n    }\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nconst changePassword = async ({\n  newPassword,\n  user,\n  accessToken\n}) => {\n  try {\n    console.log(\"sim user: \", user);\n    console.log(\"new password: \", newPassword);\n    console.log(\"pass: \", user.password);\n    const userphone = user.phoneNumber;\n    const userWith = await _user.UserModel.findOne({\n      userphone\n    });\n    const userId = userWith._id;\n    const session = await findSession(userId);\n    userWith.password = newPassword;\n    const updatedUser = await userWith.save(function (err) {\n      if (err) return handleErr(err); //user has been updated\n\n      console.log(\"success\");\n    });\n    const oldAccessTocken = accessToken; //delete session\n\n    await deleteSession(session);\n    return {\n      updatedUser,\n      oldAccessTocken\n    };\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nvar _default = {\n  signIn,\n  signUp,\n  saveNewSession,\n  findSession,\n  updateSession,\n  logout,\n  changePassword,\n  deleteSession\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtZGF0YS1hY2Nlc3MuanMiXSwibmFtZXMiOlsic2lnbkluIiwicGhvbmVOdW1iZXIiLCJwYXNzd29yZCIsInVzZXIiLCJVc2VyTW9kZWwiLCJmaW5kT25lIiwiY29tcGFyZVBhc3N3b3JkIiwidG9TdHJpbmciLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiLCJlcnJvciIsInNhdmVOZXdTZXNzaW9uIiwidXNlcklkIiwiand0VG9rZW4iLCJ0b21vcnJvd0RhdGUiLCJuZXdTZXNzaW9uIiwiU2Vzc2lvbk1vZGVsIiwiZXhwaXJhdGlvbkRhdGUiLCJ1c2VyQ291bnQiLCJzYXZlIiwiY29uc29sZSIsImxvZyIsImZpbmRTZXNzaW9uIiwic2Vzc2lvbiIsInVwZGF0ZVNlc3Npb24iLCJjb3VudCIsInVwZGF0ZWREYXRlIiwiZGVsZXRlU2Vzc2lvbiIsInJlbW92ZSIsInNpZ25VcCIsImZpcnN0TmFtZSIsIm1pZGRsZU5hbWUiLCJsYXN0TmFtZSIsInBob25lTnVtYmVyRXhpc3QiLCJzYWx0IiwiYmNyeXB0IiwiZ2VuU2FsdCIsImhhc2giLCJoYXNoU3luYyIsImxvZ291dCIsImFjY2Vzc1Rva2VuIiwiX2lkIiwiY2hhbmdlUGFzc3dvcmQiLCJuZXdQYXNzd29yZCIsInVzZXJwaG9uZSIsInVzZXJXaXRoIiwidXBkYXRlZFVzZXIiLCJlcnIiLCJoYW5kbGVFcnIiLCJvbGRBY2Nlc3NUb2NrZW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBO0FBRUEsTUFBTUEsTUFBTSxHQUFHLE9BQU87QUFBRUMsRUFBQUEsV0FBRjtBQUFlQyxFQUFBQTtBQUFmLENBQVAsS0FBcUM7QUFDbEQsTUFBSTtBQUNGLFVBQU1DLElBQUksR0FBRyxNQUFNQyxnQkFBVUMsT0FBVixDQUFrQjtBQUFFSixNQUFBQTtBQUFGLEtBQWxCLENBQW5CLENBREUsQ0FHRjs7QUFDQSxVQUFNSyxlQUFlLEdBQUlKLFFBQVEsQ0FBQ0ssUUFBVCxP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QUFZWCxLQUFaO0FBQ0Q7QUFDRixDQXZCRDs7ZUF5QmU7QUFDYlgsRUFBQUEsTUFEYTtBQUViOEIsRUFBQUEsTUFGYTtBQUdibEIsRUFBQUEsY0FIYTtBQUliVyxFQUFBQSxXQUphO0FBS2JFLEVBQUFBLGFBTGE7QUFNYmUsRUFBQUEsTUFOYTtBQU9iRyxFQUFBQSxjQVBhO0FBUWJmLEVBQUFBO0FBUmEsQyIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcc2VydmljZXNcXGF1dGhcXGRhdGEtYWNjZXNzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcclxuaW1wb3J0IHsgVXNlck1vZGVsIH0gZnJvbSBcIi4uLy4uLy4uL21vZGVscy91c2VyXCI7XHJcbmltcG9ydCB7U2Vzc2lvbk1vZGVsfSBmcm9tIFwiLi4vLi4vLi4vbW9kZWxzL3Nlc3Npb25cIjtcclxuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHQnO1xyXG5cclxuLy8gaW1wb3J0IGNyeXB0byBmcm9tIFwiY3J5cHRvXCI7XHJcblxyXG5jb25zdCBzaWduSW4gPSBhc3luYyAoeyBwaG9uZU51bWJlciwgcGFzc3dvcmQgfSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlck1vZGVsLmZpbmRPbmUoeyBwaG9uZU51bWJlciB9KTtcclxuXHJcbiAgICAvLyBjb25zdCBjb21wYXJlUGFzc3dvcmQgPSBhd2FpdCB1c2VyLmNvbXBhcmVQYXNzd29yZChwYXNzd29yZC50b1N0cmluZygpKTtcclxuICAgIGNvbnN0IGNvbXBhcmVQYXNzd29yZCA9IChwYXNzd29yZC50b1N0cmluZygpID09PSB1c2VyLnBhc3N3b3JkKVxyXG4gICAgaWYgKCFjb21wYXJlUGFzc3dvcmQpIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIlBhc3N3b3JkIGlzIGluY29ycmVjdC5cIikpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB1c2VyO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IHNhdmVOZXdTZXNzaW9uID0gYXN5bmModXNlcklkLGp3dFRva2VuLHRvbW9ycm93RGF0ZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBuZXdTZXNzaW9uID0gYXdhaXQgbmV3IFNlc3Npb25Nb2RlbCh7XHJcbiAgICAgIHVzZXJJZDp1c2VySWQsXHJcbiAgICAgIGp3dFRva2VuOmp3dFRva2VuLFxyXG4gICAgICBleHBpcmF0aW9uRGF0ZTp0b21vcnJvd0RhdGUsXHJcbiAgICAgIHVzZXJDb3VudDoxXHJcbiAgfSkuc2F2ZSgpO1xyXG4gIHJldHVybiBuZXdTZXNzaW9uXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUubG9nKCdlcnJvciBpbiBzYXZpbmcgbmV3IHNlc3Npb24nKVxyXG4gICAgY29uc29sZS5sb2coZXJyb3IpXHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgZmluZFNlc3Npb24gPSBhc3luYyh1c2VySWQpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IFNlc3Npb25Nb2RlbC5maW5kT25lKHt1c2VySWR9KTtcclxuICAgIHJldHVybiBzZXNzaW9uO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgdXBkYXRlU2Vzc2lvbiA9IGFzeW5jKGNvdW50LHNlc3Npb24sdXBkYXRlZERhdGUpICA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIHNlc3Npb24udXNlckNvdW50ID0gY291bnRcclxuICAgIHNlc3Npb24uZXhwaXJhdGlvbkRhdGUgPSB1cGRhdGVkRGF0ZVxyXG4gICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IHNlc3Npb24uc2F2ZSgpXHJcbiAgICByZXR1cm4gbmV3U2Vzc2lvblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgZGVsZXRlU2Vzc2lvbiA9IGFzeW5jKHNlc3Npb24pICA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKCdyZW1vdmUnKVxyXG4gICAgYXdhaXQgc2Vzc2lvbi5yZW1vdmUoKVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuXHJcbmNvbnN0IHNpZ25VcCA9IGFzeW5jICh7XHJcbiAgZmlyc3ROYW1lLFxyXG4gIG1pZGRsZU5hbWUsXHJcbiAgbGFzdE5hbWUsXHJcbiAgcGhvbmVOdW1iZXIsXHJcbiAgcGFzc3dvcmQsXHJcbn0pID0+IHtcclxuICB0cnkge1xyXG5cclxuICAgIGxldCB1c2VyID0gYXdhaXQgVXNlck1vZGVsLnBob25lTnVtYmVyRXhpc3QocGhvbmVOdW1iZXIpO1xyXG4gICAgaWYgKHVzZXIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImhlcmUgMlwiKVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJQaG9uZSBOdW1iZXIgaGFzIGFscmVhZHkgYmVlbiB0YWtlbi5cIikpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHVzZXIgPSBhd2FpdCBVc2VyTW9kZWwuZW1haWxFeGlzdChlbWFpbCk7XHJcbiAgICAvLyBpZiAodXNlcikge1xyXG4gICAgLy8gICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRW1haWwgaGFzIGFscmVhZHkgYmVlbiB0YWtlbi5cIikpO1xyXG4gICAgLy8gfVxyXG4gICAgY29uc3Qgc2FsdCA9IGJjcnlwdC5nZW5TYWx0KDEwKTtcclxuICAgIGNvbnN0IGhhc2ggPSBiY3J5cHQuaGFzaFN5bmMocGFzc3dvcmQsIHNhbHQpO1xyXG5cclxuICAgIHVzZXIgPSBhd2FpdCBuZXcgVXNlck1vZGVsKHtcclxuICAgICAgZmlyc3ROYW1lLFxyXG4gICAgICBtaWRkbGVOYW1lLFxyXG4gICAgICBsYXN0TmFtZSxcclxuICAgICAgcGhvbmVOdW1iZXIsXHJcbiAgICAgIGhhc2gsXHJcbiAgICB9KS5zYXZlKCk7XHJcblxyXG4gICAgcmV0dXJuIHVzZXI7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgbG9nb3V0ID0gYXN5bmMoe3VzZXIsIGFjY2Vzc1Rva2VufSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1c2VySWQgPSB1c2VyLl9pZFxyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGZpbmRTZXNzaW9uKHVzZXJJZClcclxuICAgIGNvbnN0IGNvdW50ID0gc2Vzc2lvbi51c2VyQ291bnRcclxuICAgIGlmIChjb3VudCA+IDEpIHtcclxuICAgICAgY291bnQgLT0gMVxyXG4gICAgICB1cGRhdGVTZXNzaW9uKGNvdW50LHNlc3Npb24sc2Vzc2lvbi5leHBpcmF0aW9uRGF0ZSlcclxuICAgIH1cclxuICAgIC8vZGVsZXRlIHNlc3Npb25cclxuICAgIGVsc2UgaWYgKGNvdW50ID09PSAxKSB7XHJcbiAgICAgIGRlbGV0ZVNlc3Npb24oc2Vzc2lvbilcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5sb2coZXJyb3IpXHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBjaGFuZ2VQYXNzd29yZCA9IGFzeW5jKHtuZXdQYXNzd29yZCwgdXNlciwgYWNjZXNzVG9rZW59KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKFwic2ltIHVzZXI6IFwiLHVzZXIpXHJcbiAgICBjb25zb2xlLmxvZyhcIm5ldyBwYXNzd29yZDogXCIsbmV3UGFzc3dvcmQpXHJcbiAgICBjb25zb2xlLmxvZyhcInBhc3M6IFwiLCB1c2VyLnBhc3N3b3JkKVxyXG4gICAgY29uc3QgdXNlcnBob25lID0gdXNlci5waG9uZU51bWJlclxyXG4gICAgY29uc3QgdXNlcldpdGggPSBhd2FpdCBVc2VyTW9kZWwuZmluZE9uZSh7IHVzZXJwaG9uZSB9KTtcclxuICAgIGNvbnN0IHVzZXJJZCA9IHVzZXJXaXRoLl9pZFxyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGZpbmRTZXNzaW9uKHVzZXJJZClcclxuXHJcbiAgICB1c2VyV2l0aC5wYXNzd29yZD1uZXdQYXNzd29yZFxyXG4gICAgY29uc3QgdXBkYXRlZFVzZXIgPSBhd2FpdCB1c2VyV2l0aC5zYXZlKGZ1bmN0aW9uKGVycil7XHJcbiAgICAgIGlmKGVycilyZXR1cm4gaGFuZGxlRXJyKGVycik7XHJcbiAgICAgIC8vdXNlciBoYXMgYmVlbiB1cGRhdGVkXHJcbiAgICAgIGNvbnNvbGUubG9nKFwic3VjY2Vzc1wiKVxyXG4gICAgfSlcclxuICAgIGNvbnN0IG9sZEFjY2Vzc1RvY2tlbiA9IGFjY2Vzc1Rva2VuXHJcbiAgICAvL2RlbGV0ZSBzZXNzaW9uXHJcbiAgICBhd2FpdCBkZWxldGVTZXNzaW9uKHNlc3Npb24pXHJcbiAgICAgIHJldHVybiB7dXBkYXRlZFVzZXIsIG9sZEFjY2Vzc1RvY2tlbn07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQge1xyXG4gIHNpZ25JbixcclxuICBzaWduVXAsXHJcbiAgc2F2ZU5ld1Nlc3Npb24sXHJcbiAgZmluZFNlc3Npb24sXHJcbiAgdXBkYXRlU2Vzc2lvbixcclxuICBsb2dvdXQsXHJcbiAgY2hhbmdlUGFzc3dvcmQsXHJcbiAgZGVsZXRlU2Vzc2lvbixcclxufTtcclxuIl19","map":{"version":3,"sources":["auth-data-access.js"],"names":["signIn","phoneNumber","password","user","UserModel","findOne","comparePassword","toString","Promise","reject","Error","error","saveNewSession","userId","jwtToken","tomorrowDate","newSession","SessionModel","expirationDate","userCount","save","console","log","findSession","session","updateSession","count","updatedDate","deleteSession","remove","signUp","firstName","middleName","lastName","phoneNumberExist","salt","bcrypt","genSalt","hash","hashSync","logout","accessToken","_id","changePassword","newPassword","userphone","userWith","updatedUser","err","handleErr","oldAccessTocken"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\services\\auth\\data-access\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { UserModel } from \"../../../models/user\";\r\nimport {SessionModel} from \"../../../models/session\";\r\nimport bcrypt from 'bcrypt';\r\n\r\n// import crypto from \"crypto\";\r\n\r\nconst signIn = async ({ phoneNumber, password }) => {\r\n  try {\r\n    const user = await UserModel.findOne({ phoneNumber });\r\n\r\n    // const comparePassword = await user.comparePassword(password.toString());\r\n    const comparePassword = (password.toString() === user.password)\r\n    if (!comparePassword) {\r\n      return Promise.reject(new Error(\"Password is incorrect.\"));\r\n    }\r\n\r\n    return user;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n\r\nconst saveNewSession = async(userId,jwtToken,tomorrowDate) => {\r\n  try {\r\n    const newSession = await new SessionModel({\r\n      userId:userId,\r\n      jwtToken:jwtToken,\r\n      expirationDate:tomorrowDate,\r\n      userCount:1\r\n  }).save();\r\n  return newSession\r\n  } catch (error) {\r\n    console.log('error in saving new session')\r\n    console.log(error)\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst findSession = async(userId) => {\r\n  try {\r\n    const session = await SessionModel.findOne({userId});\r\n    return session;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst updateSession = async(count,session,updatedDate)  => {\r\n  try {\r\n    session.userCount = count\r\n    session.expirationDate = updatedDate\r\n    const newSession = await session.save()\r\n    return newSession\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst deleteSession = async(session)  => {\r\n  try {\r\n    console.log('remove')\r\n    await session.remove()\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\n\r\nconst signUp = async ({\r\n  firstName,\r\n  middleName,\r\n  lastName,\r\n  phoneNumber,\r\n  password,\r\n}) => {\r\n  try {\r\n\r\n    let user = await UserModel.phoneNumberExist(phoneNumber);\r\n    if (user) {\r\n        console.log(\"here 2\")\r\n        return Promise.reject(new Error(\"Phone Number has already been taken.\"));\r\n    }\r\n\r\n    // user = await UserModel.emailExist(email);\r\n    // if (user) {\r\n    //   return Promise.reject(new Error(\"Email has already been taken.\"));\r\n    // }\r\n    const salt = bcrypt.genSalt(10);\r\n    const hash = bcrypt.hashSync(password, salt);\r\n\r\n    user = await new UserModel({\r\n      firstName,\r\n      middleName,\r\n      lastName,\r\n      phoneNumber,\r\n      hash,\r\n    }).save();\r\n\r\n    return user;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n\r\nconst logout = async({user, accessToken}) => {\r\n  try {\r\n    const userId = user._id\r\n    const session = await findSession(userId)\r\n    const count = session.userCount\r\n    if (count > 1) {\r\n      count -= 1\r\n      updateSession(count,session,session.expirationDate)\r\n    }\r\n    //delete session\r\n    else if (count === 1) {\r\n      deleteSession(session)\r\n    }\r\n  } catch (error) {\r\n    console.log(error)\r\n  }\r\n}\r\n\r\nconst changePassword = async({newPassword, user, accessToken}) => {\r\n  try {\r\n    console.log(\"sim user: \",user)\r\n    console.log(\"new password: \",newPassword)\r\n    console.log(\"pass: \", user.password)\r\n    const userphone = user.phoneNumber\r\n    const userWith = await UserModel.findOne({ userphone });\r\n    const userId = userWith._id\r\n    const session = await findSession(userId)\r\n\r\n    userWith.password=newPassword\r\n    const updatedUser = await userWith.save(function(err){\r\n      if(err)return handleErr(err);\r\n      //user has been updated\r\n      console.log(\"success\")\r\n    })\r\n    const oldAccessTocken = accessToken\r\n    //delete session\r\n    await deleteSession(session)\r\n      return {updatedUser, oldAccessTocken};\r\n  } catch (error) {\r\n    console.log(error)\r\n  }\r\n}\r\n\r\nexport default {\r\n  signIn,\r\n  signUp,\r\n  saveNewSession,\r\n  findSession,\r\n  updateSession,\r\n  logout,\r\n  changePassword,\r\n  deleteSession,\r\n};\r\n"]}},"mtime":1648783962346},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\redis-config.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _ioredis = _interopRequireDefault(require(\"ioredis\"));\n\nvar _winston = _interopRequireDefault(require(\"winston\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst client = new _ioredis.default({\n  host: process.env.REDIS_HOST,\n  port: process.env.REDIS_PORT //REDIS_PORT=6379\n\n});\nclient.on(\"error\", error => {\n  console.log('ðŸ˜’');\n  console.log(error);\n\n  _winston.default.error(error);\n\n  client.quit().then(e => console.log(e));\n});\nclient.on(\"connect\", () => _winston.default.info(\"Redis client connected\"));\nvar _default = client;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZGlzLWNvbmZpZy5qcyJdLCJuYW1lcyI6WyJjbGllbnQiLCJSZWRpcyIsImhvc3QiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfSE9TVCIsInBvcnQiLCJSRURJU19QT1JUIiwib24iLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJ3aW5zdG9uIiwicXVpdCIsInRoZW4iLCJlIiwiaW5mbyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHLElBQUlDLGdCQUFKLENBQVU7QUFDdkJDLEVBQUFBLElBQUksRUFBRUMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBREs7QUFFdkJDLEVBQUFBLElBQUksRUFBRUgsT0FBTyxDQUFDQyxHQUFSLENBQVlHLFVBRkssQ0FFTzs7QUFGUCxDQUFWLENBQWY7QUFLQVAsTUFBTSxDQUFDUSxFQUFQLENBQVUsT0FBVixFQUFvQkMsS0FBRCxJQUFXO0FBQzVCQyxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxJQUFaO0FBQ0FELEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixLQUFaOztBQUNBRyxtQkFBUUgsS0FBUixDQUFjQSxLQUFkOztBQUNBVCxFQUFBQSxNQUFNLENBQUNhLElBQVAsR0FBY0MsSUFBZCxDQUFvQkMsQ0FBRCxJQUFPTCxPQUFPLENBQUNDLEdBQVIsQ0FBWUksQ0FBWixDQUExQjtBQUNELENBTEQ7QUFPQWYsTUFBTSxDQUFDUSxFQUFQLENBQVUsU0FBVixFQUFxQixNQUFNSSxpQkFBUUksSUFBUixDQUFhLHdCQUFiLENBQTNCO2VBRWVoQixNIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxjb25maWdcXCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWRpcyBmcm9tIFwiaW9yZWRpc1wiO1xyXG5pbXBvcnQgd2luc3RvbiBmcm9tIFwid2luc3RvblwiO1xyXG5cclxuY29uc3QgY2xpZW50ID0gbmV3IFJlZGlzKHtcclxuICBob3N0OiBwcm9jZXNzLmVudi5SRURJU19IT1NULFxyXG4gIHBvcnQ6IHByb2Nlc3MuZW52LlJFRElTX1BPUlQsIC8vUkVESVNfUE9SVD02Mzc5XHJcbn0pO1xyXG5cclxuY2xpZW50Lm9uKFwiZXJyb3JcIiwgKGVycm9yKSA9PiB7XHJcbiAgY29uc29sZS5sb2coJ/CfmJInKVxyXG4gIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gIHdpbnN0b24uZXJyb3IoZXJyb3IpO1xyXG4gIGNsaWVudC5xdWl0KCkudGhlbigoZSkgPT4gY29uc29sZS5sb2coZSkpO1xyXG59KTtcclxuXHJcbmNsaWVudC5vbihcImNvbm5lY3RcIiwgKCkgPT4gd2luc3Rvbi5pbmZvKFwiUmVkaXMgY2xpZW50IGNvbm5lY3RlZFwiKSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnQ7XHJcbiJdfQ==","map":{"version":3,"sources":["redis-config.js"],"names":["client","Redis","host","process","env","REDIS_HOST","port","REDIS_PORT","on","error","console","log","winston","quit","then","e","info"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,MAAM,GAAG,IAAIC,gBAAJ,CAAU;AACvBC,EAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYC,UADK;AAEvBC,EAAAA,IAAI,EAAEH,OAAO,CAACC,GAAR,CAAYG,UAFK,CAEO;;AAFP,CAAV,CAAf;AAKAP,MAAM,CAACQ,EAAP,CAAU,OAAV,EAAoBC,KAAD,IAAW;AAC5BC,EAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACAD,EAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;;AACAG,mBAAQH,KAAR,CAAcA,KAAd;;AACAT,EAAAA,MAAM,CAACa,IAAP,GAAcC,IAAd,CAAoBC,CAAD,IAAOL,OAAO,CAACC,GAAR,CAAYI,CAAZ,CAA1B;AACD,CALD;AAOAf,MAAM,CAACQ,EAAP,CAAU,SAAV,EAAqB,MAAMI,iBAAQI,IAAR,CAAa,wBAAb,CAA3B;eAEehB,M","sourceRoot":"E:\\haleta-new-api\\src\\config\\","sourcesContent":["import Redis from \"ioredis\";\r\nimport winston from \"winston\";\r\n\r\nconst client = new Redis({\r\n  host: process.env.REDIS_HOST,\r\n  port: process.env.REDIS_PORT, //REDIS_PORT=6379\r\n});\r\n\r\nclient.on(\"error\", (error) => {\r\n  console.log('ðŸ˜’')\r\n  console.log(error)\r\n  winston.error(error);\r\n  client.quit().then((e) => console.log(e));\r\n});\r\n\r\nclient.on(\"connect\", () => winston.info(\"Redis client connected\"));\r\n\r\nexport default client;\r\n"]}},"mtime":1648685190379},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\redis\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\redis\\\\redis-services.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _redisConfig = _interopRequireDefault(require(\"../../config/redis-config\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//add to redis\n//delete single token data(token string)\nconst updateSession = async accessToken => {\n  console.log('deleting session redis');\n  let userSession;\n  await _redisConfig.default.get(accessToken, (err, sessionData) => {\n    if (sessionData) {\n      console.log('here');\n      userSession = sessionData;\n      console.log(sessionData);\n    } else if (err) {\n      console.log('errrr');\n      console.log(err);\n    }\n  });\n  console.log(accessToken);\n  console.log(userSession);\n  userSession = JSON.parse(userSession);\n  console.log(userSession);\n  console.log(userSession.userCount);\n  const count = userSession.userCount;\n\n  if (count > 1) {\n    userSession.count -= 1;\n    syncWithRedis(_redisConfig.default, accessToken, userSession);\n  } //delete session\n  else if (count === 1) {\n    console.log('deleting from redis');\n\n    _redisConfig.default.del(accessToken);\n  }\n};\n\nconst deleteSessionCompletely = async accessToken => {\n  console.log('deleting session redis');\n  let userSession;\n  await _redisConfig.default.get(accessToken, (err, sessionData) => {\n    if (sessionData) {\n      console.log('here');\n      userSession = sessionData;\n      console.log(sessionData);\n    } else if (err) {\n      console.log('errrr');\n      console.log(err);\n    }\n  });\n  console.log(accessToken);\n  console.log(userSession);\n  userSession = JSON.parse(userSession);\n  console.log(userSession);\n  console.log(userSession.userCount);\n  const count = userSession.userCount;\n  console.log('deleting from redis');\n\n  _redisConfig.default.del(accessToken);\n}; //update single token data\n\n\nconst storeNewSession = async (accessToken, session) => {\n  //fetch from mongodb\n  //update the whole cache\n  console.log(accessToken);\n  console.log('in sync wi redis', session);\n\n  _redisConfig.default.set(accessToken, JSON.stringify(session), (err, reply) => {\n    if (err) {\n      console.log(err.message);\n      console.log('errrr');\n      return Promise.reject(err);\n    }\n\n    console.log('resolving');\n    return Promise.resolve(session);\n  });\n};\n\nconst checkValueInRedis = async accessToken => {\n  console.log('cheking session redis');\n  let userSession;\n  const value = await _redisConfig.default.get(accessToken, (err, sessionData) => {\n    if (sessionData) {\n      console.log('here');\n      userSession = sessionData;\n      console.log(sessionData);\n    } else if (err) {\n      console.log('errrr');\n      console.log(err);\n    }\n  });\n  console.log(accessToken);\n  console.log(userSession);\n  userSession = JSON.parse(userSession);\n  console.log(userSession);\n  console.log(userSession.userCount);\n  return userSession;\n};\n\nvar _default = {\n  storeNewSession,\n  updateSession,\n  deleteSessionCompletely,\n  checkValueInRedis\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZGlzLXNlcnZpY2VzLmpzIl0sIm5hbWVzIjpbInVwZGF0ZVNlc3Npb24iLCJhY2Nlc3NUb2tlbiIsImNvbnNvbGUiLCJsb2ciLCJ1c2VyU2Vzc2lvbiIsImNsaWVudCIsImdldCIsImVyciIsInNlc3Npb25EYXRhIiwiSlNPTiIsInBhcnNlIiwidXNlckNvdW50IiwiY291bnQiLCJzeW5jV2l0aFJlZGlzIiwiZGVsIiwiZGVsZXRlU2Vzc2lvbkNvbXBsZXRlbHkiLCJzdG9yZU5ld1Nlc3Npb24iLCJzZXNzaW9uIiwic2V0Iiwic3RyaW5naWZ5IiwicmVwbHkiLCJtZXNzYWdlIiwiUHJvbWlzZSIsInJlamVjdCIsInJlc29sdmUiLCJjaGVja1ZhbHVlSW5SZWRpcyIsInZhbHVlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7QUFFQTtBQUVBO0FBQ0EsTUFBTUEsYUFBYSxHQUFHLE1BQU9DLFdBQVAsSUFBdUI7QUFDekNDLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHdCQUFaO0FBQ0EsTUFBSUMsV0FBSjtBQUNBLFFBQU1DLHFCQUFPQyxHQUFQLENBQVdMLFdBQVgsRUFBd0IsQ0FBQ00sR0FBRCxFQUFLQyxXQUFMLEtBQXFCO0FBQy9DLFFBQUlBLFdBQUosRUFBaUI7QUFDYk4sTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksTUFBWjtBQUNBQyxNQUFBQSxXQUFXLEdBQUdJLFdBQWQ7QUFDQU4sTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlLLFdBQVo7QUFDSCxLQUpELE1BS0ssSUFBSUQsR0FBSixFQUFRO0FBQ1RMLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLE9BQVo7QUFDQUQsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlJLEdBQVo7QUFDSDtBQUNKLEdBVkssQ0FBTjtBQVdBTCxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUYsV0FBWjtBQUNBQyxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsV0FBWjtBQUNBQSxFQUFBQSxX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QUFDQyxHQUFSLENBQVksdUJBQVo7QUFDQSxNQUFJQyxXQUFKO0FBQ0EsUUFBTXNCLEtBQUssR0FBRyxNQUFNckIscUJBQU9DLEdBQVAsQ0FBV0wsV0FBWCxFQUF3QixDQUFDTSxHQUFELEVBQUtDLFdBQUwsS0FBcUI7QUFDN0QsUUFBSUEsV0FBSixFQUFpQjtBQUNiTixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxNQUFaO0FBQ0FDLE1BQUFBLFdBQVcsR0FBR0ksV0FBZDtBQUNBTixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUssV0FBWjtBQUNILEtBSkQsTUFLSyxJQUFJRCxHQUFKLEVBQVE7QUFDVEwsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksT0FBWjtBQUNBRCxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUksR0FBWjtBQUNIO0FBQ0osR0FWbUIsQ0FBcEI7QUFXQUwsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlGLFdBQVo7QUFDQUMsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFdBQVo7QUFDQUEsRUFBQUEsV0FBVyxHQUFHSyxJQUFJLENBQUNDLEtBQUwsQ0FBV04sV0FBWCxDQUFkO0FBQ0FGLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxXQUFaO0FBQ0FGLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxXQUFXLENBQUNPLFNBQXhCO0FBQ0EsU0FBT1AsV0FBUDtBQUNILENBcEJEOztlQXNCZTtBQUNYWSxFQUFBQSxlQURXO0FBRVhoQixFQUFBQSxhQUZXO0FBR1hlLEVBQUFBLHVCQUhXO0FBSVhVLEVBQUFBO0FBSlcsQyIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcc2VydmljZXNcXHJlZGlzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2xpZW50IGZyb20gXCIuLi8uLi9jb25maWcvcmVkaXMtY29uZmlnXCI7XHJcblxyXG4vL2FkZCB0byByZWRpc1xyXG5cclxuLy9kZWxldGUgc2luZ2xlIHRva2VuIGRhdGEodG9rZW4gc3RyaW5nKVxyXG5jb25zdCB1cGRhdGVTZXNzaW9uID0gYXN5bmMgKGFjY2Vzc1Rva2VuKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygnZGVsZXRpbmcgc2Vzc2lvbiByZWRpcycpXHJcbiAgICBsZXQgdXNlclNlc3Npb247XHJcbiAgICBhd2FpdCBjbGllbnQuZ2V0KGFjY2Vzc1Rva2VuLCAoZXJyLHNlc3Npb25EYXRhKSA9PiB7XHJcbiAgICAgICAgaWYgKHNlc3Npb25EYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdoZXJlJylcclxuICAgICAgICAgICAgdXNlclNlc3Npb24gPSBzZXNzaW9uRGF0YVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzZXNzaW9uRGF0YSlcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZXJyKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycnJyJylcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICBjb25zb2xlLmxvZyhhY2Nlc3NUb2tlbilcclxuICAgIGNvbnNvbGUubG9nKHVzZXJTZXNzaW9uKVxyXG4gICAgdXNlclNlc3Npb24gPSBKU09OLnBhcnNlKHVzZXJTZXNzaW9uKVxyXG4gICAgY29uc29sZS5sb2codXNlclNlc3Npb24pXHJcbiAgICBjb25zb2xlLmxvZyh1c2VyU2Vzc2lvbi51c2VyQ291bnQpXHJcbiAgICBjb25zdCBjb3VudCA9IHVzZXJTZXNzaW9uLnVzZXJDb3VudFxyXG4gICAgaWYgKGNvdW50ID4gMSkge1xyXG4gICAgICAgIHVzZXJTZXNzaW9uLmNvdW50IC09IDFcclxuICAgICAgICBzeW5jV2l0aFJlZGlzKGNsaWVudCxhY2Nlc3NUb2tlbix1c2VyU2Vzc2lvbilcclxuICAgICAgfVxyXG4gICAgICAvL2RlbGV0ZSBzZXNzaW9uXHJcbiAgICAgIGVsc2UgaWYgKGNvdW50ID09PSAxKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0aW5nIGZyb20gcmVkaXMnKVxyXG4gICAgICAgIGNsaWVudC5kZWwoYWNjZXNzVG9rZW4pXHJcbiAgICAgIH1cclxufVxyXG5cclxuY29uc3QgZGVsZXRlU2Vzc2lvbkNvbXBsZXRlbHk9IGFzeW5jIChhY2Nlc3NUb2tlbikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ2RlbGV0aW5nIHNlc3Npb24gcmVkaXMnKVxyXG4gICAgbGV0IHVzZXJTZXNzaW9uO1xyXG4gICAgYXdhaXQgY2xpZW50LmdldChhY2Nlc3NUb2tlbiwgKGVycixzZXNzaW9uRGF0YSkgPT4ge1xyXG4gICAgICAgIGlmIChzZXNzaW9uRGF0YSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaGVyZScpXHJcbiAgICAgICAgICAgIHVzZXJTZXNzaW9uID0gc2Vzc2lvbkRhdGFcclxuICAgICAgICAgICAgY29uc29sZS5sb2coc2Vzc2lvbkRhdGEpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGVycil7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJycicpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgY29uc29sZS5sb2coYWNjZXNzVG9rZW4pXHJcbiAgICBjb25zb2xlLmxvZyh1c2VyU2Vzc2lvbilcclxuICAgIHVzZXJTZXNzaW9uID0gSlNPTi5wYXJzZSh1c2VyU2Vzc2lvbilcclxuICAgIGNvbnNvbGUubG9nKHVzZXJTZXNzaW9uKVxyXG4gICAgY29uc29sZS5sb2codXNlclNlc3Npb24udXNlckNvdW50KVxyXG4gICAgY29uc3QgY291bnQgPSB1c2VyU2Vzc2lvbi51c2VyQ291bnRcclxuICAgIFxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGluZyBmcm9tIHJlZGlzJylcclxuICAgICAgICBjbGllbnQuZGVsKGFjY2Vzc1Rva2VuKVxyXG4gICAgICBcclxufVxyXG5cclxuLy91cGRhdGUgc2luZ2xlIHRva2VuIGRhdGFcclxuY29uc3Qgc3RvcmVOZXdTZXNzaW9uID0gYXN5bmMgIChhY2Nlc3NUb2tlbixzZXNzaW9uKSA9PiB7XHJcbiAgICAvL2ZldGNoIGZyb20gbW9uZ29kYlxyXG4gICAgLy91cGRhdGUgdGhlIHdob2xlIGNhY2hlXHJcbiAgICBjb25zb2xlLmxvZyhhY2Nlc3NUb2tlbilcclxuICAgIGNvbnNvbGUubG9nKCdpbiBzeW5jIHdpIHJlZGlzJyxzZXNzaW9uKVxyXG4gICAgY2xpZW50LnNldChhY2Nlc3NUb2tlbixKU09OLnN0cmluZ2lmeShzZXNzaW9uKSwoZXJyLHJlcGx5KSA9PiB7XHJcbiAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSlcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycnJyJylcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycilcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3Jlc29sdmluZycpXHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzZXNzaW9uKVxyXG4gICAgfSlcclxufVxyXG5cclxuY29uc3QgY2hlY2tWYWx1ZUluUmVkaXMgPSBhc3luYyAoYWNjZXNzVG9rZW4pID0+IHtcclxuICAgIGNvbnNvbGUubG9nKCdjaGVraW5nIHNlc3Npb24gcmVkaXMnKVxyXG4gICAgbGV0IHVzZXJTZXNzaW9uO1xyXG4gICAgY29uc3QgdmFsdWUgPSBhd2FpdCBjbGllbnQuZ2V0KGFjY2Vzc1Rva2VuLCAoZXJyLHNlc3Npb25EYXRhKSA9PiB7XHJcbiAgICAgICAgaWYgKHNlc3Npb25EYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdoZXJlJylcclxuICAgICAgICAgICAgdXNlclNlc3Npb24gPSBzZXNzaW9uRGF0YVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzZXNzaW9uRGF0YSlcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZXJyKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycnJyJylcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICBjb25zb2xlLmxvZyhhY2Nlc3NUb2tlbilcclxuICAgIGNvbnNvbGUubG9nKHVzZXJTZXNzaW9uKVxyXG4gICAgdXNlclNlc3Npb24gPSBKU09OLnBhcnNlKHVzZXJTZXNzaW9uKVxyXG4gICAgY29uc29sZS5sb2codXNlclNlc3Npb24pXHJcbiAgICBjb25zb2xlLmxvZyh1c2VyU2Vzc2lvbi51c2VyQ291bnQpXHJcbiAgICByZXR1cm4gdXNlclNlc3Npb247XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICAgIHN0b3JlTmV3U2Vzc2lvbixcclxuICAgIHVwZGF0ZVNlc3Npb24sXHJcbiAgICBkZWxldGVTZXNzaW9uQ29tcGxldGVseSxcclxuICAgIGNoZWNrVmFsdWVJblJlZGlzLFxyXG59Il19","map":{"version":3,"sources":["redis-services.js"],"names":["updateSession","accessToken","console","log","userSession","client","get","err","sessionData","JSON","parse","userCount","count","syncWithRedis","del","deleteSessionCompletely","storeNewSession","session","set","stringify","reply","message","Promise","reject","resolve","checkValueInRedis","value"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\services\\redis\\","sourcesContent":["import client from \"../../config/redis-config\";\r\n\r\n//add to redis\r\n\r\n//delete single token data(token string)\r\nconst updateSession = async (accessToken) => {\r\n    console.log('deleting session redis')\r\n    let userSession;\r\n    await client.get(accessToken, (err,sessionData) => {\r\n        if (sessionData) {\r\n            console.log('here')\r\n            userSession = sessionData\r\n            console.log(sessionData)\r\n        }\r\n        else if (err){\r\n            console.log('errrr')\r\n            console.log(err)\r\n        }\r\n    })\r\n    console.log(accessToken)\r\n    console.log(userSession)\r\n    userSession = JSON.parse(userSession)\r\n    console.log(userSession)\r\n    console.log(userSession.userCount)\r\n    const count = userSession.userCount\r\n    if (count > 1) {\r\n        userSession.count -= 1\r\n        syncWithRedis(client,accessToken,userSession)\r\n      }\r\n      //delete session\r\n      else if (count === 1) {\r\n        console.log('deleting from redis')\r\n        client.del(accessToken)\r\n      }\r\n}\r\n\r\nconst deleteSessionCompletely= async (accessToken) => {\r\n    console.log('deleting session redis')\r\n    let userSession;\r\n    await client.get(accessToken, (err,sessionData) => {\r\n        if (sessionData) {\r\n            console.log('here')\r\n            userSession = sessionData\r\n            console.log(sessionData)\r\n        }\r\n        else if (err){\r\n            console.log('errrr')\r\n            console.log(err)\r\n        }\r\n    })\r\n    console.log(accessToken)\r\n    console.log(userSession)\r\n    userSession = JSON.parse(userSession)\r\n    console.log(userSession)\r\n    console.log(userSession.userCount)\r\n    const count = userSession.userCount\r\n    \r\n        console.log('deleting from redis')\r\n        client.del(accessToken)\r\n      \r\n}\r\n\r\n//update single token data\r\nconst storeNewSession = async  (accessToken,session) => {\r\n    //fetch from mongodb\r\n    //update the whole cache\r\n    console.log(accessToken)\r\n    console.log('in sync wi redis',session)\r\n    client.set(accessToken,JSON.stringify(session),(err,reply) => {\r\n        if (err) {\r\n            console.log(err.message)\r\n            console.log('errrr')\r\n            return Promise.reject(err)\r\n        }\r\n        console.log('resolving')\r\n        return Promise.resolve(session)\r\n    })\r\n}\r\n\r\nconst checkValueInRedis = async (accessToken) => {\r\n    console.log('cheking session redis')\r\n    let userSession;\r\n    const value = await client.get(accessToken, (err,sessionData) => {\r\n        if (sessionData) {\r\n            console.log('here')\r\n            userSession = sessionData\r\n            console.log(sessionData)\r\n        }\r\n        else if (err){\r\n            console.log('errrr')\r\n            console.log(err)\r\n        }\r\n    })\r\n    console.log(accessToken)\r\n    console.log(userSession)\r\n    userSession = JSON.parse(userSession)\r\n    console.log(userSession)\r\n    console.log(userSession.userCount)\r\n    return userSession;\r\n}\r\n\r\nexport default {\r\n    storeNewSession,\r\n    updateSession,\r\n    deleteSessionCompletely,\r\n    checkValueInRedis,\r\n}"]}},"mtime":1648792331940},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\typedefs\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\typedefs\\\\types.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nvar _graphqlCompose = require(\"graphql-compose\");\n\nvar _user = require(\"../../../models/user\");\n\n_graphqlCompose.schemaComposer.createObjectTC({\n  name: \"AccessToken\",\n  fields: {\n    accessToken: \"String!\",\n    user: _user.UserTC\n  }\n});\n\n_graphqlCompose.schemaComposer.createObjectTC({\n  name: \"Succeed\",\n  fields: {\n    succeed: \"Boolean!\"\n  }\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInR5cGVzLmpzIl0sIm5hbWVzIjpbInNjaGVtYUNvbXBvc2VyIiwiY3JlYXRlT2JqZWN0VEMiLCJuYW1lIiwiZmllbGRzIiwiYWNjZXNzVG9rZW4iLCJ1c2VyIiwiVXNlclRDIiwic3VjY2VlZCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQTs7QUFFQUEsK0JBQWVDLGNBQWYsQ0FBOEI7QUFDMUJDLEVBQUFBLElBQUksRUFBRSxhQURvQjtBQUUxQkMsRUFBQUEsTUFBTSxFQUFFO0FBQ0pDLElBQUFBLFdBQVcsRUFBRSxTQURUO0FBRUpDLElBQUFBLElBQUksRUFBRUM7QUFGRjtBQUZrQixDQUE5Qjs7QUFRQU4sK0JBQWVDLGNBQWYsQ0FBOEI7QUFDMUJDLEVBQUFBLElBQUksRUFBRSxTQURvQjtBQUUxQkMsRUFBQUEsTUFBTSxFQUFFO0FBQUNJLElBQUFBLE9BQU8sRUFBRTtBQUFWO0FBRmtCLENBQTlCIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxncmFwaHFsXFxhdXRoXFx0eXBlZGVmc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtzY2hlbWFDb21wb3Nlcn0gZnJvbSBcImdyYXBocWwtY29tcG9zZVwiO1xyXG5pbXBvcnQge1VzZXJUQ30gZnJvbSBcIi4uLy4uLy4uL21vZGVscy91c2VyXCI7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5jcmVhdGVPYmplY3RUQyh7XHJcbiAgICBuYW1lOiBcIkFjY2Vzc1Rva2VuXCIsXHJcbiAgICBmaWVsZHM6IHtcclxuICAgICAgICBhY2Nlc3NUb2tlbjogXCJTdHJpbmchXCIsXHJcbiAgICAgICAgdXNlcjogVXNlclRDLFxyXG4gICAgfSxcclxufSk7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5jcmVhdGVPYmplY3RUQyh7XHJcbiAgICBuYW1lOiBcIlN1Y2NlZWRcIixcclxuICAgIGZpZWxkczoge3N1Y2NlZWQ6IFwiQm9vbGVhbiFcIn0sXHJcbn0pOyJdfQ==","map":{"version":3,"sources":["types.js"],"names":["schemaComposer","createObjectTC","name","fields","accessToken","user","UserTC","succeed"],"mappings":";;AAAA;;AACA;;AAEAA,+BAAeC,cAAf,CAA8B;AAC1BC,EAAAA,IAAI,EAAE,aADoB;AAE1BC,EAAAA,MAAM,EAAE;AACJC,IAAAA,WAAW,EAAE,SADT;AAEJC,IAAAA,IAAI,EAAEC;AAFF;AAFkB,CAA9B;;AAQAN,+BAAeC,cAAf,CAA8B;AAC1BC,EAAAA,IAAI,EAAE,SADoB;AAE1BC,EAAAA,MAAM,EAAE;AAACI,IAAAA,OAAO,EAAE;AAAV;AAFkB,CAA9B","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\typedefs\\","sourcesContent":["import {schemaComposer} from \"graphql-compose\";\r\nimport {UserTC} from \"../../../models/user\";\r\n\r\nschemaComposer.createObjectTC({\r\n    name: \"AccessToken\",\r\n    fields: {\r\n        accessToken: \"String!\",\r\n        user: UserTC,\r\n    },\r\n});\r\n\r\nschemaComposer.createObjectTC({\r\n    name: \"Succeed\",\r\n    fields: {succeed: \"Boolean!\"},\r\n});"]}},"mtime":1648684433887},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _graphqlCompose = require(\"graphql-compose\");\n\nvar _auth = require(\"./auth\");\n\nvar _user = require(\"./user\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst schemaComposer = new _graphqlCompose.SchemaComposer();\nschemaComposer.Query.addFields(_objectSpread({}, _user.UserQuery));\nschemaComposer.Mutation.addFields(_objectSpread(_objectSpread({}, _auth.AuthMutation), _user.UserMutation));\nconst schema = schemaComposer.buildSchema();\nvar _default = schema;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInNjaGVtYUNvbXBvc2VyIiwiU2NoZW1hQ29tcG9zZXIiLCJRdWVyeSIsImFkZEZpZWxkcyIsIlVzZXJRdWVyeSIsIk11dGF0aW9uIiwiQXV0aE11dGF0aW9uIiwiVXNlck11dGF0aW9uIiwic2NoZW1hIiwiYnVpbGRTY2hlbWEiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7QUFFQSxNQUFNQSxjQUFjLEdBQUcsSUFBSUMsOEJBQUosRUFBdkI7QUFFQUQsY0FBYyxDQUFDRSxLQUFmLENBQXFCQyxTQUFyQixtQkFDT0MsZUFEUDtBQUlBSixjQUFjLENBQUNLLFFBQWYsQ0FBd0JGLFNBQXhCLGlDQUNPRyxrQkFEUCxHQUVPQyxrQkFGUDtBQUtBLE1BQU1DLE1BQU0sR0FBR1IsY0FBYyxDQUFDUyxXQUFmLEVBQWY7ZUFDZUQsTSIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtTY2hlbWFDb21wb3Nlcn0gZnJvbSBcImdyYXBocWwtY29tcG9zZVwiO1xyXG5pbXBvcnQge0F1dGhNdXRhdGlvbn0gZnJvbSBcIi4vYXV0aFwiO1xyXG5pbXBvcnQge1VzZXJNdXRhdGlvbiwgVXNlclF1ZXJ5fSBmcm9tIFwiLi91c2VyXCI7XHJcblxyXG5jb25zdCBzY2hlbWFDb21wb3NlciA9IG5ldyBTY2hlbWFDb21wb3NlcigpO1xyXG5cclxuc2NoZW1hQ29tcG9zZXIuUXVlcnkuYWRkRmllbGRzKHtcclxuICAgIC4uLlVzZXJRdWVyeSxcclxufSk7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5NdXRhdGlvbi5hZGRGaWVsZHMoe1xyXG4gICAgLi4uQXV0aE11dGF0aW9uLFxyXG4gICAgLi4uVXNlck11dGF0aW9uLFxyXG59KTtcclxuXHJcbmNvbnN0IHNjaGVtYSA9IHNjaGVtYUNvbXBvc2VyLmJ1aWxkU2NoZW1hKCk7XHJcbmV4cG9ydCBkZWZhdWx0IHNjaGVtYTtcclxuIl19","map":{"version":3,"sources":["index.js"],"names":["schemaComposer","SchemaComposer","Query","addFields","UserQuery","Mutation","AuthMutation","UserMutation","schema","buildSchema"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,cAAc,GAAG,IAAIC,8BAAJ,EAAvB;AAEAD,cAAc,CAACE,KAAf,CAAqBC,SAArB,mBACOC,eADP;AAIAJ,cAAc,CAACK,QAAf,CAAwBF,SAAxB,iCACOG,kBADP,GAEOC,kBAFP;AAKA,MAAMC,MAAM,GAAGR,cAAc,CAACS,WAAf,EAAf;eACeD,M","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\","sourcesContent":["import {SchemaComposer} from \"graphql-compose\";\r\nimport {AuthMutation} from \"./auth\";\r\nimport {UserMutation, UserQuery} from \"./user\";\r\n\r\nconst schemaComposer = new SchemaComposer();\r\n\r\nschemaComposer.Query.addFields({\r\n    ...UserQuery,\r\n});\r\n\r\nschemaComposer.Mutation.addFields({\r\n    ...AuthMutation,\r\n    ...UserMutation,\r\n});\r\n\r\nconst schema = schemaComposer.buildSchema();\r\nexport default schema;\r\n"]}},"mtime":1648684433887},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuthMutation = void 0;\n\nvar _user = require(\"../../models/user\");\n\nvar _middlewares = require(\"../../middlewares\");\n\nvar _authResolvers = _interopRequireDefault(require(\"./resolvers/auth-resolvers\"));\n\nrequire(\"./typedefs/types\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfor (const resolver in _authResolvers.default) {\n  _user.UserTC.addResolver(_authResolvers.default[resolver]);\n}\n\nconst AuthMutation = {\n  signIn: _user.UserTC.getResolver(\"signIn\", [_middlewares.authentication.isGuest, _middlewares.userValidator.signIn]),\n  signUp: _user.UserTC.getResolver(\"signUp\", [_middlewares.authentication.isGuest, _middlewares.userValidator.signUp]),\n  logout: _user.UserTC.getResolver('logout', [_middlewares.authentication.isAuth]),\n  // resetPassword: UserTC.getResolver(\"resetPassword\", [middleware.isGuest, validators.resetPassword]),\n  // newPassword: UserTC.getResolver(\"newPassword\", [middleware.isGuest, validators.newPassword]),\n  changePassword: _user.UserTC.getResolver(\"changePassword\", [_middlewares.authentication.isAuth, _middlewares.userValidator.changePassword])\n};\nexports.AuthMutation = AuthMutation;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInJlc29sdmVyIiwiUmVzb2x2ZXJzIiwiVXNlclRDIiwiYWRkUmVzb2x2ZXIiLCJBdXRoTXV0YXRpb24iLCJzaWduSW4iLCJnZXRSZXNvbHZlciIsImF1dGhlbnRpY2F0aW9uIiwiaXNHdWVzdCIsInVzZXJWYWxpZGF0b3IiLCJzaWduVXAiLCJsb2dvdXQiLCJpc0F1dGgiLCJjaGFuZ2VQYXNzd29yZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOztBQUVBOztBQUVBOzs7O0FBRUEsS0FBSyxNQUFNQSxRQUFYLElBQXVCQyxzQkFBdkIsRUFBa0M7QUFDOUJDLGVBQU9DLFdBQVAsQ0FBbUJGLHVCQUFVRCxRQUFWLENBQW5CO0FBQ0g7O0FBRUQsTUFBTUksWUFBWSxHQUFHO0FBQ2pCQyxFQUFBQSxNQUFNLEVBQUVILGFBQU9JLFdBQVAsQ0FBbUIsUUFBbkIsRUFBNkIsQ0FBQ0MsNEJBQWVDLE9BQWhCLEVBQXlCQywyQkFBY0osTUFBdkMsQ0FBN0IsQ0FEUztBQUVqQkssRUFBQUEsTUFBTSxFQUFFUixhQUFPSSxXQUFQLENBQW1CLFFBQW5CLEVBQTZCLENBQUNDLDRCQUFlQyxPQUFoQixFQUF5QkMsMkJBQWNDLE1BQXZDLENBQTdCLENBRlM7QUFHakJDLEVBQUFBLE1BQU0sRUFBRVQsYUFBT0ksV0FBUCxDQUFtQixRQUFuQixFQUE2QixDQUFDQyw0QkFBZUssTUFBaEIsQ0FBN0IsQ0FIUztBQUlqQjtBQUNBO0FBQ0FDLEVBQUFBLGNBQWMsRUFBRVgsYUFBT0ksV0FBUCxDQUFtQixnQkFBbkIsRUFBcUMsQ0FBQ0MsNEJBQWVLLE1BQWhCLEVBQXdCSCwyQkFBY0ksY0FBdEMsQ0FBckM7QUFOQyxDQUFyQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtVc2VyVEN9IGZyb20gXCIuLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5cclxuaW1wb3J0IHsgYXV0aGVudGljYXRpb24sIHVzZXJWYWxpZGF0b3IgfSBmcm9tIFwiLi4vLi4vbWlkZGxld2FyZXNcIjtcclxuXHJcbmltcG9ydCBSZXNvbHZlcnMgZnJvbSBcIi4vcmVzb2x2ZXJzL2F1dGgtcmVzb2x2ZXJzXCI7XHJcblxyXG5pbXBvcnQgXCIuL3R5cGVkZWZzL3R5cGVzXCJcclxuXHJcbmZvciAoY29uc3QgcmVzb2x2ZXIgaW4gUmVzb2x2ZXJzKSB7XHJcbiAgICBVc2VyVEMuYWRkUmVzb2x2ZXIoUmVzb2x2ZXJzW3Jlc29sdmVyXSk7XHJcbn1cclxuXHJcbmNvbnN0IEF1dGhNdXRhdGlvbiA9IHtcclxuICAgIHNpZ25JbjogVXNlclRDLmdldFJlc29sdmVyKFwic2lnbkluXCIsIFthdXRoZW50aWNhdGlvbi5pc0d1ZXN0LCB1c2VyVmFsaWRhdG9yLnNpZ25Jbl0pLFxyXG4gICAgc2lnblVwOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJzaWduVXBcIiwgW2F1dGhlbnRpY2F0aW9uLmlzR3Vlc3QsIHVzZXJWYWxpZGF0b3Iuc2lnblVwXSksXHJcbiAgICBsb2dvdXQ6IFVzZXJUQy5nZXRSZXNvbHZlcignbG9nb3V0JywgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aF0pLFxyXG4gICAgLy8gcmVzZXRQYXNzd29yZDogVXNlclRDLmdldFJlc29sdmVyKFwicmVzZXRQYXNzd29yZFwiLCBbbWlkZGxld2FyZS5pc0d1ZXN0LCB2YWxpZGF0b3JzLnJlc2V0UGFzc3dvcmRdKSxcclxuICAgIC8vIG5ld1Bhc3N3b3JkOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJuZXdQYXNzd29yZFwiLCBbbWlkZGxld2FyZS5pc0d1ZXN0LCB2YWxpZGF0b3JzLm5ld1Bhc3N3b3JkXSksXHJcbiAgICBjaGFuZ2VQYXNzd29yZDogVXNlclRDLmdldFJlc29sdmVyKFwiY2hhbmdlUGFzc3dvcmRcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgdXNlclZhbGlkYXRvci5jaGFuZ2VQYXNzd29yZF0pLFxyXG59O1xyXG5cclxuZXhwb3J0IHtBdXRoTXV0YXRpb259O1xyXG4iXX0=","map":{"version":3,"sources":["index.js"],"names":["resolver","Resolvers","UserTC","addResolver","AuthMutation","signIn","getResolver","authentication","isGuest","userValidator","signUp","logout","isAuth","changePassword"],"mappings":";;;;;;;AAAA;;AAEA;;AAEA;;AAEA;;;;AAEA,KAAK,MAAMA,QAAX,IAAuBC,sBAAvB,EAAkC;AAC9BC,eAAOC,WAAP,CAAmBF,uBAAUD,QAAV,CAAnB;AACH;;AAED,MAAMI,YAAY,GAAG;AACjBC,EAAAA,MAAM,EAAEH,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeC,OAAhB,EAAyBC,2BAAcJ,MAAvC,CAA7B,CADS;AAEjBK,EAAAA,MAAM,EAAER,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeC,OAAhB,EAAyBC,2BAAcC,MAAvC,CAA7B,CAFS;AAGjBC,EAAAA,MAAM,EAAET,aAAOI,WAAP,CAAmB,QAAnB,EAA6B,CAACC,4BAAeK,MAAhB,CAA7B,CAHS;AAIjB;AACA;AACAC,EAAAA,cAAc,EAAEX,aAAOI,WAAP,CAAmB,gBAAnB,EAAqC,CAACC,4BAAeK,MAAhB,EAAwBH,2BAAcI,cAAtC,CAArC;AANC,CAArB","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\","sourcesContent":["import {UserTC} from \"../../models/user\";\r\n\r\nimport { authentication, userValidator } from \"../../middlewares\";\r\n\r\nimport Resolvers from \"./resolvers/auth-resolvers\";\r\n\r\nimport \"./typedefs/types\"\r\n\r\nfor (const resolver in Resolvers) {\r\n    UserTC.addResolver(Resolvers[resolver]);\r\n}\r\n\r\nconst AuthMutation = {\r\n    signIn: UserTC.getResolver(\"signIn\", [authentication.isGuest, userValidator.signIn]),\r\n    signUp: UserTC.getResolver(\"signUp\", [authentication.isGuest, userValidator.signUp]),\r\n    logout: UserTC.getResolver('logout', [authentication.isAuth]),\r\n    // resetPassword: UserTC.getResolver(\"resetPassword\", [middleware.isGuest, validators.resetPassword]),\r\n    // newPassword: UserTC.getResolver(\"newPassword\", [middleware.isGuest, validators.newPassword]),\r\n    changePassword: UserTC.getResolver(\"changePassword\", [authentication.isAuth, userValidator.changePassword]),\r\n};\r\n\r\nexport {AuthMutation};\r\n"]}},"mtime":1648755864085},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\user.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserTC = exports.UserSchema = exports.UserModel = void 0;\n\nvar _mongoose = _interopRequireWildcard(require(\"mongoose\"));\n\nvar _mongooseTimestamp = _interopRequireDefault(require(\"mongoose-timestamp\"));\n\nvar _graphqlComposeMongoose = require(\"graphql-compose-mongoose\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nconst UserSchema = new _mongoose.Schema({\n  firstName: String,\n  middleName: String,\n  lastName: String,\n  email: String,\n  phoneNumber: String,\n  image: String,\n  firebaseId: String,\n  password: String,\n  status: {\n    type: String,\n    default: \"ACTIVE\",\n    enum: [\"ACTIVE\", \"BLOCKED\"]\n  },\n  roles: {\n    type: String,\n    default: \"NORMAL\",\n    enum: [\"NORMAL\", \"OWNER\", \"ADMIN\", \"SALES\"]\n  },\n  account: {\n    verification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    emailVerification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    phoneVerification: {\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      token: String,\n      expiresIn: Date\n    },\n    resetPassword: {\n      token: String,\n      expiresIn: Date\n    }\n  }\n}, {\n  collection: \"users\"\n});\nexports.UserSchema = UserSchema;\nUserSchema.plugin(_mongooseTimestamp.default);\nUserSchema.index({\n  createdAt: 1,\n  updatedAt: 1\n});\n\nUserSchema.statics.emailExist = function (email) {\n  return this.findOne({\n    email\n  });\n};\n\nUserSchema.statics.phoneNumberExist = function (phoneNumber) {\n  return this.findOne({\n    phoneNumber\n  });\n};\n\nUserSchema.methods.comparePassword = function (password) {\n  return bcrypt.compareSync(password, this.password);\n};\n\nconst UserModel = _mongoose.default.model(\"User\", UserSchema);\n\nexports.UserModel = UserModel;\nconst UserTC = (0, _graphqlComposeMongoose.composeWithMongoose)(UserModel); // const UserTC = composeWithMongoose(UserModel).removeField('password');\n\nexports.UserTC = UserTC;\nconst UserAccountTC = UserTC.getFieldTC(\"account\");\nUserAccountTC.getFieldTC(\"verification\").removeField([\"token\", \"expiresIn\"]); // UserAccountTC.removeField('resetPassword');\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsiVXNlclNjaGVtYSIsIlNjaGVtYSIsImZpcnN0TmFtZSIsIlN0cmluZyIsIm1pZGRsZU5hbWUiLCJsYXN0TmFtZSIsImVtYWlsIiwicGhvbmVOdW1iZXIiLCJpbWFnZSIsImZpcmViYXNlSWQiLCJwYXNzd29yZCIsInN0YXR1cyIsInR5cGUiLCJkZWZhdWx0IiwiZW51bSIsInJvbGVzIiwiYWNjb3VudCIsInZlcmlmaWNhdGlvbiIsInZlcmlmaWVkIiwiQm9vbGVhbiIsInRva2VuIiwiZXhwaXJlc0luIiwiRGF0ZSIsImVtYWlsVmVyaWZpY2F0aW9uIiwicGhvbmVWZXJpZmljYXRpb24iLCJyZXNldFBhc3N3b3JkIiwiY29sbGVjdGlvbiIsInBsdWdpbiIsInRpbWVzdGFtcHMiLCJpbmRleCIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInN0YXRpY3MiLCJlbWFpbEV4aXN0IiwiZmluZE9uZSIsInBob25lTnVtYmVyRXhpc3QiLCJtZXRob2RzIiwiY29tcGFyZVBhc3N3b3JkIiwiYmNyeXB0IiwiY29tcGFyZVN5bmMiLCJVc2VyTW9kZWwiLCJtb25nb29zZSIsIm1vZGVsIiwiVXNlclRDIiwiVXNlckFjY291bnRUQyIsImdldEZpZWxkVEMiLCJyZW1vdmVGaWVsZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLE1BQU1BLFVBQVUsR0FBRyxJQUFJQyxnQkFBSixDQUFXO0FBQzFCQyxFQUFBQSxTQUFTLEVBQUVDLE1BRGU7QUFFMUJDLEVBQUFBLFVBQVUsRUFBRUQsTUFGYztBQUcxQkUsRUFBQUEsUUFBUSxFQUFFRixNQUhnQjtBQUkxQkcsRUFBQUEsS0FBSyxFQUFFSCxNQUptQjtBQUsxQkksRUFBQUEsV0FBVyxFQUFFSixNQUxhO0FBTTFCSyxFQUFBQSxLQUFLLEVBQUVMLE1BTm1CO0FBTzFCTSxFQUFBQSxVQUFVLEVBQUVOLE1BUGM7QUFRMUJPLEVBQUFBLFFBQVEsRUFBRVAs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Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlLCB7U2NoZW1hfSBmcm9tIFwibW9uZ29vc2VcIjtcclxuaW1wb3J0IHRpbWVzdGFtcHMgZnJvbSBcIm1vbmdvb3NlLXRpbWVzdGFtcFwiO1xyXG5pbXBvcnQge2NvbXBvc2VXaXRoTW9uZ29vc2V9IGZyb20gXCJncmFwaHFsLWNvbXBvc2UtbW9uZ29vc2VcIjtcclxuXHJcbmNvbnN0IFVzZXJTY2hlbWEgPSBuZXcgU2NoZW1hKHtcclxuICAgIGZpcnN0TmFtZTogU3RyaW5nLFxyXG4gICAgbWlkZGxlTmFtZTogU3RyaW5nLFxyXG4gICAgbGFzdE5hbWU6IFN0cmluZyxcclxuICAgIGVtYWlsOiBTdHJpbmcsXHJcbiAgICBwaG9uZU51bWJlcjogU3RyaW5nLFxyXG4gICAgaW1hZ2U6IFN0cmluZyxcclxuICAgIGZpcmViYXNlSWQ6IFN0cmluZyxcclxuICAgIHBhc3N3b3JkOiBTdHJpbmcsXHJcbiAgICBzdGF0dXM6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZGVmYXVsdDogXCJBQ1RJVkVcIixcclxuICAgICAgICBlbnVtOiBbXCJBQ1RJVkVcIiwgXCJCTE9DS0VEXCJdLFxyXG4gICAgfSxcclxuICAgIHJvbGVzOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIGRlZmF1bHQ6IFwiTk9STUFMXCIsXHJcbiAgICAgICAgZW51bTogW1wiTk9STUFMXCIsIFwiT1dORVJcIiwgXCJBRE1JTlwiLCBcIlNBTEVTXCJdLFxyXG4gICAgfSxcclxuICAgIGFjY291bnQ6IHtcclxuICAgICAgICB2ZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW1haWxWZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcGhvbmVWZXJpZmljYXRpb246IHtcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdG9rZW46IFN0cmluZyxcclxuICAgICAgICAgICAgZXhwaXJlc0luOiBEYXRlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVzZXRQYXNzd29yZDoge1xyXG4gICAgICAgICAgICB0b2tlbjogU3RyaW5nLFxyXG4gICAgICAgICAgICBleHBpcmVzSW46IERhdGUsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcbn0sIHtcclxuICAgIGNvbGxlY3Rpb246IFwidXNlcnNcIixcclxufSk7XHJcblxyXG5Vc2VyU2NoZW1hLnBsdWdpbih0aW1lc3RhbXBzKTtcclxuVXNlclNjaGVtYS5pbmRleCh7XHJcbiAgICBjcmVhdGVkQXQ6IDEsXHJcbiAgICB1cGRhdGVkQXQ6IDEsXHJcbn0pO1xyXG5cclxuVXNlclNjaGVtYS5zdGF0aWNzLmVtYWlsRXhpc3QgPSBmdW5jdGlvbiAoZW1haWwpIHtcclxuICAgIHJldHVybiB0aGlzLmZpbmRPbmUoe2VtYWlsfSk7XHJcbn07XHJcblxyXG5Vc2VyU2NoZW1hLnN0YXRpY3MucGhvbmVOdW1iZXJFeGlzdCA9IGZ1bmN0aW9uIChwaG9uZU51bWJlcikge1xyXG4gICAgcmV0dXJuIHRoaXMuZmluZE9uZSh7cGhvbmVOdW1iZXJ9KTtcclxufTtcclxuXHJcblVzZXJTY2hlbWEubWV0aG9kcy5jb21wYXJlUGFzc3dvcmQgPSBmdW5jdGlvbiAocGFzc3dvcmQpIHtcclxuICAgIHJldHVybiBiY3J5cHQuY29tcGFyZVN5bmMocGFzc3dvcmQsIHRoaXMucGFzc3dvcmQpO1xyXG59O1xyXG5cclxuY29uc3QgVXNlck1vZGVsID0gbW9uZ29vc2UubW9kZWwoXCJVc2VyXCIsIFVzZXJTY2hlbWEpO1xyXG5jb25zdCBVc2VyVEMgPSBjb21wb3NlV2l0aE1vbmdvb3NlKFVzZXJNb2RlbCk7XHJcbi8vIGNvbnN0IFVzZXJUQyA9IGNvbXBvc2VXaXRoTW9uZ29vc2UoVXNlck1vZGVsKS5yZW1vdmVGaWVsZCgncGFzc3dvcmQnKTtcclxuXHJcbmNvbnN0IFVzZXJBY2NvdW50VEMgPSBVc2VyVEMuZ2V0RmllbGRUQyhcImFjY291bnRcIik7XHJcblxyXG5Vc2VyQWNjb3VudFRDLmdldEZpZWxkVEMoXCJ2ZXJpZmljYXRpb25cIikucmVtb3ZlRmllbGQoW1widG9rZW5cIiwgXCJleHBpcmVzSW5cIl0pO1xyXG5cclxuLy8gVXNlckFjY291bnRUQy5yZW1vdmVGaWVsZCgncmVzZXRQYXNzd29yZCcpO1xyXG5cclxuZXhwb3J0IHtVc2VyTW9kZWwsIFVzZXJUQywgVXNlclNjaGVtYX07XHJcbiJdfQ==","map":{"version":3,"sources":["user.js"],"names":["UserSchema","Schema","firstName","String","middleName","lastName","email","phoneNumber","image","firebaseId","password","status","type","default","enum","roles","account","verification","verified","Boolean","token","expiresIn","Date","emailVerification","phoneVerification","resetPassword","collection","plugin","timestamps","index","createdAt","updatedAt","statics","emailExist","findOne","phoneNumberExist","methods","comparePassword","bcrypt","compareSync","UserModel","mongoose","model","UserTC","UserAccountTC","getFieldTC","removeField"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\models\\","sourcesContent":["import mongoose, {Schema} from \"mongoose\";\r\nimport timestamps from \"mongoose-timestamp\";\r\nimport {composeWithMongoose} from \"graphql-compose-mongoose\";\r\n\r\nconst UserSchema = new Schema({\r\n    firstName: String,\r\n    middleName: String,\r\n    lastName: String,\r\n    email: String,\r\n    phoneNumber: String,\r\n    image: String,\r\n    firebaseId: String,\r\n    password: String,\r\n    status: {\r\n        type: String,\r\n        default: \"ACTIVE\",\r\n        enum: [\"ACTIVE\", \"BLOCKED\"],\r\n    },\r\n    roles: {\r\n        type: String,\r\n        default: \"NORMAL\",\r\n        enum: [\"NORMAL\", \"OWNER\", \"ADMIN\", \"SALES\"],\r\n    },\r\n    account: {\r\n        verification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        emailVerification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        phoneVerification: {\r\n            verified: {\r\n                type: Boolean,\r\n                default: false,\r\n            },\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n        resetPassword: {\r\n            token: String,\r\n            expiresIn: Date,\r\n        },\r\n    },\r\n}, {\r\n    collection: \"users\",\r\n});\r\n\r\nUserSchema.plugin(timestamps);\r\nUserSchema.index({\r\n    createdAt: 1,\r\n    updatedAt: 1,\r\n});\r\n\r\nUserSchema.statics.emailExist = function (email) {\r\n    return this.findOne({email});\r\n};\r\n\r\nUserSchema.statics.phoneNumberExist = function (phoneNumber) {\r\n    return this.findOne({phoneNumber});\r\n};\r\n\r\nUserSchema.methods.comparePassword = function (password) {\r\n    return bcrypt.compareSync(password, this.password);\r\n};\r\n\r\nconst UserModel = mongoose.model(\"User\", UserSchema);\r\nconst UserTC = composeWithMongoose(UserModel);\r\n// const UserTC = composeWithMongoose(UserModel).removeField('password');\r\n\r\nconst UserAccountTC = UserTC.getFieldTC(\"account\");\r\n\r\nUserAccountTC.getFieldTC(\"verification\").removeField([\"token\", \"expiresIn\"]);\r\n\r\n// UserAccountTC.removeField('resetPassword');\r\n\r\nexport {UserModel, UserTC, UserSchema};\r\n"]}},"mtime":1648684433894},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"authentication\", {\n  enumerable: true,\n  get: function () {\n    return _authentication.default;\n  }\n});\nObject.defineProperty(exports, \"authorization\", {\n  enumerable: true,\n  get: function () {\n    return _authorization.default;\n  }\n});\nObject.defineProperty(exports, \"phoneVerification\", {\n  enumerable: true,\n  get: function () {\n    return _phoneVerification.default;\n  }\n});\nObject.defineProperty(exports, \"userValidator\", {\n  enumerable: true,\n  get: function () {\n    return _userValidator.default;\n  }\n});\nObject.defineProperty(exports, \"validateToken\", {\n  enumerable: true,\n  get: function () {\n    return _validateToken.default;\n  }\n});\n\nvar _authentication = _interopRequireDefault(require(\"./auth/authentication\"));\n\nvar _authorization = _interopRequireDefault(require(\"./auth/authorization\"));\n\nvar _validateToken = _interopRequireDefault(require(\"./auth/validate-token\"));\n\nvar _phoneVerification = _interopRequireDefault(require(\"./auth/phone-verification\"));\n\nvar _userValidator = _interopRequireDefault(require(\"./validators/user-validator\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF1dGhlbnRpY2F0aW9uIGZyb20gXCIuL2F1dGgvYXV0aGVudGljYXRpb25cIlxyXG5pbXBvcnQgYXV0aG9yaXphdGlvbiBmcm9tIFwiLi9hdXRoL2F1dGhvcml6YXRpb25cIlxyXG5pbXBvcnQgdmFsaWRhdGVUb2tlbiBmcm9tIFwiLi9hdXRoL3ZhbGlkYXRlLXRva2VuXCJcclxuaW1wb3J0IHBob25lVmVyaWZpY2F0aW9uIGZyb20gXCIuL2F1dGgvcGhvbmUtdmVyaWZpY2F0aW9uXCJcclxuaW1wb3J0IHVzZXJWYWxpZGF0b3IgZnJvbSBcIi4vdmFsaWRhdG9ycy91c2VyLXZhbGlkYXRvclwiO1xyXG5cclxuZXhwb3J0IHtcclxuICAgIGF1dGhlbnRpY2F0aW9uLFxyXG4gICAgYXV0aG9yaXphdGlvbixcclxuICAgIHZhbGlkYXRlVG9rZW4sXHJcbiAgICBwaG9uZVZlcmlmaWNhdGlvbixcclxuICAgIHVzZXJWYWxpZGF0b3IsXHJcbn0iXX0=","map":{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\","sourcesContent":["import authentication from \"./auth/authentication\"\r\nimport authorization from \"./auth/authorization\"\r\nimport validateToken from \"./auth/validate-token\"\r\nimport phoneVerification from \"./auth/phone-verification\"\r\nimport userValidator from \"./validators/user-validator\";\r\n\r\nexport {\r\n    authentication,\r\n    authorization,\r\n    validateToken,\r\n    phoneVerification,\r\n    userValidator,\r\n}"]}},"mtime":1648684433893},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\authentication.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nconst isAuth = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n\n  if (!user) {\n    return Promise.reject(new Error(\"You must be authorized.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nconst isGuest = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n\n  if (user) {\n    return Promise.reject(new Error(\"You have already authorized.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nvar _default = {\n  isAuth,\n  isGuest\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0aW9uLmpzIl0sIm5hbWVzIjpbImlzQXV0aCIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iLCJ1c2VyIiwiUHJvbWlzZSIsInJlamVjdCIsIkVycm9yIiwiaXNHdWVzdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLE1BQU1BLE1BQU0sR0FBRyxPQUFPQyxPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUMzRCxRQUFNO0FBQUNDLElBQUFBO0FBQUQsTUFBU0YsT0FBZjs7QUFDQSxNQUFJLENBQUNFLElBQUwsRUFBVztBQUNQLFdBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlLElBQUlDLEtBQUosQ0FBVSx5QkFBVixDQUFmLENBQVA7QUFDSDs7QUFDRCxTQUFPUixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsQ0FORDs7QUFRQSxNQUFNSyxPQUFPLEdBQUcsT0FBT1QsT0FBUCxFQUFnQkMsTUFBaEIsRUFBd0JDLElBQXhCLEVBQThCQyxPQUE5QixFQUF1Q0MsSUFBdkMsS0FBZ0Q7QUFDNUQsUUFBTTtBQUFDQyxJQUFBQTtBQUFELE1BQVNGLE9BQWY7O0FBQ0EsTUFBSUUsSUFBSixFQUFVO0FBQ04sV0FBT0MsT0FBTyxDQUFDQyxNQUFSLENBQWUsSUFBSUMsS0FBSixDQUFVLDhCQUFWLENBQWYsQ0FBUDtBQUNIOztBQUNELFNBQU9SLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxDQU5EOztlQVFlO0FBQUNMLEVBQUFBLE1BQUQ7QUFBU1UsRUFBQUE7QUFBVCxDIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxtaWRkbGV3YXJlc1xcYXV0aFxcIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaXNBdXRoID0gYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgY29uc3Qge3VzZXJ9ID0gY29udGV4dDtcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJZb3UgbXVzdCBiZSBhdXRob3JpemVkLlwiKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzb2x2ZShzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pO1xyXG59O1xyXG5cclxuY29uc3QgaXNHdWVzdCA9IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgIGNvbnN0IHt1c2VyfSA9IGNvbnRleHQ7XHJcbiAgICBpZiAodXNlcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJZb3UgaGF2ZSBhbHJlYWR5IGF1dGhvcml6ZWQuXCIpKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7aXNBdXRoLCBpc0d1ZXN0fTtcclxuIl19","map":{"version":3,"sources":["authentication.js"],"names":["isAuth","resolve","source","args","context","info","user","Promise","reject","Error","isGuest"],"mappings":";;;;;;;AAAA,MAAMA,MAAM,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC3D,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;;AACA,MAAI,CAACE,IAAL,EAAW;AACP,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,yBAAV,CAAf,CAAP;AACH;;AACD,SAAOR,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAND;;AAQA,MAAMK,OAAO,GAAG,OAAOT,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC5D,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;;AACA,MAAIE,IAAJ,EAAU;AACN,WAAOC,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,8BAAV,CAAf,CAAP;AACH;;AACD,SAAOR,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAND;;eAQe;AAACL,EAAAA,MAAD;AAASU,EAAAA;AAAT,C","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["const isAuth = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    if (!user) {\r\n        return Promise.reject(new Error(\"You must be authorized.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nconst isGuest = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    if (user) {\r\n        return Promise.reject(new Error(\"You have already authorized.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nexport default {isAuth, isGuest};\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\authorization.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n//list from redis, list of functions for each role\nconst accessList = {\n  ADMIN: [\"findMany\", \"createOne\"],\n  SUPER_ADMIN: [\"findMany\", \"createOne\"],\n  NORMAL: [],\n  TUTOR: [],\n  CUSTOMER_SERVICE: []\n};\n\nconst authorization = async (resolve, source, args, context, info) => {\n  const {\n    user\n  } = context;\n  const fieldName = info.fieldName;\n  let hasAccess = false; //list from redis, list of functions for each role\n\n  user.roles.forEach(role => {\n    if (accessList[role].includes(fieldName)) {\n      hasAccess = true;\n    }\n  });\n\n  if (!hasAccess) {\n    return Promise.reject(new Error(\"Access denied.\"));\n  }\n\n  return resolve(source, args, context, info);\n};\n\nvar _default = authorization;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6YXRpb24uanMiXSwibmFtZXMiOlsiYWNjZXNzTGlzdCIsIkFETUlOIiwiU1VQRVJfQURNSU4iLCJOT1JNQUwiLCJUVVRPUiIsIkNVU1RPTUVSX1NFUlZJQ0UiLCJhdXRob3JpemF0aW9uIiwicmVzb2x2ZSIsInNvdXJjZSIsImFyZ3MiLCJjb250ZXh0IiwiaW5mbyIsInVzZXIiLCJmaWVsZE5hbWUiLCJoYXNBY2Nlc3MiLCJyb2xlcyIsImZvckVhY2giLCJyb2xlIiwiaW5jbHVkZXMiLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0EsTUFBTUEsVUFBVSxHQUFHO0FBQ2ZDLEVBQUFBLEtBQUssRUFBRSxDQUFDLFVBQUQsRUFBYSxXQUFiLENBRFE7QUFFZkMsRUFBQUEsV0FBVyxFQUFFLENBQUMsVUFBRCxFQUFhLFdBQWIsQ0FGRTtBQUdmQyxFQUFBQSxNQUFNLEVBQUUsRUFITztBQUlmQyxFQUFBQSxLQUFLLEVBQUUsRUFKUTtBQUtmQyxFQUFBQSxnQkFBZ0IsRUFBRTtBQUxILENBQW5COztBQVFBLE1BQU1DLGFBQWEsR0FBRyxPQUFPQyxPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUNsRSxRQUFNO0FBQUNDLElBQUFBO0FBQUQsTUFBU0YsT0FBZjtBQUNBLFFBQU1HLFNBQVMsR0FBR0YsSUFBSSxDQUFDRSxTQUF2QjtBQUNBLE1BQUlDLFNBQVMsR0FBRyxLQUFoQixDQUhrRSxDQUlsRTs7QUFDQUYsRUFBQUEsSUFBSSxDQUFDRyxLQUFMLENBQVdDLE9BQVgsQ0FBbUJDLElBQUksSUFBSTtBQUN2QixRQUFHakIsVUFBVSxDQUFDaUIsSUFBRCxDQUFWLENBQWlCQyxRQUFqQixDQUEwQkwsU0FBMUIsQ0FBSCxFQUF3QztBQUNwQ0MsTUFBQUEsU0FBUyxHQUFHLElBQVo7QUFDSDtBQUNKLEdBSkQ7O0FBS0EsTUFBSSxDQUFDQSxTQUFMLEVBQWdCO0FBQ1osV0FBT0ssT0FBTyxDQUFDQyxNQUFSLENBQWUsSUFBSUMsS0FBSixDQUFVLGdCQUFWLENBQWYsQ0FBUDtBQUNIOztBQUNELFNBQU9kLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxDQWREOztlQWdCZUwsYSIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbWlkZGxld2FyZXNcXGF1dGhcXCIsInNvdXJjZXNDb250ZW50IjpbIi8vbGlzdCBmcm9tIHJlZGlzLCBsaXN0IG9mIGZ1bmN0aW9ucyBmb3IgZWFjaCByb2xlXHJcbmNvbnN0IGFjY2Vzc0xpc3QgPSB7XHJcbiAgICBBRE1JTjogW1wiZmluZE1hbnlcIiwgXCJjcmVhdGVPbmVcIl0sXHJcbiAgICBTVVBFUl9BRE1JTjogW1wiZmluZE1hbnlcIiwgXCJjcmVhdGVPbmVcIl0sXHJcbiAgICBOT1JNQUw6IFtdLFxyXG4gICAgVFVUT1I6IFtdLFxyXG4gICAgQ1VTVE9NRVJfU0VSVklDRTogW10sXHJcbn07XHJcblxyXG5jb25zdCBhdXRob3JpemF0aW9uID0gYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgY29uc3Qge3VzZXJ9ID0gY29udGV4dDtcclxuICAgIGNvbnN0IGZpZWxkTmFtZSA9IGluZm8uZmllbGROYW1lXHJcbiAgICBsZXQgaGFzQWNjZXNzID0gZmFsc2VcclxuICAgIC8vbGlzdCBmcm9tIHJlZGlzLCBsaXN0IG9mIGZ1bmN0aW9ucyBmb3IgZWFjaCByb2xlXHJcbiAgICB1c2VyLnJvbGVzLmZvckVhY2gocm9sZSA9PiB7XHJcbiAgICAgICAgaWYoYWNjZXNzTGlzdFtyb2xlXS5pbmNsdWRlcyhmaWVsZE5hbWUpKXtcclxuICAgICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICBpZiAoIWhhc0FjY2Vzcykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJBY2Nlc3MgZGVuaWVkLlwiKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzb2x2ZShzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXV0aG9yaXphdGlvbjtcclxuIl19","map":{"version":3,"sources":["authorization.js"],"names":["accessList","ADMIN","SUPER_ADMIN","NORMAL","TUTOR","CUSTOMER_SERVICE","authorization","resolve","source","args","context","info","user","fieldName","hasAccess","roles","forEach","role","includes","Promise","reject","Error"],"mappings":";;;;;;AAAA;AACA,MAAMA,UAAU,GAAG;AACfC,EAAAA,KAAK,EAAE,CAAC,UAAD,EAAa,WAAb,CADQ;AAEfC,EAAAA,WAAW,EAAE,CAAC,UAAD,EAAa,WAAb,CAFE;AAGfC,EAAAA,MAAM,EAAE,EAHO;AAIfC,EAAAA,KAAK,EAAE,EAJQ;AAKfC,EAAAA,gBAAgB,EAAE;AALH,CAAnB;;AAQA,MAAMC,aAAa,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAClE,QAAM;AAACC,IAAAA;AAAD,MAASF,OAAf;AACA,QAAMG,SAAS,GAAGF,IAAI,CAACE,SAAvB;AACA,MAAIC,SAAS,GAAG,KAAhB,CAHkE,CAIlE;;AACAF,EAAAA,IAAI,CAACG,KAAL,CAAWC,OAAX,CAAmBC,IAAI,IAAI;AACvB,QAAGjB,UAAU,CAACiB,IAAD,CAAV,CAAiBC,QAAjB,CAA0BL,SAA1B,CAAH,EAAwC;AACpCC,MAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,GAJD;;AAKA,MAAI,CAACA,SAAL,EAAgB;AACZ,WAAOK,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,gBAAV,CAAf,CAAP;AACH;;AACD,SAAOd,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAdD;;eAgBeL,a","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["//list from redis, list of functions for each role\r\nconst accessList = {\r\n    ADMIN: [\"findMany\", \"createOne\"],\r\n    SUPER_ADMIN: [\"findMany\", \"createOne\"],\r\n    NORMAL: [],\r\n    TUTOR: [],\r\n    CUSTOMER_SERVICE: [],\r\n};\r\n\r\nconst authorization = async (resolve, source, args, context, info) => {\r\n    const {user} = context;\r\n    const fieldName = info.fieldName\r\n    let hasAccess = false\r\n    //list from redis, list of functions for each role\r\n    user.roles.forEach(role => {\r\n        if(accessList[role].includes(fieldName)){\r\n            hasAccess = true\r\n        }\r\n    })\r\n    if (!hasAccess) {\r\n        return Promise.reject(new Error(\"Access denied.\"));\r\n    }\r\n    return resolve(source, args, context, info);\r\n};\r\n\r\nexport default authorization;\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\validate-token.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _authDataAccess = _interopRequireDefault(require(\"../../services/auth/data-access/auth-data-access\"));\n\nvar _user = require(\"../../models/user\");\n\nvar _redisServices = _interopRequireDefault(require(\"../../services/redis/redis-services\"));\n\nvar _redisConfig = _interopRequireDefault(require(\"../../config/redis-config\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import redis from \"../config/redis-config\";\nconst validateToken = async (req, res, next) => {\n  try {\n    const authorization = req.headers.authorization;\n    console.log(\"authorization: \", authorization);\n    Object.assign(req.headers, {\n      user: null,\n      authorization: null\n    });\n\n    if (!authorization) {\n      return next();\n    }\n\n    const accessToken = authorization.split(\" \")[1];\n    console.log(\"accessTocken: \", accessToken);\n    let decoded;\n\n    if (accessToken) {\n      decoded = _jsonwebtoken.default.verify(accessToken, process.env.JWT_SECRET);\n    }\n\n    if (!decoded) {\n      // invalid token, remove the token from everywhere\n      //remove from database\n      const session = await findSession(accessToken);\n      await _authDataAccess.default.deleteSession(session); //remove from redis\n\n      await _redisConfig.default.del(accessToken);\n      return next();\n    }\n\n    if (decoded.exp * 1000 < Date.now()) {\n      //remove from database\n      const userWith = await _user.UserModel.findOne(decoded.userId);\n      const userId = userWith._id;\n      const session = await findSession(userId);\n      await _authDataAccess.default.deleteSession(session); //remove from redis\n\n      await _redisConfig.default.del(accessToken);\n      return next();\n    } //check if token is in redis\n\n\n    const isSession = await _redisServices.default.checkValueInRedis(accessToken); //if NOT in redis call next()\n\n    if (!isSession) {\n      return next();\n    } //else check last update time if greater than or equals to 1hour update the token\n    // if less skip else update token\n    // authorization = new token\n    else if (isSession) {\n      let updatedDate = isSession.expirationDate;\n      let accessToken = isSession.jwtToken;\n      const updatedAt = moment(isSession.updatedAt);\n      const now = moment(new Date());\n      const duration = moment.duration(now.diff(updatedAt)).asHours(); // console.log(duration)\n\n      if (duration >= 1) {\n        updatedDate = moment(isSession.expirationDate).add(process.env.JWT_EXPIRATION, 'days').toDate();\n      } // increase count and date of session\n\n\n      const newSession = await _authDataAccess.default.updateSession(isSession, updatedDate); // console.log('new session', newSession)\n\n      await _redisServices.default.storeNewSession(accessToken, newSession);\n    }\n\n    const user = await _user.UserModel.findById(decoded.userId);\n\n    if (!user) {\n      //remove from database token\n      const session = await _authDataAccess.default.findSession(accessToken);\n      await _authDataAccess.default.deleteSession(session); //remove from redis\n\n      await _redisConfig.default.del(accessToken); //remove from redis\n\n      return next();\n    } // if the token has come all this way everything is good just attach it to the request header\n\n\n    Object.assign(req.headers, {\n      user,\n      authorization\n    });\n    return next();\n  } catch (error) {\n    console.log(error);\n    return Promise.reject(new Error(\"Error Happened!\"));\n  }\n};\n\nvar _default = validateToken; // ------------- authorization ------------------\n// let check_user_action = async (req,action,resource) =>{\n//   if(!['updateOwn','deleteOwn'].includes(action)){\n//     return true\n//   }\n//\n//   const userResource = new Set()\n//\n//   if(resource == 'tender'){\n//     let userTender = await Tender.find({ creator_user: req.user._id })\n//     userTender.forEach(tender => userResource.add(`${tender._id}`))\n//\n//   }else if(resource == 'company'){\n//     let userCompany = await Company.find({ creator_user: req.user._id })\n//     userCompany.forEach(company => userResource.add( `${company._id}`))\n//\n//   }else if(resource == 'award'){\n//     let userAward = await Award.find({ creator_user: req.user._id })\n//     userAward.forEach(award => userResource.add(`${award._id}`))\n//   }\n//\n//   if(!userResource.has(req.params.id)){\n//     return false\n//   }\n//\n//   return true\n// }\n//\n//\n//\n// exports.authorize = function (action, resource) {\n//   return async (req, res, next) => {\n//     try {\n//       const permission = roles.can(req.user.role)[action](resource);\n//\n//       if (!permission.granted) {\n//         return res.status(401).send(\"You don't have enough permission to perform this action\");\n//       }\n//\n//       let result = await check_user_action(req,action,resource)\n//       if(!result){\n//         return res.status(401).send({ param: resource , msg: `You are not authorized to edit this ${resource}.` })\n//       }\n//\n//       next()\n//     } catch (error) {\n//       return res.status(401).send(\"You don't have enough permission to perform this action\")\n//     }\n//   }\n// }\n\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRlLXRva2VuLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlVG9rZW4iLCJyZXEiLCJyZXMiLCJuZXh0IiwiYXV0aG9yaXphdGlvbiIsImhlYWRlcnMiLCJjb25zb2xlIiwibG9nIiwiT2JqZWN0IiwiYXNzaWduIiwidXNlciIsImFjY2Vzc1Rva2VuIiwic3BsaXQiLCJkZWNvZGVkIiwiand0IiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJzZXNzaW9uIiwiZmluZFNlc3Npb24iLCJhdXRoUmVwb3NpdG9yeSIsImRlbGV0ZVNlc3Npb24iLCJjbGllbnQiLCJkZWwiLCJleHAiLCJEYXRlIiwibm93IiwidXNlcldpdGgiLCJVc2VyTW9kZWwiLCJmaW5kT25lIiwidXNlcklkIiwiX2lkIiwiaXNTZXNzaW9uIiwicmVkaXNTZXJ2aWNlIiwiY2hlY2tWYWx1ZUluUmVkaXMiLCJ1cGRhdGVkRGF0ZSIsImV4cGlyYXRpb25EYXRlIiwiand0VG9rZW4iLCJ1cGRhdGVkQXQiLCJtb21lbnQiLCJkdXJhdGlvbiIsImRpZmYiLCJhc0hvdXJzIiwiYWRkIiwiSldUX0VYUElSQVRJT04iLCJ0b0RhdGUiLCJuZXdTZXNzaW9uIiwidXBkYXRlU2Vzc2lvbiIsInN0b3JlTmV3U2Vzc2lvbiIsImZpbmRCeUlkIiwiZXJyb3IiLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7OztBQUhBO0FBS0EsTUFBTUEsYUFBYSxHQUFHLE9BQU9DLEdBQVAsRUFBWUMsR0FBWixFQUFpQkMsSUFBakIsS0FBMEI7QUFDNUMsTUFBSTtBQUNBLFVBQU1DLGFBQWEsR0FBR0gsR0FBRyxDQUFDSSxPQUFKLENBQVlELGFBQWxDO0FBQ0FFLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGlCQUFaLEVBQThCSCxhQUE5QjtBQUNBSSxJQUFBQSxNQUFNLENBQUNDLE1BQVAsQ0FBY1Is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LE1BQU1tQixnQkFBVXFCLFFBQVYsQ0FBbUJyQyxPQUFPLENBQUNrQixNQUEzQixDQUFuQjs7QUFDQSxRQUFJLENBQUNyQixJQUFMLEVBQVc7QUFDUDtBQUNBLFlBQU1TLE9BQU8sR0FBRyxNQUFNRSx3QkFBZUQsV0FBZixDQUEyQlQsV0FBM0IsQ0FBdEI7QUFFQSxZQUFNVSx3QkFBZUMsYUFBZixDQUE2QkgsT0FBN0IsQ0FBTixDQUpPLENBTVA7O0FBQ0EsWUFBTUkscUJBQU9DLEdBQVAsQ0FBV2IsV0FBWCxDQUFOLENBUE8sQ0FRUDs7QUFDQSxhQUFPUixJQUFJLEVBQVg7QUFDSCxLQXRGRCxDQXdGQTs7O0FBQ0FLLElBQUFBLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjUixHQUFHLENBQUNJLE9BQWxCLEVBQTJCO0FBQ3ZCSyxNQUFBQSxJQUR1QjtBQUV2Qk4sTUFBQUE7QUFGdUIsS0FBM0I7QUFLQSxXQUFPRCxJQUFJLEVBQVg7QUFDSCxHQS9GRCxDQStGRSxPQUFPZ0QsS0FBUCxFQUFjO0FBQ1o3QyxJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWTRDLEtBQVo7QUFDQSxXQUFPQyxPQUFPLENBQUNDLE1BQVIsQ0FBZSxJQUFJQyxLQUFKLENBQVUsaUJBQVYsQ0FBZixDQUFQO0FBQ0g7QUFDSixDQXBHRDs7ZUFzR2V0RCxhLEVBR2Y7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbWlkZGxld2FyZXNcXGF1dGhcXCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xyXG5pbXBvcnQgYXV0aFJlcG9zaXRvcnkgZnJvbSBcIi4uLy4uL3NlcnZpY2VzL2F1dGgvZGF0YS1hY2Nlc3MvYXV0aC1kYXRhLWFjY2Vzc1wiO1xyXG4vLyBpbXBvcnQgcmVkaXMgZnJvbSBcIi4uL2NvbmZpZy9yZWRpcy1jb25maWdcIjtcclxuaW1wb3J0IHtVc2VyTW9kZWx9IGZyb20gXCIuLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5pbXBvcnQgcmVkaXNTZXJ2aWNlIGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9yZWRpcy9yZWRpcy1zZXJ2aWNlc1wiXHJcbmltcG9ydCBjbGllbnQgZnJvbSBcIi4uLy4uL2NvbmZpZy9yZWRpcy1jb25maWdcIjtcclxuXHJcbmNvbnN0IHZhbGlkYXRlVG9rZW4gPSBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgYXV0aG9yaXphdGlvbiA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb25cclxuICAgICAgICBjb25zb2xlLmxvZyhcImF1dGhvcml6YXRpb246IFwiLGF1dGhvcml6YXRpb24pXHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihyZXEuaGVhZGVycywge1xyXG4gICAgICAgICAgICB1c2VyOiBudWxsLFxyXG4gICAgICAgICAgICBhdXRob3JpemF0aW9uOiBudWxsLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoIWF1dGhvcml6YXRpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gYXV0aG9yaXphdGlvbi5zcGxpdChcIiBcIilbMV07XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJhY2Nlc3NUb2NrZW46IFwiLCBhY2Nlc3NUb2tlbik7XHJcbiAgICAgICAgbGV0IGRlY29kZWQ7XHJcbiAgICAgICAgaWYgKGFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgICAgIGRlY29kZWQgPSBqd3QudmVyaWZ5KGFjY2Vzc1Rva2VuLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVUKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFkZWNvZGVkKSB7XHJcbiAgICAgICAgICAgIC8vIGludmFsaWQgdG9rZW4sIHJlbW92ZSB0aGUgdG9rZW4gZnJvbSBldmVyeXdoZXJlXHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGZyb20gZGF0YWJhc2VcclxuICAgICAgICBcclxuICAgICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGZpbmRTZXNzaW9uKGFjY2Vzc1Rva2VuKVxyXG5cclxuICAgICAgICAgICBhd2FpdCBhdXRoUmVwb3NpdG9yeS5kZWxldGVTZXNzaW9uKHNlc3Npb24pXHJcblxyXG4gICAgICAgICAgICAvL3JlbW92ZSBmcm9tIHJlZGlzXHJcbiAgICAgICAgICAgIGF3YWl0IGNsaWVudC5kZWwoYWNjZXNzVG9rZW4pXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGRlY29kZWQuZXhwICogMTAwMCA8IERhdGUubm93KCkpIHtcclxuICAgICAgICAgICAgLy9yZW1vdmUgZnJvbSBkYXRhYmFzZVxyXG5cclxuICAgICAgICAgICAgY29uc3QgdXNlcldpdGggPSBhd2FpdCBVc2VyTW9kZWwuZmluZE9uZSggZGVjb2RlZC51c2VySWQgKTtcclxuICAgICAgICAgICAgY29uc3QgdXNlcklkID0gdXNlcldpdGguX2lkXHJcbiAgICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBmaW5kU2Vzc2lvbih1c2VySWQpXHJcblxyXG4gICAgICAgICAgIGF3YWl0IGF1dGhSZXBvc2l0b3J5LmRlbGV0ZVNlc3Npb24oc2Vzc2lvbilcclxuXHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGZyb20gcmVkaXNcclxuICAgICAgICAgICAgYXdhaXQgY2xpZW50LmRlbChhY2Nlc3NUb2tlbilcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL2NoZWNrIGlmIHRva2VuIGlzIGluIHJlZGlzXHJcbiAgICAgICAgY29uc3QgaXNTZXNzaW9uID0gYXdhaXQgcmVkaXNTZXJ2aWNlLmNoZWNrVmFsdWVJblJlZGlzKGFjY2Vzc1Rva2VuKVxyXG4gICAgICAgIC8vaWYgTk9UIGluIHJlZGlzIGNhbGwgbmV4dCgpXHJcbiAgICAgICAgaWYgKCFpc1Nlc3Npb24pe1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvL2Vsc2UgY2hlY2sgbGFzdCB1cGRhdGUgdGltZSBpZiBncmVhdGVyIHRoYW4gb3IgZXF1YWxzIHRvIDFob3VyIHVwZGF0ZSB0aGUgdG9rZW5cclxuICAgICAgICAvLyBpZiBsZXNzIHNraXAgZWxzZSB1cGRhdGUgdG9rZW5cclxuICAgICAgICAvLyBhdXRob3JpemF0aW9uID0gbmV3IHRva2VuXHJcbiAgICAgICAgZWxzZSBpZihpc1Nlc3Npb24pe1xyXG4gICAgICAgICAgICBsZXQgdXBkYXRlZERhdGUgPSBpc1Nlc3Npb24uZXhwaXJhdGlvbkRhdGU7XHJcbiAgICAgICAgICAgIGxldCBhY2Nlc3NUb2tlbiA9IGlzU2Vzc2lvbi5qd3RUb2tlblxyXG5cclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEF0ID0gbW9tZW50KGlzU2Vzc2lvbi51cGRhdGVkQXQpXHJcbiAgICAgICAgICAgIGNvbnN0IG5vdyA9IG1vbWVudChuZXcgRGF0ZSgpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gKG1vbWVudC5kdXJhdGlvbihub3cuZGlmZih1cGRhdGVkQXQpKSkuYXNIb3VycygpXHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGR1cmF0aW9uKVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGR1cmF0aW9uID49IDEpIHtcclxuICAgICAgICAgICAgICAgIHVwZGF0ZWREYXRlID0gKG1vbWVudChpc1Nlc3Npb24uZXhwaXJhdGlvbkRhdGUpLmFkZChwcm9jZXNzLmVudi5KV1RfRVhQSVJBVElPTiwnZGF5cycpKS50b0RhdGUoKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGluY3JlYXNlIGNvdW50IGFuZCBkYXRlIG9mIHNlc3Npb25cclxuICAgICAgICAgICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IGF1dGhSZXBvc2l0b3J5LnVwZGF0ZVNlc3Npb24oaXNTZXNzaW9uLHVwZGF0ZWREYXRlKVxyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnbmV3IHNlc3Npb24nLCBuZXdTZXNzaW9uKVxyXG4gICAgICAgICAgICBhd2FpdCByZWRpc1NlcnZpY2Uuc3RvcmVOZXdTZXNzaW9uKGFjY2Vzc1Rva2VuLG5ld1Nlc3Npb24pXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlck1vZGVsLmZpbmRCeUlkKGRlY29kZWQudXNlcklkKTtcclxuICAgICAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgICAgICAgLy9yZW1vdmUgZnJvbSBkYXRhYmFzZSB0b2tlblxyXG4gICAgICAgICAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aFJlcG9zaXRvcnkuZmluZFNlc3Npb24oYWNjZXNzVG9rZW4pXHJcblxyXG4gICAgICAgICAgICBhd2FpdCBhdXRoUmVwb3NpdG9yeS5kZWxldGVTZXNzaW9uKHNlc3Npb24pXHJcblxyXG4gICAgICAgICAgICAvL3JlbW92ZSBmcm9tIHJlZGlzXHJcbiAgICAgICAgICAgIGF3YWl0IGNsaWVudC5kZWwoYWNjZXNzVG9rZW4pXHJcbiAgICAgICAgICAgIC8vcmVtb3ZlIGZyb20gcmVkaXNcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGlmIHRoZSB0b2tlbiBoYXMgY29tZSBhbGwgdGhpcyB3YXkgZXZlcnl0aGluZyBpcyBnb29kIGp1c3QgYXR0YWNoIGl0IHRvIHRoZSByZXF1ZXN0IGhlYWRlclxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24ocmVxLmhlYWRlcnMsIHtcclxuICAgICAgICAgICAgdXNlcixcclxuICAgICAgICAgICAgYXV0aG9yaXphdGlvbixcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpXHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVycm9yIEhhcHBlbmVkIVwiKSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB2YWxpZGF0ZVRva2VuO1xyXG5cclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0gYXV0aG9yaXphdGlvbiAtLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbi8vIGxldCBjaGVja191c2VyX2FjdGlvbiA9IGFzeW5jIChyZXEsYWN0aW9uLHJlc291cmNlKSA9PntcclxuLy8gICBpZighWyd1cGRhdGVPd24nLCdkZWxldGVPd24nXS5pbmNsdWRlcyhhY3Rpb24pKXtcclxuLy8gICAgIHJldHVybiB0cnVlXHJcbi8vICAgfVxyXG4vL1xyXG4vLyAgIGNvbnN0IHVzZXJSZXNvdXJjZSA9IG5ldyBTZXQoKVxyXG4vL1xyXG4vLyAgIGlmKHJlc291cmNlID09ICd0ZW5kZXInKXtcclxuLy8gICAgIGxldCB1c2VyVGVuZGVyID0gYXdhaXQgVGVuZGVyLmZpbmQoeyBjcmVhdG9yX3VzZXI6IHJlcS51c2VyLl9pZCB9KVxyXG4vLyAgICAgdXNlclRlbmRlci5mb3JFYWNoKHRlbmRlciA9PiB1c2VyUmVzb3VyY2UuYWRkKGAke3RlbmRlci5faWR9YCkpXHJcbi8vXHJcbi8vICAgfWVsc2UgaWYocmVzb3VyY2UgPT0gJ2NvbXBhbnknKXtcclxuLy8gICAgIGxldCB1c2VyQ29tcGFueSA9IGF3YWl0IENvbXBhbnkuZmluZCh7IGNyZWF0b3JfdXNlcjogcmVxLnVzZXIuX2lkIH0pXHJcbi8vICAgICB1c2VyQ29tcGFueS5mb3JFYWNoKGNvbXBhbnkgPT4gdXNlclJlc291cmNlLmFkZCggYCR7Y29tcGFueS5faWR9YCkpXHJcbi8vXHJcbi8vICAgfWVsc2UgaWYocmVzb3VyY2UgPT0gJ2F3YXJkJyl7XHJcbi8vICAgICBsZXQgdXNlckF3YXJkID0gYXdhaXQgQXdhcmQuZmluZCh7IGNyZWF0b3JfdXNlcjogcmVxLnVzZXIuX2lkIH0pXHJcbi8vICAgICB1c2VyQXdhcmQuZm9yRWFjaChhd2FyZCA9PiB1c2VyUmVzb3VyY2UuYWRkKGAke2F3YXJkLl9pZH1gKSlcclxuLy8gICB9XHJcbi8vXHJcbi8vICAgaWYoIXVzZXJSZXNvdXJjZS5oYXMocmVxLnBhcmFtcy5pZCkpe1xyXG4vLyAgICAgcmV0dXJuIGZhbHNlXHJcbi8vICAgfVxyXG4vL1xyXG4vLyAgIHJldHVybiB0cnVlXHJcbi8vIH1cclxuLy9cclxuLy9cclxuLy9cclxuLy8gZXhwb3J0cy5hdXRob3JpemUgPSBmdW5jdGlvbiAoYWN0aW9uLCByZXNvdXJjZSkge1xyXG4vLyAgIHJldHVybiBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuLy8gICAgIHRyeSB7XHJcbi8vICAgICAgIGNvbnN0IHBlcm1pc3Npb24gPSByb2xlcy5jYW4ocmVxLnVzZXIucm9sZSlbYWN0aW9uXShyZXNvdXJjZSk7XHJcbi8vXHJcbi8vICAgICAgIGlmICghcGVybWlzc2lvbi5ncmFudGVkKSB7XHJcbi8vICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKFwiWW91IGRvbid0IGhhdmUgZW5vdWdoIHBlcm1pc3Npb24gdG8gcGVyZm9ybSB0aGlzIGFjdGlvblwiKTtcclxuLy8gICAgICAgfVxyXG4vL1xyXG4vLyAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgY2hlY2tfdXNlcl9hY3Rpb24ocmVxLGFjdGlvbixyZXNvdXJjZSlcclxuLy8gICAgICAgaWYoIXJlc3VsdCl7XHJcbi8vICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKHsgcGFyYW06IHJlc291cmNlICwgbXNnOiBgWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBlZGl0IHRoaXMgJHtyZXNvdXJjZX0uYCB9KVxyXG4vLyAgICAgICB9XHJcbi8vXHJcbi8vICAgICAgIG5leHQoKVxyXG4vLyAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuLy8gICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKFwiWW91IGRvbid0IGhhdmUgZW5vdWdoIHBlcm1pc3Npb24gdG8gcGVyZm9ybSB0aGlzIGFjdGlvblwiKVxyXG4vLyAgICAgfVxyXG4vLyAgIH1cclxuLy8gfVxyXG4iXX0=","map":{"version":3,"sources":["validate-token.js"],"names":["validateToken","req","res","next","authorization","headers","console","log","Object","assign","user","accessToken","split","decoded","jwt","verify","process","env","JWT_SECRET","session","findSession","authRepository","deleteSession","client","del","exp","Date","now","userWith","UserModel","findOne","userId","_id","isSession","redisService","checkValueInRedis","updatedDate","expirationDate","jwtToken","updatedAt","moment","duration","diff","asHours","add","JWT_EXPIRATION","toDate","newSession","updateSession","storeNewSession","findById","error","Promise","reject","Error"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport authRepository from \"../../services/auth/data-access/auth-data-access\";\r\n// import redis from \"../config/redis-config\";\r\nimport {UserModel} from \"../../models/user\";\r\nimport redisService from \"../../services/redis/redis-services\"\r\nimport client from \"../../config/redis-config\";\r\n\r\nconst validateToken = async (req, res, next) => {\r\n    try {\r\n        const authorization = req.headers.authorization\r\n        console.log(\"authorization: \",authorization)\r\n        Object.assign(req.headers, {\r\n            user: null,\r\n            authorization: null,\r\n        });\r\n\r\n        if (!authorization) {\r\n            return next();\r\n        }\r\n\r\n        const accessToken = authorization.split(\" \")[1];\r\n        console.log(\"accessTocken: \", accessToken);\r\n        let decoded;\r\n        if (accessToken) {\r\n            decoded = jwt.verify(accessToken, process.env.JWT_SECRET);\r\n        }\r\n        if (!decoded) {\r\n            // invalid token, remove the token from everywhere\r\n            //remove from database\r\n        \r\n            const session = await findSession(accessToken)\r\n\r\n           await authRepository.deleteSession(session)\r\n\r\n            //remove from redis\r\n            await client.del(accessToken)\r\n\r\n            return next();\r\n        }\r\n\r\n        if (decoded.exp * 1000 < Date.now()) {\r\n            //remove from database\r\n\r\n            const userWith = await UserModel.findOne( decoded.userId );\r\n            const userId = userWith._id\r\n            const session = await findSession(userId)\r\n\r\n           await authRepository.deleteSession(session)\r\n\r\n            //remove from redis\r\n            await client.del(accessToken)\r\n\r\n            return next();\r\n        }\r\n\r\n        //check if token is in redis\r\n        const isSession = await redisService.checkValueInRedis(accessToken)\r\n        //if NOT in redis call next()\r\n        if (!isSession){\r\n            return next();\r\n        }\r\n        //else check last update time if greater than or equals to 1hour update the token\r\n        // if less skip else update token\r\n        // authorization = new token\r\n        else if(isSession){\r\n            let updatedDate = isSession.expirationDate;\r\n            let accessToken = isSession.jwtToken\r\n\r\n            const updatedAt = moment(isSession.updatedAt)\r\n            const now = moment(new Date());\r\n            \r\n            const duration = (moment.duration(now.diff(updatedAt))).asHours()\r\n            // console.log(duration)\r\n            \r\n            if (duration >= 1) {\r\n                updatedDate = (moment(isSession.expirationDate).add(process.env.JWT_EXPIRATION,'days')).toDate()\r\n            }\r\n            // increase count and date of session\r\n            const newSession = await authRepository.updateSession(isSession,updatedDate)\r\n            // console.log('new session', newSession)\r\n            await redisService.storeNewSession(accessToken,newSession)\r\n        }\r\n\r\n        const user = await UserModel.findById(decoded.userId);\r\n        if (!user) {\r\n            //remove from database token\r\n            const session = await authRepository.findSession(accessToken)\r\n\r\n            await authRepository.deleteSession(session)\r\n\r\n            //remove from redis\r\n            await client.del(accessToken)\r\n            //remove from redis\r\n            return next();\r\n        }\r\n\r\n        // if the token has come all this way everything is good just attach it to the request header\r\n        Object.assign(req.headers, {\r\n            user,\r\n            authorization,\r\n        });\r\n\r\n        return next();\r\n    } catch (error) {\r\n        console.log(error)\r\n        return Promise.reject(new Error(\"Error Happened!\"));\r\n    }\r\n};\r\n\r\nexport default validateToken;\r\n\r\n\r\n// ------------- authorization ------------------\r\n\r\n// let check_user_action = async (req,action,resource) =>{\r\n//   if(!['updateOwn','deleteOwn'].includes(action)){\r\n//     return true\r\n//   }\r\n//\r\n//   const userResource = new Set()\r\n//\r\n//   if(resource == 'tender'){\r\n//     let userTender = await Tender.find({ creator_user: req.user._id })\r\n//     userTender.forEach(tender => userResource.add(`${tender._id}`))\r\n//\r\n//   }else if(resource == 'company'){\r\n//     let userCompany = await Company.find({ creator_user: req.user._id })\r\n//     userCompany.forEach(company => userResource.add( `${company._id}`))\r\n//\r\n//   }else if(resource == 'award'){\r\n//     let userAward = await Award.find({ creator_user: req.user._id })\r\n//     userAward.forEach(award => userResource.add(`${award._id}`))\r\n//   }\r\n//\r\n//   if(!userResource.has(req.params.id)){\r\n//     return false\r\n//   }\r\n//\r\n//   return true\r\n// }\r\n//\r\n//\r\n//\r\n// exports.authorize = function (action, resource) {\r\n//   return async (req, res, next) => {\r\n//     try {\r\n//       const permission = roles.can(req.user.role)[action](resource);\r\n//\r\n//       if (!permission.granted) {\r\n//         return res.status(401).send(\"You don't have enough permission to perform this action\");\r\n//       }\r\n//\r\n//       let result = await check_user_action(req,action,resource)\r\n//       if(!result){\r\n//         return res.status(401).send({ param: resource , msg: `You are not authorized to edit this ${resource}.` })\r\n//       }\r\n//\r\n//       next()\r\n//     } catch (error) {\r\n//       return res.status(401).send(\"You don't have enough permission to perform this action\")\r\n//     }\r\n//   }\r\n// }\r\n"]}},"mtime":1648793105802},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\auth\\\\phone-verification.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\n// import admin from \"../../config/firebase-config\";\nconst phoneVerification = async (resolve, source, args, context, info) => {\n  // const {phoneVerification} = context;\n  // let phoneNumber = \"\";\n  //\n  // await admin\n  //     .auth()\n  //     .verifyIdToken(phoneVerification)\n  //     .then((decodedToken) => {\n  //         phoneNumber = decodedToken.phone_number;\n  //     })\n  //     .catch(() => Promise.reject(new Error(\"Error happened!\")));\n  // if (phoneNumber === \"\") {\n  //     return Promise.reject(new Error(\"Phone number not detected!\"));\n  // }\n  // context.phoneNumber = phoneNumber;\n  return resolve(source, args, context, info);\n};\n\nvar _default = phoneVerification;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBob25lLXZlcmlmaWNhdGlvbi5qcyJdLCJuYW1lcyI6WyJwaG9uZVZlcmlmaWNhdGlvbiIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUVBLE1BQU1BLGlCQUFpQixHQUFHLE9BQU9DLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFPSixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsQ0FoQkQ7O2VBa0JlTCxpQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbWlkZGxld2FyZXNcXGF1dGhcXCIsInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCBhZG1pbiBmcm9tIFwiLi4vLi4vY29uZmlnL2ZpcmViYXNlLWNvbmZpZ1wiO1xyXG5cclxuY29uc3QgcGhvbmVWZXJpZmljYXRpb24gPSBhc3luYyAocmVzb2x2ZSwgc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKSA9PiB7XHJcbiAgICAvLyBjb25zdCB7cGhvbmVWZXJpZmljYXRpb259ID0gY29udGV4dDtcclxuICAgIC8vIGxldCBwaG9uZU51bWJlciA9IFwiXCI7XHJcbiAgICAvL1xyXG4gICAgLy8gYXdhaXQgYWRtaW5cclxuICAgIC8vICAgICAuYXV0aCgpXHJcbiAgICAvLyAgICAgLnZlcmlmeUlkVG9rZW4ocGhvbmVWZXJpZmljYXRpb24pXHJcbiAgICAvLyAgICAgLnRoZW4oKGRlY29kZWRUb2tlbikgPT4ge1xyXG4gICAgLy8gICAgICAgICBwaG9uZU51bWJlciA9IGRlY29kZWRUb2tlbi5waG9uZV9udW1iZXI7XHJcbiAgICAvLyAgICAgfSlcclxuICAgIC8vICAgICAuY2F0Y2goKCkgPT4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3IgaGFwcGVuZWQhXCIpKSk7XHJcbiAgICAvLyBpZiAocGhvbmVOdW1iZXIgPT09IFwiXCIpIHtcclxuICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiUGhvbmUgbnVtYmVyIG5vdCBkZXRlY3RlZCFcIikpO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gY29udGV4dC5waG9uZU51bWJlciA9IHBob25lTnVtYmVyO1xyXG4gICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgcGhvbmVWZXJpZmljYXRpb247XHJcbiJdfQ==","map":{"version":3,"sources":["phone-verification.js"],"names":["phoneVerification","resolve","source","args","context","info"],"mappings":";;;;;;;AAAA;AAEA,MAAMA,iBAAiB,GAAG,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAOJ,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,CAhBD;;eAkBeL,iB","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\auth\\","sourcesContent":["// import admin from \"../../config/firebase-config\";\r\n\r\nconst phoneVerification = async (resolve, source, args, context, info) => {\r\n    // const {phoneVerification} = context;\r\n    // let phoneNumber = \"\";\r\n    //\r\n    // await admin\r\n    //     .auth()\r\n    //     .verifyIdToken(phoneVerification)\r\n    //     .then((decodedToken) => {\r\n    //         phoneNumber = decodedToken.phone_number;\r\n    //     })\r\n    //     .catch(() => Promise.reject(new Error(\"Error happened!\")));\r\n    // if (phoneNumber === \"\") {\r\n    //     return Promise.reject(new Error(\"Phone number not detected!\"));\r\n    // }\r\n    // context.phoneNumber = phoneNumber;\r\n    return resolve(source, args, context, info);\r\n}\r\n\r\nexport default phoneVerification;\r\n"]}},"mtime":1648684433891},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\validators\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\middlewares\\\\validators\\\\user-validator.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n// import validator from \"validators\";\nconst userValidator = {\n  changePassword: async (resolve, source, args, context, info) => {\n    const {\n      newPassword\n    } = args; // if (!validator.isLength(newPassword, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: newPassword\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  newPassword: async (resolve, source, args, context, info) => {\n    const {\n      newPassword\n    } = args; // if (!validator.isLength(newPassword, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: newPassword\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  resetPassword: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = validator.normalizeEmail(email);\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    return resolve(source, args, context, info);\n  },\n  signIn: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = email.toString().toLowerCase();\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    return resolve(source, args, context, info);\n  },\n  signUp: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = email.toString().toLowerCase();\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    const {\n      password\n    } = args; // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\n    //     return Promise.reject(new Error(\"Error: email\"));\n    // }\n    //\n    // if (!validator.isLength(password, {min: 6})) {\n    //     return Promise.reject(new Error(\"Error: password\"));\n    // }\n\n    return resolve(source, args, context, info);\n  },\n  updateUser: async (resolve, source, args, context, info) => {\n    let {\n      email\n    } = args; // email = validator.normalizeEmail(email);\n    // email = validator.trim(email);\n    //\n    // Object.assign(args, {email});\n\n    const {\n      firstName,\n      lastName\n    } = args; // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\n    //     return Promise.reject(new Error(\"Error: email\"));\n    // }\n    // if (!validator.isLength(firstName, {min: 2})) {\n    //     return Promise.reject(new Error(\"Error: firstName\"));\n    // }\n    // if (!validator.isLength(lastName, {min: 2})) {\n    //     return Promise.reject(new Error(\"Error: lastName\"));\n    // }\n\n    return resolve(source, args, context, info);\n  }\n};\nvar _default = userValidator;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXItdmFsaWRhdG9yLmpzIl0sIm5hbWVzIjpbInVzZXJWYWxpZGF0b3IiLCJjaGFuZ2VQYXNzd29yZCIsInJlc29sdmUiLCJzb3VyY2UiLCJhcmdzIiwiY29udGV4dCIsImluZm8iLCJuZXdQYXNzd29yZCIsInJlc2V0UGFzc3dvcmQiLCJlbWFpbCIsInNpZ25JbiIsInNpZ25VcCIsInBhc3N3b3JkIiwidXBkYXRlVXNlciIsImZpcnN0TmFtZSIsImxhc3ROYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUVBLE1BQU1BLGFBQWEsR0FBRztBQUNsQkMsRUFBQUEsY0FBYyxFQUFFLE9BQU9DLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQzVELFVBQU07QUFBQ0MsTUFBQUE7QUFBRCxRQUFnQkgsSUFBdEIsQ0FENEQsQ0FHNUQ7QUFDQTtBQUNBOztBQUVBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxHQVRpQjtBQVVsQkMsRUFBQUEsV0FBVyxFQUFFLE9BQU9MLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3pELFVBQU07QUFBQ0MsTUFBQUE7QUFBRCxRQUFnQkgsSUFBdEIsQ0FEeUQsQ0FHekQ7QUFDQTtBQUNBOztBQUVBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSCxHQWxCaUI7QUFtQmxCRSxFQUFBQSxhQUFhLEVBQUUsT0FBT04sT0FBUCxFQUFnQkMsTUFBaEIsRUFBd0JDLElBQXhCLEVBQThCQyxPQUE5QixFQUF1Q0MsSUFBdkMsS0FBZ0Q7QUFDM0QsUUFBSTtBQUFDRyxNQUFBQTtBQUFELFFBQVVMLElBQWQsQ0FEMkQsQ0FHM0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsV0FBT0YsT0FBTyxDQUFDQyxNQUFELEVBQVNDLElBQVQsRUFBZUMsT0FBZixFQUF3QkMsSUFBeEIsQ0FBZDtBQUNILEdBNUJpQjtBQTZCbEJJLEVBQUFBLE1BQU0sRUFBRSxPQUFPUixPQUFQLEVBQWdCQyxNQUFoQixFQUF3QkMsSUFBeEIsRUFBOEJDLE9BQTlCLEVBQXVDQyxJQUF2QyxLQUFnRDtBQUNwRCxRQUFJO0FBQUNHLE1BQUFBO0FBQUQsUUFBVUwsSUFBZCxDQURvRCxDQUdwRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxXQUFPRixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsR0F0Q2lCO0FBdUNsQkssRUFBQUEsTUFBTSxFQUFFLE9BQU9ULE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3BELFFBQUk7QUFBQ0csTUFBQUE7QUFBRCxRQUFVTCxJQUFkLENBRG9ELENBR3BEO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFVBQU07QUFBQ1EsTUFBQUE7QUFBRCxRQUFhUixJQUFuQixDQVJvRCxDQVVwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxXQUFPRixPQUFPLENBQUNDLE1BQUQsRUFBU0MsSUFBVCxFQUFlQyxPQUFmLEVBQXdCQyxJQUF4QixDQUFkO0FBQ0gsR0ExRGlCO0FBMkRsQk8sRUFBQUEsVUFBVSxFQUFFLE9BQU9YLE9BQVAsRUFBZ0JDLE1BQWhCLEVBQXdCQyxJQUF4QixFQUE4QkMsT0FBOUIsRUFBdUNDLElBQXZDLEtBQWdEO0FBQ3hELFFBQUk7QUFBQ0csTUFBQUE7QUFBRCxRQUFVTCxJQUFkLENBRHdELENBR3hEO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFVBQU07QUFDRlUsTUFBQUEsU0FERTtBQUVGQyxNQUFBQTtBQUZFLFFBR0ZYLElBSEosQ0FSd0QsQ0FheEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLFdBQU9GLE9BQU8sQ0FBQ0MsTUFBRCxFQUFTQyxJQUFULEVBQWVDLE9BQWYsRUFBd0JDLElBQXhCLENBQWQ7QUFDSDtBQWxGaUIsQ0FBdEI7ZUFxRmVOLGEiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXG1pZGRsZXdhcmVzXFx2YWxpZGF0b3JzXFwiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbXBvcnQgdmFsaWRhdG9yIGZyb20gXCJ2YWxpZGF0b3JzXCI7XHJcblxyXG5jb25zdCB1c2VyVmFsaWRhdG9yID0ge1xyXG4gICAgY2hhbmdlUGFzc3dvcmQ6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB7bmV3UGFzc3dvcmR9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgobmV3UGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IG5ld1Bhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgbmV3UGFzc3dvcmQ6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBjb25zdCB7bmV3UGFzc3dvcmR9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgobmV3UGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IG5ld1Bhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgcmVzZXRQYXNzd29yZDogYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgICAgIGxldCB7ZW1haWx9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gZW1haWwgPSB2YWxpZGF0b3Iubm9ybWFsaXplRW1haWwoZW1haWwpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxuICAgIH0sXHJcbiAgICBzaWduSW46IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBsZXQge2VtYWlsfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGVtYWlsID0gZW1haWwudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoc291cmNlLCBhcmdzLCBjb250ZXh0LCBpbmZvKTtcclxuICAgIH0sXHJcbiAgICBzaWduVXA6IGFzeW5jIChyZXNvbHZlLCBzb3VyY2UsIGFyZ3MsIGNvbnRleHQsIGluZm8pID0+IHtcclxuICAgICAgICBsZXQge2VtYWlsfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGVtYWlsID0gZW1haWwudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgY29uc3Qge3Bhc3N3b3JkfSA9IGFyZ3M7XHJcblxyXG4gICAgICAgIC8vIGlmICghdmFsaWRhdG9yLmlzRW1haWwoZW1haWwsIHthbGxvd191dGY4X2xvY2FsX3BhcnQ6IGZhbHNlfSkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVycm9yOiBlbWFpbFwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gaWYgKCF2YWxpZGF0b3IuaXNMZW5ndGgocGFzc3dvcmQsIHttaW46IDZ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IHBhc3N3b3JkXCIpKTtcclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG4gICAgdXBkYXRlVXNlcjogYXN5bmMgKHJlc29sdmUsIHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbykgPT4ge1xyXG4gICAgICAgIGxldCB7ZW1haWx9ID0gYXJncztcclxuXHJcbiAgICAgICAgLy8gZW1haWwgPSB2YWxpZGF0b3Iubm9ybWFsaXplRW1haWwoZW1haWwpO1xyXG4gICAgICAgIC8vIGVtYWlsID0gdmFsaWRhdG9yLnRyaW0oZW1haWwpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbihhcmdzLCB7ZW1haWx9KTtcclxuXHJcbiAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICBmaXJzdE5hbWUsXHJcbiAgICAgICAgICAgIGxhc3ROYW1lLFxyXG4gICAgICAgIH0gPSBhcmdzO1xyXG5cclxuICAgICAgICAvLyBpZiAoIXZhbGlkYXRvci5pc0VtYWlsKGVtYWlsLCB7YWxsb3dfdXRmOF9sb2NhbF9wYXJ0OiBmYWxzZX0pKSB7XHJcbiAgICAgICAgLy8gICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJFcnJvcjogZW1haWxcIikpO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyBpZiAoIXZhbGlkYXRvci5pc0xlbmd0aChmaXJzdE5hbWUsIHttaW46IDJ9KSkge1xyXG4gICAgICAgIC8vICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRXJyb3I6IGZpcnN0TmFtZVwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIC8vIGlmICghdmFsaWRhdG9yLmlzTGVuZ3RoKGxhc3ROYW1lLCB7bWluOiAyfSkpIHtcclxuICAgICAgICAvLyAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIkVycm9yOiBsYXN0TmFtZVwiKSk7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgICAgIHJldHVybiByZXNvbHZlKHNvdXJjZSwgYXJncywgY29udGV4dCwgaW5mbyk7XHJcbiAgICB9LFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlclZhbGlkYXRvcjtcclxuIl19","map":{"version":3,"sources":["user-validator.js"],"names":["userValidator","changePassword","resolve","source","args","context","info","newPassword","resetPassword","email","signIn","signUp","password","updateUser","firstName","lastName"],"mappings":";;;;;;AAAA;AAEA,MAAMA,aAAa,GAAG;AAClBC,EAAAA,cAAc,EAAE,OAAOC,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC5D,UAAM;AAACC,MAAAA;AAAD,QAAgBH,IAAtB,CAD4D,CAG5D;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GATiB;AAUlBC,EAAAA,WAAW,EAAE,OAAOL,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACzD,UAAM;AAACC,MAAAA;AAAD,QAAgBH,IAAtB,CADyD,CAGzD;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GAlBiB;AAmBlBE,EAAAA,aAAa,EAAE,OAAON,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AAC3D,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CAD2D,CAG3D;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GA5BiB;AA6BlBI,EAAAA,MAAM,EAAE,OAAOR,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACpD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADoD,CAGpD;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GAtCiB;AAuClBK,EAAAA,MAAM,EAAE,OAAOT,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACpD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADoD,CAGpD;AACA;AACA;AACA;;AAEA,UAAM;AAACQ,MAAAA;AAAD,QAAaR,IAAnB,CARoD,CAUpD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH,GA1DiB;AA2DlBO,EAAAA,UAAU,EAAE,OAAOX,OAAP,EAAgBC,MAAhB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuCC,IAAvC,KAAgD;AACxD,QAAI;AAACG,MAAAA;AAAD,QAAUL,IAAd,CADwD,CAGxD;AACA;AACA;AACA;;AAEA,UAAM;AACFU,MAAAA,SADE;AAEFC,MAAAA;AAFE,QAGFX,IAHJ,CARwD,CAaxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAAOF,OAAO,CAACC,MAAD,EAASC,IAAT,EAAeC,OAAf,EAAwBC,IAAxB,CAAd;AACH;AAlFiB,CAAtB;eAqFeN,a","sourceRoot":"E:\\haleta-new-api\\src\\middlewares\\validators\\","sourcesContent":["// import validator from \"validators\";\r\n\r\nconst userValidator = {\r\n    changePassword: async (resolve, source, args, context, info) => {\r\n        const {newPassword} = args;\r\n\r\n        // if (!validator.isLength(newPassword, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: newPassword\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    newPassword: async (resolve, source, args, context, info) => {\r\n        const {newPassword} = args;\r\n\r\n        // if (!validator.isLength(newPassword, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: newPassword\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    resetPassword: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = validator.normalizeEmail(email);\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    signIn: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = email.toString().toLowerCase();\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    signUp: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = email.toString().toLowerCase();\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        const {password} = args;\r\n\r\n        // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\r\n        //     return Promise.reject(new Error(\"Error: email\"));\r\n        // }\r\n        //\r\n        // if (!validator.isLength(password, {min: 6})) {\r\n        //     return Promise.reject(new Error(\"Error: password\"));\r\n        // }\r\n\r\n        return resolve(source, args, context, info);\r\n    },\r\n    updateUser: async (resolve, source, args, context, info) => {\r\n        let {email} = args;\r\n\r\n        // email = validator.normalizeEmail(email);\r\n        // email = validator.trim(email);\r\n        //\r\n        // Object.assign(args, {email});\r\n\r\n        const {\r\n            firstName,\r\n            lastName,\r\n        } = args;\r\n\r\n        // if (!validator.isEmail(email, {allow_utf8_local_part: false})) {\r\n        //     return Promise.reject(new Error(\"Error: email\"));\r\n        // }\r\n        // if (!validator.isLength(firstName, {min: 2})) {\r\n        //     return Promise.reject(new Error(\"Error: firstName\"));\r\n        // }\r\n        // if (!validator.isLength(lastName, {min: 2})) {\r\n        //     return Promise.reject(new Error(\"Error: lastName\"));\r\n        // }\r\n        return resolve(source, args, context, info);\r\n    },\r\n};\r\n\r\nexport default userValidator;\r\n"]}},"mtime":1648684433893},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\resolvers\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\resolvers\\\\auth-resolvers.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _authUseCases = _interopRequireDefault(require(\"../../../services/auth/use-cases/auth-use-cases\"));\n\nvar _redisServices = _interopRequireDefault(require(\"../../../services/redis/redis-services\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\nconst signIn = {\n  name: \"signIn\",\n  type: \"AccessToken!\",\n  args: {\n    phoneNumber: \"String!\",\n    password: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      phoneNumber,\n      password\n    }\n  }) => {\n    try {\n      const {\n        user,\n        accessToken\n      } = await _authUseCases.default.signIn({\n        phoneNumber,\n        password\n      });\n      return {\n        accessToken,\n        user\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst signUp = {\n  name: \"signUp\",\n  type: \"AccessToken!\",\n  args: {\n    firstName: \"String!\",\n    middleName: \"String!\",\n    lastName: \"String!\",\n    password: \"String!\",\n    phoneNumber: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      firstName,\n      middleName,\n      lastName,\n      password,\n      phoneNumber\n    },\n    context: {\n      phoneVerification\n    }\n  }) => {\n    try {\n      const {\n        accessToken,\n        user\n      } = await _authUseCases.default.signUp({\n        firstName,\n        middleName,\n        lastName,\n        password,\n        phoneNumber\n      });\n      console.log(accessToken);\n      return {\n        accessToken,\n        // roles: user.roles,\n        user\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst logout = {\n  name: 'logout',\n  type: 'Succeed!',\n  resolve: async ({\n    context: {\n      user,\n      accessToken\n    }\n  }) => {\n    try {\n      // await redis.set(`expiredToken:${accessToken}`, user._id, 'EX', process.env.REDIS_TOKEN_EXPIRY);\n      await _authUseCases.default.logout({\n        user,\n        accessToken\n      });\n      return {\n        succeed: true\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nconst changePassword = {\n  name: \"changePassword\",\n  type: \"AccessToken!\",\n  args: {\n    newPassword: \"String!\"\n  },\n  resolve: async ({\n    args: {\n      newPassword\n    },\n    context: {\n      user,\n      accessToken\n    }\n  }) => {\n    try {\n      console.log(\"changepassword\");\n      const {\n        updatedUser,\n        oldAccessTocken\n      } = await _authUseCases.default.changePassword({\n        newPassword,\n        user,\n        accessToken\n      });\n      return {\n        updatedUser,\n        oldAccessTocken\n      };\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  }\n};\nvar _default = {\n  signIn,\n  signUp,\n  logout,\n  changePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtcmVzb2x2ZXJzLmpzIl0sIm5hbWVzIjpbInNpZ25JbiIsIm5hbWUiLCJ0eXBlIiwiYXJncyIsInBob25lTnVtYmVyIiwicGFzc3dvcmQiLCJyZXNvbHZlIiwidXNlciIsImFjY2Vzc1Rva2VuIiwiYXV0aFNlcnZpY2VzIiwiZXJyb3IiLCJQcm9taXNlIiwicmVqZWN0Iiwic2lnblVwIiwiZmlyc3ROYW1lIiwibWlkZGxlTmFtZSIsImxhc3ROYW1lIiwiY29udGV4dCIsInBob25lVmVyaWZpY2F0aW9uIiwiY29uc29sZSIsImxvZyIsImxvZ291dCIsInN1Y2NlZWQiLCJjaGFuZ2VQYXNzd29yZCIsIm5ld1Bhc3N3b3JkIiwidXBkYXRlZFVzZXIiLCJvbGRBY2Nlc3NUb2NrZW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBO0FBRUEsTUFBTUEsTUFBTSxHQUFHO0FBQ1hDLEVBQUFBLElBQUksRUFBRSxRQURLO0FBRVhDLEVBQUFBLElBQUksRUFBRSxjQUZLO0FBR1hDLEVBQUFBLElBQUksRUFBRTtBQUNGQyxJQUFBQSxXQUFXLEVBQUUsU0FEWDtBQUVGQyxJQUFBQSxRQUFRLEVBQUU7QUFGUixHQUhLO0FBT1hDLEVBQUFBLE9BQU8sRUFBRSxPQUFPO0FBQUNILElBQUFBLElBQUksRUFBRTtBQUFDQyxNQUFBQSxXQUFEO0FBQWNDLE1BQUFBO0FBQWQ7QUFBUCxHQUFQLEtBQTJDO0FBQ2hELFFBQUk7QUFFQSxZQUFNO0FBQUNFLFFBQUFBLElBQUQ7QUFBT0MsUUFBQUE7QUFBUCxVQUFzQixNQUFNQyxzQkFBYVQsTUFBYixDQUFvQjtBQUFDSSxRQUFBQSxXQUFEO0FBQWNDLFFBQUFBO0FBQWQsT0FBcEIsQ0FBbEM7QUFFQSxhQUFPO0FBQUNHLFFBQUFBLFdBQUQ7QUFBY0QsUUFBQUE7QUFBZCxPQUFQO0FBQ0gsS0FMRCxDQUtFLE9BQU9HLEtBQVAsRUFBYztBQUNaLGFBQU9DLE9BQU8sQ0FBQ0MsTUFBUixD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RUFBYztBQUNaLGFBQU9DLE9BQU8sQ0FBQ0MsTUFBUixDQUFlRixLQUFmLENBQVA7QUFDSDtBQUNKO0FBZmtCLENBQXZCO2VBa0JlO0FBQ1hWLEVBQUFBLE1BRFc7QUFFWGEsRUFBQUEsTUFGVztBQUdYUSxFQUFBQSxNQUhXO0FBSVhFLEVBQUFBO0FBSlcsQyIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcZ3JhcGhxbFxcYXV0aFxccmVzb2x2ZXJzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcclxuaW1wb3J0IHtVc2VyTW9kZWx9IGZyb20gXCIuLi8uLi8uLi9tb2RlbHMvdXNlclwiO1xyXG5pbXBvcnQgYXV0aFNlcnZpY2VzIGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9hdXRoL3VzZS1jYXNlcy9hdXRoLXVzZS1jYXNlc1wiO1xyXG5pbXBvcnQgc3RvcmVOZXdTZXNzaW9uIGZyb20gXCIuLi8uLi8uLi9zZXJ2aWNlcy9yZWRpcy9yZWRpcy1zZXJ2aWNlc1wiXHJcblxyXG4vLyBpbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcclxuXHJcbmNvbnN0IHNpZ25JbiA9IHtcclxuICAgIG5hbWU6IFwic2lnbkluXCIsXHJcbiAgICB0eXBlOiBcIkFjY2Vzc1Rva2VuIVwiLFxyXG4gICAgYXJnczoge1xyXG4gICAgICAgIHBob25lTnVtYmVyOiBcIlN0cmluZyFcIixcclxuICAgICAgICBwYXNzd29yZDogXCJTdHJpbmchXCIsXHJcbiAgICB9LFxyXG4gICAgcmVzb2x2ZTogYXN5bmMgKHthcmdzOiB7cGhvbmVOdW1iZXIsIHBhc3N3b3JkfX0pID0+IHtcclxuICAgICAgICB0cnkge1xyXG5cclxuICAgICAgICAgICAgY29uc3Qge3VzZXIsIGFjY2Vzc1Rva2VufSA9IGF3YWl0IGF1dGhTZXJ2aWNlcy5zaWduSW4oe3Bob25lTnVtYmVyLCBwYXNzd29yZH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHthY2Nlc3NUb2tlbiwgdXNlcn07XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59O1xyXG5cclxuXHJcbmNvbnN0IHNpZ25VcCA9IHtcclxuICAgIG5hbWU6IFwic2lnblVwXCIsXHJcbiAgICB0eXBlOiBcIkFjY2Vzc1Rva2VuIVwiLFxyXG4gICAgYXJnczoge1xyXG4gICAgICAgIGZpcnN0TmFtZTogXCJTdHJpbmchXCIsXHJcbiAgICAgICAgbWlkZGxlTmFtZTogXCJTdHJpbmchXCIsXHJcbiAgICAgICAgbGFzdE5hbWU6IFwiU3RyaW5nIVwiLFxyXG4gICAgICAgIHBhc3N3b3JkOiBcIlN0cmluZyFcIixcclxuICAgICAgICBwaG9uZU51bWJlcjogXCJTdHJpbmchXCIsXHJcbiAgICB9LFxyXG4gICAgcmVzb2x2ZTogYXN5bmMgKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJnczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWlkZGxlTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG9uZU51bWJlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG9uZVZlcmlmaWNhdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB9KSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHthY2Nlc3NUb2tlbiwgdXNlcn0gPSBhd2FpdCBhdXRoU2VydmljZXMuc2lnblVwKHtcclxuICAgICAgICAgICAgICAgIGZpcnN0TmFtZSxcclxuICAgICAgICAgICAgICAgIG1pZGRsZU5hbWUsXHJcbiAgICAgICAgICAgICAgICBsYXN0TmFtZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkLFxyXG4gICAgICAgICAgICAgICAgcGhvbmVOdW1iZXIsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhY2Nlc3NUb2tlbikgICBcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuLFxyXG4gICAgICAgICAgICAgICAgLy8gcm9sZXM6IHVzZXIucm9sZXMsXHJcbiAgICAgICAgICAgICAgICB1c2VyLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxufTtcclxuXHJcbmNvbnN0IGxvZ291dCA9IHtcclxuICAgIG5hbWU6ICdsb2dvdXQnLFxyXG4gICAgdHlwZTogJ1N1Y2NlZWQhJyxcclxuICAgIHJlc29sdmU6IGFzeW5jICh7Y29udGV4dDoge3VzZXIsIGFjY2Vzc1Rva2VufX0pID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBhd2FpdCByZWRpcy5zZXQoYGV4cGlyZWRUb2tlbjoke2FjY2Vzc1Rva2VufWAsIHVzZXIuX2lkLCAnRVgnLCBwcm9jZXNzLmVudi5SRURJU19UT0tFTl9FWFBJUlkpO1xyXG4gICAgICAgICAgICBhd2FpdCBhdXRoU2VydmljZXMubG9nb3V0KHt1c2VyLGFjY2Vzc1Rva2VufSlcclxuICAgICAgICAgICAgcmV0dXJuIHtzdWNjZWVkOiB0cnVlfTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbmNvbnN0IGNoYW5nZVBhc3N3b3JkID0ge1xyXG4gICAgbmFtZTogXCJjaGFuZ2VQYXNzd29yZFwiLFxyXG4gICAgdHlwZTogXCJBY2Nlc3NUb2tlbiFcIixcclxuICAgIGFyZ3M6IHtcclxuICAgICAgICBuZXdQYXNzd29yZDogXCJTdHJpbmchXCIsXHJcbiAgICB9LFxyXG4gICAgcmVzb2x2ZTogYXN5bmMgKHthcmdzOiB7bmV3UGFzc3dvcmR9LCBjb250ZXh0OiB7dXNlciwgYWNjZXNzVG9rZW59fSkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbmNvbnNvbGUubG9nKFwiY2hhbmdlcGFzc3dvcmRcIilcclxuICAgICAgICAgICAgY29uc3Qge3VwZGF0ZWRVc2VyLCBvbGRBY2Nlc3NUb2NrZW59ID0gYXdhaXQgYXV0aFNlcnZpY2VzLmNoYW5nZVBhc3N3b3JkKHtuZXdQYXNzd29yZCwgdXNlciwgYWNjZXNzVG9rZW59KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB7dXBkYXRlZFVzZXIsIG9sZEFjY2Vzc1RvY2tlbn07XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQge1xyXG4gICAgc2lnbkluLFxyXG4gICAgc2lnblVwLFxyXG4gICAgbG9nb3V0LFxyXG4gICAgY2hhbmdlUGFzc3dvcmQsXHJcbn0iXX0=","map":{"version":3,"sources":["auth-resolvers.js"],"names":["signIn","name","type","args","phoneNumber","password","resolve","user","accessToken","authServices","error","Promise","reject","signUp","firstName","middleName","lastName","context","phoneVerification","console","log","logout","succeed","changePassword","newPassword","updatedUser","oldAccessTocken"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA;AAEA,MAAMA,MAAM,GAAG;AACXC,EAAAA,IAAI,EAAE,QADK;AAEXC,EAAAA,IAAI,EAAE,cAFK;AAGXC,EAAAA,IAAI,EAAE;AACFC,IAAAA,WAAW,EAAE,SADX;AAEFC,IAAAA,QAAQ,EAAE;AAFR,GAHK;AAOXC,EAAAA,OAAO,EAAE,OAAO;AAACH,IAAAA,IAAI,EAAE;AAACC,MAAAA,WAAD;AAAcC,MAAAA;AAAd;AAAP,GAAP,KAA2C;AAChD,QAAI;AAEA,YAAM;AAACE,QAAAA,IAAD;AAAOC,QAAAA;AAAP,UAAsB,MAAMC,sBAAaT,MAAb,CAAoB;AAACI,QAAAA,WAAD;AAAcC,QAAAA;AAAd,OAApB,CAAlC;AAEA,aAAO;AAACG,QAAAA,WAAD;AAAcD,QAAAA;AAAd,OAAP;AACH,KALD,CAKE,OAAOG,KAAP,EAAc;AACZ,aAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH;AACJ;AAhBU,CAAf;AAoBA,MAAMG,MAAM,GAAG;AACXZ,EAAAA,IAAI,EAAE,QADK;AAEXC,EAAAA,IAAI,EAAE,cAFK;AAGXC,EAAAA,IAAI,EAAE;AACFW,IAAAA,SAAS,EAAE,SADT;AAEFC,IAAAA,UAAU,EAAE,SAFV;AAGFC,IAAAA,QAAQ,EAAE,SAHR;AAIFX,IAAAA,QAAQ,EAAE,SAJR;AAKFD,IAAAA,WAAW,EAAE;AALX,GAHK;AAUXE,EAAAA,OAAO,EAAE,OAAO;AACIH,IAAAA,IAAI,EAAE;AACFW,MAAAA,SADE;AAEFC,MAAAA,UAFE;AAGFC,MAAAA,QAHE;AAIFX,MAAAA,QAJE;AAKFD,MAAAA;AALE,KADV;AAQIa,IAAAA,OAAO,EAAE;AACLC,MAAAA;AADK;AARb,GAAP,KAWa;AAClB,QAAI;AAEA,YAAM;AAACV,QAAAA,WAAD;AAAcD,QAAAA;AAAd,UAAsB,MAAME,sBAAaI,MAAb,CAAoB;AAClDC,QAAAA,SADkD;AAElDC,QAAAA,UAFkD;AAGlDC,QAAAA,QAHkD;AAIlDX,QAAAA,QAJkD;AAKlDD,QAAAA;AALkD,OAApB,CAAlC;AAOAe,MAAAA,OAAO,CAACC,GAAR,CAAYZ,WAAZ;AACA,aAAO;AACHA,QAAAA,WADG;AAEH;AACAD,QAAAA;AAHG,OAAP;AAKH,KAfD,CAeE,OAAOG,KAAP,EAAc;AACZ,aAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH;AACJ;AAxCU,CAAf;AA2CA,MAAMW,MAAM,GAAG;AACXpB,EAAAA,IAAI,EAAE,QADK;AAEXC,EAAAA,IAAI,EAAE,UAFK;AAGXI,EAAAA,OAAO,EAAE,OAAO;AAACW,IAAAA,OAAO,EAAE;AAACV,MAAAA,IAAD;AAAOC,MAAAA;AAAP;AAAV,GAAP,KAA0C;AAC/C,QAAI;AACA;AACA,YAAMC,sBAAaY,MAAb,CAAoB;AAACd,QAAAA,IAAD;AAAMC,QAAAA;AAAN,OAApB,CAAN;AACA,aAAO;AAACc,QAAAA,OAAO,EAAE;AAAV,OAAP;AACH,KAJD,CAIE,OAAOZ,KAAP,EAAc;AACZ,aAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH;AACJ;AAXU,CAAf;AAcA,MAAMa,cAAc,GAAG;AACnBtB,EAAAA,IAAI,EAAE,gBADa;AAEnBC,EAAAA,IAAI,EAAE,cAFa;AAGnBC,EAAAA,IAAI,EAAE;AACFqB,IAAAA,WAAW,EAAE;AADX,GAHa;AAMnBlB,EAAAA,OAAO,EAAE,OAAO;AAACH,IAAAA,IAAI,EAAE;AAACqB,MAAAA;AAAD,KAAP;AAAsBP,IAAAA,OAAO,EAAE;AAACV,MAAAA,IAAD;AAAOC,MAAAA;AAAP;AAA/B,GAAP,KAA+D;AACpE,QAAI;AACZW,MAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACY,YAAM;AAACK,QAAAA,WAAD;AAAcC,QAAAA;AAAd,UAAiC,MAAMjB,sBAAac,cAAb,CAA4B;AAACC,QAAAA,WAAD;AAAcjB,QAAAA,IAAd;AAAoBC,QAAAA;AAApB,OAA5B,CAA7C;AAEA,aAAO;AAACiB,QAAAA,WAAD;AAAcC,QAAAA;AAAd,OAAP;AACH,KALD,CAKE,OAAOhB,KAAP,EAAc;AACZ,aAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH;AACJ;AAfkB,CAAvB;eAkBe;AACXV,EAAAA,MADW;AAEXa,EAAAA,MAFW;AAGXQ,EAAAA,MAHW;AAIXE,EAAAA;AAJW,C","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\resolvers\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport {UserModel} from \"../../../models/user\";\r\nimport authServices from \"../../../services/auth/use-cases/auth-use-cases\";\r\nimport storeNewSession from \"../../../services/redis/redis-services\"\r\n\r\n// import crypto from \"crypto\";\r\n\r\nconst signIn = {\r\n    name: \"signIn\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        phoneNumber: \"String!\",\r\n        password: \"String!\",\r\n    },\r\n    resolve: async ({args: {phoneNumber, password}}) => {\r\n        try {\r\n\r\n            const {user, accessToken} = await authServices.signIn({phoneNumber, password});\r\n\r\n            return {accessToken, user};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\n\r\nconst signUp = {\r\n    name: \"signUp\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        firstName: \"String!\",\r\n        middleName: \"String!\",\r\n        lastName: \"String!\",\r\n        password: \"String!\",\r\n        phoneNumber: \"String!\",\r\n    },\r\n    resolve: async ({\r\n                        args: {\r\n                            firstName,\r\n                            middleName,\r\n                            lastName,\r\n                            password,\r\n                            phoneNumber\r\n                        },\r\n                        context: {\r\n                            phoneVerification,\r\n                        },\r\n                    }) => {\r\n        try {\r\n\r\n            const {accessToken, user} = await authServices.signUp({\r\n                firstName,\r\n                middleName,\r\n                lastName,\r\n                password,\r\n                phoneNumber,\r\n            });\r\n            console.log(accessToken)   \r\n            return {\r\n                accessToken,\r\n                // roles: user.roles,\r\n                user,\r\n            };\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\nconst logout = {\r\n    name: 'logout',\r\n    type: 'Succeed!',\r\n    resolve: async ({context: {user, accessToken}}) => {\r\n        try {\r\n            // await redis.set(`expiredToken:${accessToken}`, user._id, 'EX', process.env.REDIS_TOKEN_EXPIRY);\r\n            await authServices.logout({user,accessToken})\r\n            return {succeed: true};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    }\r\n};\r\n\r\nconst changePassword = {\r\n    name: \"changePassword\",\r\n    type: \"AccessToken!\",\r\n    args: {\r\n        newPassword: \"String!\",\r\n    },\r\n    resolve: async ({args: {newPassword}, context: {user, accessToken}}) => {\r\n        try {\r\nconsole.log(\"changepassword\")\r\n            const {updatedUser, oldAccessTocken} = await authServices.changePassword({newPassword, user, accessToken});\r\n\r\n            return {updatedUser, oldAccessTocken};\r\n        } catch (error) {\r\n            return Promise.reject(error);\r\n        }\r\n    },\r\n};\r\n\r\nexport default {\r\n    signIn,\r\n    signUp,\r\n    logout,\r\n    changePassword,\r\n}"]}},"mtime":1648765826720},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\user\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\user\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserQuery = exports.UserMutation = void 0;\n\nvar _user = require(\"../../models/user\");\n\nvar _middlewares = require(\"../../middlewares\");\n\n// import Resolvers from \"./use-cases\";\n//\n// for (const resolver in Resolvers) {\n//     UserTC.addResolver(Resolvers[resolver]);\n// }\nconst UserQuery = {\n  userById: _user.UserTC.getResolver(\"findById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userByIds: _user.UserTC.getResolver(\"findByIds\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userOne: _user.UserTC.getResolver(\"findOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userMany: _user.UserTC.getResolver(\"findMany\", [_middlewares.authentication.isAuth, _middlewares.authorization])\n};\nexports.UserQuery = UserQuery;\nconst UserMutation = {\n  userCreateOne: _user.UserTC.getResolver(\"createOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userCreateMany: _user.UserTC.getResolver(\"createMany\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateById: _user.UserTC.getResolver(\"updateById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateOne: _user.UserTC.getResolver(\"updateOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateMany: _user.UserTC.getResolver(\"updateMany\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveById: _user.UserTC.getResolver(\"removeById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveOne: _user.UserTC.getResolver(\"removeOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveMany: _user.UserTC.getResolver(\"removeMany\", [_middlewares.authentication.isAuth, _middlewares.authorization])\n};\nexports.UserMutation = UserMutation;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIlVzZXJRdWVyeSIsInVzZXJCeUlkIiwiVXNlclRDIiwiZ2V0UmVzb2x2ZXIiLCJhdXRoZW50aWNhdGlvbiIsImlzQXV0aCIsImF1dGhvcml6YXRpb24iLCJ1c2VyQnlJZHMiLCJ1c2VyT25lIiwidXNlck1hbnkiLCJVc2VyTXV0YXRpb24iLCJ1c2VyQ3JlYXRlT25lIiwidXNlckNyZWF0ZU1hbnkiLCJ1c2VyVXBkYXRlQnlJZCIsInVzZXJVcGRhdGVPbmUiLCJ1c2VyVXBkYXRlTWFueSIsInVzZXJSZW1vdmVCeUlkIiwidXNlclJlbW92ZU9uZSIsInVzZXJSZW1vdmVNYW55Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLE1BQU1BLFNBQVMsR0FBRztBQUNkQyxFQUFBQSxRQUFRLEVBQUVDLGFBQU9DLFdBQVAsQ0FBbUIsVUFBbkIsRUFBK0IsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBL0IsQ0FESTtBQUVkQyxFQUFBQSxTQUFTLEVBQUVMLGFBQU9DLFdBQVAsQ0FBbUIsV0FBbkIsRUFBZ0MsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBaEMsQ0FGRztBQUdkRSxFQUFBQSxPQUFPLEVBQUVOLGFBQU9DLFdBQVAsQ0FBbUIsU0FBbkIsRUFBOEIsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBOUIsQ0FISztBQUlkRyxFQUFBQSxRQUFRLEVBQUVQLGFBQU9DLFdBQVAsQ0FBbUIsVUFBbkIsRUFBK0IsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBL0I7QUFKSSxDQUFsQjs7QUFPQSxNQUFNSSxZQUFZLEdBQUc7QUFDakJDLEVBQUFBLGFBQWEsRUFBRVQsYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQURFO0FBRWpCTSxFQUFBQSxjQUFjLEVBQUVWLGFBQU9DLFdBQVAsQ0FBbUIsWUFBbkIsRUFBaUMsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBakMsQ0FGQztBQUdqQk8sRUFBQUEsY0FBYyxFQUFFWCxhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDLENBSEM7QUFJakJRLEVBQUFBLGFBQWEsRUFBRVosYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQUpFO0FBS2pCUyxFQUFBQSxjQUFjLEVBQUViLGFBQU9DLFdBQVAsQ0FBbUIsWUFBbkIsRUFBaUMsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBakMsQ0FMQztBQU1qQlUsRUFBQUEsY0FBYyxFQUFFZCxhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDLENBTkM7QUFPakJXLEVBQUFBLGFBQWEsRUFBRWYsYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQVBFO0FBUWpCWSxFQUFBQSxjQUFjLEVBQUVoQixhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDO0FBUkMsQ0FBckIiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXGdyYXBocWxcXHVzZXJcXCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7VXNlclRDfSBmcm9tIFwiLi4vLi4vbW9kZWxzL3VzZXJcIjtcclxuXHJcbmltcG9ydCB7YXV0aGVudGljYXRpb24sIGF1dGhvcml6YXRpb259IGZyb20gXCIuLi8uLi9taWRkbGV3YXJlc1wiO1xyXG4vLyBpbXBvcnQgUmVzb2x2ZXJzIGZyb20gXCIuL3VzZS1jYXNlc1wiO1xyXG4vL1xyXG4vLyBmb3IgKGNvbnN0IHJlc29sdmVyIGluIFJlc29sdmVycykge1xyXG4vLyAgICAgVXNlclRDLmFkZFJlc29sdmVyKFJlc29sdmVyc1tyZXNvbHZlcl0pO1xyXG4vLyB9XHJcblxyXG5jb25zdCBVc2VyUXVlcnkgPSB7XHJcbiAgICB1c2VyQnlJZDogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZEJ5SWRcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlckJ5SWRzOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJmaW5kQnlJZHNcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlck9uZTogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZE9uZVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyTWFueTogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZE1hbnlcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG59O1xyXG5cclxuY29uc3QgVXNlck11dGF0aW9uID0ge1xyXG4gICAgdXNlckNyZWF0ZU9uZTogVXNlclRDLmdldFJlc29sdmVyKFwiY3JlYXRlT25lXCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJDcmVhdGVNYW55OiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJjcmVhdGVNYW55XCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJVcGRhdGVCeUlkOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJ1cGRhdGVCeUlkXCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJVcGRhdGVPbmU6IFVzZXJUQy5nZXRSZXNvbHZlcihcInVwZGF0ZU9uZVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyVXBkYXRlTWFueTogVXNlclRDLmdldFJlc29sdmVyKFwidXBkYXRlTWFueVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyUmVtb3ZlQnlJZDogVXNlclRDLmdldFJlc29sdmVyKFwicmVtb3ZlQnlJZFwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyUmVtb3ZlT25lOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJyZW1vdmVPbmVcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlclJlbW92ZU1hbnk6IFVzZXJUQy5nZXRSZXNvbHZlcihcInJlbW92ZU1hbnlcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG59O1xyXG5cclxuZXhwb3J0IHtVc2VyUXVlcnksIFVzZXJNdXRhdGlvbn07XHJcbiJdfQ==","map":{"version":3,"sources":["index.js"],"names":["UserQuery","userById","UserTC","getResolver","authentication","isAuth","authorization","userByIds","userOne","userMany","UserMutation","userCreateOne","userCreateMany","userUpdateById","userUpdateOne","userUpdateMany","userRemoveById","userRemoveOne","userRemoveMany"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;AACA;AACA;AACA;AACA;AAEA,MAAMA,SAAS,GAAG;AACdC,EAAAA,QAAQ,EAAEC,aAAOC,WAAP,CAAmB,UAAnB,EAA+B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA/B,CADI;AAEdC,EAAAA,SAAS,EAAEL,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAFG;AAGdE,EAAAA,OAAO,EAAEN,aAAOC,WAAP,CAAmB,SAAnB,EAA8B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA9B,CAHK;AAIdG,EAAAA,QAAQ,EAAEP,aAAOC,WAAP,CAAmB,UAAnB,EAA+B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA/B;AAJI,CAAlB;;AAOA,MAAMI,YAAY,GAAG;AACjBC,EAAAA,aAAa,EAAET,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CADE;AAEjBM,EAAAA,cAAc,EAAEV,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CAFC;AAGjBO,EAAAA,cAAc,EAAEX,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CAHC;AAIjBQ,EAAAA,aAAa,EAAEZ,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAJE;AAKjBS,EAAAA,cAAc,EAAEb,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CALC;AAMjBU,EAAAA,cAAc,EAAEd,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CANC;AAOjBW,EAAAA,aAAa,EAAEf,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAPE;AAQjBY,EAAAA,cAAc,EAAEhB,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC;AARC,CAArB","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\user\\","sourcesContent":["import {UserTC} from \"../../models/user\";\r\n\r\nimport {authentication, authorization} from \"../../middlewares\";\r\n// import Resolvers from \"./use-cases\";\r\n//\r\n// for (const resolver in Resolvers) {\r\n//     UserTC.addResolver(Resolvers[resolver]);\r\n// }\r\n\r\nconst UserQuery = {\r\n    userById: UserTC.getResolver(\"findById\", [authentication.isAuth, authorization]),\r\n    userByIds: UserTC.getResolver(\"findByIds\", [authentication.isAuth, authorization]),\r\n    userOne: UserTC.getResolver(\"findOne\", [authentication.isAuth, authorization]),\r\n    userMany: UserTC.getResolver(\"findMany\", [authentication.isAuth, authorization]),\r\n};\r\n\r\nconst UserMutation = {\r\n    userCreateOne: UserTC.getResolver(\"createOne\", [authentication.isAuth, authorization]),\r\n    userCreateMany: UserTC.getResolver(\"createMany\", [authentication.isAuth, authorization]),\r\n    userUpdateById: UserTC.getResolver(\"updateById\", [authentication.isAuth, authorization]),\r\n    userUpdateOne: UserTC.getResolver(\"updateOne\", [authentication.isAuth, authorization]),\r\n    userUpdateMany: UserTC.getResolver(\"updateMany\", [authentication.isAuth, authorization]),\r\n    userRemoveById: UserTC.getResolver(\"removeById\", [authentication.isAuth, authorization]),\r\n    userRemoveOne: UserTC.getResolver(\"removeOne\", [authentication.isAuth, authorization]),\r\n    userRemoveMany: UserTC.getResolver(\"removeMany\", [authentication.isAuth, authorization]),\r\n};\r\n\r\nexport {UserQuery, UserMutation};\r\n"]}},"mtime":1648684433888},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\mongodb-config.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nvar _mongoose = _interopRequireDefault(require(\"mongoose\"));\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n_dotenv.default.config();\n\nmain().then(() => console.log(\"Mongoose connected\")).catch(err => console.log(err));\n\nasync function main() {\n  await _mongoose.default.connect(process.env.MONGODB_URI);\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vbmdvZGItY29uZmlnLmpzIl0sIm5hbWVzIjpbImRvdGVudiIsImNvbmZpZyIsIm1haW4iLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwibW9uZ29vc2UiLCJjb25uZWN0IiwicHJvY2VzcyIsImVudiIsIk1PTkdPREJfVVJJIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOzs7O0FBRUFBLGdCQUFPQyxNQUFQOztBQUVBQyxJQUFJLEdBQ0NDLElBREwsQ0FDVSxNQUFNQyxPQUFPLENBQUNDLEdBQVIsQ0FBWSxvQkFBWixDQURoQixFQUVLQyxLQUZMLENBRVdDLEdBQUcsSUFBSUgsT0FBTyxDQUFDQyxHQUFSLENBQVlFLEdBQVosQ0FGbEI7O0FBSUEsZUFBZUwsSUFBZixHQUFzQjtBQUNsQixRQUFNTSxrQkFBU0MsT0FBVCxDQUFpQkMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFdBQTdCLENBQU47QUFDSCIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcY29uZmlnXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XHJcbmltcG9ydCBkb3RlbnYgZnJvbSBcImRvdGVudlwiO1xyXG5cclxuZG90ZW52LmNvbmZpZygpO1xyXG5cclxubWFpbigpXHJcbiAgICAudGhlbigoKSA9PiBjb25zb2xlLmxvZyhcIk1vbmdvb3NlIGNvbm5lY3RlZFwiKSlcclxuICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBtYWluKCkge1xyXG4gICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdChwcm9jZXNzLmVudi5NT05HT0RCX1VSSSk7XHJcbn0iXX0=","map":{"version":3,"sources":["mongodb-config.js"],"names":["dotenv","config","main","then","console","log","catch","err","mongoose","connect","process","env","MONGODB_URI"],"mappings":";;AAAA;;AACA;;;;AAEAA,gBAAOC,MAAP;;AAEAC,IAAI,GACCC,IADL,CACU,MAAMC,OAAO,CAACC,GAAR,CAAY,oBAAZ,CADhB,EAEKC,KAFL,CAEWC,GAAG,IAAIH,OAAO,CAACC,GAAR,CAAYE,GAAZ,CAFlB;;AAIA,eAAeL,IAAf,GAAsB;AAClB,QAAMM,kBAASC,OAAT,CAAiBC,OAAO,CAACC,GAAR,CAAYC,WAA7B,CAAN;AACH","sourceRoot":"E:\\haleta-new-api\\src\\config\\","sourcesContent":["import mongoose from \"mongoose\";\r\nimport dotenv from \"dotenv\";\r\n\r\ndotenv.config();\r\n\r\nmain()\r\n    .then(() => console.log(\"Mongoose connected\"))\r\n    .catch(err => console.log(err));\r\n\r\nasync function main() {\r\n    await mongoose.connect(process.env.MONGODB_URI);\r\n}"]}},"mtime":1648684433884},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\use-cases\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\use-cases\\\\auth-use-cases.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _session = require(\"../../../models/session\");\n\nvar _authDataAccess = _interopRequireDefault(require(\"../data-access/auth-data-access\"));\n\nvar _redisConfig = _interopRequireDefault(require(\"../../../config/redis-config\"));\n\nvar _redisServices = _interopRequireDefault(require(\"../../redis/redis-services\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\n//load our .env file\nrequire('dotenv').config();\n\nconst moment = require(\"moment\");\n\nconst signIn = async ({\n  phoneNumber,\n  password\n}) => {\n  try {\n    const user = await _authDataAccess.default.signIn({\n      phoneNumber,\n      password\n    });\n    const userId = user._id; //check if session exists in mongodb \n\n    const session = await _authDataAccess.default.findSession(userId);\n    console.log(session);\n    let accessToken;\n\n    if (session) {\n      //session exists in mongodb'\n      console.log('sessison exists');\n      let updatedDate = session.expirationDate;\n      accessToken = session.jwtToken;\n      const updatedAt = moment(session.updatedAt);\n      const now = moment(new Date());\n      const duration = moment.duration(now.diff(updatedAt)).asHours();\n      console.log(duration);\n\n      if (duration >= 1) {\n        updatedDate = moment(session.expirationDate).add(1, 'days').toDate();\n      } // increase count and date of session\n\n\n      const newSession = await _authDataAccess.default.updateSession(session.userCount + 1, session, updatedDate);\n      console.log('new session', newSession);\n      await _redisServices.default.storeNewSession(accessToken, newSession); //     let dataInRedis;\n      //     await client.get(accessToken, async(err,sessionData) => {\n      //        if (sessionData) {\n      //            dataInRedis = sessionData\n      //            console.log(sessionData)\n      //        }\n      //        else if (err){\n      //            console.log('errrr')\n      //            console.log(err)\n      //        }\n      //    })\n      //    console.log('data in redis ', dataInRedis)\n    } else {\n      console.log(\"session does not exit\"); //session doesn't exist create a new one\n\n      accessToken = await _jsonwebtoken.default.sign(user.toJSON(), process.env.JWT_SECRET, {\n        expiresIn: process.env.JWT_EXPIRATION\n      });\n      const tomorrowDate = moment().clone().add(1, 'days').toDate(); // save session in mongodb\n\n      const newSession = await _authDataAccess.default.saveNewSession(userId, accessToken, tomorrowDate);\n      console.log(newSession);\n      await _redisServices.default.storeNewSession(accessToken, newSession); // // store session in redis\n      // redisService.storeNewSession(client,session)\n    }\n\n    return {\n      accessToken,\n      user\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst signUp = async ({\n  firstName,\n  middleName,\n  lastName,\n  password,\n  phoneNumber\n}) => {\n  try {\n    const user = await _authDataAccess.default.signUp({\n      firstName,\n      middleName,\n      lastName,\n      password,\n      phoneNumber\n    });\n    const userId = user._id; //check if there is an error\n\n    if (!user) {\n      return Promise.reject(new Error(\"user doesn't exist\"));\n    } //we only need firstName, fathersName, lastName, role\n    //define a new function to sign user information\n\n\n    const accessToken = jwtSign({\n      firstName: user.firstName,\n      lastName: user.lastName,\n      _id: user._id\n    }); // storeNewSession(token, user information(id), count, last update)\n\n    const tomorrowDate = moment().clone().add(process.env.JWT_EXPIRATION, 'days').toDate(); // save session in mongodb\n\n    const newSession = await _authDataAccess.default.saveNewSession(userId, accessToken, tomorrowDate);\n    console.log(\"In auth us case\", accessToken);\n    await _redisServices.default.storeNewSession(accessToken, newSession);\n    return {\n      accessToken,\n      user\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst logout = async ({\n  user,\n  accessToken\n}) => {\n  try {\n    await _authDataAccess.default.logout({\n      user,\n      accessToken\n    });\n    await _redisServices.default.updateSession(accessToken);\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst changePassword = async ({\n  newPassword,\n  user,\n  accessToken\n}) => {\n  try {\n    const {\n      updatedUser,\n      oldAccessTocken\n    } = await _authDataAccess.default.changePassword({\n      newPassword,\n      user,\n      accessToken\n    });\n    await _redisServices.default.deleteSessionCompletely(accessToken);\n    return {\n      updatedUser,\n      oldAccessTocken\n    };\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst jwtSign = user => {\n  return _jsonwebtoken.default.sign(JSON.parse(JSON.stringify(user)), // roles: user.roles,\n  process.env.JWT_SECRET);\n};\n\nvar _default = {\n  signIn,\n  signUp,\n  logout,\n  changePassword\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtdXNlLWNhc2VzLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJjb25maWciLCJtb21lbnQiLCJzaWduSW4iLCJwaG9uZU51bWJlciIsInBhc3N3b3JkIiwidXNlciIsImF1dGhSZXBvc2l0b3J5IiwidXNlcklkIiwiX2lkIiwic2Vzc2lvbiIsImZpbmRTZXNzaW9uIiwiY29uc29sZSIsImxvZyIsImFjY2Vzc1Rva2VuIiwidXBkYXRlZERhdGUiLCJleHBpcmF0aW9uRGF0ZSIsImp3dFRva2VuIiwidXBkYXRlZEF0Iiwibm93IiwiRGF0ZSIsImR1cmF0aW9uIiwiZGlmZiIsImFzSG91cnMiLCJhZGQiLCJ0b0RhdGUiLCJuZXdTZXNzaW9uIiwidXBkYXRlU2Vzc2lvbiIsInVzZXJDb3VudCIsInJlZGlzU2VydmljZSIsInN0b3JlTmV3U2Vzc2lvbiIsImp3dCIsInNpZ24iLCJ0b0pTT04iLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsIkpXVF9FWFBJUkFUSU9OIiwidG9tb3Jyb3dEYXRlIiwiY2xvbmUiLCJzYXZlTmV3U2Vzc2lvbiIsImVycm9yIiwiUHJvbWlzZSIsInJlamVjdCIsInNpZ25VcCIsImZpcnN0TmFtZSIsIm1pZGRsZU5hbWUiLCJsYXN0TmFtZSIsIkVycm9yIiwiand0U2lnbiIsImxvZ291dCIsImNoYW5nZVBhc3N3b3JkIiwibmV3UGFzc3dvcmQiLCJ1cGRhdGVkVXNlciIsIm9sZEFjY2Vzc1RvY2tlbiIsImRlbGV0ZVNlc3Npb25Db21wbGV0ZWx5IiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7Ozs7QUFIQTtBQUlBO0FBQ0FBLE9BQU8sQ0FBQyxRQUFELENBQVAsQ0FBa0JDLE1BQWxCOztBQUVBLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDLFFBQUQsQ0FBdEI7O0FBRUEsTUFBTUcsTUFBTSxHQUFH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QTtBQUFkLEtBQVA7QUFDSCxHQUpELENBSUUsT0FBT2IsS0FBUCxFQUFjO0FBQ1osV0FBT0MsT0FBTyxDQUFDQyxNQUFSLENBQWVGLEtBQWYsQ0FBUDtBQUNIO0FBQ0osQ0FSRDs7QUFVQSxNQUFNUSxPQUFPLEdBQUk1QyxJQUFELElBQVE7QUFDcEIsU0FBT3lCLHNCQUFJQyxJQUFKLENBQ0h5QixJQUFJLENBQUNDLEtBQUwsQ0FBV0QsSUFBSSxDQUFDRSxTQUFMLENBQWVyRCxJQUFmLENBQVgsQ0FERyxFQUVIO0FBQ0E0QixFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsVUFIVCxDQUFQO0FBSUgsQ0FMRDs7ZUFPZTtBQUNYakMsRUFBQUEsTUFEVztBQUVYMEMsRUFBQUEsTUFGVztBQUdYTSxFQUFBQSxNQUhXO0FBSVhDLEVBQUFBO0FBSlcsQyIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcc2VydmljZXNcXGF1dGhcXHVzZS1jYXNlc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XHJcbmltcG9ydCB7VXNlck1vZGVsfSBmcm9tIFwiLi4vLi4vLi4vbW9kZWxzL3VzZXJcIjtcclxuaW1wb3J0IHtTZXNzaW9uTW9kZWx9IGZyb20gXCIuLi8uLi8uLi9tb2RlbHMvc2Vzc2lvblwiO1xyXG4vLyBpbXBvcnQgY3J5cHRvIGZyb20gXCJjcnlwdG9cIjtcclxuaW1wb3J0IGF1dGhSZXBvc2l0b3J5IGZyb20gXCIuLi9kYXRhLWFjY2Vzcy9hdXRoLWRhdGEtYWNjZXNzXCI7XHJcbmltcG9ydCBjbGllbnQgZnJvbSBcIi4uLy4uLy4uL2NvbmZpZy9yZWRpcy1jb25maWdcIjtcclxuaW1wb3J0IHJlZGlzU2VydmljZSBmcm9tIFwiLi4vLi4vcmVkaXMvcmVkaXMtc2VydmljZXNcIlxyXG4vL2xvYWQgb3VyIC5lbnYgZmlsZVxyXG5yZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKVxyXG5cclxuY29uc3QgbW9tZW50ID0gcmVxdWlyZShcIm1vbWVudFwiKVxyXG5cclxuY29uc3Qgc2lnbkluID0gYXN5bmMgKHtwaG9uZU51bWJlciwgcGFzc3dvcmR9KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5zaWduSW4oe3Bob25lTnVtYmVyLCBwYXNzd29yZH0pO1xyXG4gICAgICAgIGNvbnN0IHVzZXJJZCA9IHVzZXIuX2lkXHJcbiAgICAgICAgLy9jaGVjayBpZiBzZXNzaW9uIGV4aXN0cyBpbiBtb25nb2RiIFxyXG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5maW5kU2Vzc2lvbih1c2VySWQpXHJcbiAgICAgICAgY29uc29sZS5sb2coc2Vzc2lvbilcclxuICAgICAgICBsZXQgYWNjZXNzVG9rZW47XHJcblxyXG4gICAgICAgIGlmIChzZXNzaW9uKSB7XHJcbiAgICAgICAgICAgIC8vc2Vzc2lvbiBleGlzdHMgaW4gbW9uZ29kYidcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Nlc3Npc29uIGV4aXN0cycpXHJcbiAgICAgICAgICAgIGxldCB1cGRhdGVkRGF0ZSA9IHNlc3Npb24uZXhwaXJhdGlvbkRhdGU7XHJcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gc2Vzc2lvbi5qd3RUb2tlblxyXG5cclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEF0ID0gbW9tZW50KHNlc3Npb24udXBkYXRlZEF0KVxyXG4gICAgICAgICAgICBjb25zdCBub3cgPSBtb21lbnQobmV3IERhdGUoKSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IChtb21lbnQuZHVyYXRpb24obm93LmRpZmYodXBkYXRlZEF0KSkpLmFzSG91cnMoKVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkdXJhdGlvbilcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChkdXJhdGlvbiA+PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVkRGF0ZSA9IChtb21lbnQoc2Vzc2lvbi5leHBpcmF0aW9uRGF0ZSkuYWRkKDEsJ2RheXMnKSkudG9EYXRlKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBpbmNyZWFzZSBjb3VudCBhbmQgZGF0ZSBvZiBzZXNzaW9uXHJcbiAgICAgICAgICAgIGNvbnN0IG5ld1Nlc3Npb24gPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS51cGRhdGVTZXNzaW9uKHNlc3Npb24udXNlckNvdW50KzEsc2Vzc2lvbix1cGRhdGVkRGF0ZSlcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ25ldyBzZXNzaW9uJywgbmV3U2Vzc2lvbilcclxuICAgICAgICAgICAgYXdhaXQgcmVkaXNTZXJ2aWNlLnN0b3JlTmV3U2Vzc2lvbihhY2Nlc3NUb2tlbixuZXdTZXNzaW9uKVxyXG4gICAgICAgIC8vICAgICBsZXQgZGF0YUluUmVkaXM7XHJcbiAgICAgICAgLy8gICAgIGF3YWl0IGNsaWVudC5nZXQoYWNjZXNzVG9rZW4sIGFzeW5jKGVycixzZXNzaW9uRGF0YSkgPT4ge1xyXG4gICAgICAgIC8vICAgICAgICBpZiAoc2Vzc2lvbkRhdGEpIHtcclxuICAgICAgICAvLyAgICAgICAgICAgIGRhdGFJblJlZGlzID0gc2Vzc2lvbkRhdGFcclxuICAgICAgICAvLyAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlc3Npb25EYXRhKVxyXG4gICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgICAgIGVsc2UgaWYgKGVycil7XHJcbiAgICAgICAgLy8gICAgICAgICAgICBjb25zb2xlLmxvZygnZXJycnInKVxyXG4gICAgICAgIC8vICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxyXG4gICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAgLy8gICAgfSlcclxuICAgICAgICAvLyAgICBjb25zb2xlLmxvZygnZGF0YSBpbiByZWRpcyAnLCBkYXRhSW5SZWRpcylcclxuICAgICAgICB9XHJcbiBcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzZXNzaW9uIGRvZXMgbm90IGV4aXRcIilcclxuICAgICAgICAgICAgLy9zZXNzaW9uIGRvZXNuJ3QgZXhpc3QgY3JlYXRlIGEgbmV3IG9uZVxyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IGF3YWl0IGp3dC5zaWduKHVzZXIudG9KU09OKCksIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQsIHtcclxuICAgICAgICAgICAgICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSQVRJT04sXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgICAgICAgY29uc3QgdG9tb3Jyb3dEYXRlID0gKG1vbWVudCgpLmNsb25lKCkuYWRkKDEsJ2RheXMnKSkudG9EYXRlKClcclxuICAgICAgICAgICAgLy8gc2F2ZSBzZXNzaW9uIGluIG1vbmdvZGJcclxuICAgICAgICAgICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IGF1dGhSZXBvc2l0b3J5LnNhdmVOZXdTZXNzaW9uKHVzZXJJZCxhY2Nlc3NUb2tlbix0b21vcnJvd0RhdGUpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG5ld1Nlc3Npb24pXHJcbiAgICAgICAgICAgIGF3YWl0IHJlZGlzU2VydmljZS5zdG9yZU5ld1Nlc3Npb24oYWNjZXNzVG9rZW4sbmV3U2Vzc2lvbilcclxuICAgICAgICAgICAgLy8gLy8gc3RvcmUgc2Vzc2lvbiBpbiByZWRpc1xyXG4gICAgICAgICAgICAvLyByZWRpc1NlcnZpY2Uuc3RvcmVOZXdTZXNzaW9uKGNsaWVudCxzZXNzaW9uKVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgdXNlcixcclxuICAgICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBzaWduVXAgPSBhc3luYyAoe2ZpcnN0TmFtZSxtaWRkbGVOYW1lLGxhc3ROYW1lLHBhc3N3b3JkLHBob25lTnVtYmVyfSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgYXV0aFJlcG9zaXRvcnkuc2lnblVwKHtmaXJzdE5hbWUsbWlkZGxlTmFtZSxsYXN0TmFtZSxwYXNzd29yZCxwaG9uZU51bWJlcn0pXHJcbiAgICAgICAgY29uc3QgdXNlcklkID0gdXNlci5faWRcclxuICAgICAgICAvL2NoZWNrIGlmIHRoZXJlIGlzIGFuIGVycm9yXHJcbiAgICAgICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJ1c2VyIGRvZXNuJ3QgZXhpc3RcIikpO1xyXG4gICAgICAgIH1cclxuICAgIC8vd2Ugb25seSBuZWVkIGZpcnN0TmFtZSwgZmF0aGVyc05hbWUsIGxhc3ROYW1lLCByb2xlXHJcbiAgICAgICAgICAgIC8vZGVmaW5lIGEgbmV3IGZ1bmN0aW9uIHRvIHNpZ24gdXNlciBpbmZvcm1hdGlvblxyXG5cclxuICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBqd3RTaWduKHtmaXJzdE5hbWU6dXNlci5maXJzdE5hbWUsIGxhc3ROYW1lOnVzZXIubGFzdE5hbWUsIF9pZDp1c2VyLl9pZH0pO1xyXG4gICAgICAgIC8vIHN0b3JlTmV3U2Vzc2lvbih0b2tlbiwgdXNlciBpbmZvcm1hdGlvbihpZCksIGNvdW50LCBsYXN0IHVwZGF0ZSlcclxuICAgICAgICBjb25zdCB0b21vcnJvd0RhdGUgPSAobW9tZW50KCkuY2xvbmUoKS5hZGQocHJvY2Vzcy5lbnYuSldUX0VYUElSQVRJT04sJ2RheXMnKSkudG9EYXRlKClcclxuICAgICAgICAvLyBzYXZlIHNlc3Npb24gaW4gbW9uZ29kYlxyXG4gICAgICAgIGNvbnN0IG5ld1Nlc3Npb24gPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5zYXZlTmV3U2Vzc2lvbih1c2VySWQsYWNjZXNzVG9rZW4sdG9tb3Jyb3dEYXRlKVxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiSW4gYXV0aCB1cyBjYXNlXCIsYWNjZXNzVG9rZW4pXHJcbiAgICAgICAgYXdhaXQgcmVkaXNTZXJ2aWNlLnN0b3JlTmV3U2Vzc2lvbihhY2Nlc3NUb2tlbixuZXdTZXNzaW9uKVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuLFxyXG4gICAgICAgICAgICB1c2VyLFxyXG4gICAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmNvbnN0IGxvZ291dCA9IGFzeW5jICh7dXNlciwgYWNjZXNzVG9rZW59KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IGF1dGhSZXBvc2l0b3J5LmxvZ291dCh7dXNlciwgYWNjZXNzVG9rZW59KVxyXG4gICAgICAgIGF3YWl0IHJlZGlzU2VydmljZS51cGRhdGVTZXNzaW9uKGFjY2Vzc1Rva2VuKVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBjaGFuZ2VQYXNzd29yZCA9IGFzeW5jICh7bmV3UGFzc3dvcmQsIHVzZXIsIGFjY2Vzc1Rva2VufSkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7dXBkYXRlZFVzZXIsIG9sZEFjY2Vzc1RvY2tlbn0gPSBhd2FpdCBhdXRoUmVwb3NpdG9yeS5jaGFuZ2VQYXNzd29yZCh7bmV3UGFzc3dvcmQsIHVzZXIsIGFjY2Vzc1Rva2VufSlcclxuICAgICAgICBhd2FpdCByZWRpc1NlcnZpY2UuZGVsZXRlU2Vzc2lvbkNvbXBsZXRlbHkoYWNjZXNzVG9rZW4pXHJcbiAgICAgICAgcmV0dXJuIHt1cGRhdGVkVXNlciwgb2xkQWNjZXNzVG9ja2VufTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcclxuICAgIH1cclxufVxyXG5cclxuY29uc3Qgand0U2lnbiA9ICh1c2VyKT0+e1xyXG4gICAgcmV0dXJuIGp3dC5zaWduKFxyXG4gICAgICAgIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodXNlcikpLFxyXG4gICAgICAgIC8vIHJvbGVzOiB1c2VyLnJvbGVzLFxyXG4gICAgICAgIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBzaWduSW4sXHJcbiAgICBzaWduVXAsXHJcbiAgICBsb2dvdXQsXHJcbiAgICBjaGFuZ2VQYXNzd29yZCxcclxufSJdfQ==","map":{"version":3,"sources":["auth-use-cases.js"],"names":["require","config","moment","signIn","phoneNumber","password","user","authRepository","userId","_id","session","findSession","console","log","accessToken","updatedDate","expirationDate","jwtToken","updatedAt","now","Date","duration","diff","asHours","add","toDate","newSession","updateSession","userCount","redisService","storeNewSession","jwt","sign","toJSON","process","env","JWT_SECRET","expiresIn","JWT_EXPIRATION","tomorrowDate","clone","saveNewSession","error","Promise","reject","signUp","firstName","middleName","lastName","Error","jwtSign","logout","changePassword","newPassword","updatedUser","oldAccessTocken","deleteSessionCompletely","JSON","parse","stringify"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\services\\auth\\use-cases\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport {UserModel} from \"../../../models/user\";\r\nimport {SessionModel} from \"../../../models/session\";\r\n// import crypto from \"crypto\";\r\nimport authRepository from \"../data-access/auth-data-access\";\r\nimport client from \"../../../config/redis-config\";\r\nimport redisService from \"../../redis/redis-services\"\r\n//load our .env file\r\nrequire('dotenv').config()\r\n\r\nconst moment = require(\"moment\")\r\n\r\nconst signIn = async ({phoneNumber, password}) => {\r\n    try {\r\n        const user = await authRepository.signIn({phoneNumber, password});\r\n        const userId = user._id\r\n        //check if session exists in mongodb \r\n        const session = await authRepository.findSession(userId)\r\n        console.log(session)\r\n        let accessToken;\r\n\r\n        if (session) {\r\n            //session exists in mongodb'\r\n            console.log('sessison exists')\r\n            let updatedDate = session.expirationDate;\r\n            accessToken = session.jwtToken\r\n\r\n            const updatedAt = moment(session.updatedAt)\r\n            const now = moment(new Date());\r\n            \r\n            const duration = (moment.duration(now.diff(updatedAt))).asHours()\r\n            console.log(duration)\r\n            \r\n            if (duration >= 1) {\r\n                updatedDate = (moment(session.expirationDate).add(1,'days')).toDate()\r\n            }\r\n            // increase count and date of session\r\n            const newSession = await authRepository.updateSession(session.userCount+1,session,updatedDate)\r\n            console.log('new session', newSession)\r\n            await redisService.storeNewSession(accessToken,newSession)\r\n        //     let dataInRedis;\r\n        //     await client.get(accessToken, async(err,sessionData) => {\r\n        //        if (sessionData) {\r\n        //            dataInRedis = sessionData\r\n        //            console.log(sessionData)\r\n        //        }\r\n        //        else if (err){\r\n        //            console.log('errrr')\r\n        //            console.log(err)\r\n        //        }\r\n        //    })\r\n        //    console.log('data in redis ', dataInRedis)\r\n        }\r\n \r\n        else {\r\n            console.log(\"session does not exit\")\r\n            //session doesn't exist create a new one\r\n            accessToken = await jwt.sign(user.toJSON(), process.env.JWT_SECRET, {\r\n                expiresIn: process.env.JWT_EXPIRATION,\r\n            });\r\n      \r\n            const tomorrowDate = (moment().clone().add(1,'days')).toDate()\r\n            // save session in mongodb\r\n            const newSession = await authRepository.saveNewSession(userId,accessToken,tomorrowDate)\r\n            console.log(newSession)\r\n            await redisService.storeNewSession(accessToken,newSession)\r\n            // // store session in redis\r\n            // redisService.storeNewSession(client,session)\r\n        }\r\n        \r\n        return {\r\n            accessToken,\r\n            user,\r\n        };\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst signUp = async ({firstName,middleName,lastName,password,phoneNumber}) => {\r\n    try {\r\n        const user = await authRepository.signUp({firstName,middleName,lastName,password,phoneNumber})\r\n        const userId = user._id\r\n        //check if there is an error\r\n        if (!user) {\r\n            return Promise.reject(new Error(\"user doesn't exist\"));\r\n        }\r\n    //we only need firstName, fathersName, lastName, role\r\n            //define a new function to sign user information\r\n\r\n            const accessToken = jwtSign({firstName:user.firstName, lastName:user.lastName, _id:user._id});\r\n        // storeNewSession(token, user information(id), count, last update)\r\n        const tomorrowDate = (moment().clone().add(process.env.JWT_EXPIRATION,'days')).toDate()\r\n        // save session in mongodb\r\n        const newSession = await authRepository.saveNewSession(userId,accessToken,tomorrowDate)\r\n        console.log(\"In auth us case\",accessToken)\r\n        await redisService.storeNewSession(accessToken,newSession)\r\n        return {\r\n            accessToken,\r\n            user,\r\n        };\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst logout = async ({user, accessToken}) => {\r\n    try {\r\n        await authRepository.logout({user, accessToken})\r\n        await redisService.updateSession(accessToken)\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst changePassword = async ({newPassword, user, accessToken}) => {\r\n    try {\r\n        const {updatedUser, oldAccessTocken} = await authRepository.changePassword({newPassword, user, accessToken})\r\n        await redisService.deleteSessionCompletely(accessToken)\r\n        return {updatedUser, oldAccessTocken};\r\n    } catch (error) {\r\n        return Promise.reject(error);\r\n    }\r\n}\r\n\r\nconst jwtSign = (user)=>{\r\n    return jwt.sign(\r\n        JSON.parse(JSON.stringify(user)),\r\n        // roles: user.roles,\r\n        process.env.JWT_SECRET);\r\n}\r\n\r\nexport default {\r\n    signIn,\r\n    signUp,\r\n    logout,\r\n    changePassword,\r\n}"]}},"mtime":1648792585823},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\models\\\\session.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SessionTC = exports.SessionSchema = exports.SessionModel = void 0;\n\nvar _mongoose = _interopRequireWildcard(require(\"mongoose\"));\n\nvar _mongooseTimestamp = _interopRequireDefault(require(\"mongoose-timestamp\"));\n\nvar _graphqlComposeMongoose = require(\"graphql-compose-mongoose\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\n\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nconst SessionSchema = new _mongoose.Schema({\n  userId: {\n    type: _mongoose.Schema.Types.ObjectId,\n    ref: \"User\"\n  },\n  jwtToken: String,\n  expirationDate: Date,\n  userCount: Number\n}, {\n  collection: \"sessions\"\n});\nexports.SessionSchema = SessionSchema;\nSessionSchema.plugin(_mongooseTimestamp.default);\nSessionSchema.index({\n  createdAt: 1,\n  updatedAt: 1\n});\n\nconst SessionModel = _mongoose.default.model(\"Session\", SessionSchema);\n\nexports.SessionModel = SessionModel;\nconst SessionTC = (0, _graphqlComposeMongoose.composeWithMongoose)(SessionModel);\nexports.SessionTC = SessionTC;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlc3Npb24uanMiXSwibmFtZXMiOlsiU2Vzc2lvblNjaGVtYSIsIlNjaGVtYSIsInVzZXJJZCIsInR5cGUiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwiand0VG9rZW4iLCJTdHJpbmciLCJleHBpcmF0aW9uRGF0ZSIsIkRhdGUiLCJ1c2VyQ291bnQiLCJOdW1iZXIiLCJjb2xsZWN0aW9uIiwicGx1Z2luIiwidGltZXN0YW1wcyIsImluZGV4IiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwiU2Vzc2lvbk1vZGVsIiwibW9uZ29vc2UiLCJtb2RlbCIsIlNlc3Npb25UQyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLE1BQU1BLGFBQWEsR0FBRyxJQUFJQyxnQkFBSixDQUFXO0FBQzdCQyxFQUFBQSxNQUFNLEVBQUU7QUFDSkMsSUFBQUEsSUFBSSxFQUFFRixpQkFBT0csS0FBUCxDQUFhQyxRQURmO0FBRUpDLElBQUFBLEdBQUcsRUFBRTtBQUZELEdBRHFCO0FBSzdCQyxFQUFBQSxRQUFRLEVBQUVDLE1BTG1CO0FBTTdCQyxFQUFBQSxjQUFjLEVBQUVDLElBTmE7QUFPN0JDLEVBQUFBLFNBQVMsRUFBRUM7QUFQa0IsQ0FBWCxFQVFuQjtBQUNDQyxFQUFBQSxVQUFVLEVBQUU7QUFEYixDQVJtQixDQUF0Qjs7QUFZQWIsYUFBYSxDQUFDYyxNQUFkLENBQXFCQywwQkFBckI7QUFDQWYsYUFBYSxDQUFDZ0IsS0FBZCxDQUFvQjtBQUNoQkMsRUFBQUEsU0FBUyxFQUFFLENBREs7QUFFaEJDLEVBQUFBLFNBQVMsRUFBRTtBQUZLLENBQXBCOztBQUtBLE1BQU1DLFlBQVksR0FBR0Msa0JBQVNDLEtBQVQsQ0FBZSxTQUFmLEVBQTBCckIsYUFBMUIsQ0FBckI7OztBQUNBLE1BQU1zQixTQUFTLEdBQUcsaURBQW9CSCxZQUFwQixDQUFsQiIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcbW9kZWxzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UsIHtTY2hlbWF9IGZyb20gXCJtb25nb29zZVwiO1xyXG5pbXBvcnQgdGltZXN0YW1wcyBmcm9tIFwibW9uZ29vc2UtdGltZXN0YW1wXCI7XHJcbmltcG9ydCB7Y29tcG9zZVdpdGhNb25nb29zZX0gZnJvbSBcImdyYXBocWwtY29tcG9zZS1tb25nb29zZVwiO1xyXG5cclxuY29uc3QgU2Vzc2lvblNjaGVtYSA9IG5ldyBTY2hlbWEoe1xyXG4gICAgdXNlcklkOiB7XHJcbiAgICAgICAgdHlwZTogU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgIHJlZjogXCJVc2VyXCIsXHJcbiAgICB9LFxyXG4gICAgand0VG9rZW46IFN0cmluZyxcclxuICAgIGV4cGlyYXRpb25EYXRlOiBEYXRlLFxyXG4gICAgdXNlckNvdW50OiBOdW1iZXIsXHJcbn0sIHtcclxuICAgIGNvbGxlY3Rpb246IFwic2Vzc2lvbnNcIixcclxufSk7XHJcblxyXG5TZXNzaW9uU2NoZW1hLnBsdWdpbih0aW1lc3RhbXBzKTtcclxuU2Vzc2lvblNjaGVtYS5pbmRleCh7XHJcbiAgICBjcmVhdGVkQXQ6IDEsXHJcbiAgICB1cGRhdGVkQXQ6IDEsXHJcbn0pO1xyXG5cclxuY29uc3QgU2Vzc2lvbk1vZGVsID0gbW9uZ29vc2UubW9kZWwoXCJTZXNzaW9uXCIsIFNlc3Npb25TY2hlbWEpO1xyXG5jb25zdCBTZXNzaW9uVEMgPSBjb21wb3NlV2l0aE1vbmdvb3NlKFNlc3Npb25Nb2RlbCk7XHJcblxyXG5leHBvcnQge1Nlc3Npb25Nb2RlbCwgU2Vzc2lvblRDLCBTZXNzaW9uU2NoZW1hfTtcclxuIl19","map":{"version":3,"sources":["session.js"],"names":["SessionSchema","Schema","userId","type","Types","ObjectId","ref","jwtToken","String","expirationDate","Date","userCount","Number","collection","plugin","timestamps","index","createdAt","updatedAt","SessionModel","mongoose","model","SessionTC"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,aAAa,GAAG,IAAIC,gBAAJ,CAAW;AAC7BC,EAAAA,MAAM,EAAE;AACJC,IAAAA,IAAI,EAAEF,iBAAOG,KAAP,CAAaC,QADf;AAEJC,IAAAA,GAAG,EAAE;AAFD,GADqB;AAK7BC,EAAAA,QAAQ,EAAEC,MALmB;AAM7BC,EAAAA,cAAc,EAAEC,IANa;AAO7BC,EAAAA,SAAS,EAAEC;AAPkB,CAAX,EAQnB;AACCC,EAAAA,UAAU,EAAE;AADb,CARmB,CAAtB;;AAYAb,aAAa,CAACc,MAAd,CAAqBC,0BAArB;AACAf,aAAa,CAACgB,KAAd,CAAoB;AAChBC,EAAAA,SAAS,EAAE,CADK;AAEhBC,EAAAA,SAAS,EAAE;AAFK,CAApB;;AAKA,MAAMC,YAAY,GAAGC,kBAASC,KAAT,CAAe,SAAf,EAA0BrB,aAA1B,CAArB;;;AACA,MAAMsB,SAAS,GAAG,iDAAoBH,YAApB,CAAlB","sourceRoot":"E:\\haleta-new-api\\src\\models\\","sourcesContent":["import mongoose, {Schema} from \"mongoose\";\r\nimport timestamps from \"mongoose-timestamp\";\r\nimport {composeWithMongoose} from \"graphql-compose-mongoose\";\r\n\r\nconst SessionSchema = new Schema({\r\n    userId: {\r\n        type: Schema.Types.ObjectId,\r\n        ref: \"User\",\r\n    },\r\n    jwtToken: String,\r\n    expirationDate: Date,\r\n    userCount: Number,\r\n}, {\r\n    collection: \"sessions\",\r\n});\r\n\r\nSessionSchema.plugin(timestamps);\r\nSessionSchema.index({\r\n    createdAt: 1,\r\n    updatedAt: 1,\r\n});\r\n\r\nconst SessionModel = mongoose.model(\"Session\", SessionSchema);\r\nconst SessionTC = composeWithMongoose(SessionModel);\r\n\r\nexport {SessionModel, SessionTC, SessionSchema};\r\n"]}},"mtime":1648685190383},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\data-access\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\auth\\\\data-access\\\\auth-data-access.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _user = require(\"../../../models/user\");\n\nvar _session = require(\"../../../models/session\");\n\nvar _bcrypt = _interopRequireDefault(require(\"bcrypt\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import crypto from \"crypto\";\nconst signIn = async ({\n  phoneNumber,\n  password\n}) => {\n  try {\n    const user = await _user.UserModel.findOne({\n      phoneNumber\n    }); // const comparePassword = await user.comparePassword(password.toString());\n\n    const comparePassword = password.toString() === user.password;\n\n    if (!comparePassword) {\n      return Promise.reject(new Error(\"Password is incorrect.\"));\n    }\n\n    return user;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst saveNewSession = async (userId, jwtToken, tomorrowDate) => {\n  try {\n    const newSession = await new _session.SessionModel({\n      userId: userId,\n      jwtToken: jwtToken,\n      expirationDate: tomorrowDate,\n      userCount: 1\n    }).save();\n    return newSession;\n  } catch (error) {\n    console.log('error in saving new session');\n    console.log(error);\n    return Promise.reject(error);\n  }\n};\n\nconst findSession = async key => {\n  try {\n    const session = await _session.SessionModel.findOne({\n      key\n    });\n    return session;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst updateSession = async (count, session, updatedDate) => {\n  try {\n    session.userCount = count;\n    session.expirationDate = updatedDate;\n    const newSession = await session.save();\n    return newSession;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst deleteSession = async session => {\n  try {\n    console.log('remove');\n    await session.remove();\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst signUp = async ({\n  firstName,\n  middleName,\n  lastName,\n  phoneNumber,\n  password\n}) => {\n  try {\n    let user = await _user.UserModel.phoneNumberExist(phoneNumber);\n\n    if (user) {\n      console.log(\"here 2\");\n      return Promise.reject(new Error(\"Phone Number has already been taken.\"));\n    } // user = await UserModel.emailExist(email);\n    // if (user) {\n    //   return Promise.reject(new Error(\"Email has already been taken.\"));\n    // }\n\n\n    const salt = _bcrypt.default.genSalt(10);\n\n    const hash = _bcrypt.default.hashSync(password, salt);\n\n    user = await new _user.UserModel({\n      firstName,\n      middleName,\n      lastName,\n      phoneNumber,\n      hash\n    }).save();\n    return user;\n  } catch (error) {\n    return Promise.reject(error);\n  }\n};\n\nconst logout = async ({\n  user,\n  accessToken\n}) => {\n  try {\n    const userId = user._id;\n    const session = await findSession(userId);\n    const count = session.userCount;\n\n    if (count > 1) {\n      count -= 1;\n      updateSession(count, session, session.expirationDate);\n    } //delete session\n    else if (count === 1) {\n      deleteSession(session);\n    }\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nconst changePassword = async ({\n  newPassword,\n  user,\n  accessToken\n}) => {\n  try {\n    console.log(\"sim user: \", user);\n    console.log(\"new password: \", newPassword);\n    console.log(\"pass: \", user.password);\n    const userphone = user.phoneNumber;\n    const userWith = await _user.UserModel.findOne({\n      userphone\n    });\n    const userId = userWith._id;\n    const session = await findSession(userId);\n    userWith.password = newPassword;\n    const updatedUser = await userWith.save(function (err) {\n      if (err) return handleErr(err); //user has been updated\n\n      console.log(\"success\");\n    });\n    const oldAccessTocken = accessToken; //delete session\n\n    await deleteSession(session);\n    return {\n      updatedUser,\n      oldAccessTocken\n    };\n  } catch (error) {\n    console.log(error);\n  }\n};\n\nvar _default = {\n  signIn,\n  signUp,\n  saveNewSession,\n  findSession,\n  updateSession,\n  logout,\n  changePassword,\n  deleteSession\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgtZGF0YS1hY2Nlc3MuanMiXSwibmFtZXMiOlsic2lnbkluIiwicGhvbmVOdW1iZXIiLCJwYXNzd29yZCIsInVzZXIiLCJVc2VyTW9kZWwiLCJmaW5kT25lIiwiY29tcGFyZVBhc3N3b3JkIiwidG9TdHJpbmciLCJQcm9taXNlIiwicmVqZWN0IiwiRXJyb3IiLCJlcnJvciIsInNhdmVOZXdTZXNzaW9uIiwidXNlcklkIiwiand0VG9rZW4iLCJ0b21vcnJvd0RhdGUiLCJuZXdTZXNzaW9uIiwiU2Vzc2lvbk1vZGVsIiwiZXhwaXJhdGlvbkRhdGUiLCJ1c2VyQ291bnQiLCJzYXZlIiwiY29uc29sZSIsImxvZyIsImZpbmRTZXNzaW9uIiwia2V5Iiwic2Vzc2lvbiIsInVwZGF0ZVNlc3Npb24iLCJjb3VudCIsInVwZGF0ZWREYXRlIiwiZGVsZXRlU2Vzc2lvbiIsInJlbW92ZSIsInNpZ25VcCIsImZpcnN0TmFtZSIsIm1pZGRsZU5hbWUiLCJsYXN0TmFtZSIsInBob25lTnVtYmVyRXhpc3QiLCJzYWx0IiwiYmNyeXB0IiwiZ2VuU2FsdCIsImhhc2giLCJoYXNoU3luYyIsImxvZ291dCIsImFjY2Vzc1Rva2VuIiwiX2lkIiwiY2hhbmdlUGFzc3dvcmQiLCJuZXdQYXNzd29yZCIsInVzZXJwaG9uZSIsInVzZXJXaXRoIiwidXBkYXRlZFVzZXIiLCJlcnIiLCJoYW5kbGVFcnIiLCJvbGRBY2Nlc3NUb2NrZW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBO0FBRUEsTUFBTUEsTUFBTSxHQUFHLE9BQU87QUFBRUMsRUFBQUEsV0FBRjtBQUFlQyxFQUFBQTtBQUFmLENBQVAsS0FBcUM7QUFDbEQsTUFBSTtBQUNGLFVBQU1DLElBQUksR0FBRyxNQUFNQyxnQkFBVUMsT0FBVixDQUFrQjtBQUFFSixNQUFBQTtBQUFGLEtBQWxCLENBQW5CLENBREUsQ0FHRjs7QUFDQSxVQUFNSyxlQUFlLEdBQUlKLFFBQVEsQ0FBQ0ss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R0FBUixDQUFZWCxLQUFaO0FBQ0Q7QUFDRixDQXZCRDs7ZUF5QmU7QUFDYlgsRUFBQUEsTUFEYTtBQUViK0IsRUFBQUEsTUFGYTtBQUdibkIsRUFBQUEsY0FIYTtBQUliVyxFQUFBQSxXQUphO0FBS2JHLEVBQUFBLGFBTGE7QUFNYmUsRUFBQUEsTUFOYTtBQU9iRyxFQUFBQSxjQVBhO0FBUWJmLEVBQUFBO0FBUmEsQyIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcc2VydmljZXNcXGF1dGhcXGRhdGEtYWNjZXNzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcclxuaW1wb3J0IHsgVXNlck1vZGVsIH0gZnJvbSBcIi4uLy4uLy4uL21vZGVscy91c2VyXCI7XHJcbmltcG9ydCB7U2Vzc2lvbk1vZGVsfSBmcm9tIFwiLi4vLi4vLi4vbW9kZWxzL3Nlc3Npb25cIjtcclxuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHQnO1xyXG5cclxuLy8gaW1wb3J0IGNyeXB0byBmcm9tIFwiY3J5cHRvXCI7XHJcblxyXG5jb25zdCBzaWduSW4gPSBhc3luYyAoeyBwaG9uZU51bWJlciwgcGFzc3dvcmQgfSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlck1vZGVsLmZpbmRPbmUoeyBwaG9uZU51bWJlciB9KTtcclxuXHJcbiAgICAvLyBjb25zdCBjb21wYXJlUGFzc3dvcmQgPSBhd2FpdCB1c2VyLmNvbXBhcmVQYXNzd29yZChwYXNzd29yZC50b1N0cmluZygpKTtcclxuICAgIGNvbnN0IGNvbXBhcmVQYXNzd29yZCA9IChwYXNzd29yZC50b1N0cmluZygpID09PSB1c2VyLnBhc3N3b3JkKVxyXG4gICAgaWYgKCFjb21wYXJlUGFzc3dvcmQpIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihcIlBhc3N3b3JkIGlzIGluY29ycmVjdC5cIikpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB1c2VyO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gIH1cclxufTtcclxuXHJcbmNvbnN0IHNhdmVOZXdTZXNzaW9uID0gYXN5bmModXNlcklkLGp3dFRva2VuLHRvbW9ycm93RGF0ZSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBuZXdTZXNzaW9uID0gYXdhaXQgbmV3IFNlc3Npb25Nb2RlbCh7XHJcbiAgICAgIHVzZXJJZDp1c2VySWQsXHJcbiAgICAgIGp3dFRva2VuOmp3dFRva2VuLFxyXG4gICAgICBleHBpcmF0aW9uRGF0ZTp0b21vcnJvd0RhdGUsXHJcbiAgICAgIHVzZXJDb3VudDoxXHJcbiAgfSkuc2F2ZSgpO1xyXG4gIHJldHVybiBuZXdTZXNzaW9uXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUubG9nKCdlcnJvciBpbiBzYXZpbmcgbmV3IHNlc3Npb24nKVxyXG4gICAgY29uc29sZS5sb2coZXJyb3IpXHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgZmluZFNlc3Npb24gPSBhc3luYyhrZXkpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IFNlc3Npb25Nb2RlbC5maW5kT25lKHtrZXl9KTtcclxuICAgIHJldHVybiBzZXNzaW9uO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgdXBkYXRlU2Vzc2lvbiA9IGFzeW5jKGNvdW50LHNlc3Npb24sdXBkYXRlZERhdGUpICA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIHNlc3Npb24udXNlckNvdW50ID0gY291bnRcclxuICAgIHNlc3Npb24uZXhwaXJhdGlvbkRhdGUgPSB1cGRhdGVkRGF0ZVxyXG4gICAgY29uc3QgbmV3U2Vzc2lvbiA9IGF3YWl0IHNlc3Npb24uc2F2ZSgpXHJcbiAgICByZXR1cm4gbmV3U2Vzc2lvblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuY29uc3QgZGVsZXRlU2Vzc2lvbiA9IGFzeW5jKHNlc3Npb24pICA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKCdyZW1vdmUnKVxyXG4gICAgYXdhaXQgc2Vzc2lvbi5yZW1vdmUoKVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuXHJcbmNvbnN0IHNpZ25VcCA9IGFzeW5jICh7XHJcbiAgZmlyc3ROYW1lLFxyXG4gIG1pZGRsZU5hbWUsXHJcbiAgbGFzdE5hbWUsXHJcbiAgcGhvbmVOdW1iZXIsXHJcbiAgcGFzc3dvcmQsXHJcbn0pID0+IHtcclxuICB0cnkge1xyXG5cclxuICAgIGxldCB1c2VyID0gYXdhaXQgVXNlck1vZGVsLnBob25lTnVtYmVyRXhpc3QocGhvbmVOdW1iZXIpO1xyXG4gICAgaWYgKHVzZXIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImhlcmUgMlwiKVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoXCJQaG9uZSBOdW1iZXIgaGFzIGFscmVhZHkgYmVlbiB0YWtlbi5cIikpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHVzZXIgPSBhd2FpdCBVc2VyTW9kZWwuZW1haWxFeGlzdChlbWFpbCk7XHJcbiAgICAvLyBpZiAodXNlcikge1xyXG4gICAgLy8gICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKFwiRW1haWwgaGFzIGFscmVhZHkgYmVlbiB0YWtlbi5cIikpO1xyXG4gICAgLy8gfVxyXG4gICAgY29uc3Qgc2FsdCA9IGJjcnlwdC5nZW5TYWx0KDEwKTtcclxuICAgIGNvbnN0IGhhc2ggPSBiY3J5cHQuaGFzaFN5bmMocGFzc3dvcmQsIHNhbHQpO1xyXG5cclxuICAgIHVzZXIgPSBhd2FpdCBuZXcgVXNlck1vZGVsKHtcclxuICAgICAgZmlyc3ROYW1lLFxyXG4gICAgICBtaWRkbGVOYW1lLFxyXG4gICAgICBsYXN0TmFtZSxcclxuICAgICAgcGhvbmVOdW1iZXIsXHJcbiAgICAgIGhhc2gsXHJcbiAgICB9KS5zYXZlKCk7XHJcblxyXG4gICAgcmV0dXJuIHVzZXI7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgbG9nb3V0ID0gYXN5bmMoe3VzZXIsIGFjY2Vzc1Rva2VufSkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1c2VySWQgPSB1c2VyLl9pZFxyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGZpbmRTZXNzaW9uKHVzZXJJZClcclxuICAgIGNvbnN0IGNvdW50ID0gc2Vzc2lvbi51c2VyQ291bnRcclxuICAgIGlmIChjb3VudCA+IDEpIHtcclxuICAgICAgY291bnQgLT0gMVxyXG4gICAgICB1cGRhdGVTZXNzaW9uKGNvdW50LHNlc3Npb24sc2Vzc2lvbi5leHBpcmF0aW9uRGF0ZSlcclxuICAgIH1cclxuICAgIC8vZGVsZXRlIHNlc3Npb25cclxuICAgIGVsc2UgaWYgKGNvdW50ID09PSAxKSB7XHJcbiAgICAgIGRlbGV0ZVNlc3Npb24oc2Vzc2lvbilcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5sb2coZXJyb3IpXHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBjaGFuZ2VQYXNzd29yZCA9IGFzeW5jKHtuZXdQYXNzd29yZCwgdXNlciwgYWNjZXNzVG9rZW59KSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnNvbGUubG9nKFwic2ltIHVzZXI6IFwiLHVzZXIpXHJcbiAgICBjb25zb2xlLmxvZyhcIm5ldyBwYXNzd29yZDogXCIsbmV3UGFzc3dvcmQpXHJcbiAgICBjb25zb2xlLmxvZyhcInBhc3M6IFwiLCB1c2VyLnBhc3N3b3JkKVxyXG4gICAgY29uc3QgdXNlcnBob25lID0gdXNlci5waG9uZU51bWJlclxyXG4gICAgY29uc3QgdXNlcldpdGggPSBhd2FpdCBVc2VyTW9kZWwuZmluZE9uZSh7IHVzZXJwaG9uZSB9KTtcclxuICAgIGNvbnN0IHVzZXJJZCA9IHVzZXJXaXRoLl9pZFxyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGZpbmRTZXNzaW9uKHVzZXJJZClcclxuXHJcbiAgICB1c2VyV2l0aC5wYXNzd29yZD1uZXdQYXNzd29yZFxyXG4gICAgY29uc3QgdXBkYXRlZFVzZXIgPSBhd2FpdCB1c2VyV2l0aC5zYXZlKGZ1bmN0aW9uKGVycil7XHJcbiAgICAgIGlmKGVycilyZXR1cm4gaGFuZGxlRXJyKGVycik7XHJcbiAgICAgIC8vdXNlciBoYXMgYmVlbiB1cGRhdGVkXHJcbiAgICAgIGNvbnNvbGUubG9nKFwic3VjY2Vzc1wiKVxyXG4gICAgfSlcclxuICAgIGNvbnN0IG9sZEFjY2Vzc1RvY2tlbiA9IGFjY2Vzc1Rva2VuXHJcbiAgICAvL2RlbGV0ZSBzZXNzaW9uXHJcbiAgICBhd2FpdCBkZWxldGVTZXNzaW9uKHNlc3Npb24pXHJcbiAgICAgIHJldHVybiB7dXBkYXRlZFVzZXIsIG9sZEFjY2Vzc1RvY2tlbn07XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQge1xyXG4gIHNpZ25JbixcclxuICBzaWduVXAsXHJcbiAgc2F2ZU5ld1Nlc3Npb24sXHJcbiAgZmluZFNlc3Npb24sXHJcbiAgdXBkYXRlU2Vzc2lvbixcclxuICBsb2dvdXQsXHJcbiAgY2hhbmdlUGFzc3dvcmQsXHJcbiAgZGVsZXRlU2Vzc2lvbixcclxufTtcclxuIl19","map":{"version":3,"sources":["auth-data-access.js"],"names":["signIn","phoneNumber","password","user","UserModel","findOne","comparePassword","toString","Promise","reject","Error","error","saveNewSession","userId","jwtToken","tomorrowDate","newSession","SessionModel","expirationDate","userCount","save","console","log","findSession","key","session","updateSession","count","updatedDate","deleteSession","remove","signUp","firstName","middleName","lastName","phoneNumberExist","salt","bcrypt","genSalt","hash","hashSync","logout","accessToken","_id","changePassword","newPassword","userphone","userWith","updatedUser","err","handleErr","oldAccessTocken"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA;AAEA,MAAMA,MAAM,GAAG,OAAO;AAAEC,EAAAA,WAAF;AAAeC,EAAAA;AAAf,CAAP,KAAqC;AAClD,MAAI;AACF,UAAMC,IAAI,GAAG,MAAMC,gBAAUC,OAAV,CAAkB;AAAEJ,MAAAA;AAAF,KAAlB,CAAnB,CADE,CAGF;;AACA,UAAMK,eAAe,GAAIJ,QAAQ,CAACK,QAAT,OAAwBJ,IAAI,CAACD,QAAtD;;AACA,QAAI,CAACI,eAAL,EAAsB;AACpB,aAAOE,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,wBAAV,CAAf,CAAP;AACD;;AAED,WAAOP,IAAP;AACD,GAVD,CAUE,OAAOQ,KAAP,EAAc;AACd,WAAOH,OAAO,CAACC,MAAR,CAAeE,KAAf,CAAP;AACD;AACF,CAdD;;AAgBA,MAAMC,cAAc,GAAG,OAAMC,MAAN,EAAaC,QAAb,EAAsBC,YAAtB,KAAuC;AAC5D,MAAI;AACF,UAAMC,UAAU,GAAG,MAAM,IAAIC,qBAAJ,CAAiB;AACxCJ,MAAAA,MAAM,EAACA,MADiC;AAExCC,MAAAA,QAAQ,EAACA,QAF+B;AAGxCI,MAAAA,cAAc,EAACH,YAHyB;AAIxCI,MAAAA,SAAS,EAAC;AAJ8B,KAAjB,EAKxBC,IALwB,EAAzB;AAMF,WAAOJ,UAAP;AACC,GARD,CAQE,OAAOL,KAAP,EAAc;AACdU,IAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ;AACAD,IAAAA,OAAO,CAACC,GAAR,CAAYX,KAAZ;AACA,WAAOH,OAAO,CAACC,MAAR,CAAeE,KAAf,CAAP;AACD;AACF,CAdD;;AAgBA,MAAMY,WAAW,GAAG,MAAMC,GAAN,IAAc;AAChC,MAAI;AACF,UAAMC,OAAO,GAAG,MAAMR,sBAAaZ,OAAb,CAAqB;AAACmB,MAAAA;AAAD,KAArB,CAAtB;AACA,WAAOC,OAAP;AACD,GAHD,CAGE,OAAOd,KAAP,EAAc;AACd,WAAOH,OAAO,CAACC,MAAR,CAAeE,KAAf,CAAP;AACD;AACF,CAPD;;AASA,MAAMe,aAAa,GAAG,OAAMC,KAAN,EAAYF,OAAZ,EAAoBG,WAApB,KAAqC;AACzD,MAAI;AACFH,IAAAA,OAAO,CAACN,SAAR,GAAoBQ,KAApB;AACAF,IAAAA,OAAO,CAACP,cAAR,GAAyBU,WAAzB;AACA,UAAMZ,UAAU,GAAG,MAAMS,OAAO,CAACL,IAAR,EAAzB;AACA,WAAOJ,UAAP;AACD,GALD,CAKE,OAAOL,KAAP,EAAc;AACd,WAAOH,OAAO,CAACC,MAAR,CAAeE,KAAf,CAAP;AACD;AACF,CATD;;AAWA,MAAMkB,aAAa,GAAG,MAAMJ,OAAN,IAAmB;AACvC,MAAI;AACFJ,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACA,UAAMG,OAAO,CAACK,MAAR,EAAN;AACD,GAHD,CAGE,OAAOnB,KAAP,EAAc;AACd,WAAOH,OAAO,CAACC,MAAR,CAAeE,KAAf,CAAP;AACD;AACF,CAPD;;AAUA,MAAMoB,MAAM,GAAG,OAAO;AACpBC,EAAAA,SADoB;AAEpBC,EAAAA,UAFoB;AAGpBC,EAAAA,QAHoB;AAIpBjC,EAAAA,WAJoB;AAKpBC,EAAAA;AALoB,CAAP,KAMT;AACJ,MAAI;AAEF,QAAIC,IAAI,GAAG,MAAMC,gBAAU+B,gBAAV,CAA2BlC,WAA3B,CAAjB;;AACA,QAAIE,IAAJ,EAAU;AACNkB,MAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACA,aAAOd,OAAO,CAACC,MAAR,CAAe,IAAIC,KAAJ,CAAU,sCAAV,CAAf,CAAP;AACH,KANC,CAQF;AACA;AACA;AACA;;;AACA,UAAM0B,IAAI,GAAGC,gBAAOC,OAAP,CAAe,EAAf,CAAb;;AACA,UAAMC,IAAI,GAAGF,gBAAOG,QAAP,CAAgBtC,QAAhB,EAA0BkC,IAA1B,CAAb;;AAEAjC,IAAAA,IAAI,GAAG,MAAM,IAAIC,eAAJ,CAAc;AACzB4B,MAAAA,SADyB;AAEzBC,MAAAA,UAFyB;AAGzBC,MAAAA,QAHyB;AAIzBjC,MAAAA,WAJyB;AAKzBsC,MAAAA;AALyB,KAAd,EAMVnB,IANU,EAAb;AAQA,WAAOjB,IAAP;AACD,GAxBD,CAwBE,OAAOQ,KAAP,EAAc;AACd,WAAOH,OAAO,CAACC,MAAR,CAAeE,KAAf,CAAP;AACD;AACF,CAlCD;;AAoCA,MAAM8B,MAAM,GAAG,OAAM;AAACtC,EAAAA,IAAD;AAAOuC,EAAAA;AAAP,CAAN,KAA8B;AAC3C,MAAI;AACF,UAAM7B,MAAM,GAAGV,IAAI,CAACwC,GAApB;AACA,UAAMlB,OAAO,GAAG,MAAMF,WAAW,CAACV,MAAD,CAAjC;AACA,UAAMc,KAAK,GAAGF,OAAO,CAACN,SAAtB;;AACA,QAAIQ,KAAK,GAAG,CAAZ,EAAe;AACbA,MAAAA,KAAK,IAAI,CAAT;AACAD,MAAAA,aAAa,CAACC,KAAD,EAAOF,OAAP,EAAeA,OAAO,CAACP,cAAvB,CAAb;AACD,KAHD,CAIA;AAJA,SAKK,IAAIS,KAAK,KAAK,CAAd,EAAiB;AACpBE,MAAAA,aAAa,CAACJ,OAAD,CAAb;AACD;AACF,GAZD,CAYE,OAAOd,KAAP,EAAc;AACdU,IAAAA,OAAO,CAACC,GAAR,CAAYX,KAAZ;AACD;AACF,CAhBD;;AAkBA,MAAMiC,cAAc,GAAG,OAAM;AAACC,EAAAA,WAAD;AAAc1C,EAAAA,IAAd;AAAoBuC,EAAAA;AAApB,CAAN,KAA2C;AAChE,MAAI;AACFrB,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAAyBnB,IAAzB;AACAkB,IAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA6BuB,WAA7B;AACAxB,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBnB,IAAI,CAACD,QAA3B;AACA,UAAM4C,SAAS,GAAG3C,IAAI,CAACF,WAAvB;AACA,UAAM8C,QAAQ,GAAG,MAAM3C,gBAAUC,OAAV,CAAkB;AAAEyC,MAAAA;AAAF,KAAlB,CAAvB;AACA,UAAMjC,MAAM,GAAGkC,QAAQ,CAACJ,GAAxB;AACA,UAAMlB,OAAO,GAAG,MAAMF,WAAW,CAACV,MAAD,CAAjC;AAEAkC,IAAAA,QAAQ,CAAC7C,QAAT,GAAkB2C,WAAlB;AACA,UAAMG,WAAW,GAAG,MAAMD,QAAQ,CAAC3B,IAAT,CAAc,UAAS6B,GAAT,EAAa;AACnD,UAAGA,GAAH,EAAO,OAAOC,SAAS,CAACD,GAAD,CAAhB,CAD4C,CAEnD;;AACA5B,MAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACD,KAJyB,CAA1B;AAKA,UAAM6B,eAAe,GAAGT,WAAxB,CAfE,CAgBF;;AACA,UAAMb,aAAa,CAACJ,OAAD,CAAnB;AACE,WAAO;AAACuB,MAAAA,WAAD;AAAcG,MAAAA;AAAd,KAAP;AACH,GAnBD,CAmBE,OAAOxC,KAAP,EAAc;AACdU,IAAAA,OAAO,CAACC,GAAR,CAAYX,KAAZ;AACD;AACF,CAvBD;;eAyBe;AACbX,EAAAA,MADa;AAEb+B,EAAAA,MAFa;AAGbnB,EAAAA,cAHa;AAIbW,EAAAA,WAJa;AAKbG,EAAAA,aALa;AAMbe,EAAAA,MANa;AAObG,EAAAA,cAPa;AAQbf,EAAAA;AARa,C","sourceRoot":"E:\\haleta-new-api\\src\\services\\auth\\data-access\\","sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport { UserModel } from \"../../../models/user\";\r\nimport {SessionModel} from \"../../../models/session\";\r\nimport bcrypt from 'bcrypt';\r\n\r\n// import crypto from \"crypto\";\r\n\r\nconst signIn = async ({ phoneNumber, password }) => {\r\n  try {\r\n    const user = await UserModel.findOne({ phoneNumber });\r\n\r\n    // const comparePassword = await user.comparePassword(password.toString());\r\n    const comparePassword = (password.toString() === user.password)\r\n    if (!comparePassword) {\r\n      return Promise.reject(new Error(\"Password is incorrect.\"));\r\n    }\r\n\r\n    return user;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n\r\nconst saveNewSession = async(userId,jwtToken,tomorrowDate) => {\r\n  try {\r\n    const newSession = await new SessionModel({\r\n      userId:userId,\r\n      jwtToken:jwtToken,\r\n      expirationDate:tomorrowDate,\r\n      userCount:1\r\n  }).save();\r\n  return newSession\r\n  } catch (error) {\r\n    console.log('error in saving new session')\r\n    console.log(error)\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst findSession = async(key) => {\r\n  try {\r\n    const session = await SessionModel.findOne({key});\r\n    return session;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst updateSession = async(count,session,updatedDate)  => {\r\n  try {\r\n    session.userCount = count\r\n    session.expirationDate = updatedDate\r\n    const newSession = await session.save()\r\n    return newSession\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\nconst deleteSession = async(session)  => {\r\n  try {\r\n    console.log('remove')\r\n    await session.remove()\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n}\r\n\r\n\r\nconst signUp = async ({\r\n  firstName,\r\n  middleName,\r\n  lastName,\r\n  phoneNumber,\r\n  password,\r\n}) => {\r\n  try {\r\n\r\n    let user = await UserModel.phoneNumberExist(phoneNumber);\r\n    if (user) {\r\n        console.log(\"here 2\")\r\n        return Promise.reject(new Error(\"Phone Number has already been taken.\"));\r\n    }\r\n\r\n    // user = await UserModel.emailExist(email);\r\n    // if (user) {\r\n    //   return Promise.reject(new Error(\"Email has already been taken.\"));\r\n    // }\r\n    const salt = bcrypt.genSalt(10);\r\n    const hash = bcrypt.hashSync(password, salt);\r\n\r\n    user = await new UserModel({\r\n      firstName,\r\n      middleName,\r\n      lastName,\r\n      phoneNumber,\r\n      hash,\r\n    }).save();\r\n\r\n    return user;\r\n  } catch (error) {\r\n    return Promise.reject(error);\r\n  }\r\n};\r\n\r\nconst logout = async({user, accessToken}) => {\r\n  try {\r\n    const userId = user._id\r\n    const session = await findSession(userId)\r\n    const count = session.userCount\r\n    if (count > 1) {\r\n      count -= 1\r\n      updateSession(count,session,session.expirationDate)\r\n    }\r\n    //delete session\r\n    else if (count === 1) {\r\n      deleteSession(session)\r\n    }\r\n  } catch (error) {\r\n    console.log(error)\r\n  }\r\n}\r\n\r\nconst changePassword = async({newPassword, user, accessToken}) => {\r\n  try {\r\n    console.log(\"sim user: \",user)\r\n    console.log(\"new password: \",newPassword)\r\n    console.log(\"pass: \", user.password)\r\n    const userphone = user.phoneNumber\r\n    const userWith = await UserModel.findOne({ userphone });\r\n    const userId = userWith._id\r\n    const session = await findSession(userId)\r\n\r\n    userWith.password=newPassword\r\n    const updatedUser = await userWith.save(function(err){\r\n      if(err)return handleErr(err);\r\n      //user has been updated\r\n      console.log(\"success\")\r\n    })\r\n    const oldAccessTocken = accessToken\r\n    //delete session\r\n    await deleteSession(session)\r\n      return {updatedUser, oldAccessTocken};\r\n  } catch (error) {\r\n    console.log(error)\r\n  }\r\n}\r\n\r\nexport default {\r\n  signIn,\r\n  signUp,\r\n  saveNewSession,\r\n  findSession,\r\n  updateSession,\r\n  logout,\r\n  changePassword,\r\n  deleteSession,\r\n};\r\n"]}},"mtime":1648793176316},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\redis-config.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _ioredis = _interopRequireDefault(require(\"ioredis\"));\n\nvar _winston = _interopRequireDefault(require(\"winston\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst client = new _ioredis.default({\n  host: process.env.REDIS_HOST,\n  port: process.env.REDIS_PORT //REDIS_PORT=6379\n\n});\nclient.on(\"error\", error => {\n  console.log('ðŸ˜’');\n  console.log(error);\n\n  _winston.default.error(error);\n\n  client.quit().then(e => console.log(e));\n});\nclient.on(\"connect\", () => _winston.default.info(\"Redis client connected\"));\nvar _default = client;\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZGlzLWNvbmZpZy5qcyJdLCJuYW1lcyI6WyJjbGllbnQiLCJSZWRpcyIsImhvc3QiLCJwcm9jZXNzIiwiZW52IiwiUkVESVNfSE9TVCIsInBvcnQiLCJSRURJU19QT1JUIiwib24iLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJ3aW5zdG9uIiwicXVpdCIsInRoZW4iLCJlIiwiaW5mbyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHLElBQUlDLGdCQUFKLENBQVU7QUFDdkJDLEVBQUFBLElBQUksRUFBRUMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBREs7QUFFdkJDLEVBQUFBLElBQUksRUFBRUgsT0FBTyxDQUFDQyxHQUFSLENBQVlHLFVBRkssQ0FFTzs7QUFGUCxDQUFWLENBQWY7QUFLQVAsTUFBTSxDQUFDUSxFQUFQLENBQVUsT0FBVixFQUFvQkMsS0FBRCxJQUFXO0FBQzVCQyxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxJQUFaO0FBQ0FELEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixLQUFaOztBQUNBRyxtQkFBUUgsS0FBUixDQUFjQSxLQUFkOztBQUNBVCxFQUFBQSxNQUFNLENBQUNhLElBQVAsR0FBY0MsSUFBZCxDQUFvQkMsQ0FBRCxJQUFPTCxPQUFPLENBQUNDLEdBQVIsQ0FBWUksQ0FBWixDQUExQjtBQUNELENBTEQ7QUFPQWYsTUFBTSxDQUFDUSxFQUFQLENBQVUsU0FBVixFQUFxQixNQUFNSSxpQkFBUUksSUFBUixDQUFhLHdCQUFiLENBQTNCO2VBRWVoQixNIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxjb25maWdcXCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWRpcyBmcm9tIFwiaW9yZWRpc1wiO1xyXG5pbXBvcnQgd2luc3RvbiBmcm9tIFwid2luc3RvblwiO1xyXG5cclxuY29uc3QgY2xpZW50ID0gbmV3IFJlZGlzKHtcclxuICBob3N0OiBwcm9jZXNzLmVudi5SRURJU19IT1NULFxyXG4gIHBvcnQ6IHByb2Nlc3MuZW52LlJFRElTX1BPUlQsIC8vUkVESVNfUE9SVD02Mzc5XHJcbn0pO1xyXG5cclxuY2xpZW50Lm9uKFwiZXJyb3JcIiwgKGVycm9yKSA9PiB7XHJcbiAgY29uc29sZS5sb2coJ/CfmJInKVxyXG4gIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gIHdpbnN0b24uZXJyb3IoZXJyb3IpO1xyXG4gIGNsaWVudC5xdWl0KCkudGhlbigoZSkgPT4gY29uc29sZS5sb2coZSkpO1xyXG59KTtcclxuXHJcbmNsaWVudC5vbihcImNvbm5lY3RcIiwgKCkgPT4gd2luc3Rvbi5pbmZvKFwiUmVkaXMgY2xpZW50IGNvbm5lY3RlZFwiKSk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnQ7XHJcbiJdfQ==","map":{"version":3,"sources":["redis-config.js"],"names":["client","Redis","host","process","env","REDIS_HOST","port","REDIS_PORT","on","error","console","log","winston","quit","then","e","info"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,MAAM,GAAG,IAAIC,gBAAJ,CAAU;AACvBC,EAAAA,IAAI,EAAEC,OAAO,CAACC,GAAR,CAAYC,UADK;AAEvBC,EAAAA,IAAI,EAAEH,OAAO,CAACC,GAAR,CAAYG,UAFK,CAEO;;AAFP,CAAV,CAAf;AAKAP,MAAM,CAACQ,EAAP,CAAU,OAAV,EAAoBC,KAAD,IAAW;AAC5BC,EAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACAD,EAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;;AACAG,mBAAQH,KAAR,CAAcA,KAAd;;AACAT,EAAAA,MAAM,CAACa,IAAP,GAAcC,IAAd,CAAoBC,CAAD,IAAOL,OAAO,CAACC,GAAR,CAAYI,CAAZ,CAA1B;AACD,CALD;AAOAf,MAAM,CAACQ,EAAP,CAAU,SAAV,EAAqB,MAAMI,iBAAQI,IAAR,CAAa,wBAAb,CAA3B;eAEehB,M","sourceRoot":"E:\\haleta-new-api\\src\\config\\","sourcesContent":["import Redis from \"ioredis\";\r\nimport winston from \"winston\";\r\n\r\nconst client = new Redis({\r\n  host: process.env.REDIS_HOST,\r\n  port: process.env.REDIS_PORT, //REDIS_PORT=6379\r\n});\r\n\r\nclient.on(\"error\", (error) => {\r\n  console.log('ðŸ˜’')\r\n  console.log(error)\r\n  winston.error(error);\r\n  client.quit().then((e) => console.log(e));\r\n});\r\n\r\nclient.on(\"connect\", () => winston.info(\"Redis client connected\"));\r\n\r\nexport default client;\r\n"]}},"mtime":1648685190379},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\redis\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\services\\\\redis\\\\redis-services.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _redisConfig = _interopRequireDefault(require(\"../../config/redis-config\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//add to redis\n//delete single token data(token string)\nconst updateSession = async accessToken => {\n  console.log('deleting session redis');\n  let userSession;\n  await _redisConfig.default.get(accessToken, (err, sessionData) => {\n    if (sessionData) {\n      console.log('here');\n      userSession = sessionData;\n      console.log(sessionData);\n    } else if (err) {\n      console.log('errrr');\n      console.log(err);\n    }\n  });\n  console.log(accessToken);\n  console.log(userSession);\n  userSession = JSON.parse(userSession);\n  console.log(userSession);\n  console.log(userSession.userCount);\n  const count = userSession.userCount;\n\n  if (count > 1) {\n    userSession.count -= 1;\n    syncWithRedis(_redisConfig.default, accessToken, userSession);\n  } //delete session\n  else if (count === 1) {\n    console.log('deleting from redis');\n\n    _redisConfig.default.del(accessToken);\n  }\n};\n\nconst deleteSessionCompletely = async accessToken => {\n  console.log('deleting session redis');\n  let userSession;\n  await _redisConfig.default.get(accessToken, (err, sessionData) => {\n    if (sessionData) {\n      console.log('here');\n      userSession = sessionData;\n      console.log(sessionData);\n    } else if (err) {\n      console.log('errrr');\n      console.log(err);\n    }\n  });\n  console.log(accessToken);\n  console.log(userSession);\n  userSession = JSON.parse(userSession);\n  console.log(userSession);\n  console.log(userSession.userCount);\n  const count = userSession.userCount;\n  console.log('deleting from redis');\n\n  _redisConfig.default.del(accessToken);\n}; //update single token data\n\n\nconst storeNewSession = async (accessToken, session) => {\n  //fetch from mongodb\n  //update the whole cache\n  console.log(accessToken);\n  console.log('in sync wi redis', session);\n\n  _redisConfig.default.set(accessToken, JSON.stringify(session), (err, reply) => {\n    if (err) {\n      console.log(err.message);\n      console.log('errrr');\n      return Promise.reject(err);\n    }\n\n    console.log('resolving');\n    return Promise.resolve(session);\n  });\n};\n\nconst checkValueInRedis = async accessToken => {\n  console.log('cheking session redis');\n  let userSession;\n  const value = await _redisConfig.default.get(accessToken, (err, sessionData) => {\n    if (sessionData) {\n      console.log('here');\n      userSession = sessionData;\n      console.log(sessionData);\n    } else if (err) {\n      console.log('errrr');\n      console.log(err);\n    }\n  });\n  console.log(accessToken);\n  console.log(userSession);\n  userSession = JSON.parse(userSession);\n  console.log(userSession);\n  console.log(userSession.userCount);\n  return userSession;\n};\n\nvar _default = {\n  storeNewSession,\n  updateSession,\n  deleteSessionCompletely,\n  checkValueInRedis\n};\nexports.default = _default;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZGlzLXNlcnZpY2VzLmpzIl0sIm5hbWVzIjpbInVwZGF0ZVNlc3Npb24iLCJhY2Nlc3NUb2tlbiIsImNvbnNvbGUiLCJsb2ciLCJ1c2VyU2Vzc2lvbiIsImNsaWVudCIsImdldCIsImVyciIsInNlc3Npb25EYXRhIiwiSlNPTiIsInBhcnNlIiwidXNlckNvdW50IiwiY291bnQiLCJzeW5jV2l0aFJlZGlzIiwiZGVsIiwiZGVsZXRlU2Vzc2lvbkNvbXBsZXRlbHkiLCJzdG9yZU5ld1Nlc3Npb24iLCJzZXNzaW9uIiwic2V0Iiwic3RyaW5naWZ5IiwicmVwbHkiLCJtZXNzYWdlIiwiUHJvbWlzZSIsInJlamVjdCIsInJlc29sdmUiLCJjaGVja1ZhbHVlSW5SZWRpcyIsInZhbHVlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7QUFFQTtBQUVBO0FBQ0EsTUFBTUEsYUFBYSxHQUFHLE1BQU9DLFdBQVAsSUFBdUI7QUFDekNDLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHdCQUFaO0FBQ0EsTUFBSUMsV0FBSjtBQUNBLFFBQU1DLHFCQUFPQyxHQUFQLENBQVdMLFdBQVgsRUFBd0IsQ0FBQ00sR0FBRCxFQUFLQyxXQUFMLEtBQXFCO0FBQy9DLFFBQUlBLFdBQUosRUFBaUI7QUFDYk4sTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksTUFBWjtBQUNBQyxNQUFBQSxXQUFXLEdBQUdJLFdBQWQ7QUFDQU4sTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlLLFdBQVo7QUFDSCxLQUpELE1BS0ssSUFBSUQsR0FBSixFQUFRO0FBQ1RMLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLE9BQVo7QUFDQUQsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlJLEdBQVo7QUFDSDtBQUNKLEdBVkssQ0FBTjtBQVdBTCxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUYsV0FBWjtBQUNBQyxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsV0FBWjtBQUNBQSxFQUFBQSxX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QUFDQyxHQUFSLENBQVksdUJBQVo7QUFDQSxNQUFJQyxXQUFKO0FBQ0EsUUFBTXNCLEtBQUssR0FBRyxNQUFNckIscUJBQU9DLEdBQVAsQ0FBV0wsV0FBWCxFQUF3QixDQUFDTSxHQUFELEVBQUtDLFdBQUwsS0FBcUI7QUFDN0QsUUFBSUEsV0FBSixFQUFpQjtBQUNiTixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxNQUFaO0FBQ0FDLE1BQUFBLFdBQVcsR0FBR0ksV0FBZDtBQUNBTixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUssV0FBWjtBQUNILEtBSkQsTUFLSyxJQUFJRCxHQUFKLEVBQVE7QUFDVEwsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksT0FBWjtBQUNBRCxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUksR0FBWjtBQUNIO0FBQ0osR0FWbUIsQ0FBcEI7QUFXQUwsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlGLFdBQVo7QUFDQUMsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFdBQVo7QUFDQUEsRUFBQUEsV0FBVyxHQUFHSyxJQUFJLENBQUNDLEtBQUwsQ0FBV04sV0FBWCxDQUFkO0FBQ0FGLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxXQUFaO0FBQ0FGLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxXQUFXLENBQUNPLFNBQXhCO0FBQ0EsU0FBT1AsV0FBUDtBQUNILENBcEJEOztlQXNCZTtBQUNYWSxFQUFBQSxlQURXO0FBRVhoQixFQUFBQSxhQUZXO0FBR1hlLEVBQUFBLHVCQUhXO0FBSVhVLEVBQUFBO0FBSlcsQyIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcc2VydmljZXNcXHJlZGlzXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2xpZW50IGZyb20gXCIuLi8uLi9jb25maWcvcmVkaXMtY29uZmlnXCI7XHJcblxyXG4vL2FkZCB0byByZWRpc1xyXG5cclxuLy9kZWxldGUgc2luZ2xlIHRva2VuIGRhdGEodG9rZW4gc3RyaW5nKVxyXG5jb25zdCB1cGRhdGVTZXNzaW9uID0gYXN5bmMgKGFjY2Vzc1Rva2VuKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZygnZGVsZXRpbmcgc2Vzc2lvbiByZWRpcycpXHJcbiAgICBsZXQgdXNlclNlc3Npb247XHJcbiAgICBhd2FpdCBjbGllbnQuZ2V0KGFjY2Vzc1Rva2VuLCAoZXJyLHNlc3Npb25EYXRhKSA9PiB7XHJcbiAgICAgICAgaWYgKHNlc3Npb25EYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdoZXJlJylcclxuICAgICAgICAgICAgdXNlclNlc3Npb24gPSBzZXNzaW9uRGF0YVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzZXNzaW9uRGF0YSlcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZXJyKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycnJyJylcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICBjb25zb2xlLmxvZyhhY2Nlc3NUb2tlbilcclxuICAgIGNvbnNvbGUubG9nKHVzZXJTZXNzaW9uKVxyXG4gICAgdXNlclNlc3Npb24gPSBKU09OLnBhcnNlKHVzZXJTZXNzaW9uKVxyXG4gICAgY29uc29sZS5sb2codXNlclNlc3Npb24pXHJcbiAgICBjb25zb2xlLmxvZyh1c2VyU2Vzc2lvbi51c2VyQ291bnQpXHJcbiAgICBjb25zdCBjb3VudCA9IHVzZXJTZXNzaW9uLnVzZXJDb3VudFxyXG4gICAgaWYgKGNvdW50ID4gMSkge1xyXG4gICAgICAgIHVzZXJTZXNzaW9uLmNvdW50IC09IDFcclxuICAgICAgICBzeW5jV2l0aFJlZGlzKGNsaWVudCxhY2Nlc3NUb2tlbix1c2VyU2Vzc2lvbilcclxuICAgICAgfVxyXG4gICAgICAvL2RlbGV0ZSBzZXNzaW9uXHJcbiAgICAgIGVsc2UgaWYgKGNvdW50ID09PSAxKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0aW5nIGZyb20gcmVkaXMnKVxyXG4gICAgICAgIGNsaWVudC5kZWwoYWNjZXNzVG9rZW4pXHJcbiAgICAgIH1cclxufVxyXG5cclxuY29uc3QgZGVsZXRlU2Vzc2lvbkNvbXBsZXRlbHk9IGFzeW5jIChhY2Nlc3NUb2tlbikgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ2RlbGV0aW5nIHNlc3Npb24gcmVkaXMnKVxyXG4gICAgbGV0IHVzZXJTZXNzaW9uO1xyXG4gICAgYXdhaXQgY2xpZW50LmdldChhY2Nlc3NUb2tlbiwgKGVycixzZXNzaW9uRGF0YSkgPT4ge1xyXG4gICAgICAgIGlmIChzZXNzaW9uRGF0YSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaGVyZScpXHJcbiAgICAgICAgICAgIHVzZXJTZXNzaW9uID0gc2Vzc2lvbkRhdGFcclxuICAgICAgICAgICAgY29uc29sZS5sb2coc2Vzc2lvbkRhdGEpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGVycil7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJycicpXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gICAgY29uc29sZS5sb2coYWNjZXNzVG9rZW4pXHJcbiAgICBjb25zb2xlLmxvZyh1c2VyU2Vzc2lvbilcclxuICAgIHVzZXJTZXNzaW9uID0gSlNPTi5wYXJzZSh1c2VyU2Vzc2lvbilcclxuICAgIGNvbnNvbGUubG9nKHVzZXJTZXNzaW9uKVxyXG4gICAgY29uc29sZS5sb2codXNlclNlc3Npb24udXNlckNvdW50KVxyXG4gICAgY29uc3QgY291bnQgPSB1c2VyU2Vzc2lvbi51c2VyQ291bnRcclxuICAgIFxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGluZyBmcm9tIHJlZGlzJylcclxuICAgICAgICBjbGllbnQuZGVsKGFjY2Vzc1Rva2VuKVxyXG4gICAgICBcclxufVxyXG5cclxuLy91cGRhdGUgc2luZ2xlIHRva2VuIGRhdGFcclxuY29uc3Qgc3RvcmVOZXdTZXNzaW9uID0gYXN5bmMgIChhY2Nlc3NUb2tlbixzZXNzaW9uKSA9PiB7XHJcbiAgICAvL2ZldGNoIGZyb20gbW9uZ29kYlxyXG4gICAgLy91cGRhdGUgdGhlIHdob2xlIGNhY2hlXHJcbiAgICBjb25zb2xlLmxvZyhhY2Nlc3NUb2tlbilcclxuICAgIGNvbnNvbGUubG9nKCdpbiBzeW5jIHdpIHJlZGlzJyxzZXNzaW9uKVxyXG4gICAgY2xpZW50LnNldChhY2Nlc3NUb2tlbixKU09OLnN0cmluZ2lmeShzZXNzaW9uKSwoZXJyLHJlcGx5KSA9PiB7XHJcbiAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIubWVzc2FnZSlcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycnJyJylcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycilcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3Jlc29sdmluZycpXHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzZXNzaW9uKVxyXG4gICAgfSlcclxufVxyXG5cclxuY29uc3QgY2hlY2tWYWx1ZUluUmVkaXMgPSBhc3luYyAoYWNjZXNzVG9rZW4pID0+IHtcclxuICAgIGNvbnNvbGUubG9nKCdjaGVraW5nIHNlc3Npb24gcmVkaXMnKVxyXG4gICAgbGV0IHVzZXJTZXNzaW9uO1xyXG4gICAgY29uc3QgdmFsdWUgPSBhd2FpdCBjbGllbnQuZ2V0KGFjY2Vzc1Rva2VuLCAoZXJyLHNlc3Npb25EYXRhKSA9PiB7XHJcbiAgICAgICAgaWYgKHNlc3Npb25EYXRhKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdoZXJlJylcclxuICAgICAgICAgICAgdXNlclNlc3Npb24gPSBzZXNzaW9uRGF0YVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzZXNzaW9uRGF0YSlcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZXJyKXtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2VycnJyJylcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbiAgICBjb25zb2xlLmxvZyhhY2Nlc3NUb2tlbilcclxuICAgIGNvbnNvbGUubG9nKHVzZXJTZXNzaW9uKVxyXG4gICAgdXNlclNlc3Npb24gPSBKU09OLnBhcnNlKHVzZXJTZXNzaW9uKVxyXG4gICAgY29uc29sZS5sb2codXNlclNlc3Npb24pXHJcbiAgICBjb25zb2xlLmxvZyh1c2VyU2Vzc2lvbi51c2VyQ291bnQpXHJcbiAgICByZXR1cm4gdXNlclNlc3Npb247XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICAgIHN0b3JlTmV3U2Vzc2lvbixcclxuICAgIHVwZGF0ZVNlc3Npb24sXHJcbiAgICBkZWxldGVTZXNzaW9uQ29tcGxldGVseSxcclxuICAgIGNoZWNrVmFsdWVJblJlZGlzLFxyXG59Il19","map":{"version":3,"sources":["redis-services.js"],"names":["updateSession","accessToken","console","log","userSession","client","get","err","sessionData","JSON","parse","userCount","count","syncWithRedis","del","deleteSessionCompletely","storeNewSession","session","set","stringify","reply","message","Promise","reject","resolve","checkValueInRedis","value"],"mappings":"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","sourceRoot":"E:\\haleta-new-api\\src\\services\\redis\\","sourcesContent":["import client from \"../../config/redis-config\";\r\n\r\n//add to redis\r\n\r\n//delete single token data(token string)\r\nconst updateSession = async (accessToken) => {\r\n    console.log('deleting session redis')\r\n    let userSession;\r\n    await client.get(accessToken, (err,sessionData) => {\r\n        if (sessionData) {\r\n            console.log('here')\r\n            userSession = sessionData\r\n            console.log(sessionData)\r\n        }\r\n        else if (err){\r\n            console.log('errrr')\r\n            console.log(err)\r\n        }\r\n    })\r\n    console.log(accessToken)\r\n    console.log(userSession)\r\n    userSession = JSON.parse(userSession)\r\n    console.log(userSession)\r\n    console.log(userSession.userCount)\r\n    const count = userSession.userCount\r\n    if (count > 1) {\r\n        userSession.count -= 1\r\n        syncWithRedis(client,accessToken,userSession)\r\n      }\r\n      //delete session\r\n      else if (count === 1) {\r\n        console.log('deleting from redis')\r\n        client.del(accessToken)\r\n      }\r\n}\r\n\r\nconst deleteSessionCompletely= async (accessToken) => {\r\n    console.log('deleting session redis')\r\n    let userSession;\r\n    await client.get(accessToken, (err,sessionData) => {\r\n        if (sessionData) {\r\n            console.log('here')\r\n            userSession = sessionData\r\n            console.log(sessionData)\r\n        }\r\n        else if (err){\r\n            console.log('errrr')\r\n            console.log(err)\r\n        }\r\n    })\r\n    console.log(accessToken)\r\n    console.log(userSession)\r\n    userSession = JSON.parse(userSession)\r\n    console.log(userSession)\r\n    console.log(userSession.userCount)\r\n    const count = userSession.userCount\r\n    \r\n        console.log('deleting from redis')\r\n        client.del(accessToken)\r\n      \r\n}\r\n\r\n//update single token data\r\nconst storeNewSession = async  (accessToken,session) => {\r\n    //fetch from mongodb\r\n    //update the whole cache\r\n    console.log(accessToken)\r\n    console.log('in sync wi redis',session)\r\n    client.set(accessToken,JSON.stringify(session),(err,reply) => {\r\n        if (err) {\r\n            console.log(err.message)\r\n            console.log('errrr')\r\n            return Promise.reject(err)\r\n        }\r\n        console.log('resolving')\r\n        return Promise.resolve(session)\r\n    })\r\n}\r\n\r\nconst checkValueInRedis = async (accessToken) => {\r\n    console.log('cheking session redis')\r\n    let userSession;\r\n    const value = await client.get(accessToken, (err,sessionData) => {\r\n        if (sessionData) {\r\n            console.log('here')\r\n            userSession = sessionData\r\n            console.log(sessionData)\r\n        }\r\n        else if (err){\r\n            console.log('errrr')\r\n            console.log(err)\r\n        }\r\n    })\r\n    console.log(accessToken)\r\n    console.log(userSession)\r\n    userSession = JSON.parse(userSession)\r\n    console.log(userSession)\r\n    console.log(userSession.userCount)\r\n    return userSession;\r\n}\r\n\r\nexport default {\r\n    storeNewSession,\r\n    updateSession,\r\n    deleteSessionCompletely,\r\n    checkValueInRedis,\r\n}"]}},"mtime":1648792331940},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\typedefs\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\auth\\\\typedefs\\\\types.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nvar _graphqlCompose = require(\"graphql-compose\");\n\nvar _user = require(\"../../../models/user\");\n\n_graphqlCompose.schemaComposer.createObjectTC({\n  name: \"AccessToken\",\n  fields: {\n    accessToken: \"String!\",\n    user: _user.UserTC\n  }\n});\n\n_graphqlCompose.schemaComposer.createObjectTC({\n  name: \"Succeed\",\n  fields: {\n    succeed: \"Boolean!\"\n  }\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInR5cGVzLmpzIl0sIm5hbWVzIjpbInNjaGVtYUNvbXBvc2VyIiwiY3JlYXRlT2JqZWN0VEMiLCJuYW1lIiwiZmllbGRzIiwiYWNjZXNzVG9rZW4iLCJ1c2VyIiwiVXNlclRDIiwic3VjY2VlZCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQTs7QUFFQUEsK0JBQWVDLGNBQWYsQ0FBOEI7QUFDMUJDLEVBQUFBLElBQUksRUFBRSxhQURvQjtBQUUxQkMsRUFBQUEsTUFBTSxFQUFFO0FBQ0pDLElBQUFBLFdBQVcsRUFBRSxTQURUO0FBRUpDLElBQUFBLElBQUksRUFBRUM7QUFGRjtBQUZrQixDQUE5Qjs7QUFRQU4sK0JBQWVDLGNBQWYsQ0FBOEI7QUFDMUJDLEVBQUFBLElBQUksRUFBRSxTQURvQjtBQUUxQkMsRUFBQUEsTUFBTSxFQUFFO0FBQUNJLElBQUFBLE9BQU8sRUFBRTtBQUFWO0FBRmtCLENBQTlCIiwic291cmNlUm9vdCI6IkU6XFxoYWxldGEtbmV3LWFwaVxcc3JjXFxncmFwaHFsXFxhdXRoXFx0eXBlZGVmc1xcIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtzY2hlbWFDb21wb3Nlcn0gZnJvbSBcImdyYXBocWwtY29tcG9zZVwiO1xyXG5pbXBvcnQge1VzZXJUQ30gZnJvbSBcIi4uLy4uLy4uL21vZGVscy91c2VyXCI7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5jcmVhdGVPYmplY3RUQyh7XHJcbiAgICBuYW1lOiBcIkFjY2Vzc1Rva2VuXCIsXHJcbiAgICBmaWVsZHM6IHtcclxuICAgICAgICBhY2Nlc3NUb2tlbjogXCJTdHJpbmchXCIsXHJcbiAgICAgICAgdXNlcjogVXNlclRDLFxyXG4gICAgfSxcclxufSk7XHJcblxyXG5zY2hlbWFDb21wb3Nlci5jcmVhdGVPYmplY3RUQyh7XHJcbiAgICBuYW1lOiBcIlN1Y2NlZWRcIixcclxuICAgIGZpZWxkczoge3N1Y2NlZWQ6IFwiQm9vbGVhbiFcIn0sXHJcbn0pOyJdfQ==","map":{"version":3,"sources":["types.js"],"names":["schemaComposer","createObjectTC","name","fields","accessToken","user","UserTC","succeed"],"mappings":";;AAAA;;AACA;;AAEAA,+BAAeC,cAAf,CAA8B;AAC1BC,EAAAA,IAAI,EAAE,aADoB;AAE1BC,EAAAA,MAAM,EAAE;AACJC,IAAAA,WAAW,EAAE,SADT;AAEJC,IAAAA,IAAI,EAAEC;AAFF;AAFkB,CAA9B;;AAQAN,+BAAeC,cAAf,CAA8B;AAC1BC,EAAAA,IAAI,EAAE,SADoB;AAE1BC,EAAAA,MAAM,EAAE;AAACI,IAAAA,OAAO,EAAE;AAAV;AAFkB,CAA9B","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\auth\\typedefs\\","sourcesContent":["import {schemaComposer} from \"graphql-compose\";\r\nimport {UserTC} from \"../../../models/user\";\r\n\r\nschemaComposer.createObjectTC({\r\n    name: \"AccessToken\",\r\n    fields: {\r\n        accessToken: \"String!\",\r\n        user: UserTC,\r\n    },\r\n});\r\n\r\nschemaComposer.createObjectTC({\r\n    name: \"Succeed\",\r\n    fields: {succeed: \"Boolean!\"},\r\n});"]}},"mtime":1648684433887},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\user\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\graphql\\\\user\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.UserQuery = exports.UserMutation = void 0;\n\nvar _user = require(\"../../models/user\");\n\nvar _middlewares = require(\"../../middlewares\");\n\n// import Resolvers from \"./use-cases\";\n//\n// for (const resolver in Resolvers) {\n//     UserTC.addResolver(Resolvers[resolver]);\n// }\nconst UserQuery = {\n  userById: _user.UserTC.getResolver(\"findById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userByIds: _user.UserTC.getResolver(\"findByIds\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userOne: _user.UserTC.getResolver(\"findOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userMany: _user.UserTC.getResolver(\"findMany\", [_middlewares.authentication.isAuth, _middlewares.authorization])\n};\nexports.UserQuery = UserQuery;\nconst UserMutation = {\n  userCreateOne: _user.UserTC.getResolver(\"createOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userCreateMany: _user.UserTC.getResolver(\"createMany\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateById: _user.UserTC.getResolver(\"updateById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateOne: _user.UserTC.getResolver(\"updateOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userUpdateMany: _user.UserTC.getResolver(\"updateMany\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveById: _user.UserTC.getResolver(\"removeById\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveOne: _user.UserTC.getResolver(\"removeOne\", [_middlewares.authentication.isAuth, _middlewares.authorization]),\n  userRemoveMany: _user.UserTC.getResolver(\"removeMany\", [_middlewares.authentication.isAuth, _middlewares.authorization])\n};\nexports.UserMutation = UserMutation;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIlVzZXJRdWVyeSIsInVzZXJCeUlkIiwiVXNlclRDIiwiZ2V0UmVzb2x2ZXIiLCJhdXRoZW50aWNhdGlvbiIsImlzQXV0aCIsImF1dGhvcml6YXRpb24iLCJ1c2VyQnlJZHMiLCJ1c2VyT25lIiwidXNlck1hbnkiLCJVc2VyTXV0YXRpb24iLCJ1c2VyQ3JlYXRlT25lIiwidXNlckNyZWF0ZU1hbnkiLCJ1c2VyVXBkYXRlQnlJZCIsInVzZXJVcGRhdGVPbmUiLCJ1c2VyVXBkYXRlTWFueSIsInVzZXJSZW1vdmVCeUlkIiwidXNlclJlbW92ZU9uZSIsInVzZXJSZW1vdmVNYW55Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLE1BQU1BLFNBQVMsR0FBRztBQUNkQyxFQUFBQSxRQUFRLEVBQUVDLGFBQU9DLFdBQVAsQ0FBbUIsVUFBbkIsRUFBK0IsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBL0IsQ0FESTtBQUVkQyxFQUFBQSxTQUFTLEVBQUVMLGFBQU9DLFdBQVAsQ0FBbUIsV0FBbkIsRUFBZ0MsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBaEMsQ0FGRztBQUdkRSxFQUFBQSxPQUFPLEVBQUVOLGFBQU9DLFdBQVAsQ0FBbUIsU0FBbkIsRUFBOEIsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBOUIsQ0FISztBQUlkRyxFQUFBQSxRQUFRLEVBQUVQLGFBQU9DLFdBQVAsQ0FBbUIsVUFBbkIsRUFBK0IsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBL0I7QUFKSSxDQUFsQjs7QUFPQSxNQUFNSSxZQUFZLEdBQUc7QUFDakJDLEVBQUFBLGFBQWEsRUFBRVQsYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQURFO0FBRWpCTSxFQUFBQSxjQUFjLEVBQUVWLGFBQU9DLFdBQVAsQ0FBbUIsWUFBbkIsRUFBaUMsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBakMsQ0FGQztBQUdqQk8sRUFBQUEsY0FBYyxFQUFFWCxhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDLENBSEM7QUFJakJRLEVBQUFBLGFBQWEsRUFBRVosYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQUpFO0FBS2pCUyxFQUFBQSxjQUFjLEVBQUViLGFBQU9DLFdBQVAsQ0FBbUIsWUFBbkIsRUFBaUMsQ0FBQ0MsNEJBQWVDLE1BQWhCLEVBQXdCQywwQkFBeEIsQ0FBakMsQ0FMQztBQU1qQlUsRUFBQUEsY0FBYyxFQUFFZCxhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDLENBTkM7QUFPakJXLEVBQUFBLGFBQWEsRUFBRWYsYUFBT0MsV0FBUCxDQUFtQixXQUFuQixFQUFnQyxDQUFDQyw0QkFBZUMsTUFBaEIsRUFBd0JDLDBCQUF4QixDQUFoQyxDQVBFO0FBUWpCWSxFQUFBQSxjQUFjLEVBQUVoQixhQUFPQyxXQUFQLENBQW1CLFlBQW5CLEVBQWlDLENBQUNDLDRCQUFlQyxNQUFoQixFQUF3QkMsMEJBQXhCLENBQWpDO0FBUkMsQ0FBckIiLCJzb3VyY2VSb290IjoiRTpcXGhhbGV0YS1uZXctYXBpXFxzcmNcXGdyYXBocWxcXHVzZXJcXCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7VXNlclRDfSBmcm9tIFwiLi4vLi4vbW9kZWxzL3VzZXJcIjtcclxuXHJcbmltcG9ydCB7YXV0aGVudGljYXRpb24sIGF1dGhvcml6YXRpb259IGZyb20gXCIuLi8uLi9taWRkbGV3YXJlc1wiO1xyXG4vLyBpbXBvcnQgUmVzb2x2ZXJzIGZyb20gXCIuL3VzZS1jYXNlc1wiO1xyXG4vL1xyXG4vLyBmb3IgKGNvbnN0IHJlc29sdmVyIGluIFJlc29sdmVycykge1xyXG4vLyAgICAgVXNlclRDLmFkZFJlc29sdmVyKFJlc29sdmVyc1tyZXNvbHZlcl0pO1xyXG4vLyB9XHJcblxyXG5jb25zdCBVc2VyUXVlcnkgPSB7XHJcbiAgICB1c2VyQnlJZDogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZEJ5SWRcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlckJ5SWRzOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJmaW5kQnlJZHNcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlck9uZTogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZE9uZVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyTWFueTogVXNlclRDLmdldFJlc29sdmVyKFwiZmluZE1hbnlcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG59O1xyXG5cclxuY29uc3QgVXNlck11dGF0aW9uID0ge1xyXG4gICAgdXNlckNyZWF0ZU9uZTogVXNlclRDLmdldFJlc29sdmVyKFwiY3JlYXRlT25lXCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJDcmVhdGVNYW55OiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJjcmVhdGVNYW55XCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJVcGRhdGVCeUlkOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJ1cGRhdGVCeUlkXCIsIFthdXRoZW50aWNhdGlvbi5pc0F1dGgsIGF1dGhvcml6YXRpb25dKSxcclxuICAgIHVzZXJVcGRhdGVPbmU6IFVzZXJUQy5nZXRSZXNvbHZlcihcInVwZGF0ZU9uZVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyVXBkYXRlTWFueTogVXNlclRDLmdldFJlc29sdmVyKFwidXBkYXRlTWFueVwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyUmVtb3ZlQnlJZDogVXNlclRDLmdldFJlc29sdmVyKFwicmVtb3ZlQnlJZFwiLCBbYXV0aGVudGljYXRpb24uaXNBdXRoLCBhdXRob3JpemF0aW9uXSksXHJcbiAgICB1c2VyUmVtb3ZlT25lOiBVc2VyVEMuZ2V0UmVzb2x2ZXIoXCJyZW1vdmVPbmVcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG4gICAgdXNlclJlbW92ZU1hbnk6IFVzZXJUQy5nZXRSZXNvbHZlcihcInJlbW92ZU1hbnlcIiwgW2F1dGhlbnRpY2F0aW9uLmlzQXV0aCwgYXV0aG9yaXphdGlvbl0pLFxyXG59O1xyXG5cclxuZXhwb3J0IHtVc2VyUXVlcnksIFVzZXJNdXRhdGlvbn07XHJcbiJdfQ==","map":{"version":3,"sources":["index.js"],"names":["UserQuery","userById","UserTC","getResolver","authentication","isAuth","authorization","userByIds","userOne","userMany","UserMutation","userCreateOne","userCreateMany","userUpdateById","userUpdateOne","userUpdateMany","userRemoveById","userRemoveOne","userRemoveMany"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;AACA;AACA;AACA;AACA;AAEA,MAAMA,SAAS,GAAG;AACdC,EAAAA,QAAQ,EAAEC,aAAOC,WAAP,CAAmB,UAAnB,EAA+B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA/B,CADI;AAEdC,EAAAA,SAAS,EAAEL,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAFG;AAGdE,EAAAA,OAAO,EAAEN,aAAOC,WAAP,CAAmB,SAAnB,EAA8B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA9B,CAHK;AAIdG,EAAAA,QAAQ,EAAEP,aAAOC,WAAP,CAAmB,UAAnB,EAA+B,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAA/B;AAJI,CAAlB;;AAOA,MAAMI,YAAY,GAAG;AACjBC,EAAAA,aAAa,EAAET,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CADE;AAEjBM,EAAAA,cAAc,EAAEV,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CAFC;AAGjBO,EAAAA,cAAc,EAAEX,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CAHC;AAIjBQ,EAAAA,aAAa,EAAEZ,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAJE;AAKjBS,EAAAA,cAAc,EAAEb,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CALC;AAMjBU,EAAAA,cAAc,EAAEd,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC,CANC;AAOjBW,EAAAA,aAAa,EAAEf,aAAOC,WAAP,CAAmB,WAAnB,EAAgC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAhC,CAPE;AAQjBY,EAAAA,cAAc,EAAEhB,aAAOC,WAAP,CAAmB,YAAnB,EAAiC,CAACC,4BAAeC,MAAhB,EAAwBC,0BAAxB,CAAjC;AARC,CAArB","sourceRoot":"E:\\haleta-new-api\\src\\graphql\\user\\","sourcesContent":["import {UserTC} from \"../../models/user\";\r\n\r\nimport {authentication, authorization} from \"../../middlewares\";\r\n// import Resolvers from \"./use-cases\";\r\n//\r\n// for (const resolver in Resolvers) {\r\n//     UserTC.addResolver(Resolvers[resolver]);\r\n// }\r\n\r\nconst UserQuery = {\r\n    userById: UserTC.getResolver(\"findById\", [authentication.isAuth, authorization]),\r\n    userByIds: UserTC.getResolver(\"findByIds\", [authentication.isAuth, authorization]),\r\n    userOne: UserTC.getResolver(\"findOne\", [authentication.isAuth, authorization]),\r\n    userMany: UserTC.getResolver(\"findMany\", [authentication.isAuth, authorization]),\r\n};\r\n\r\nconst UserMutation = {\r\n    userCreateOne: UserTC.getResolver(\"createOne\", [authentication.isAuth, authorization]),\r\n    userCreateMany: UserTC.getResolver(\"createMany\", [authentication.isAuth, authorization]),\r\n    userUpdateById: UserTC.getResolver(\"updateById\", [authentication.isAuth, authorization]),\r\n    userUpdateOne: UserTC.getResolver(\"updateOne\", [authentication.isAuth, authorization]),\r\n    userUpdateMany: UserTC.getResolver(\"updateMany\", [authentication.isAuth, authorization]),\r\n    userRemoveById: UserTC.getResolver(\"removeById\", [authentication.isAuth, authorization]),\r\n    userRemoveOne: UserTC.getResolver(\"removeOne\", [authentication.isAuth, authorization]),\r\n    userRemoveMany: UserTC.getResolver(\"removeMany\", [authentication.isAuth, authorization]),\r\n};\r\n\r\nexport {UserQuery, UserMutation};\r\n"]}},"mtime":1648684433888},"{\"assumptions\":{},\"sourceRoot\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"E:\\\\haleta-new-api\",\"filename\":\"E:\\\\haleta-new-api\\\\src\\\\config\\\\mongodb-config.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"E:\\\\haleta-new-api\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"proposal-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"proposal-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{},\"externalDependencies\":[]},{\"key\":\"syntax-class-static-block\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-private-property-in-object\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-class-properties\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.17.8:development":{"value":{"code":"\"use strict\";\n\nvar _mongoose = _interopRequireDefault(require(\"mongoose\"));\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n_dotenv.default.config();\n\nmain().then(() => console.log(\"Mongoose connected\")).catch(err => console.log(err));\n\nasync function main() {\n  await _mongoose.default.connect(process.env.MONGODB_URI);\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vbmdvZGItY29uZmlnLmpzIl0sIm5hbWVzIjpbImRvdGVudiIsImNvbmZpZyIsIm1haW4iLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwibW9uZ29vc2UiLCJjb25uZWN0IiwicHJvY2VzcyIsImVudiIsIk1PTkdPREJfVVJJIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOzs7O0FBRUFBLGdCQUFPQyxNQUFQOztBQUVBQyxJQUFJLEdBQ0NDLElBREwsQ0FDVSxNQUFNQyxPQUFPLENBQUNDLEdBQVIsQ0FBWSxvQkFBWixDQURoQixFQUVLQyxLQUZMLENBRVdDLEdBQUcsSUFBSUgsT0FBTyxDQUFDQyxHQUFSLENBQVlFLEdBQVosQ0FGbEI7O0FBSUEsZUFBZUwsSUFBZixHQUFzQjtBQUNsQixRQUFNTSxrQkFBU0MsT0FBVCxDQUFpQkMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFdBQTdCLENBQU47QUFDSCIsInNvdXJjZVJvb3QiOiJFOlxcaGFsZXRhLW5ldy1hcGlcXHNyY1xcY29uZmlnXFwiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XHJcbmltcG9ydCBkb3RlbnYgZnJvbSBcImRvdGVudlwiO1xyXG5cclxuZG90ZW52LmNvbmZpZygpO1xyXG5cclxubWFpbigpXHJcbiAgICAudGhlbigoKSA9PiBjb25zb2xlLmxvZyhcIk1vbmdvb3NlIGNvbm5lY3RlZFwiKSlcclxuICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcblxyXG5hc3luYyBmdW5jdGlvbiBtYWluKCkge1xyXG4gICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdChwcm9jZXNzLmVudi5NT05HT0RCX1VSSSk7XHJcbn0iXX0=","map":{"version":3,"sources":["mongodb-config.js"],"names":["dotenv","config","main","then","console","log","catch","err","mongoose","connect","process","env","MONGODB_URI"],"mappings":";;AAAA;;AACA;;;;AAEAA,gBAAOC,MAAP;;AAEAC,IAAI,GACCC,IADL,CACU,MAAMC,OAAO,CAACC,GAAR,CAAY,oBAAZ,CADhB,EAEKC,KAFL,CAEWC,GAAG,IAAIH,OAAO,CAACC,GAAR,CAAYE,GAAZ,CAFlB;;AAIA,eAAeL,IAAf,GAAsB;AAClB,QAAMM,kBAASC,OAAT,CAAiBC,OAAO,CAACC,GAAR,CAAYC,WAA7B,CAAN;AACH","sourceRoot":"E:\\haleta-new-api\\src\\config\\","sourcesContent":["import mongoose from \"mongoose\";\r\nimport dotenv from \"dotenv\";\r\n\r\ndotenv.config();\r\n\r\nmain()\r\n    .then(() => console.log(\"Mongoose connected\"))\r\n    .catch(err => console.log(err));\r\n\r\nasync function main() {\r\n    await mongoose.connect(process.env.MONGODB_URI);\r\n}"]}},"mtime":1648684433884}}